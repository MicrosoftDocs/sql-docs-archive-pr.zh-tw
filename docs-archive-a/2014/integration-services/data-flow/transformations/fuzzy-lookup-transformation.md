---
title: 模糊查閱轉換 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.dts.designer.fuzzylookuptrans.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- temporary tables [Integration Services]
- Fuzzy Lookup transformation
- reference tables [Integration Services]
- match similar data [Integration Services]
- replacing missing values
- correcting data [Integration Services]
- cache [Integration Services]
- standardizing data [Integration Services]
- lookups [Integration Services]
- confidence scores [Integration Services]
- fuzzy matches
- missing values replaced [Integration Services]
- similarity thresholds [Integration Services]
ms.assetid: 019db426-3de2-4ca9-8667-79fd9a47a068
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 742a87e7425fd65b8af7bcda87c237151d382f77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87597239"
---
# <a name="fuzzy-lookup-transformation"></a><span data-ttu-id="95e8a-102">模糊查閱轉換</span><span class="sxs-lookup"><span data-stu-id="95e8a-102">Fuzzy Lookup Transformation</span></span>
  <span data-ttu-id="95e8a-103">「模糊查閱」轉換會執行資料清除工作，例如標準化資料、更正資料及提供遺漏值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-103">The Fuzzy Lookup transformation performs data cleaning tasks such as standardizing data, correcting data, and providing missing values.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="95e8a-104">如需模糊查閱轉換 (包括效能和記憶體限制) 的詳細資訊，請參閱 [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604)(SQL Server Integration Services 2005 中的模糊查閱和模糊群組) 白皮書。</span><span class="sxs-lookup"><span data-stu-id="95e8a-104">For more detailed information about the Fuzzy Lookup transformation, including performance and memory limitations, see the white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span></span>  
  
 <span data-ttu-id="95e8a-105">「模糊查詢」轉換與「查閱」轉換的不同之處在於其使用模糊比對。</span><span class="sxs-lookup"><span data-stu-id="95e8a-105">The Fuzzy Lookup transformation differs from the Lookup transformation in its use of fuzzy matching.</span></span> <span data-ttu-id="95e8a-106">「查閱」轉換使用等聯結 (Equi-Join)，在參考資料表中尋找相符的資料錄。</span><span class="sxs-lookup"><span data-stu-id="95e8a-106">The Lookup transformation uses an equi-join to locate matching records in the reference table.</span></span> <span data-ttu-id="95e8a-107">它會傳回至少有一項相符資料錄的資料錄，以及傳回沒有任何相符資料錄的資料錄。</span><span class="sxs-lookup"><span data-stu-id="95e8a-107">It returns records with at least one matching record, and returns records with no matching records.</span></span> <span data-ttu-id="95e8a-108">相反地，「模糊查閱」轉換會使用模糊比對，傳回參考資料表中的一個或多個相近相符項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-108">In contrast, the Fuzzy Lookup transformation uses fuzzy matching to return one or more close matches in the reference table.</span></span>  
  
 <span data-ttu-id="95e8a-109">在封裝資料流程中，「模糊查閱」轉換經常在「查閱」轉換後發生。</span><span class="sxs-lookup"><span data-stu-id="95e8a-109">A Fuzzy Lookup transformation frequently follows a Lookup transformation in a package data flow.</span></span> <span data-ttu-id="95e8a-110">首先，「查閱」轉換會嘗試尋找完全相符項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-110">First, the Lookup transformation tries to find an exact match.</span></span> <span data-ttu-id="95e8a-111">如果找不到，「模糊查閱」轉換會提供參考資料表中的相近相符項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-111">If it fails, the Fuzzy Lookup transformation provides close matches from the reference table.</span></span>  
  
 <span data-ttu-id="95e8a-112">轉換需要存取包含用於清除和擴充輸入資料之值的參考資料來源。</span><span class="sxs-lookup"><span data-stu-id="95e8a-112">The transformation needs access to a reference data source that contains the values that are used to clean and extend the input data.</span></span> <span data-ttu-id="95e8a-113">參考資料來源必須是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫中的資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-113">The reference data source must be a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="95e8a-114">輸入資料行中的值與參考資料表中的值之間的比對可能是完全相符或模糊相符。</span><span class="sxs-lookup"><span data-stu-id="95e8a-114">The match between the value in an input column and the value in the reference table can be an exact match or a fuzzy match.</span></span> <span data-ttu-id="95e8a-115">不過，轉換至少需要一個資料行相符，才能設定進行模糊比對。</span><span class="sxs-lookup"><span data-stu-id="95e8a-115">However, the transformation requires at least one column match to be configured for fuzzy matching.</span></span> <span data-ttu-id="95e8a-116">如果只想要使用完全比對，請改為使用「查閱」轉換。</span><span class="sxs-lookup"><span data-stu-id="95e8a-116">If you want to use only exact matching, use the Lookup transformation instead.</span></span>  
  
 <span data-ttu-id="95e8a-117">此轉換有一個輸入和一個輸出。</span><span class="sxs-lookup"><span data-stu-id="95e8a-117">This transformation has one input and one output.</span></span>  
  
 <span data-ttu-id="95e8a-118">只有具有 `DT_WSTR` 和 `DT_STR` 資料類型的輸入資料行可用於模糊比對。</span><span class="sxs-lookup"><span data-stu-id="95e8a-118">Only input columns with the `DT_WSTR` and `DT_STR` data types can be used in fuzzy matching.</span></span> <span data-ttu-id="95e8a-119">完全比對可使用任何 DTS 資料類型，但 `DT_TEXT`、`DT_NTEXT` 和 `DT_IMAGE` 除外。</span><span class="sxs-lookup"><span data-stu-id="95e8a-119">Exact matching can use any DTS data type except `DT_TEXT`, `DT_NTEXT`, and `DT_IMAGE`.</span></span> <span data-ttu-id="95e8a-120">如需詳細資訊，請參閱 [Integration Services 資料類型](../integration-services-data-types.md)。</span><span class="sxs-lookup"><span data-stu-id="95e8a-120">For more information, see [Integration Services Data Types](../integration-services-data-types.md).</span></span> <span data-ttu-id="95e8a-121">參與輸入與參考資料表之間聯結的資料行必須具有相容的資料類型。</span><span class="sxs-lookup"><span data-stu-id="95e8a-121">Columns that participate in the join between the input and the reference table must have compatible data types.</span></span> <span data-ttu-id="95e8a-122">例如，將具有 DTS 資料類型的資料行聯結 `DT_WSTR` 到具有資料類型的資料行是有效的， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` 但將具有資料類型的資料行聯結 `DT_WSTR` 到具有 `int` 資料類型的資料行則是不正確。</span><span class="sxs-lookup"><span data-stu-id="95e8a-122">For example, it is valid to join a column with the DTS `DT_WSTR` data type to a column with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` data type, but invalid to join a column with the `DT_WSTR` data type to a column with the `int` data type.</span></span>  
  
 <span data-ttu-id="95e8a-123">您可以指定最大記憶體數量、資料列比較演算法，以及轉換使用的索引和參考資料表快取，以自訂此轉換。</span><span class="sxs-lookup"><span data-stu-id="95e8a-123">You can customize this transformation by specifying the maximum amount of memory, the row comparison algorithm, and the caching of indexes and reference tables that the transformation uses.</span></span>  
  
 <span data-ttu-id="95e8a-124">您可以透過設定 MaxMemoryUsage 自訂屬性來設定模糊查閱轉換所使用的記憶體數量。</span><span class="sxs-lookup"><span data-stu-id="95e8a-124">The amount of memory that the Fuzzy Lookup transformation uses can be configured by setting the MaxMemoryUsage custom property.</span></span> <span data-ttu-id="95e8a-125">您可以指定百萬位元組 (MB) 數，或是使用 0 值，讓轉換依據其需求與可用實體記憶體，使用動態的記憶體數量。</span><span class="sxs-lookup"><span data-stu-id="95e8a-125">You can specify the number of megabytes (MB), or use the value 0, which lets the transformation use a dynamic amount of memory based on its needs and the physical memory available.</span></span> <span data-ttu-id="95e8a-126">屬性運算式可以在載入封裝時更新 MaxMemoryUsage 自訂屬性。</span><span class="sxs-lookup"><span data-stu-id="95e8a-126">The MaxMemoryUsage custom property can be updated by a property expression when the package is loaded.</span></span> <span data-ttu-id="95e8a-127">如需詳細資訊，請參閱 [Integration Services &#40;SSIS&#41; 運算式](../../expressions/integration-services-ssis-expressions.md)、[在封裝中使用屬性運算式](../../expressions/use-property-expressions-in-packages.md)和[轉換自訂屬性](transformation-custom-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="95e8a-127">For more information, see [Integration Services &#40;SSIS&#41; Expressions](../../expressions/integration-services-ssis-expressions.md), [Use Property Expressions in Packages](../../expressions/use-property-expressions-in-packages.md), and [Transformation Custom Properties](transformation-custom-properties.md).</span></span>  
  
## <a name="controlling-fuzzy-matching-behavior"></a><span data-ttu-id="95e8a-128">控制模糊比對行為</span><span class="sxs-lookup"><span data-stu-id="95e8a-128">Controlling Fuzzy Matching Behavior</span></span>  
 <span data-ttu-id="95e8a-129">「模糊查閱」轉換包含三種用於自訂其所執行之查閱的功能：每個輸入資料列傳回的相符項目上限、Token 分隔符號，以及相似度臨界值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-129">The Fuzzy Lookup transformation includes three features for customizing the lookup it performs: maximum number of matches to return per input row, token delimiters, and similarity thresholds.</span></span>  
  
 <span data-ttu-id="95e8a-130">轉換會傳回零或多個相符項目，最多可傳回指定的相符項目數。</span><span class="sxs-lookup"><span data-stu-id="95e8a-130">The transformation returns zero or more matches up to the number of matches specified.</span></span> <span data-ttu-id="95e8a-131">指定相符項目上限並不會保證轉換傳回最大數目的相符項目，而只會保證轉換最多傳回該數目的相符項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-131">Specifying a maximum number of matches does not guarantee that the transformation returns the maximum number of matches; it only guarantees that the transformation returns at most that number of matches.</span></span> <span data-ttu-id="95e8a-132">如果您將相符項目上限設為大於 1 的值，則每個查閱的轉換輸出可能會包含一個以上的資料列，且部分資料列可能是重複的。</span><span class="sxs-lookup"><span data-stu-id="95e8a-132">If you set the maximum number of matches to a value greater than 1, the output of the transformation may include more than one row per lookup and some of the rows may be duplicates.</span></span>  
  
 <span data-ttu-id="95e8a-133">轉換會提供用於 Token 化資料的預設分隔符號集，但您可以加入 Token 分隔符號，以符合資料的需要。</span><span class="sxs-lookup"><span data-stu-id="95e8a-133">The transformation provides a default set of delimiters used to tokenize the data, but you can add token delimiters to suit the needs of your data.</span></span> <span data-ttu-id="95e8a-134">Delimiters 屬性包含預設分隔符號。</span><span class="sxs-lookup"><span data-stu-id="95e8a-134">The Delimiters property contains the default delimiters.</span></span> <span data-ttu-id="95e8a-135">Token 化是十分重要的，這是因為它會定義資料內相互比較的單位。</span><span class="sxs-lookup"><span data-stu-id="95e8a-135">Tokenization is important because it defines the units within the data that are compared to each other.</span></span>  
  
 <span data-ttu-id="95e8a-136">相似度臨界值可在元件和聯結層級進行設定。</span><span class="sxs-lookup"><span data-stu-id="95e8a-136">The similarity thresholds can be set at the component and join levels.</span></span> <span data-ttu-id="95e8a-137">僅當轉換在輸入和參考資料表中的資料行之間執行模糊比對時，聯結層級相似度臨界值才可用。</span><span class="sxs-lookup"><span data-stu-id="95e8a-137">The join-level similarity threshold is only available when the transformation performs a fuzzy match between columns in the input and the reference table.</span></span> <span data-ttu-id="95e8a-138">相似度範圍是從 0 到 1。</span><span class="sxs-lookup"><span data-stu-id="95e8a-138">The similarity range is 0 to 1.</span></span> <span data-ttu-id="95e8a-139">臨界值愈接近 1，資料列和資料行就愈近似於重複項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-139">The closer to 1 the threshold is, the more similar the rows and columns must be to qualify as duplicates.</span></span> <span data-ttu-id="95e8a-140">透過在元件和聯結層級設定 MinSimilarity 屬性，可以指定相似度臨界值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-140">You specify the similarity threshold by setting the MinSimilarity property at the component and join levels.</span></span> <span data-ttu-id="95e8a-141">為滿足在元件層級指定的相似度，所有資料列之所有相符項目的相似度都必須大於或等於在元件層級指定的相似度臨界值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-141">To satisfy the similarity that is specified at the component level, all rows must have a similarity across all matches that is greater than or equal to the similarity threshold that is specified at the component level.</span></span> <span data-ttu-id="95e8a-142">也就是說，您無法在元件層級指定非常相近的相符，除非資料列或聯結層級的相符具有相同的相似度。</span><span class="sxs-lookup"><span data-stu-id="95e8a-142">That is, you cannot specify a very close match at the component level unless the matches at the row or join level are equally close.</span></span>  
  
 <span data-ttu-id="95e8a-143">每個相符都包括相似度分數和信心分數。</span><span class="sxs-lookup"><span data-stu-id="95e8a-143">Each match includes a similarity score and a confidence score.</span></span> <span data-ttu-id="95e8a-144">相似度分數是輸入資料錄與「模糊查閱」轉換從參考資料表傳回之資料錄之間文字相似度的數學量值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-144">The similarity score is a mathematical measure of the textural similarity between the input record and the record that Fuzzy Lookup transformation returns from the reference table.</span></span> <span data-ttu-id="95e8a-145">信心分數是指特定值在參考資料表眾多相符項目中為最相符項目之可能性的量值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-145">The confidence score is a measure of how likely it is that a particular value is the best match among the matches found in the reference table.</span></span> <span data-ttu-id="95e8a-146">指派給資料錄的信心分數會視傳回的其他相符資料錄而定。</span><span class="sxs-lookup"><span data-stu-id="95e8a-146">The confidence score assigned to a record depends on the other matching records that are returned.</span></span> <span data-ttu-id="95e8a-147">例如，比對 *St.* 與 *Saint* 會傳回較低的相似度分數，無論其他相符項目為何。</span><span class="sxs-lookup"><span data-stu-id="95e8a-147">For example, matching *St.* and *Saint* returns a low similarity score regardless of other matches.</span></span> <span data-ttu-id="95e8a-148">如果 *Saint* 是傳回的唯一相符項目，則信心分數會很高。</span><span class="sxs-lookup"><span data-stu-id="95e8a-148">If *Saint* is the only match returned, the confidence score is high.</span></span> <span data-ttu-id="95e8a-149">如果 *Saint* 和 *St.* 都在參考資料表中，則 *St.* 的信心較高，而 *Saint* 的信心較低。</span><span class="sxs-lookup"><span data-stu-id="95e8a-149">If both *Saint* and *St.* appear in the reference table, the confidence in *St.* is high and the confidence in *Saint* is low.</span></span> <span data-ttu-id="95e8a-150">不過，高相似度可能並不意味著高信心。</span><span class="sxs-lookup"><span data-stu-id="95e8a-150">However, high similarity may not mean high confidence.</span></span> <span data-ttu-id="95e8a-151">例如，如果您是在查閱值 *Chapter 4*，則所傳回的結果 *Chapter 1*、 *Chapter 2*和 *Chapter 3* 都會具有很高的相似度分數，但信心分數卻都較低，原因是並不清楚結果中的哪一個項目是最相符的項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-151">For example, if you are looking up the value *Chapter 4*, the returned results *Chapter 1*, *Chapter 2*, and *Chapter 3* have a high similarity score but a low confidence score because it is unclear which of the results is the best match.</span></span>  
  
 <span data-ttu-id="95e8a-152">相似度分數由介於 0 與 1 之間的十進位值表示，其中相似度分數 1 表示輸入資料行中的值與參考資料表中的值之間完全相符。</span><span class="sxs-lookup"><span data-stu-id="95e8a-152">The similarity score is represented by a decimal value between 0 and 1, where a similarity score of 1 means an exact match between the value in the input column and the value in the reference table.</span></span> <span data-ttu-id="95e8a-153">信心分數也是介於 0 與 1 之間的十進位值，它表示對相符的信心。</span><span class="sxs-lookup"><span data-stu-id="95e8a-153">The confidence score, also a decimal value between 0 and 1, indicates the confidence in the match.</span></span> <span data-ttu-id="95e8a-154">如果找不到可用的相符項目，則會將相似度和信心分數 0 指派給資料列，且從參考資料表複製的輸出資料行將包含 Null 值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-154">If no usable match is found, similarity and confidence scores of 0 are assigned to the row, and the output columns copied from the reference table will contain null values.</span></span>  
  
 <span data-ttu-id="95e8a-155">有時，「模糊查閱」在參考資料表中可能找不到適當的相符項目。</span><span class="sxs-lookup"><span data-stu-id="95e8a-155">Sometimes, Fuzzy Lookup may not locate appropriate matches in the reference table.</span></span> <span data-ttu-id="95e8a-156">如果查閱中使用的輸入值是單一短字，則可能會發生這種狀況。</span><span class="sxs-lookup"><span data-stu-id="95e8a-156">This can occur if the input value that is used in a lookup is a single, short word.</span></span> <span data-ttu-id="95e8a-157">例如，如果該資料行或資料列的任何其他資料行中沒有其他 Token，則 *helo* 與參考資料表中的值 *hello* 不相符。</span><span class="sxs-lookup"><span data-stu-id="95e8a-157">For example, *helo* is not matched with the value *hello* in a reference table when no other tokens are present in that column or any other column in the row.</span></span>  
  
 <span data-ttu-id="95e8a-158">轉換輸出資料行包括標示為傳遞資料行的輸入資料行、在查閱資料表中選取的資料行，以及下列其他資料行：</span><span class="sxs-lookup"><span data-stu-id="95e8a-158">The transformation output columns include the input columns that are marked as pass-through columns, the selected columns in the lookup table, and the following additional columns:</span></span>  
  
-   <span data-ttu-id="95e8a-159">**_Similarity**，描述輸入與參考資料行中值之間相似度的資料行。</span><span class="sxs-lookup"><span data-stu-id="95e8a-159">**_Similarity**, a column that describes the similarity between values in the input and reference columns.</span></span>  
  
-   <span data-ttu-id="95e8a-160">**_Confidence**，描述相符品質的資料行。</span><span class="sxs-lookup"><span data-stu-id="95e8a-160">**_Confidence**, a column that describes the quality of the match.</span></span>  
  
 <span data-ttu-id="95e8a-161">轉換會使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫連接，以建立模糊比對演算法所使用的暫存資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-161">The transformation uses the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database to create the temporary tables that the fuzzy matching algorithm uses.</span></span>  
  
## <a name="running-the-fuzzy-lookup-transformation"></a><span data-ttu-id="95e8a-162">執行模糊查閱轉換</span><span class="sxs-lookup"><span data-stu-id="95e8a-162">Running the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="95e8a-163">當封裝首次執行轉換時，轉換會複製參考資料表、將具有整數資料類型的索引鍵加入新資料表，並在索引鍵資料行上建立索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-163">When the package first runs the transformation, the transformation copies the reference table, adds a key with an integer data type to the new table, and builds an index on the key column.</span></span> <span data-ttu-id="95e8a-164">接著，轉換會在參考資料表的副本上建立索引，稱為相符索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-164">Next, the transformation builds an index, called a match index, on the copy of the reference table.</span></span> <span data-ttu-id="95e8a-165">相符索引會將值的 Token 化結果儲存在轉換輸入資料行中，轉換接著會在查閱作業中使用該 Token。</span><span class="sxs-lookup"><span data-stu-id="95e8a-165">The match index stores the results of tokenizing the values in the transformation input columns, and the transformation then uses the tokens in the lookup operation.</span></span> <span data-ttu-id="95e8a-166">相符索引是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫中的資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-166">The match index is a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>  
  
 <span data-ttu-id="95e8a-167">當封裝再次執行時，轉換可使用現有的相符索引，也可建立新索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-167">When the package runs again, the transformation can either use an existing match index or create a new index.</span></span> <span data-ttu-id="95e8a-168">如果參考資料表是靜態的，則封裝可以避免發生費時的程序，以便為資料清除的重複工作階段重建索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-168">If the reference table is static, the package can avoid the potentially expensive process of rebuilding the index for repeat sessions of data cleaning.</span></span> <span data-ttu-id="95e8a-169">如果選擇使用現有的索引，則該索引是在封裝首次執行時建立的。</span><span class="sxs-lookup"><span data-stu-id="95e8a-169">If you choose to use an existing index, the index is created the first time that the package runs.</span></span> <span data-ttu-id="95e8a-170">如果多個「模糊查閱」轉換使用相同的參考資料表，則它們都可使用同一索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-170">If multiple Fuzzy Lookup transformations use the same reference table, they can all use the same index.</span></span> <span data-ttu-id="95e8a-171">若要重複使用索引，查閱作業必須是相同的，且查閱必須使用相同的資料行。</span><span class="sxs-lookup"><span data-stu-id="95e8a-171">To reuse the index, the lookup operations must be identical; the lookup must use the same columns.</span></span> <span data-ttu-id="95e8a-172">您可以命名索引，並選取儲存索引之 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫的連接。</span><span class="sxs-lookup"><span data-stu-id="95e8a-172">You can name the index and select the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that saves the index.</span></span>  
  
 <span data-ttu-id="95e8a-173">如果轉換儲存相符索引，則該相符索引可自動維護。</span><span class="sxs-lookup"><span data-stu-id="95e8a-173">If the transformation saves the match index, the match index can be maintained automatically.</span></span> <span data-ttu-id="95e8a-174">這表示每次更新參考資料表中的資料錄時，也會更新相符索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-174">This means that every time a record in the reference table is updated, the match index is also updated.</span></span> <span data-ttu-id="95e8a-175">維護相符索引可節約處理時間，因為封裝執行時無需重建索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-175">Maintaining the match index can save processing time, because the index does not have to be rebuilt when the package runs.</span></span> <span data-ttu-id="95e8a-176">您可以指定轉換如何管理相符索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-176">You can specify how the transformation manages the match index.</span></span>  
  
 <span data-ttu-id="95e8a-177">下表描述相符索引選項。</span><span class="sxs-lookup"><span data-stu-id="95e8a-177">The following table describes the match index options.</span></span>  
  
|<span data-ttu-id="95e8a-178">選項</span><span class="sxs-lookup"><span data-stu-id="95e8a-178">Option</span></span>|<span data-ttu-id="95e8a-179">描述</span><span class="sxs-lookup"><span data-stu-id="95e8a-179">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="95e8a-180">**GenerateAndMaintainNewIndex**</span><span class="sxs-lookup"><span data-stu-id="95e8a-180">**GenerateAndMaintainNewIndex**</span></span>|<span data-ttu-id="95e8a-181">建立、儲存並維護新索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-181">Create a new index, save it, and maintain it.</span></span> <span data-ttu-id="95e8a-182">轉換會在參考資料表上安裝觸發程序，以讓參考資料表與索引資料表同步。</span><span class="sxs-lookup"><span data-stu-id="95e8a-182">The transformation installs triggers on the reference table to keep the reference table and index table synchronized.</span></span>|  
|<span data-ttu-id="95e8a-183">**GenerateAndPersistNewIndex**</span><span class="sxs-lookup"><span data-stu-id="95e8a-183">**GenerateAndPersistNewIndex**</span></span>|<span data-ttu-id="95e8a-184">建立並儲存新索引，但不對其進行維護。</span><span class="sxs-lookup"><span data-stu-id="95e8a-184">Create a new index and save it, but do not maintain it.</span></span>|  
|<span data-ttu-id="95e8a-185">**GenerateNewIndex**</span><span class="sxs-lookup"><span data-stu-id="95e8a-185">**GenerateNewIndex**</span></span>|<span data-ttu-id="95e8a-186">建立新索引，但不對其進行儲存。</span><span class="sxs-lookup"><span data-stu-id="95e8a-186">Create a new index, but do not save it.</span></span>|  
|<span data-ttu-id="95e8a-187">**ReuseExistingIndex**</span><span class="sxs-lookup"><span data-stu-id="95e8a-187">**ReuseExistingIndex**</span></span>|<span data-ttu-id="95e8a-188">重複使用現有的索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-188">Reuse an existing index.</span></span>|  
  
### <a name="maintenance-of-the-match-index-table"></a><span data-ttu-id="95e8a-189">相符索引資料表的維護</span><span class="sxs-lookup"><span data-stu-id="95e8a-189">Maintenance of the Match Index Table</span></span>  
 <span data-ttu-id="95e8a-190">**GenerateAndMaintainNewIndex** 選項會在參考資料表上安裝觸發程序，讓相符索引資料表與參考資料表同步。</span><span class="sxs-lookup"><span data-stu-id="95e8a-190">The **GenerateAndMaintainNewIndex** option installs triggers on the reference table to keep the match index table and the reference table synchronized.</span></span> <span data-ttu-id="95e8a-191">如果您必須移除已安裝的觸發程序，則必須執行 **sp_FuzzyLookupTableMaintenanceUnInstall** 預存程序，並提供 MatchIndexName 屬性中指定的名稱作為輸入參數值。</span><span class="sxs-lookup"><span data-stu-id="95e8a-191">If you have to remove the installed trigger, you must run the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure, and provide the name specified in the MatchIndexName property as the input parameter value.</span></span>  
  
 <span data-ttu-id="95e8a-192">在執行 **sp_FuzzyLookupTableMaintenanceUnInstall** 預存程序之前，您不應刪除所維護的相符索引資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-192">You should not delete the maintained match index table before running the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure.</span></span> <span data-ttu-id="95e8a-193">一旦刪除相符索引資料表，參考資料表上的觸發程序就無法再正確執行。</span><span class="sxs-lookup"><span data-stu-id="95e8a-193">If the match index table is deleted, the triggers on the reference table will not execute correctly.</span></span> <span data-ttu-id="95e8a-194">參考資料表的所有後續更新都將失敗，直到您手動卸除參考資料表上的觸發程序為止。</span><span class="sxs-lookup"><span data-stu-id="95e8a-194">All subsequent updates to the reference table will fail until you manually drop the triggers on the reference table.</span></span>  
  
 <span data-ttu-id="95e8a-195">SQL TRUNCATE TABLE 命令不會叫用 DELETE 觸發程序。</span><span class="sxs-lookup"><span data-stu-id="95e8a-195">The SQL TRUNCATE TABLE command does not invoke DELETE triggers.</span></span> <span data-ttu-id="95e8a-196">如果在參考資料表上使用 TRUNCATE TABLE 命令，則參考資料表和相符索引將不再同步，且「模糊查閱」轉換會失敗。</span><span class="sxs-lookup"><span data-stu-id="95e8a-196">If the TRUNCATE TABLE command is used on the reference table, the reference table and the match index will no longer be synchronized and the Fuzzy Lookup transformation fails.</span></span> <span data-ttu-id="95e8a-197">在參考資料表上安裝維護相符索引資料表的觸發程序時，您應該使用 SQL DELETE 命令，而不是 TRUNCATE TABLE 命令。</span><span class="sxs-lookup"><span data-stu-id="95e8a-197">While the triggers that maintain the match index table are installed on the reference table, you should use the SQL DELETE command instead of the TRUNCATE TABLE command.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="95e8a-198">當您在 **[模糊查閱轉換編輯器]** 的 **[參考資料表]** 索引標籤上選取 **[維護儲存的索引]** 時，轉換會使用具名預存程序來維護索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-198">When you select **Maintain stored index** on the **Reference Table** tab of the **Fuzzy Lookup Transformation Editor**, the transformation uses managed stored procedures to maintain the index.</span></span> <span data-ttu-id="95e8a-199">這些 Managed 預存程序會使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]中的 Common Language Runtime (CLR) 整合功能。</span><span class="sxs-lookup"><span data-stu-id="95e8a-199">These managed stored procedures use the common language runtime (CLR) integration feature in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="95e8a-200">根據預設，不會啟用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 中的 CLR 整合功能。</span><span class="sxs-lookup"><span data-stu-id="95e8a-200">By default, CLR integration in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled.</span></span> <span data-ttu-id="95e8a-201">若要使用 **[維護儲存的索引]** 功能，您必須啟用 CLR 整合。</span><span class="sxs-lookup"><span data-stu-id="95e8a-201">To use the **Maintain stored index** functionality, you must enable CLR integration.</span></span> <span data-ttu-id="95e8a-202">如需詳細資訊，請參閱 [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md)。</span><span class="sxs-lookup"><span data-stu-id="95e8a-202">For more information, see [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span></span>  
>   
>  <span data-ttu-id="95e8a-203">因為 **[維護儲存的索引]** 選項需要 CLR 整合，因此只有當您在已啟用 CLR 整合的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體上選取參考資料表時，這項功能才有效。</span><span class="sxs-lookup"><span data-stu-id="95e8a-203">Because the **Maintain stored index** option requires CLR integration, this feature works only when you select a reference table on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where CLR integration is enabled.</span></span>  
  
## <a name="row-comparison"></a><span data-ttu-id="95e8a-204">資料列比較</span><span class="sxs-lookup"><span data-stu-id="95e8a-204">Row Comparison</span></span>  
 <span data-ttu-id="95e8a-205">設定模糊查閱轉換時，您可以指定轉換在參考資料表中尋找相符記錄時所使用的比較演算法。</span><span class="sxs-lookup"><span data-stu-id="95e8a-205">When you configure the Fuzzy Lookup transformation, you can specify the comparison algorithm that the transformation uses to locate matching records in the reference table.</span></span> <span data-ttu-id="95e8a-206">如果您將 [詳盡] 屬性設為 `True` ，則轉換會比較輸入中的每個資料列與參考資料表中的每個資料列。</span><span class="sxs-lookup"><span data-stu-id="95e8a-206">If you set the Exhaustive property to `True`, the transformation compares every row in the input to every row in the reference table.</span></span> <span data-ttu-id="95e8a-207">此比較演算法可產生更精確的結果，但很可能會讓轉換的執行速度更慢，除非參考資料表中的資料列數目較小。</span><span class="sxs-lookup"><span data-stu-id="95e8a-207">This comparison algorithm may produce more accurate results, but it is likely to make the transformation perform more slowly unless the number of rows is the reference table is small.</span></span> <span data-ttu-id="95e8a-208">如果徹底的屬性設定為 `True` ，則會將整個參考資料表載入記憶體中。</span><span class="sxs-lookup"><span data-stu-id="95e8a-208">If the Exhaustive property is set to `True`, the entire reference table is loaded into memory.</span></span> <span data-ttu-id="95e8a-209">為避免效能問題，建議您 `True` 只在封裝開發期間將詳盡的屬性設為。</span><span class="sxs-lookup"><span data-stu-id="95e8a-209">To avoid performance issues, it is advisable to set the Exhaustive property to `True` during package development only.</span></span>  
  
 <span data-ttu-id="95e8a-210">如果徹底的屬性設定為 `False` ，模糊查閱轉換只會傳回至少具有一個索引 token 或子字串的相符專案 (子字串稱為「 *q-克*」) ，與輸入記錄相同。</span><span class="sxs-lookup"><span data-stu-id="95e8a-210">If the Exhaustive property is set to `False`, the Fuzzy Lookup transformation returns only matches that have at least one indexed token or substring (the substring is called a *q-gram*) in common with the input record.</span></span> <span data-ttu-id="95e8a-211">為了達到最高的查閱效率，模糊查閱轉換只會在它用來尋找相符項目的反向索引結構中，檢索資料表內每個資料列中的一個 Token 子集。</span><span class="sxs-lookup"><span data-stu-id="95e8a-211">To maximize the efficiency of lookups, only a subset of the tokens in each row in the table is indexed in the inverted index structure that the Fuzzy Lookup transformation uses to locate matches.</span></span> <span data-ttu-id="95e8a-212">如果輸入資料集很小，您可以將詳盡設定為， `True` 以避免遺漏索引資料表中沒有通用標記的相符專案。</span><span class="sxs-lookup"><span data-stu-id="95e8a-212">When the input dataset is small, you can set Exhaustive to `True` to avoid missing matches for which no common tokens exist in the index table.</span></span>  
  
## <a name="caching-of-indexes-and-reference-tables"></a><span data-ttu-id="95e8a-213">索引和參考資料表的快取</span><span class="sxs-lookup"><span data-stu-id="95e8a-213">Caching of Indexes and Reference Tables</span></span>  
 <span data-ttu-id="95e8a-214">設定「模糊查閱」轉換時，您可以指定在轉換執行其工作之前，是否在記憶體中部分快取索引和參考資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-214">When you configure the Fuzzy Lookup transformation, you can specify whether the transformation partially caches the index and reference table in memory before the transformation does its work.</span></span> <span data-ttu-id="95e8a-215">如果您將 WarmCaches 屬性設定為 `True` ，則會將索引和參考資料表載入記憶體中。</span><span class="sxs-lookup"><span data-stu-id="95e8a-215">If you set the WarmCaches property to `True`, the index and reference table are loaded into memory.</span></span> <span data-ttu-id="95e8a-216">當輸入有許多資料列時，將 WarmCaches 屬性設定為 `True` 可以改善轉換的效能。</span><span class="sxs-lookup"><span data-stu-id="95e8a-216">When the input has many rows, setting the WarmCaches property to `True` can improve the performance of the transformation.</span></span> <span data-ttu-id="95e8a-217">當輸入資料列的數目很小時，將 WarmCaches 屬性設定為， `False` 可以更快速地重複使用大型索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-217">When the number of input rows is small, setting the WarmCaches property to `False` can make the reuse of a large index faster.</span></span>  
  
## <a name="temporary-tables-and-indexes"></a><span data-ttu-id="95e8a-218">暫存資料表和索引</span><span class="sxs-lookup"><span data-stu-id="95e8a-218">Temporary Tables and Indexes</span></span>  
 <span data-ttu-id="95e8a-219">在執行階段，「模糊查閱」轉換會在轉換連接到的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫中建立暫存物件，例如資料表和索引。</span><span class="sxs-lookup"><span data-stu-id="95e8a-219">At run time, the Fuzzy Lookup transformation creates temporary objects, such as tables and indexes, in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that the transformation connects to.</span></span> <span data-ttu-id="95e8a-220">這些暫存資料表和索引的大小，與參考資料表中的資料列和 Token 數目，以及「模糊查閱」轉換所建立的 Token 數目成正比，因此它們會佔用相當大的磁碟空間。</span><span class="sxs-lookup"><span data-stu-id="95e8a-220">The size of these temporary tables and indexes is proportionate to the number of rows and tokens in the reference table and the number of tokens that the Fuzzy Lookup transformation creates; therefore, they could potentially consume a significant amount of disk space.</span></span> <span data-ttu-id="95e8a-221">轉換還會查詢這些暫存資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-221">The transformation also queries these temporary tables.</span></span> <span data-ttu-id="95e8a-222">因此，您應該考量將「模糊查閱」轉換連接到 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 資料庫的非生產執行個體，特別是當生產伺服器的可用磁碟空間十分有限時。</span><span class="sxs-lookup"><span data-stu-id="95e8a-222">You should therefore consider connecting the Fuzzy Lookup transformation to a non-production instance of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database, especially if the production server has limited disk space available.</span></span>  
  
 <span data-ttu-id="95e8a-223">如果此轉換所使用的資料表和索引在本機電腦上，則轉換的效能會有所改進。</span><span class="sxs-lookup"><span data-stu-id="95e8a-223">The performance of this transformation may improve if the tables and indexes it uses are located on the local computer.</span></span> <span data-ttu-id="95e8a-224">如果「模糊查閱」轉換所使用的參考資料表在生產伺服器上，則應考量將資料表複製到非生產伺服器，並設定「模糊查閱」轉換存取該副本。</span><span class="sxs-lookup"><span data-stu-id="95e8a-224">If the reference table that the Fuzzy Lookup transformation uses is on the production server, you should consider copying the table to a non-production server and configuring the Fuzzy Lookup transformation to access the copy.</span></span> <span data-ttu-id="95e8a-225">如此一來，您就可避免查閱查詢耗用生產伺服器上的資源。</span><span class="sxs-lookup"><span data-stu-id="95e8a-225">By doing this, you can prevent the lookup queries from consuming resources on the production server.</span></span> <span data-ttu-id="95e8a-226">此外，如果「模糊查閱」轉換維護相符索引 (也就是說，如果將 MatchIndexOptionsis 設為 **GenerateAndMaintainNewIndex**)，則轉換可能會在資料清除作業期間鎖定參考資料表，以防止其他使用者和應用程式存取該資料表。</span><span class="sxs-lookup"><span data-stu-id="95e8a-226">In addition, if the Fuzzy Lookup transformation maintains the match index-that is, if MatchIndexOptionsis set to **GenerateAndMaintainNewIndex**-the transformation may lock the reference table for the duration of the data cleaning operation and prevent other users and applications from accessing the table.</span></span>  
  
## <a name="configuring-the-fuzzy-lookup-transformation"></a><span data-ttu-id="95e8a-227">設定模糊查閱轉換</span><span class="sxs-lookup"><span data-stu-id="95e8a-227">Configuring the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="95e8a-228">您可以透過 [!INCLUDE[ssIS](../../../includes/ssis-md.md)] 設計師或以程式設計方式設定屬性。</span><span class="sxs-lookup"><span data-stu-id="95e8a-228">You can set properties through [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer or programmatically.</span></span>  
  
 <span data-ttu-id="95e8a-229">如需有關可在 **[模糊查閱轉換編輯器]** 對話方塊中設定之屬性的詳細資訊，請按下列其中一個主題：</span><span class="sxs-lookup"><span data-stu-id="95e8a-229">For more information about the properties that you can set in the **Fuzzy Lookup Transformation Editor** dialog box, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="95e8a-230">模糊查閱轉換編輯器 &#40;參考資料表索引標籤&#41;</span><span class="sxs-lookup"><span data-stu-id="95e8a-230">Fuzzy Lookup Transformation Editor &#40;Reference Table Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)  
  
-   [<span data-ttu-id="95e8a-231">模糊查閱轉換編輯器 &#40;資料行索引標籤&#41;</span><span class="sxs-lookup"><span data-stu-id="95e8a-231">Fuzzy Lookup Transformation Editor &#40;Columns Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-columns-tab.md)  
  
-   [<span data-ttu-id="95e8a-232">模糊查閱轉換編輯器 &#40;進階索引標籤&#41;</span><span class="sxs-lookup"><span data-stu-id="95e8a-232">Fuzzy Lookup Transformation Editor &#40;Advanced Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-advanced-tab.md)  
  
 <span data-ttu-id="95e8a-233">如需有關可以在 **[進階編輯器]** 對話方塊中或以程式設計方式設定之屬性的詳細資訊，請按下列其中一個主題：</span><span class="sxs-lookup"><span data-stu-id="95e8a-233">For more information about the properties that you can set in the **Advanced Editor** dialog box or programmatically, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="95e8a-234">Common Properties</span><span class="sxs-lookup"><span data-stu-id="95e8a-234">Common Properties</span></span>](../../common-properties.md)  
  
-   [<span data-ttu-id="95e8a-235">轉換自訂屬性</span><span class="sxs-lookup"><span data-stu-id="95e8a-235">Transformation Custom Properties</span></span>](transformation-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="95e8a-236">相關工作</span><span class="sxs-lookup"><span data-stu-id="95e8a-236">Related Tasks</span></span>  
 <span data-ttu-id="95e8a-237">如需如何設定資料流程元件屬性的詳細資訊，請參閱 [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md)(設定資料流程元件的屬性)。</span><span class="sxs-lookup"><span data-stu-id="95e8a-237">For details about how to set properties of a data flow component, see [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="95e8a-238">另請參閱</span><span class="sxs-lookup"><span data-stu-id="95e8a-238">See Also</span></span>  
 <span data-ttu-id="95e8a-239">[查閱轉換](lookup-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="95e8a-239">[Lookup Transformation](lookup-transformation.md) </span></span>  
 <span data-ttu-id="95e8a-240">[模糊群組轉換](fuzzy-grouping-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="95e8a-240">[Fuzzy Grouping Transformation](fuzzy-grouping-transformation.md) </span></span>  
 [<span data-ttu-id="95e8a-241">Integration Services 轉換</span><span class="sxs-lookup"><span data-stu-id="95e8a-241">Integration Services Transformations</span></span>](integration-services-transformations.md)  
  
  
