---
title: CDC 控制工作 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595239"
---
# <a name="cdc-control-task"></a><span data-ttu-id="57ded-102">CDC 控制工作</span><span class="sxs-lookup"><span data-stu-id="57ded-102">CDC Control Task</span></span>
  <span data-ttu-id="57ded-103">CDC 控制工作是用來控制異動資料擷取 (CDC) 封裝的開發週期。</span><span class="sxs-lookup"><span data-stu-id="57ded-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="57ded-104">它會處理 CDC 封裝與初始載入封裝的同步處理，以及 CDC 封裝執行中所處理之記錄序號 (LSN) 範圍的管理。</span><span class="sxs-lookup"><span data-stu-id="57ded-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="57ded-105">此外，CDC 控制工作也會處理錯誤狀況和復原。</span><span class="sxs-lookup"><span data-stu-id="57ded-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="57ded-106">CDC 控制工作在 SSIS 封裝變數中維護 CDC 封裝的狀態，也可以將它保存在資料庫資料表中，以便於跨封裝啟動和在一起執行通用 CDC 處理序的多個封裝之間維護狀態 (例如某個工作可能負責初始載入，而另一個工作則負責滴漏式饋送更新)。</span><span class="sxs-lookup"><span data-stu-id="57ded-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="57ded-107">CDC 控制工作支援兩個作業群組。</span><span class="sxs-lookup"><span data-stu-id="57ded-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="57ded-108">一個群組處理初始載入和變更處理的同步處理，另一個群組則管理 CDC 封裝執行期間 LSN 變更處理範圍及追蹤何者已成功處理。</span><span class="sxs-lookup"><span data-stu-id="57ded-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="57ded-109">下列作業會處理初始載入和變更處理的同步處理：</span><span class="sxs-lookup"><span data-stu-id="57ded-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="57ded-110">作業</span><span class="sxs-lookup"><span data-stu-id="57ded-110">Operation</span></span>|<span data-ttu-id="57ded-111">描述</span><span class="sxs-lookup"><span data-stu-id="57ded-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="57ded-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="57ded-112">ResetCdcState</span></span>|<span data-ttu-id="57ded-113">此作業是用來重設與目前 CDC 內容相關聯的永續性 CDC 狀態。</span><span class="sxs-lookup"><span data-stu-id="57ded-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="57ded-114">執行此作業之後，LSN 時間戳記 `sys.fn_cdc_get_max_lsn` 資料表中的目前最大 LSN 就會變成下一個處理範圍的範圍開頭。</span><span class="sxs-lookup"><span data-stu-id="57ded-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="57ded-115">此作業需要來源資料庫的連接。</span><span class="sxs-lookup"><span data-stu-id="57ded-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="57ded-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="57ded-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="57ded-117">在初始載入封裝開始時使用此作業，以便在初始載入封裝開始讀取來源資料表之前記錄來源資料庫中目前的 LSN。</span><span class="sxs-lookup"><span data-stu-id="57ded-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="57ded-118">這需要來源資料庫的連接，以呼叫 `sys.fn_cdc_get_max_lsn`。</span><span class="sxs-lookup"><span data-stu-id="57ded-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="57ded-119">如果您在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (亦即，非 Oracle) 上工作時選取了 MarkInitialLoadStart，連線管理員中指定的使用者就必須是 db_owner 或系統管理員。</span><span class="sxs-lookup"><span data-stu-id="57ded-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="57ded-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="57ded-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="57ded-121">在初始載入封裝結束時使用此作業，以便在初始載入封裝完成讀取來源資料表之後記錄來源資料庫中目前的 LSN。</span><span class="sxs-lookup"><span data-stu-id="57ded-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="57ded-122">這個 LSN 的決定方式如下：記錄進行此作業時的目前時間，然後在 CDC 資料庫中查詢 `cdc.lsn_time_`mapping 資料表，尋找該時間之後發生的變更。</span><span class="sxs-lookup"><span data-stu-id="57ded-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="57ded-123">如果您在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (亦即，非 Oracle) 上工作時選取了 MarkInitialLoadEnd，連線管理員中指定的使用者就必須是 db_owner 或系統管理員。</span><span class="sxs-lookup"><span data-stu-id="57ded-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="57ded-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="57ded-124">MarkCdcStart</span></span>|<span data-ttu-id="57ded-125">此作業是在從快照集資料庫進行初始載入時使用。</span><span class="sxs-lookup"><span data-stu-id="57ded-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="57ded-126">在此情況下，變更處理應該在快照集 LSN 之後立即開始。</span><span class="sxs-lookup"><span data-stu-id="57ded-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="57ded-127">您可以指定要使用的快照集資料庫名稱，CDC 控制工作就會在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 中查詢快照集 LSN。</span><span class="sxs-lookup"><span data-stu-id="57ded-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="57ded-128">您還可以選擇直接指定快照集 LSN。</span><span class="sxs-lookup"><span data-stu-id="57ded-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="57ded-129">如果您在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (亦即，非 Oracle) 上工作時選取了 MarkCdcStart，連線管理員中指定的使用者就必須是 db_owner 或系統管理員。</span><span class="sxs-lookup"><span data-stu-id="57ded-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="57ded-130">下列作業用來管理處理範圍：</span><span class="sxs-lookup"><span data-stu-id="57ded-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="57ded-131">作業</span><span class="sxs-lookup"><span data-stu-id="57ded-131">Operation</span></span>|<span data-ttu-id="57ded-132">描述</span><span class="sxs-lookup"><span data-stu-id="57ded-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="57ded-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="57ded-133">GetProcessingRange</span></span>|<span data-ttu-id="57ded-134">此作業是在叫用使用 CDC 來源資料流程的資料流程之前使用。</span><span class="sxs-lookup"><span data-stu-id="57ded-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="57ded-135">叫用此作業時，它會建立 CDC 來源資料流程所讀取的 LSN 範圍。</span><span class="sxs-lookup"><span data-stu-id="57ded-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="57ded-136">此範圍會儲存在資料流程處理期間 CDC 來源所使用的 SSIS 封裝變數中。</span><span class="sxs-lookup"><span data-stu-id="57ded-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="57ded-137">如需儲存之狀態的詳細資訊，請參閱 [定義狀態變數](../data-flow/define-a-state-variable.md)。</span><span class="sxs-lookup"><span data-stu-id="57ded-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="57ded-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="57ded-138">MarkProcessedRange</span></span>|<span data-ttu-id="57ded-139">在每個 CDC 執行之後 (CDC 資料流程順利完成之後) 執行此作業，以便記錄 CDC 執行期間完整處理的最後一個 LSN。</span><span class="sxs-lookup"><span data-stu-id="57ded-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="57ded-140">下次執行 GetProcessingRange 時，這個位置就是下一個處理範圍的開頭。</span><span class="sxs-lookup"><span data-stu-id="57ded-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="57ded-141">處理 CDC 狀態持續性</span><span class="sxs-lookup"><span data-stu-id="57ded-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="57ded-142">CDC 控制工作會在啟動之間維護永續性狀態。</span><span class="sxs-lookup"><span data-stu-id="57ded-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="57ded-143">儲存在 CDC 狀態中的資訊用來決定及維護 CDC 封裝的處理範圍，以及用於偵測錯誤狀態。</span><span class="sxs-lookup"><span data-stu-id="57ded-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="57ded-144">永續性狀態儲存為字串。</span><span class="sxs-lookup"><span data-stu-id="57ded-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="57ded-145">如需詳細資訊，請參閱 [定義狀態變數](../data-flow/define-a-state-variable.md)。</span><span class="sxs-lookup"><span data-stu-id="57ded-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="57ded-146">CDC 控制工作支援兩種狀態持續性類型。</span><span class="sxs-lookup"><span data-stu-id="57ded-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="57ded-147">手動狀態持續性：在此情況下，CDC 控制工作會管理儲存在封裝變數中的狀態，但是封裝開發人員必須在呼叫 CDC 控制之前從永續性存放區讀取變數，然後在最後一次呼叫 CDC 控制而且 CDC 執行完成之後將變數寫回該永續性存放區。</span><span class="sxs-lookup"><span data-stu-id="57ded-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="57ded-148">自動狀態持續性：CDC 狀態會儲存在資料庫資料表中。</span><span class="sxs-lookup"><span data-stu-id="57ded-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="57ded-149">此狀態是在 **[要用於儲存狀態的資料表]** 屬性 (位於儲存狀態的選定連接管理員) 所指名資料表中， **StateName** 屬性所提供的名稱下儲存。</span><span class="sxs-lookup"><span data-stu-id="57ded-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="57ded-150">預設是來源連接管理員，但常見作法是將它做為目標連接管理員。</span><span class="sxs-lookup"><span data-stu-id="57ded-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="57ded-151">CDC 控制工作會更新狀態資料表中的狀態值，並認可此值做為環境交易的一部分。</span><span class="sxs-lookup"><span data-stu-id="57ded-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="57ded-152">錯誤處理</span><span class="sxs-lookup"><span data-stu-id="57ded-152">Error Handling</span></span>  
 <span data-ttu-id="57ded-153">在下列情況下，CDC 控制工作可能會報告錯誤：</span><span class="sxs-lookup"><span data-stu-id="57ded-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="57ded-154">它無法讀取 CDC 永續性狀態或永續性狀態更新失敗。</span><span class="sxs-lookup"><span data-stu-id="57ded-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="57ded-155">它無法從來源資料庫讀取目前的 LSN 資訊。</span><span class="sxs-lookup"><span data-stu-id="57ded-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="57ded-156">CDC 狀態讀取不一致。</span><span class="sxs-lookup"><span data-stu-id="57ded-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="57ded-157">在所有這些情況下，CDC 控制工作都會報告錯誤，而 SSIS 則會以處理控制流程錯誤的標準方式予以處理。</span><span class="sxs-lookup"><span data-stu-id="57ded-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="57ded-158">在未呼叫標記處理的範圍的情況下，直接在取得處理範圍作業之後叫用另一個取得處理範圍作業時，CDC 控制工作可能也會報告警告。</span><span class="sxs-lookup"><span data-stu-id="57ded-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="57ded-159">這種情況表示上次執行失敗，或者另一個 CDC 封裝可能正在以相同的 CDC 狀態名稱下執行。</span><span class="sxs-lookup"><span data-stu-id="57ded-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="57ded-160">設定 CDC 控制工作</span><span class="sxs-lookup"><span data-stu-id="57ded-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="57ded-161">您可以透過 SSIS 設計師或以程式設計方式設定屬性。</span><span class="sxs-lookup"><span data-stu-id="57ded-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="57ded-162">本節內容</span><span class="sxs-lookup"><span data-stu-id="57ded-162">In This Section</span></span>  
  
-   [<span data-ttu-id="57ded-163">CDC 控制工作編輯器</span><span class="sxs-lookup"><span data-stu-id="57ded-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="57ded-164">CDC 控制工作自訂屬性</span><span class="sxs-lookup"><span data-stu-id="57ded-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="57ded-165">相關工作</span><span class="sxs-lookup"><span data-stu-id="57ded-165">Related Tasks</span></span>  
 [<span data-ttu-id="57ded-166">定義狀態變數</span><span class="sxs-lookup"><span data-stu-id="57ded-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="57ded-167">相關內容</span><span class="sxs-lookup"><span data-stu-id="57ded-167">Related Content</span></span>  
  
-   <span data-ttu-id="57ded-168">social.technet.microsoft.com 上的技術文章： [安裝 Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958)。</span><span class="sxs-lookup"><span data-stu-id="57ded-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="57ded-169">social.technet.microsoft.com 上的技術文章： [疑難排解 Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity 中的組態問題](https://go.microsoft.com/fwlink/?LinkId=252960)。</span><span class="sxs-lookup"><span data-stu-id="57ded-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="57ded-170">social.technet.microsoft.com 上的技術文章： [疑難排解 Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity 中的 CDC 執行個體錯誤](https://go.microsoft.com/fwlink/?LinkId=252961)。</span><span class="sxs-lookup"><span data-stu-id="57ded-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
