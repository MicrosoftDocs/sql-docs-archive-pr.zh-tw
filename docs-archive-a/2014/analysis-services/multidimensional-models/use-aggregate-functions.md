---
title: 使用彙總函式 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- aggregate functions [Analysis Services]
ms.assetid: c42166ef-b75c-45f4-859c-09a3e9617664
author: minewiskan
ms.author: owend
ms.openlocfilehash: 83cdc571019cffd8ae99e00f119541736c6f503b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87597404"
---
# <a name="use-aggregate-functions"></a><span data-ttu-id="4baf8-102">使用彙總函式</span><span class="sxs-lookup"><span data-stu-id="4baf8-102">Use Aggregate Functions</span></span>
  <span data-ttu-id="4baf8-103">當維度用於配量量值時，量值會與該維度所含的階層一起彙總。</span><span class="sxs-lookup"><span data-stu-id="4baf8-103">When a dimension is used to slice a measure, the measure is summarized along the hierarchies contained in that dimension.</span></span> <span data-ttu-id="4baf8-104">而總和行為則視指定給量值的彙總函式而定</span><span class="sxs-lookup"><span data-stu-id="4baf8-104">The summation behavior depends on the aggregate function specified for the measure.</span></span> <span data-ttu-id="4baf8-105">對於大多數包含數值資料的量值而言，彙總函式是 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4baf8-105">For most measures containing numeric data, the aggregate function is `Sum`.</span></span> <span data-ttu-id="4baf8-106">量值的值會依據所使用的階層層級而加總為不同的數量。</span><span class="sxs-lookup"><span data-stu-id="4baf8-106">The value of the measure will sum to different amounts depending on which level of the hierarchy is active.</span></span>  
  
 <span data-ttu-id="4baf8-107">在 Analysis Services 中，您建立的每個量值都有一個彙總函數可以決定量值的作業。</span><span class="sxs-lookup"><span data-stu-id="4baf8-107">In Analysis Services, every measure that you create is backed by an aggregation function that determines the measure's operation.</span></span> <span data-ttu-id="4baf8-108">預先定義的匯總類型包括 `Sum` 、 `Min` 、 `Max` 、 `Count` 、**相異計數**，以及數個其他更特殊化的函式。</span><span class="sxs-lookup"><span data-stu-id="4baf8-108">Predefined aggregation types include `Sum`, `Min`, `Max`, `Count`, **Distinct Count**, and several other more specialized functions.</span></span> <span data-ttu-id="4baf8-109">或者，您如需透過複雜或自訂的公式執行彙總，可以建置 MDX 計算，而不使用預先建置的彙總函數。</span><span class="sxs-lookup"><span data-stu-id="4baf8-109">Alternatively, if you require aggregations based on complex or custom formulas, you can build an MDX calculation in lieu of using a prebuilt aggregation function.</span></span> <span data-ttu-id="4baf8-110">例如，若您要定義百分比值的量值，可以在 MDX 中使用導出量值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-110">For example, if you want to define a measure for a percentage value, you would do that in MDX, using a calculated measure.</span></span> <span data-ttu-id="4baf8-111">請參閱 [CREATE MEMBER 陳述式 &#40;MDX&#41;](/sql/mdx/mdx-data-definition-create-member)。</span><span class="sxs-lookup"><span data-stu-id="4baf8-111">See [CREATE MEMBER Statement &#40;MDX&#41;](/sql/mdx/mdx-data-definition-create-member).</span></span>  
  
 <span data-ttu-id="4baf8-112">由 [Cube 精靈] 建立的量值，會在定義量值時，為其指派彙總類型。</span><span class="sxs-lookup"><span data-stu-id="4baf8-112">Measures that are created via the Cube Wizard are assigned an aggregation type as part of the measure definition.</span></span> <span data-ttu-id="4baf8-113">若來源資料行包含數值資料，彙總類型一律為 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4baf8-113">The aggregation type is always `Sum`, assuming the source column contains numeric data.</span></span> <span data-ttu-id="4baf8-114">無論來源資料行的資料類型為何，一律會指派 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4baf8-114">`Sum` is assigned regardless of the source column's data type.</span></span> <span data-ttu-id="4baf8-115">例如，若是使用 [Cube 精靈] 建立量值，並將其從事實資料表提取到所有資料行，則即使來源為日期時間資料行，所得量值的彙總類型都會是 `Sum`。</span><span class="sxs-lookup"><span data-stu-id="4baf8-115">For example, if you used the Cube Wizard to create measures, and you pulled in all columns from a fact table, you will notice that all of the resulting measures have an aggregation of `Sum`, even if the source is a date time column.</span></span> <span data-ttu-id="4baf8-116">對於精靈所建立的量值，請務必檢查預先指派的彙總方法，以確認彙總函數的適用性。</span><span class="sxs-lookup"><span data-stu-id="4baf8-116">Always review the pre-assigned aggregation methods for measures created via the wizard to make sure the aggregation function is suitable.</span></span>  
  
 <span data-ttu-id="4baf8-117">您可以使用 [!INCLUDE[ss_dtbi](../../includes/ss-dtbi-md.md)]或 MDX 指派或變更任一個 Cube 定義的彙總方法。</span><span class="sxs-lookup"><span data-stu-id="4baf8-117">You can assign or change the aggregation method in the either the cube definition, via [!INCLUDE[ss_dtbi](../../includes/ss-dtbi-md.md)], or via MDX.</span></span> <span data-ttu-id="4baf8-118">如需進一步指示，請參閱[在多維度模型中建立量值和量值群組](create-measures-and-measure-groups-in-multidimensional-models.md)或 [Aggregate &#40;MDX&#41;](/sql/mdx/aggregate-mdx)。</span><span class="sxs-lookup"><span data-stu-id="4baf8-118">See [Create Measures and Measure Groups in Multidimensional Models](create-measures-and-measure-groups-in-multidimensional-models.md) or [Aggregate &#40;MDX&#41;](/sql/mdx/aggregate-mdx) for further instructions.</span></span>  
  
##  <a name="aggregate-functions"></a><a name="AggFunction"></a><span data-ttu-id="4baf8-119">彙總函式</span><span class="sxs-lookup"><span data-stu-id="4baf8-119">Aggregate Functions</span></span>  
 [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)] <span data-ttu-id="4baf8-120">提供多種函數可以彙總量值群組中所含維度的量值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-120">provides functions to aggregate measures along the dimensions that are contained in measure groups.</span></span> <span data-ttu-id="4baf8-121">彙總函式的「加總性」\*\* 決定如何在 Cube 的所有維度中來彙總量值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-121">The *additivity* of an aggregation function determines how the measure is aggregated across all the dimensions in the cube.</span></span> <span data-ttu-id="4baf8-122">彙總函式分成三個加總性層級：</span><span class="sxs-lookup"><span data-stu-id="4baf8-122">Aggregation functions fall into three levels of additivity:</span></span>  
  
 <span data-ttu-id="4baf8-123">加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-123">Additive</span></span>  
 <span data-ttu-id="4baf8-124">此為加總量值，也稱為完全加總量值，可將包含該量值的量值群組中，所包含的所有維度加以彙總，而且沒有限制。</span><span class="sxs-lookup"><span data-stu-id="4baf8-124">An additive measure, also called a fully additive measure, can be aggregated along all the dimensions that are included in the measure group that contains the measure, without restriction.</span></span>  
  
 <span data-ttu-id="4baf8-125">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-125">Semiadditive</span></span>  
 <span data-ttu-id="4baf8-126">局部加總量值可將包含該量值的量值群組中，所包含的部分而非全部維度加以彙總。</span><span class="sxs-lookup"><span data-stu-id="4baf8-126">A semiadditive measure can be aggregated along some, but not all, dimensions that are included in the measure group that contains the measure.</span></span> <span data-ttu-id="4baf8-127">例如，可將地理維度中代表存貨可用數量的量值加以彙總，以產生所有倉庫可用的總數量，但不能將時間維度的量值加以彙總，因為該量值代表可用數量的定期快照集。</span><span class="sxs-lookup"><span data-stu-id="4baf8-127">For example, a measure that represents the quantity available for inventory can be aggregated along a geography dimension to produce a total quantity available for all warehouses, but the measure cannot be aggregated along a time dimension because the measure represents a periodic snapshot of quantities available.</span></span> <span data-ttu-id="4baf8-128">彙總時間維度的量值可能會產生不正確的結果。</span><span class="sxs-lookup"><span data-stu-id="4baf8-128">Aggregating such a measure along a time dimension would produce incorrect results.</span></span> <span data-ttu-id="4baf8-129">如需詳細資訊，請參閱 [定義局部加總行為](define-semiadditive-behavior.md) 。</span><span class="sxs-lookup"><span data-stu-id="4baf8-129">See [Define Semiadditive Behavior](define-semiadditive-behavior.md) for details.</span></span>  
  
 <span data-ttu-id="4baf8-130">非加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-130">Nonadditive</span></span>  
 <span data-ttu-id="4baf8-131">非加總量值無法將包含該量值的量值群組中，所包含的任何維度加以彙總。</span><span class="sxs-lookup"><span data-stu-id="4baf8-131">A nonadditive measure cannot be aggregated along any dimension in the measure group that contains the measure.</span></span> <span data-ttu-id="4baf8-132">反之，必須在代表量值的 Cube 中，個別計算每一個資料格的量值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-132">Instead, the measure must be individually calculated for each cell in the cube that represents the measure.</span></span> <span data-ttu-id="4baf8-133">例如，傳回百分比的導出量值 (例如獲利率) 無法從任何維度的子成員之百分比值彙總而得。</span><span class="sxs-lookup"><span data-stu-id="4baf8-133">For example, a calculated measure that returns a percentage, such as profit margin, cannot be aggregated from the percentage values of child members in any dimension.</span></span>  
  
 <span data-ttu-id="4baf8-134">下表列出 [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)]的彙總函式，並描述函數的加總性和預期輸出。</span><span class="sxs-lookup"><span data-stu-id="4baf8-134">The following table lists the aggregation functions in [!INCLUDE[ssASnoversion](../../../includes/ssasnoversion-md.md)], and describes both the additivity and expected output of the function.</span></span>  
  
|<span data-ttu-id="4baf8-135">彙總函式</span><span class="sxs-lookup"><span data-stu-id="4baf8-135">Aggregation function</span></span>|<span data-ttu-id="4baf8-136">加總性</span><span class="sxs-lookup"><span data-stu-id="4baf8-136">Additivity</span></span>|<span data-ttu-id="4baf8-137">傳回值</span><span class="sxs-lookup"><span data-stu-id="4baf8-137">Returned value</span></span>|  
|--------------------------|----------------|--------------------|  
|`Sum`|<span data-ttu-id="4baf8-138">加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-138">Additive</span></span>|<span data-ttu-id="4baf8-139">針對所有子成員，計算值的總和。</span><span class="sxs-lookup"><span data-stu-id="4baf8-139">Calculates the sum of values for all child members.</span></span> <span data-ttu-id="4baf8-140">這是預設的彙總函式。</span><span class="sxs-lookup"><span data-stu-id="4baf8-140">This is the default aggregation function.</span></span>|  
|`Count`|<span data-ttu-id="4baf8-141">加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-141">Additive</span></span>|<span data-ttu-id="4baf8-142">擷取所有子成員的計數。</span><span class="sxs-lookup"><span data-stu-id="4baf8-142">Retrieves the count of all child members.</span></span>|  
|`Min`|<span data-ttu-id="4baf8-143">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-143">Semiadditive</span></span>|<span data-ttu-id="4baf8-144">擷取所有子成員的最低值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-144">Retrieves the lowest value for all child members.</span></span>|  
|`Max`|<span data-ttu-id="4baf8-145">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-145">Semiadditive</span></span>|<span data-ttu-id="4baf8-146">擷取所有子成員的最高值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-146">Retrieves the highest value for all child members.</span></span>|  
|`DistinctCount`|<span data-ttu-id="4baf8-147">非加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-147">Nonadditive</span></span>|<span data-ttu-id="4baf8-148">擷取所有唯一子成員的計數。</span><span class="sxs-lookup"><span data-stu-id="4baf8-148">Retrieves the count of all unique child members.</span></span> <span data-ttu-id="4baf8-149">如需詳細資訊，請參閱下一節中的 [About Distinct Count measure](use-aggregate-functions.md#bkmk_distinct) (關於相異計數量值)。</span><span class="sxs-lookup"><span data-stu-id="4baf8-149">For more details, see [About Distinct Count Measures](use-aggregate-functions.md#bkmk_distinct) in the next section.</span></span>|  
|`None`|<span data-ttu-id="4baf8-150">非加法</span><span class="sxs-lookup"><span data-stu-id="4baf8-150">Nonadditive</span></span>|<span data-ttu-id="4baf8-151">不執行彙總，而且針對包含該量值的量值群組，直接從事實資料表提供維度中分葉與非分葉成員的所有值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-151">No aggregation is performed, and all values for leaf and nonleaf members in a dimension are supplied directly from the fact table for the measure group that contains the measure.</span></span> <span data-ttu-id="4baf8-152">如果無法從成員的事實資料表讀取任何值，該成員的值就會設定為 Null。</span><span class="sxs-lookup"><span data-stu-id="4baf8-152">If no value can be read from the fact table for a member, the value for that member is set to null.</span></span>|  
|`ByAccount`|<span data-ttu-id="4baf8-153">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-153">Semiadditive</span></span>|<span data-ttu-id="4baf8-154">針對帳戶維度中的成員，依據指派給帳戶類型的彙總函式來計算彙總。</span><span class="sxs-lookup"><span data-stu-id="4baf8-154">Calculates the aggregation according to the aggregation function assigned to the account type for a member in an account dimension.</span></span> <span data-ttu-id="4baf8-155">如果量值群組中沒有帳戶類型維度，則視為 `None` 彙總函式。</span><span class="sxs-lookup"><span data-stu-id="4baf8-155">If no account type dimension exists in the measure group, treated as the `None` aggregation function.</span></span><br /><br /> <span data-ttu-id="4baf8-156">如需帳戶維度的詳細資訊，請參閱 [建立父子式類型維度的財務帳戶](database-dimensions-finance-account-of-parent-child-type.md)。</span><span class="sxs-lookup"><span data-stu-id="4baf8-156">For more information about account dimensions, see [Create a Finance Account of parent-child type Dimension](database-dimensions-finance-account-of-parent-child-type.md).</span></span>|  
|`AverageOfChildren`|<span data-ttu-id="4baf8-157">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-157">Semiadditive</span></span>|<span data-ttu-id="4baf8-158">針對所有非空白的子成員，計算值的平均。</span><span class="sxs-lookup"><span data-stu-id="4baf8-158">Calculates the average of values for all non-empty child members.</span></span>|  
|`FirstChild`|<span data-ttu-id="4baf8-159">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-159">Semiadditive</span></span>|<span data-ttu-id="4baf8-160">擷取第一個子成員的值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-160">Retrieves the value of the first child member.</span></span>|  
|`LastChild`|<span data-ttu-id="4baf8-161">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-161">Semiadditive</span></span>|<span data-ttu-id="4baf8-162">擷取最後一個子成員的值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-162">Retrieves the value of the last child member.</span></span>|  
|`FirstNonEmpty`|<span data-ttu-id="4baf8-163">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-163">Semiadditive</span></span>|<span data-ttu-id="4baf8-164">擷取第一個非空白之子成員的值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-164">Retrieves the value of the first non-empty child member.</span></span>|  
|`LastNonEmpty`|<span data-ttu-id="4baf8-165">局部加總</span><span class="sxs-lookup"><span data-stu-id="4baf8-165">Semiadditive</span></span>|<span data-ttu-id="4baf8-166">擷取最後一個非空白之子成員的值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-166">Retrieves the value of the last non-empty child member.</span></span>|  
  
##  <a name="about-distinct-count-measures"></a><a name="bkmk_distinct"></a> <span data-ttu-id="4baf8-167">About Distinct Count measure</span><span class="sxs-lookup"><span data-stu-id="4baf8-167">About Distinct Count Measures</span></span>  
 <span data-ttu-id="4baf8-168">具有 **彙總函式** 屬性值 **Distinct Count** 的量值稱為相異計數量值。</span><span class="sxs-lookup"><span data-stu-id="4baf8-168">A measure with an **Aggregate Function** property value of **Distinct Count** is called a distinct count measure.</span></span> <span data-ttu-id="4baf8-169">相異計數量值可用來統計事實資料表中某維度之最低層級成員的出現次數。</span><span class="sxs-lookup"><span data-stu-id="4baf8-169">A distinct count measure can be used to count occurrences of a dimension's lowest-level members in the fact table.</span></span> <span data-ttu-id="4baf8-170">因為當成員出現多次時，此計數便會不同，所以只會計算一次。</span><span class="sxs-lookup"><span data-stu-id="4baf8-170">Because the count is distinct, if a member occurs multiple times, it is counted only once.</span></span> <span data-ttu-id="4baf8-171">相異計數量值只會用在專用的量值群組中。</span><span class="sxs-lookup"><span data-stu-id="4baf8-171">A distinct count measure is always placed in a dedicated measure group.</span></span> <span data-ttu-id="4baf8-172">最佳做法是將相異計數量值放入設計師內建的專用量值群組，以最佳化效能。</span><span class="sxs-lookup"><span data-stu-id="4baf8-172">Putting a distinct count measure into its own measure group is a best practice that has been built into the designer as a performance optimization technique.</span></span>  
  
 <span data-ttu-id="4baf8-173">相異計數量值通常是用來針對維度的每一個成員判斷，另一個維度有多少相異的最低層級成員共用事實資料表中的資料列；</span><span class="sxs-lookup"><span data-stu-id="4baf8-173">Distinct count measures are commonly used to determine for each member of a dimension how many distinct, lowest-level members of another dimension share rows in the fact table.</span></span> <span data-ttu-id="4baf8-174">例如在 Sales Cube 中，針對每一個客戶及客戶群組判斷，已經購買了多少數量的相異產品？</span><span class="sxs-lookup"><span data-stu-id="4baf8-174">For example, in a Sales cube, for each customer and customer group, how many distinct products were purchased?</span></span> <span data-ttu-id="4baf8-175">(也就是說，對於客戶維度的每一個成員而言，產品維度中有多少相異的最低層級成員共用事實資料表中的資料列？)或者在 Internet Site Visits Cube 中，針對每一個網站造訪者及網站造訪者群組判斷，此網際網路網站上造訪過的相異網頁數目。</span><span class="sxs-lookup"><span data-stu-id="4baf8-175">(That is, for each member of the Customers dimension, how many distinct, lowest-level members of the Products dimension share rows in the fact table?) Or, for example, in an Internet Site Visits cube, for each site visitor and site visitor group, how many distinct pages on the Internet site were visited?</span></span> <span data-ttu-id="4baf8-176">(也就是說，對於網站造訪者維度的每一個成員而言，網頁維度中有多少相異的最低層級成員共用事實資料表中的資料列？)在每一個範例中，第二個維度的最低層級成員是由相異計數量值所統計。</span><span class="sxs-lookup"><span data-stu-id="4baf8-176">(That is, for each member of the Site Visitors dimension, how many distinct, lowest-level members of the Pages dimension share rows in the fact table?) In each of these examples, the second dimension's lowest-level members are counted by a distinct count measure.</span></span>  
  
 <span data-ttu-id="4baf8-177">此分析種類不需要限制為兩個維度；</span><span class="sxs-lookup"><span data-stu-id="4baf8-177">This kind of analysis need not be limited to two dimensions.</span></span> <span data-ttu-id="4baf8-178">事實上，相異計數量值可由 Cube 中的任何維度組合 (包括含有已計算成員的維度) 加以區隔及切割。</span><span class="sxs-lookup"><span data-stu-id="4baf8-178">In fact, a distinct count measure can be separated and sliced by any combination of dimensions in the cube, including the dimension that contains the counted members.</span></span>  
  
 <span data-ttu-id="4baf8-179">計算成員的相異計數量值是以事實資料表中的外部索引鍵資料行為根據</span><span class="sxs-lookup"><span data-stu-id="4baf8-179">A distinct count measure that counts members is based on a foreign key column in the fact table.</span></span> <span data-ttu-id="4baf8-180">(也就是說，此量值的 **來源資料行** 屬性會識別此資料行。)這個資料行會聯結可識別相異計數量值所計算之成員的維度資料表資料行。</span><span class="sxs-lookup"><span data-stu-id="4baf8-180">(That is, the measure's **Source Column** property identifies this column.) This column joins the dimension table column that identifies the members counted by the distinct count measure.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4baf8-181">另請參閱</span><span class="sxs-lookup"><span data-stu-id="4baf8-181">See Also</span></span>  
 <span data-ttu-id="4baf8-182">[量值和量值群組](measures-and-measure-groups.md) </span><span class="sxs-lookup"><span data-stu-id="4baf8-182">[Measures and Measure Groups](measures-and-measure-groups.md) </span></span>  
 <span data-ttu-id="4baf8-183">[Mdx 函數參考 &#40;MDX&#41;](/sql/mdx/mdx-function-reference-mdx) </span><span class="sxs-lookup"><span data-stu-id="4baf8-183">[MDX Function Reference &#40;MDX&#41;](/sql/mdx/mdx-function-reference-mdx) </span></span>  
 [<span data-ttu-id="4baf8-184">定義局部加總行為</span><span class="sxs-lookup"><span data-stu-id="4baf8-184">Define Semiadditive Behavior</span></span>](define-semiadditive-behavior.md)  
  
  
