---
title: Analysis Services 資料採礦) 的嵌套資料表 (|Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- data mining [Analysis Services], nested tables
- tables [Analysis Services], nested
- nested tables
ms.assetid: cb192aa2-597e-4d4f-ac34-3556d037fed4
author: minewiskan
ms.author: owend
ms.openlocfilehash: 78b1022751ae6d381b86512f45f7232bebe7fcd0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87687365"
---
# <a name="nested-tables-analysis-services---data-mining"></a><span data-ttu-id="b67ec-102">巢狀資料表 (Analysis Services - 資料採礦)</span><span class="sxs-lookup"><span data-stu-id="b67ec-102">Nested Tables (Analysis Services - Data Mining)</span></span>
  <span data-ttu-id="b67ec-103">在中 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] ，資料必須以案例資料表中包含的一系列案例形式，送到資料採礦演算法。</span><span class="sxs-lookup"><span data-stu-id="b67ec-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], data must be fed to a data mining algorithm as a series of cases that are contained within a case table.</span></span> <span data-ttu-id="b67ec-104">不過，並非所有的案例都可以由單一資料列描述。</span><span class="sxs-lookup"><span data-stu-id="b67ec-104">However, not all cases can be described by a single row of data.</span></span> <span data-ttu-id="b67ec-105">例如，案例可能從兩個資料表衍生：一個資料表包含客戶資訊，而另一個資料表包含客戶購買資訊。</span><span class="sxs-lookup"><span data-stu-id="b67ec-105">For example, a case might be derived from two tables: one table that contains customer information, and another table that contains customer purchases.</span></span> <span data-ttu-id="b67ec-106">客戶資訊表中的單一客戶在客戶購買資料表中可能有多筆購買項目，所以很難以單一資料列描述資料。</span><span class="sxs-lookup"><span data-stu-id="b67ec-106">A single customer in the customer information table might have multiple items in the customer purchases table, which makes it difficult to describe the data by using a single row.</span></span> [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]<span data-ttu-id="b67ec-107">使用*嵌套資料表*，提供處理這些案例的唯一方法。</span><span class="sxs-lookup"><span data-stu-id="b67ec-107">provides a unique method for handling these cases, by using *nested tables*.</span></span> <span data-ttu-id="b67ec-108">下圖展示巢狀資料表的概念。</span><span class="sxs-lookup"><span data-stu-id="b67ec-108">The concept of a nested table is demonstrated in the following illustration.</span></span>  
  
 <span data-ttu-id="b67ec-109">![使用巢狀資料表結合的兩個資料表](../media/nested-tables.gif "使用巢狀資料表結合的兩個資料表")</span><span class="sxs-lookup"><span data-stu-id="b67ec-109">![Two tables combined by using a nested table](../media/nested-tables.gif "Two tables combined by using a nested table")</span></span>  
  
 <span data-ttu-id="b67ec-110">在此圖表中，第一個資料表 (父資料表) 包含客戶相關資訊，且每一位客戶有唯一識別碼的關聯。</span><span class="sxs-lookup"><span data-stu-id="b67ec-110">In this diagram, the first table, which is the parent table, contains information about customers, and associates a unique identifier for each customer.</span></span> <span data-ttu-id="b67ec-111">第二個資料表 (子資料表) 包含每一位客戶的購買資訊。</span><span class="sxs-lookup"><span data-stu-id="b67ec-111">The second table, the child table, contains the purchases for each customer.</span></span> <span data-ttu-id="b67ec-112">子資料表中的購買資訊會經由唯一識別碼 **CustomerKey** 資料行，與父資料表產生關聯。</span><span class="sxs-lookup"><span data-stu-id="b67ec-112">The purchases in the child table are related to the parent table by the unique identifier, the **CustomerKey** column.</span></span> <span data-ttu-id="b67ec-113">圖表中的第三個資料表會顯示這兩個資料表的結合。</span><span class="sxs-lookup"><span data-stu-id="b67ec-113">The third table in the diagram shows the two tables combined.</span></span>  
  
 <span data-ttu-id="b67ec-114">巢狀資料表會以案例資料表中的特殊資料行表示，此資料行的資料類型為 **TABLE**。</span><span class="sxs-lookup"><span data-stu-id="b67ec-114">A nested table is represented in the case table as a special column that has a data type of **TABLE**.</span></span> <span data-ttu-id="b67ec-115">針對任何特定的案例資料列，這種資料行包含從子資料表中選取與父資料表有關的資料列。</span><span class="sxs-lookup"><span data-stu-id="b67ec-115">For any particular case row, this kind of column contains selected rows from the child table that pertain to the parent table.</span></span>  
  
 <span data-ttu-id="b67ec-116">巢狀資料表中的資料可以用於預測或輸入，或同時用於兩者。</span><span class="sxs-lookup"><span data-stu-id="b67ec-116">The data in a nested table can be used for prediction or for input, or for both.</span></span> <span data-ttu-id="b67ec-117">例如，您可能有兩個巢狀資料表資料行在一個模型中：一個巢狀資料表資料行可能包含客戶已購買的產品清單，而另一個巢狀資料表則包含調查到的客戶嗜好與興趣資訊。</span><span class="sxs-lookup"><span data-stu-id="b67ec-117">For example, you might have two nested table columns in a model: one nested table column might contain a list of the products that a customer has purchased, while the other nested table column contains information about the customer's hobbies and interests, possibly obtained from a survey.</span></span> <span data-ttu-id="b67ec-118">在此案例中，您可以使用客戶的嗜好與興趣，做為分析購買行為以及預測可能購買產品的輸入。</span><span class="sxs-lookup"><span data-stu-id="b67ec-118">In this scenario, you could use the customer's hobbies and interests as an input for analyzing purchasing behavior, and predicting likely purchases.</span></span>  
  
## <a name="joining-case-tables-and-nested-tables"></a><span data-ttu-id="b67ec-119">聯結案例資料表和巢狀資料表</span><span class="sxs-lookup"><span data-stu-id="b67ec-119">Joining Case Tables and Nested Tables</span></span>  
 <span data-ttu-id="b67ec-120">為了建立巢狀資料表，兩個來源資料表必須包含已定義的關聯性，讓一個資料表中的項目可以與另一個資料表相關。</span><span class="sxs-lookup"><span data-stu-id="b67ec-120">In order to create a nested table, the two source tables must contain a defined relationship so that the items in one table can be related to the other table.</span></span> <span data-ttu-id="b67ec-121">在 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中，您可以在資料來源檢視內定義此關聯性。</span><span class="sxs-lookup"><span data-stu-id="b67ec-121">In [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], you can define this relationship in the data source view.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b67ec-122">**CustomerKey** 欄位是關聯式索引鍵，用於在資料來源檢視定義內連結案例資料表和巢狀資料表，以及在採礦結構內建立資料行的關聯性。</span><span class="sxs-lookup"><span data-stu-id="b67ec-122">The **CustomerKey** field is the relational key that is used to link the case table and the nested table within the data source view definition, and to establish the relationship of the columns within the mining structure.</span></span> <span data-ttu-id="b67ec-123">不過，一般而言，您不應該在建立於該結構上的採礦模型中使用此關聯式索引鍵。</span><span class="sxs-lookup"><span data-stu-id="b67ec-123">However, typically you should not use this relational key in mining models built on that structure.</span></span> <span data-ttu-id="b67ec-124">如果關聯式索引鍵資料行只用於聯結資料表，而不會提供對於分析有用的資訊，則通常最好將它從採礦模型內去除。</span><span class="sxs-lookup"><span data-stu-id="b67ec-124">Usually it is best to omit the relational key column from the mining model if it serves only to join the tables and does not provide information that is interesting for analysis.</span></span>  
  
 <span data-ttu-id="b67ec-125">您可以使用資料採礦延伸模組 (DMX) 或分析管理物件 (AMO)，以程式設計方式來建立巢狀資料表，或使用 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]中的資料採礦精靈和資料採礦設計師來建立巢狀資料表。</span><span class="sxs-lookup"><span data-stu-id="b67ec-125">You can create nested tables programmatically by either using Data Mining Extensions (DMX) or Analysis Management Objects (AMO), or you can use the Data Mining Wizard and Data Mining Designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span></span>  
  
## <a name="using-nested-table-columns-in-a-mining-model"></a><span data-ttu-id="b67ec-126">在採礦模型中使用巢狀資料表資料行</span><span class="sxs-lookup"><span data-stu-id="b67ec-126">Using Nested Table Columns in a Mining Model</span></span>  
 <span data-ttu-id="b67ec-127">在案例資料表中，索引鍵通常是客戶識別碼、產品名稱或數列中的日期，也就是能在資料表中唯一識別資料列的資料。</span><span class="sxs-lookup"><span data-stu-id="b67ec-127">In the case table, the key is often a customer ID, a product name, or date in a series: data that uniquely identifies a row in the table.</span></span> <span data-ttu-id="b67ec-128">.</span><span class="sxs-lookup"><span data-stu-id="b67ec-128">.</span></span> <span data-ttu-id="b67ec-129">不過，在巢狀資料表中，索引鍵通常不是關聯式索引鍵 (或外部索引鍵)，而是代表您正在建模之屬性的資料行。</span><span class="sxs-lookup"><span data-stu-id="b67ec-129">However, in nested tables, the key is typically not the relational key (or foreign key) but rather the column that represents the attribute that you are modeling.</span></span>  
  
 <span data-ttu-id="b67ec-130">例如，如果案例資料表包含訂單，而巢狀資料表包含訂單中的項目，則您會想針對多個訂單的巢狀資料表所儲存項目之間的關聯性來建立模型 (這些訂單是儲存在案例資料表中)。</span><span class="sxs-lookup"><span data-stu-id="b67ec-130">For example, if the case table contains orders, and the nested table contains items in the order, you would be interested in modeling the relationship between items stored in the nested table across multiple orders, which are stored in the case table.</span></span> <span data-ttu-id="b67ec-131">因此，雖然 **Items** 巢狀資料表會依照關聯式索引鍵 **OrderID** 聯結到 **Orders**案例資料表，但您不該使用 **OrderID** 作為巢狀資料表索引鍵。</span><span class="sxs-lookup"><span data-stu-id="b67ec-131">Therefore, although the **Items** nested table is joined to the **Orders** case table by the relational key **OrderID**, you should not use **OrderID** as the nested table key.</span></span> <span data-ttu-id="b67ec-132">而是應該選取 **Items** 資料行作為巢狀資料表索引鍵，因為該資料行包含您要建立模型的資料。</span><span class="sxs-lookup"><span data-stu-id="b67ec-132">Instead, you would select the **Items** column as the nested table key, because that column contains the data that you want to model.</span></span> <span data-ttu-id="b67ec-133">大多數的情況下，您都可以忽略採礦模型中的 **OrderID** 而不會發生問題，因為案例資料表和巢狀資料表之間的關聯性已藉由資料來源檢視定義而建立。</span><span class="sxs-lookup"><span data-stu-id="b67ec-133">In most cases, you can safely ignore **OrderID** in the mining model, because the relationship between the case table and the nested table has already been established by the data source view definition.</span></span>  
  
 <span data-ttu-id="b67ec-134">當您選擇資料行當做巢狀資料表索引鍵時，必須確定該資料行中的值對每個案例而言是唯一的。</span><span class="sxs-lookup"><span data-stu-id="b67ec-134">When you choose a column to use as the nested table key, you must ensure that the values in that column are unique for each case.</span></span> <span data-ttu-id="b67ec-135">例如，如果案例資料表代表客戶而巢狀資料表代表該客戶購買的項目，您就必須確定為每個客戶列出的項目不會超過一次。</span><span class="sxs-lookup"><span data-stu-id="b67ec-135">For example, if the case table represents customers and the nested table represents items purchased by the customer, you must ensure that no item is listed more than one time per customer.</span></span> <span data-ttu-id="b67ec-136">如果客戶購買同一項目超過一次，則您可以建立不同的檢視，以提供資料行來彙總每項唯一產品的購買次數。</span><span class="sxs-lookup"><span data-stu-id="b67ec-136">If a customer has purchased the same item more than one time, you might want to create a different view that has a column that aggregates the count of purchases for each unique product.</span></span>  
  
 <span data-ttu-id="b67ec-137">如何處理巢狀資料表中的重複值，是根據您建立的採礦模型以及要解決的商務問題而定。</span><span class="sxs-lookup"><span data-stu-id="b67ec-137">How you decide to handle duplicate values in a nested table depends on the mining model that you are creating and the business problem that you are solving.</span></span> <span data-ttu-id="b67ec-138">在某些情況下，您可能並不在意客戶購買特定產品的次數，而只想檢查是否至少有一次購買的記錄；</span><span class="sxs-lookup"><span data-stu-id="b67ec-138">In some scenarios you might not care how many times a customer has purchased a particular product, but want to check for the existence of at least one purchase.</span></span> <span data-ttu-id="b67ec-139">在其他情況下，購買的數量及順序則可能很重要。</span><span class="sxs-lookup"><span data-stu-id="b67ec-139">In other scenarios, the quantity and sequence of purchases might be very important.</span></span>  
  
 <span data-ttu-id="b67ec-140">如果項目的順序很重要，則可能需要其他的資料行來代表順序。</span><span class="sxs-lookup"><span data-stu-id="b67ec-140">If the order of items is important, you might need an additional column that indicates the sequence.</span></span> <span data-ttu-id="b67ec-141">使用時序叢集演算法來建立模型時，必須選擇其他的 *key sequence* 資料行來代表項目的順序。</span><span class="sxs-lookup"><span data-stu-id="b67ec-141">When you use the sequence clustering algorithm to create a model, you must choose an additional *key sequence* column to represent the order of the items.</span></span> <span data-ttu-id="b67ec-142">Key Sequence 資料行是特殊種類的巢狀索引鍵，只會用於時序叢集模型且需要唯一的數值資料類型。</span><span class="sxs-lookup"><span data-stu-id="b67ec-142">The key sequence column is a special kind of nested key that is used only in sequence clustering models, and requires a unique numeric data type.</span></span> <span data-ttu-id="b67ec-143">例如，整數和日期這兩者都可當做 Key Sequence 資料行，但所有的時序值都必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="b67ec-143">For example, integers and dates can both be used as a key sequence column, but all sequence values must be unique.</span></span> <span data-ttu-id="b67ec-144">除了 Key Sequence 資料行之外，時序叢集模型也擁有巢狀資料表索引鍵，用於代表要建立模型的屬性 (例如已購買的產品等)。</span><span class="sxs-lookup"><span data-stu-id="b67ec-144">In addition to the key sequence column, a sequence clustering model also has a nested table key that represents the attribute that is being modeled, such as the products that have been purchased.</span></span>  
  
### <a name="using-non-key-nested-columns-from-a-nested-table"></a><span data-ttu-id="b67ec-145">從巢狀資料表使用非索引鍵巢狀資料行</span><span class="sxs-lookup"><span data-stu-id="b67ec-145">Using Non-Key Nested Columns from a Nested Table</span></span>  
 <span data-ttu-id="b67ec-146">在您定義案例資料表及巢狀資料表之間的聯結，並選擇含有有趣及唯一的屬性 (要當做巢狀資料表索引鍵) 的資料行後，就可以包含巢狀資料表的其他資料行當做模型的輸出。</span><span class="sxs-lookup"><span data-stu-id="b67ec-146">After you have defined the join between the case table and the nested table, and you have chosen a column that contains interesting and unique attributes to use as the nested table key, you can include other columns from the nested table to use as input to the model.</span></span> <span data-ttu-id="b67ec-147">巢狀資料表的所有資料行都可用於輸出、預測及輸出，或僅用於預測。</span><span class="sxs-lookup"><span data-stu-id="b67ec-147">All columns from the nested table can be used for input, prediction and input, or for prediction only.</span></span>  
  
 <span data-ttu-id="b67ec-148">例如，如果巢狀資料表包含資料行 **Product**、 **ProductQuantity**和 **ProductPrice**，您可以選擇 **Product** 作為巢狀資料表索引鍵，但對採礦結構加入 **ProductQuantity** 當作輸出。</span><span class="sxs-lookup"><span data-stu-id="b67ec-148">For example, if the nested table contains the columns **Product**, **ProductQuantity**, and **ProductPrice**, you might choose **Product** as the nested table key, but add **ProductQuantity** to the mining structure to use as input.</span></span>  
  
## <a name="filtering-nested-table-data"></a><span data-ttu-id="b67ec-149">篩選巢狀資料表資料</span><span class="sxs-lookup"><span data-stu-id="b67ec-149">Filtering Nested Table Data</span></span>  
 <span data-ttu-id="b67ec-150">在 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]中，您可以在用於定型或測試資料採礦模型的資料上建立篩選。</span><span class="sxs-lookup"><span data-stu-id="b67ec-150">In [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], you can create filters on the data that is used to train or test a data mining model.</span></span> <span data-ttu-id="b67ec-151">篩選可用於影響模型的構成要素或在案例子集上測試模型。</span><span class="sxs-lookup"><span data-stu-id="b67ec-151">A filer can be used to affect the composition of the model, or to test the model on a subset of cases.</span></span> <span data-ttu-id="b67ec-152">篩選也可以套用到巢狀資料表。</span><span class="sxs-lookup"><span data-stu-id="b67ec-152">Filters can also be applied to nested tables.</span></span> <span data-ttu-id="b67ec-153">不過，巢狀資料表可使用的語法具有限制。</span><span class="sxs-lookup"><span data-stu-id="b67ec-153">However, there are limitations on the syntax that can be used with nested tables.</span></span>  
  
 <span data-ttu-id="b67ec-154">通常當您將篩選套用至巢狀資料表時，也是在測試屬性是否存在。</span><span class="sxs-lookup"><span data-stu-id="b67ec-154">Often when you apply a filter to a nested table you are testing for the existence or nonexistence of an attribute.</span></span> <span data-ttu-id="b67ec-155">例如，您可以套用篩選，限制模型中所用的案例只能是在巢狀資料表中具有指定值的案例。</span><span class="sxs-lookup"><span data-stu-id="b67ec-155">For example, you can apply a filter that restricts the cases used in the model to only those cases that have a specified value in the nested table.</span></span> <span data-ttu-id="b67ec-156">或者，也可以將模型中使用的案例限制為尚未購買過特定項目的客戶。</span><span class="sxs-lookup"><span data-stu-id="b67ec-156">Or, you could restrict the cases used in the model to customers who have not purchased a particular item.</span></span>  
  
 <span data-ttu-id="b67ec-157">在巢狀資料表上建立篩選時，也可以使用大於或小於等運算子。</span><span class="sxs-lookup"><span data-stu-id="b67ec-157">When you create filters on a nested table, you can also use operators such as greater than or less than.</span></span> <span data-ttu-id="b67ec-158">例如，您可以將模型中使用的案例限制為至少購買過 n 個目標產品的客戶。</span><span class="sxs-lookup"><span data-stu-id="b67ec-158">For example, you could restrict the cases used in the model to customers who had purchased at least n units of the target product.</span></span> <span data-ttu-id="b67ec-159">對巢狀資料表屬性進行篩選的能力，可為模型的自訂提供極大的彈性。</span><span class="sxs-lookup"><span data-stu-id="b67ec-159">The ability to filter on nested table attributes provides great flexibility for customizing models.</span></span>  
  
 <span data-ttu-id="b67ec-160">如需如何建立及使用模型篩選的詳細資訊，請參閱[採礦模型的篩選 &#40;Analysis Services - 資料採礦&#41;](mining-models-analysis-services-data-mining.md)。</span><span class="sxs-lookup"><span data-stu-id="b67ec-160">For more information about how to create and use model filters, see [Filters for Mining Models &#40;Analysis Services - Data Mining&#41;](mining-models-analysis-services-data-mining.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b67ec-161">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b67ec-161">See Also</span></span>  
 <span data-ttu-id="b67ec-162">[資料採礦演算法 &#40;Analysis Services-資料採礦&#41;](data-mining-algorithms-analysis-services-data-mining.md) </span><span class="sxs-lookup"><span data-stu-id="b67ec-162">[Data Mining Algorithms &#40;Analysis Services - Data Mining&#41;](data-mining-algorithms-analysis-services-data-mining.md) </span></span>  
 [<span data-ttu-id="b67ec-163">採礦結構 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="b67ec-163">Mining Structures &#40;Analysis Services - Data Mining&#41;</span></span>](mining-structures-analysis-services-data-mining.md)  
  
  
