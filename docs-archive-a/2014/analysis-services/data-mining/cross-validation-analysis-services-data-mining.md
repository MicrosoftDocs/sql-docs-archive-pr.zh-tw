---
title: 交叉驗證 (Analysis Services-資料採礦) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- stored procedures [Analysis Services], data mining
- cross-validation [data mining]
- scoring [data mining]
- accuracy testing [data mining]
ms.assetid: 718b9072-0f35-482a-a803-9178002ff5b9
author: minewiskan
ms.author: owend
ms.openlocfilehash: ea26856075d37d815d819fa0eada61d677f77819
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87594849"
---
# <a name="cross-validation-analysis-services---data-mining"></a><span data-ttu-id="6b876-102">交叉驗證 (Analysis Services - 資料採礦)</span><span class="sxs-lookup"><span data-stu-id="6b876-102">Cross-Validation (Analysis Services - Data Mining)</span></span>
  <span data-ttu-id="6b876-103">*交叉驗證*是分析中的標準工具，它是協助您開發和微調資料採礦模型的一項重要功能。</span><span class="sxs-lookup"><span data-stu-id="6b876-103">*Cross-validation* is a standard tool in analytics and is an important feature for helping you develop and fine-tune data mining models.</span></span> <span data-ttu-id="6b876-104">在您建立了採礦結構和相關的採礦模型之後，就可以使用交叉驗證來確定模型的有效性。</span><span class="sxs-lookup"><span data-stu-id="6b876-104">You use cross-validation after you have created a mining structure and related mining models to ascertain the validity of the model.</span></span>  <span data-ttu-id="6b876-105">交叉驗證具有下列應用方式：</span><span class="sxs-lookup"><span data-stu-id="6b876-105">Cross-validation has the following applications:</span></span>  
  
-   <span data-ttu-id="6b876-106">驗證特定採礦模型的健全性。</span><span class="sxs-lookup"><span data-stu-id="6b876-106">Validating the robustness of a particular mining model.</span></span>  
  
-   <span data-ttu-id="6b876-107">從單一陳述式評估多個模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-107">Evaluating multiple models from a single statement.</span></span>  
  
-   <span data-ttu-id="6b876-108">建立多個模型，然後根據統計資料來識別最佳模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-108">Building multiple models and then identifying the best model based on statistics.</span></span>  
  
 <span data-ttu-id="6b876-109">本節描述如何使用針對資料採礦提供的交叉驗證功能，以及如何針對單一模型或是以單一資料集為根據的多個模型來解譯交叉驗證的結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-109">This section describes how to use the cross-validation features provided for data mining, and how to interpret the results of cross-validation for either a single model or for multiple models based on a single data set.</span></span>  
  
## <a name="overview-of-cross-validation-process"></a><span data-ttu-id="6b876-110">交叉驗證程序的概觀</span><span class="sxs-lookup"><span data-stu-id="6b876-110">Overview of Cross-Validation Process</span></span>  
 <span data-ttu-id="6b876-111">交叉驗證包含兩個階段：定型和產生結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-111">Cross-validation consists of two phases, training and result generation.</span></span> <span data-ttu-id="6b876-112">這些階段包含下列步驟：</span><span class="sxs-lookup"><span data-stu-id="6b876-112">These phases include the following steps:</span></span>  
  
-   <span data-ttu-id="6b876-113">選取目標採礦結構。</span><span class="sxs-lookup"><span data-stu-id="6b876-113">You select a target mining structure.</span></span>  
  
-   <span data-ttu-id="6b876-114">指定您想要測試的模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-114">You specify the models you want to test.</span></span> <span data-ttu-id="6b876-115">這是選擇性步驟；您也可以只測試採礦結構。</span><span class="sxs-lookup"><span data-stu-id="6b876-115">This step is optional; you can test just the mining structure as well.</span></span>  
  
-   <span data-ttu-id="6b876-116">指定參數來測試定型的模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-116">You specify the parameters for testing the trained models.</span></span>  
  
    -   <span data-ttu-id="6b876-117">可預測的屬性、預測的值和精確度臨界值。</span><span class="sxs-lookup"><span data-stu-id="6b876-117">The predictable attribute, predicted value, and accuracy threshold.</span></span>  
  
    -   <span data-ttu-id="6b876-118">將結構或模型資料分割成的摺疊數。</span><span class="sxs-lookup"><span data-stu-id="6b876-118">The number of folds into which to partition the structure or model data.</span></span>  
  
-   [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6b876-119">所建立並定型的模型數目與摺疊數目一樣。</span><span class="sxs-lookup"><span data-stu-id="6b876-119">creates and trains as many models as there are folds.</span></span>  
  
-   [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6b876-120">會針對每個模型中的每個摺疊或是整體資料集傳回一組精確度標準。</span><span class="sxs-lookup"><span data-stu-id="6b876-120">returns a set of accuracy metrics for each fold in each model, or for the data set as a whole.</span></span>  
  
## <a name="configuring-cross-validation"></a><span data-ttu-id="6b876-121">設定交叉驗證</span><span class="sxs-lookup"><span data-stu-id="6b876-121">Configuring Cross-Validation</span></span>  
 <span data-ttu-id="6b876-122">您可以自訂交叉驗證的運作方式，以便控制交叉區段的數目、測試的模型，以及預測的精確度列。</span><span class="sxs-lookup"><span data-stu-id="6b876-122">You can customize the way that cross-validation works to control the number of cross-sections, the models that are tested, and the accuracy bar for predictions.</span></span> <span data-ttu-id="6b876-123">如果您使用交叉驗證預存程序，就可以同時指定用來驗證模型的資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-123">If you use the cross-validation stored procedures, you can also specify the data set that is used for validating the models.</span></span> <span data-ttu-id="6b876-124">這些豐富的選項表示您可以輕易地產生許多組之後必須比較和分析的不同結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-124">This wealth of choices means that you can easily produce many sets of different results that must then be compared and analyzed.</span></span>  
  
 <span data-ttu-id="6b876-125">本節提供的資訊可協助您正確地設定交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-125">This section provides information to help you configure cross-validation appropriately.</span></span>  
  
### <a name="setting-the-number-of-partitions"></a><span data-ttu-id="6b876-126">設定資料分割的數目</span><span class="sxs-lookup"><span data-stu-id="6b876-126">Setting the Number of Partitions</span></span>  
 <span data-ttu-id="6b876-127">當您指定資料分割的數目時，便決定了即將建立的暫時性模型數目。</span><span class="sxs-lookup"><span data-stu-id="6b876-127">When you specify the number of partitions, you determine how many temporary models will be created.</span></span> <span data-ttu-id="6b876-128">對於每個資料分割而言，資料的交叉區段會標示為當做測試集使用，而且針對不在資料分割中的其餘資料所做的定型會建立新的模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-128">For each partition, a cross-section of the data is flagged for use as the test set, and a new model is created by training on the remaining data not in the partition.</span></span> <span data-ttu-id="6b876-129">這項程序會重複進行，直到 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 已建立並測試指定的模型數目為止。</span><span class="sxs-lookup"><span data-stu-id="6b876-129">This process is repeated until [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] has created and tested the specified number of models.</span></span> <span data-ttu-id="6b876-130">您指定要用於交叉驗證的資料會平均地分配給所有資料分割。</span><span class="sxs-lookup"><span data-stu-id="6b876-130">The data that you specified as being available for cross-validation is distributed evenly among all partitions.</span></span>  
  
 <span data-ttu-id="6b876-131">下圖中的範例將說明指定了三個摺疊時，資料的使用方式。</span><span class="sxs-lookup"><span data-stu-id="6b876-131">The example in the diagram illustrates the usage of data if three folds are specified.</span></span>  
  
 <span data-ttu-id="6b876-132">![交叉驗證如何分割資料](../media/xvoverviewmain.gif "交叉驗證如何分割資料")</span><span class="sxs-lookup"><span data-stu-id="6b876-132">![How cross-validation segments data](../media/xvoverviewmain.gif "How cross-validation segments data")</span></span>  
  
 <span data-ttu-id="6b876-133">在上圖的狀況中，採礦結構包含用於測試的鑑效組資料集，但是尚未加入用於交叉驗證的測試資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-133">In the scenario in the diagram, the mining structure contains a holdout data set that is used for testing, but the test data set has not been included for cross-validation.</span></span> <span data-ttu-id="6b876-134">因此，訓練資料集中的所有資料 (採礦結構中 70% 的資料) 都會用於交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-134">As a result, all the data in the training data set, 70 percent of the data in the mining structure, is used for cross-validation.</span></span> <span data-ttu-id="6b876-135">交叉驗證報表會顯示每個資料分割中所用的案例總數。</span><span class="sxs-lookup"><span data-stu-id="6b876-135">The cross-validation report shows the total number of cases used in each partition.</span></span>  
  
 <span data-ttu-id="6b876-136">您也可以指定要使用的整體案例數目，藉以指定在交叉驗證期間使用的資料量。</span><span class="sxs-lookup"><span data-stu-id="6b876-136">You can also specify the amount of data that is used during cross-validation, by specifying the number of overall cases to use.</span></span> <span data-ttu-id="6b876-137">這些案例會平均地分配給所有摺疊。</span><span class="sxs-lookup"><span data-stu-id="6b876-137">The cases are distributed evenly across all folds.</span></span>  
  
 <span data-ttu-id="6b876-138">如果採礦結構儲存在 SQL Server [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的執行個體中，您可以針對摺疊數目設定的最大值就是 256 或案例的數目 (兩者取較小者)。</span><span class="sxs-lookup"><span data-stu-id="6b876-138">For mining structures stored in an instance of SQL Server [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], the maximum value that you can set for the number of folds is 256, or the number of cases, whichever is less.</span></span> <span data-ttu-id="6b876-139">如果您要使用工作階段採礦結構，最大摺疊數目就是 10。</span><span class="sxs-lookup"><span data-stu-id="6b876-139">If you are using a session mining structure, the maximum number of folds is 10.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6b876-140">當您增加摺疊的數目時，執行交叉驗證所需的時間就會因而增加，因為系統必須針對每個摺疊產生並測試一個模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-140">As you increase the number of folds, the time required to perform cross-validation increases accordingly, because a model must be generated and tested for each fold.</span></span> <span data-ttu-id="6b876-141">如果摺疊的數目過高，您可能會遇到效能問題。</span><span class="sxs-lookup"><span data-stu-id="6b876-141">You may experience performance problems if the number of folds is too high.</span></span>  
  
### <a name="setting-the-accuracy-threshold"></a><span data-ttu-id="6b876-142">設定精確度臨界值</span><span class="sxs-lookup"><span data-stu-id="6b876-142">Setting the Accuracy Threshold</span></span>  
 <span data-ttu-id="6b876-143">此狀態臨界值可讓您設定預測的精確度列。</span><span class="sxs-lookup"><span data-stu-id="6b876-143">The state threshold lets you set the accuracy bar for predictions.</span></span> <span data-ttu-id="6b876-144">對於每個案例而言，模型會計算 *「預測機率」*(Predict Probability)，這表示預測狀態正確的機率。</span><span class="sxs-lookup"><span data-stu-id="6b876-144">For each case, the model calculates the *predict probability*, meaning the probability that the predicted state is correct.</span></span> <span data-ttu-id="6b876-145">如果預測機率超過精確度列，預測就會計算成正確。如果沒有超過，預測就會計算成不正確。</span><span class="sxs-lookup"><span data-stu-id="6b876-145">If the predict probability exceeds the accuracy bar, the prediction is counted as correct; if not, the prediction is counted as incorrect.</span></span> <span data-ttu-id="6b876-146">您可以將 [狀態臨界值]\*\*\*\* 設定為介於 0.0 與 1.0 之間的數字來控制此值，其中較接近 1 的數字代表對於預測有信心的強烈等級，而較接近 0 的數字則代表預測不太可能成真。</span><span class="sxs-lookup"><span data-stu-id="6b876-146">You control this value by setting **State Threshold** to a number between 0.0 and 1.0, where numbers closer to 1 indicate a strong level of confidence in the predictions, and numbers closer to 0 indicate that the prediction is less likely to be true.</span></span> <span data-ttu-id="6b876-147">狀態臨界值的預測值為 NULL，表示具有最高機率的預測狀態會被視為目標值。</span><span class="sxs-lookup"><span data-stu-id="6b876-147">The default value for state threshold is NULL, which means that the predicted state with the highest probability is considered the target value.</span></span>  
  
 <span data-ttu-id="6b876-148">您應該注意，狀態臨界值的設定會影響模型精確度的量值。</span><span class="sxs-lookup"><span data-stu-id="6b876-148">You should be aware that the setting for state threshold affects measures of model accuracy.</span></span> <span data-ttu-id="6b876-149">例如，假設您有三個想要測試的模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-149">For example, assume that you have three models that you want to test.</span></span> <span data-ttu-id="6b876-150">所有模型都是根據相同的採礦結構，而且全都預測資料行 [Bike Buyer]。</span><span class="sxs-lookup"><span data-stu-id="6b876-150">All are based on the same mining structure and all predict the column [Bike Buyer].</span></span> <span data-ttu-id="6b876-151">此外，您也想要預測單一值 1，這表示「是的，將會購買」。</span><span class="sxs-lookup"><span data-stu-id="6b876-151">Moreover, you want to predict a single value of 1, meaning "yes, will buy."</span></span> <span data-ttu-id="6b876-152">這三個模型傳回預測機率為 0.05、0.15 和 0.8 的預測。</span><span class="sxs-lookup"><span data-stu-id="6b876-152">The three models return predictions with predict probabilities of 0.05, 0.15, and 0.8.</span></span> <span data-ttu-id="6b876-153">如果您將狀態臨界值設定為 0.10，其中兩個預測就會計算成正確。</span><span class="sxs-lookup"><span data-stu-id="6b876-153">If you set the state threshold to 0.10, two of the predictions are counted as correct.</span></span> <span data-ttu-id="6b876-154">如果您將狀態臨界值設定為 0.5，只有一個模型會計算成已傳回正確的預測。</span><span class="sxs-lookup"><span data-stu-id="6b876-154">If you set the state threshold to 0.5, only one model is counted as having returned a correct prediction.</span></span> <span data-ttu-id="6b876-155">如果您使用預設值 Null，最可能的預測就會計算成正確。</span><span class="sxs-lookup"><span data-stu-id="6b876-155">If you use the default value, null, the most probable prediction is counted as correct.</span></span> <span data-ttu-id="6b876-156">在此情況中，這三個預測都會計算成正確。</span><span class="sxs-lookup"><span data-stu-id="6b876-156">In this case, all three predictions would be counted as correct.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6b876-157">雖然您可以設定臨界值的值為 0.0，但是這個值沒有意義，因為每個預測都將計算成正確，即使是機率為零的預測也一樣。</span><span class="sxs-lookup"><span data-stu-id="6b876-157">You can set a value of 0.0 for the threshold, but the value is meaningless, because every prediction will be counted as correct, even those with zero probability.</span></span> <span data-ttu-id="6b876-158">請小心不要將 [狀態臨界值]\*\*\*\* 設定為 0.0。</span><span class="sxs-lookup"><span data-stu-id="6b876-158">Be careful not to accidentally set **State Threshold** to 0.0.</span></span>  
  
### <a name="choosing-models-and-columns-to-validate"></a><span data-ttu-id="6b876-159">選擇要驗證的模型和資料行</span><span class="sxs-lookup"><span data-stu-id="6b876-159">Choosing Models and Columns to Validate</span></span>  
 <span data-ttu-id="6b876-160">當您使用資料採礦設計師中的 [交叉驗證]\*\*\*\* 索引標籤時，必須先從清單選取可預測的資料行。</span><span class="sxs-lookup"><span data-stu-id="6b876-160">When you use the **Cross Validation** tab in Data Mining Designer, you must first select the predictable column from a list.</span></span> <span data-ttu-id="6b876-161">一般而言，採礦結構可以支援許多採礦模型，但並不是所有的採礦模型都使用同一個可預測資料行。</span><span class="sxs-lookup"><span data-stu-id="6b876-161">Typically, a mining structure can support many mining models, not all of which use the same predictable column.</span></span> <span data-ttu-id="6b876-162">當您執行交叉驗證時，只有使用同一個可預測資料行的模型可包含在報表中。</span><span class="sxs-lookup"><span data-stu-id="6b876-162">When you run cross-validation, only those models that use the same predictable column can be included in the report.</span></span>  
  
 <span data-ttu-id="6b876-163">若要選擇可預測屬性，請按一下 [目標屬性]\*\*\*\*，然後從清單選取資料行。</span><span class="sxs-lookup"><span data-stu-id="6b876-163">To choose a predictable attribute, click **Target Attribute** and select the column from the list.</span></span> <span data-ttu-id="6b876-164">如果目標屬性是一個嵌套的資料行，或是嵌套的資料表中的資料行，您就必須使用格式 \<Nested Table Name> (索引鍵) . 來輸入嵌套資料行的名稱 \<Nested Column> 。</span><span class="sxs-lookup"><span data-stu-id="6b876-164">If the target attribute is a nested column, or a column in a nested table, you must type the name of the nested column using the format \<Nested Table Name>(key).\<Nested Column>.</span></span> <span data-ttu-id="6b876-165">如果從嵌套資料表使用的唯一資料行是索引鍵資料行，您可以使用 \<Nested Table Name> (索引鍵) 。</span><span class="sxs-lookup"><span data-stu-id="6b876-165">If the only column used from the nested table is the key column, you can use \<Nested Table Name>(key).</span></span>  
  
 <span data-ttu-id="6b876-166">在您選取可預測屬性之後， [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 會自動測試所有使用同一個可預測屬性的模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-166">After you select the predictable attribute, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] automatically tests all models that use the same predictable attribute.</span></span> <span data-ttu-id="6b876-167">如果目標屬性包含離散的值，且您有想要預測的特定值，則可以在選取可預測資料行之後，選擇性地輸入目標狀態。</span><span class="sxs-lookup"><span data-stu-id="6b876-167">If the target attribute contains discrete values, after you have selected the predictable column, you can optionally type a target state, if there is a specific value that you want to predict.</span></span>  
  
 <span data-ttu-id="6b876-168">目標狀態的選擇會影響傳回的量值。</span><span class="sxs-lookup"><span data-stu-id="6b876-168">The selection of the target state affects the measures that are returned.</span></span> <span data-ttu-id="6b876-169">如果您指定目標屬性（也就是資料行名稱），而未挑選您想要讓模型預測的特定值，則根據預設，模型會在其最可能狀態的預測上進行評估。</span><span class="sxs-lookup"><span data-stu-id="6b876-169">If you specify a target attribute-that is, a column name-and do not pick a specific value that you want the model to predict, by default the model will be evaluated on its prediction of the most probable state.</span></span>  
  
 <span data-ttu-id="6b876-170">當您搭配叢集模型使用交叉驗證時，沒有可預測的資料行；而是要從 [目標屬性]\*\*\*\* 清單方塊中的清單選取 [#Cluster]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="6b876-170">When you use cross-validation with clustering models, there is no predictable column; instead, you select **#Cluster** from the list in the **Target Attribute** list box.</span></span> <span data-ttu-id="6b876-171">在選取這個選項之後，其他與叢集模型無關的選項 (例如，[目標狀態]\*\*\*\*) 就會停用。</span><span class="sxs-lookup"><span data-stu-id="6b876-171">After you have selected this option, other options that are not relevant to clustering models, such as **Target State**, are disabled.</span></span> [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="6b876-172">接著會測試所有與採礦結構相關聯的叢集模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-172">will then test all clustering models that are associated with the mining structure.</span></span>  
  
## <a name="tools-for-cross-validation"></a><span data-ttu-id="6b876-173">交叉驗證工具</span><span class="sxs-lookup"><span data-stu-id="6b876-173">Tools for Cross-Validation</span></span>  
 <span data-ttu-id="6b876-174">您可以從資料採礦設計師使用交叉驗證，或者藉由執行預存程序來執行交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-174">You can use cross-validation from the Data Mining Designer, or you can perform cross-validation by running stored procedures.</span></span>  
  
 <span data-ttu-id="6b876-175">如果您使用資料採礦設計師工具來執行交叉驗證，就可以在單一對話方塊中設定定型和精確度結果參數。</span><span class="sxs-lookup"><span data-stu-id="6b876-175">If you use the Data Mining Designer tools to perform cross-validation, you can configure the training and accuracy results parameters in a single dialog box.</span></span> <span data-ttu-id="6b876-176">這樣可讓您更輕易地設定和檢視結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-176">This makes it easier to set up and view results.</span></span> <span data-ttu-id="6b876-177">您可以測量與單一採礦結構有關之所有採礦模型的精確度，然後立即在 HTML 報表中檢視結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-177">You can measure the accuracy of all mining models that are related to a single mining structure and then immediately view the results in an HTML report.</span></span> <span data-ttu-id="6b876-178">此外，預存程序會提供一些優點，例如新增的自訂內容以及為程序撰寫指令碼的功能。</span><span class="sxs-lookup"><span data-stu-id="6b876-178">However, the stored procedures offer some advantages, such as added customizations and the ability to script the process.</span></span>  
  
### <a name="cross-validation-in-data-mining-designer"></a><span data-ttu-id="6b876-179">資料採礦設計師中的交叉驗證</span><span class="sxs-lookup"><span data-stu-id="6b876-179">Cross-Validation in Data Mining Designer</span></span>  
 <span data-ttu-id="6b876-180">您可以在 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 或 SQL Server Development Studio 中使用 [採礦精確度圖表] 檢視的 [交叉驗證]\*\*\*\* 索引標籤，藉以執行交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-180">You can perform cross-validation by using the **Cross-Validation** tab of the Mining Accuracy Chart view in either [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or SQL Server Development Studio.</span></span>  
  
 <span data-ttu-id="6b876-181">若要查看如何使用此使用者介面建立交叉驗證報表的範例，請參閱 [建立交叉驗證報表](create-a-cross-validation-report.md)。</span><span class="sxs-lookup"><span data-stu-id="6b876-181">To see an example of how to create a cross-validation report using the user interface, see [Create a Cross-Validation Report](create-a-cross-validation-report.md).</span></span>  
  
### <a name="cross-validation-stored-procedures"></a><span data-ttu-id="6b876-182">交叉驗證預存程序</span><span class="sxs-lookup"><span data-stu-id="6b876-182">Cross-Validation Stored Procedures</span></span>  
 <span data-ttu-id="6b876-183">對於進階使用者而言，交叉驗證也可以完全參數化系統預存程序的形式來提供。</span><span class="sxs-lookup"><span data-stu-id="6b876-183">For advanced users, cross-validation is also available in the form of fully parameterized system stored procedures.</span></span> <span data-ttu-id="6b876-184">您可以從 [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] 或任何 Managed 程式碼應用程式連接至 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]執行個體，藉以執行這些預存程序。</span><span class="sxs-lookup"><span data-stu-id="6b876-184">You can run the stored procedures by connecting to an instance of [!INCLUDE[ssASCurrent](../../includes/ssascurrent-md.md)] from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], or from any managed code application.</span></span>  
  
 <span data-ttu-id="6b876-185">這些預存程序是依據採礦模型類型分組的。</span><span class="sxs-lookup"><span data-stu-id="6b876-185">The stored procedures are grouped by mining model type.</span></span> <span data-ttu-id="6b876-186">其中一組預存程序只會搭配叢集模型一起運作。</span><span class="sxs-lookup"><span data-stu-id="6b876-186">One set of stored procedures works with clustering models only.</span></span> <span data-ttu-id="6b876-187">其他另一組預存程序則會搭配其他採礦模型一起運作。</span><span class="sxs-lookup"><span data-stu-id="6b876-187">The other set of stored procedures works with other mining models.</span></span>  
  
 <span data-ttu-id="6b876-188">針對每種類型的「模型」或「非叢集」，預存程式會以兩個不同的階段執行交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-188">For each type of mining model, clustered or nonclustered, the stored procedures perform cross-validation in two separate phases.</span></span>  
  
 <span data-ttu-id="6b876-189">**分割資料並產生資料分割的標準**</span><span class="sxs-lookup"><span data-stu-id="6b876-189">**Partition data and generate metrics for partitions**</span></span>  
  
 <span data-ttu-id="6b876-190">在第一個階段中，您會呼叫系統預存程序，此程序所建立的資料分割數目與您在資料集內部指定的數目一樣，而且它會針對每個資料分割傳回精確度結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-190">For the first phase, you call a system stored procedure that creates as many partitions as you specify within the data set, and returns accuracy results for each partition.</span></span> <span data-ttu-id="6b876-191">然後 Analysis Services 會針對每個標準計算資料分割的平均和標準差。</span><span class="sxs-lookup"><span data-stu-id="6b876-191">For each metric, Analysis Services then calculates the mean and standard deviation for the partitions.</span></span>  
  
-   [<span data-ttu-id="6b876-192">SystemGetCrossValidationResults &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-192">SystemGetCrossValidationResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetcrossvalidationresults-analysis-services-data-mining)  
  
-   [<span data-ttu-id="6b876-193">SystemGetClusterCrossValidationResults &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-193">SystemGetClusterCrossValidationResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetclustercrossvalidationresults-analysis-services-data-mining)  
  
 <span data-ttu-id="6b876-194">**產生整個資料集的標準**</span><span class="sxs-lookup"><span data-stu-id="6b876-194">**Generate metrics for entire data set**</span></span>  
  
 <span data-ttu-id="6b876-195">在第二個階段中，您會呼叫另一組預存程序。</span><span class="sxs-lookup"><span data-stu-id="6b876-195">In the second phase, you call a different set of stored procedures.</span></span> <span data-ttu-id="6b876-196">這些預存程序不會分割資料集，但是會針對整個指定的資料集傳回精確度結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-196">These stored procedures do not partition the data set, but generate accuracy results for the specified data set as a whole.</span></span> <span data-ttu-id="6b876-197">如果您已經分割和處理採礦結構，您可以呼叫第二組預存程序來得到結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-197">If you have already partitioned and processed a mining structure, you can call this second set of stored procedures to get just the results.</span></span>  
  
-   [<span data-ttu-id="6b876-198">SystemGetAccuracyResults &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-198">SystemGetAccuracyResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetaccuracyresults-analysis-services-data-mining)  
  
-   [<span data-ttu-id="6b876-199">SystemGetClusterAccuracyResults &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-199">SystemGetClusterAccuracyResults &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/systemgetclusteraccuracyresults-analysis-services-data-mining)  
  
#### <a name="defining-the-testing-data"></a><span data-ttu-id="6b876-200">定義測試資料</span><span class="sxs-lookup"><span data-stu-id="6b876-200">Defining the Testing Data</span></span>  
 <span data-ttu-id="6b876-201">當您執行計算精確度的交叉驗證預存程序 (SystemGetAccuracyResults 或 SystemGetClusterAccuracyResults) 時，您可以指定在交叉驗證期間進行測試所使用的資料來源。</span><span class="sxs-lookup"><span data-stu-id="6b876-201">When you run the cross-validation stored procedures that calculate accuracy (SystemGetAccuracyResults or SystemGetClusterAccuracyResults), you can specify the source of the data that is used for testing during cross-validation.</span></span> <span data-ttu-id="6b876-202">使用者介面中無法使用這個選項。</span><span class="sxs-lookup"><span data-stu-id="6b876-202">This option is not available in the user interface.</span></span>  
  
 <span data-ttu-id="6b876-203">您可以將下列任何選項指定為測試資料來源：</span><span class="sxs-lookup"><span data-stu-id="6b876-203">You can specify as a testing data source any of the following options:</span></span>  
  
-   <span data-ttu-id="6b876-204">僅使用定型資料。</span><span class="sxs-lookup"><span data-stu-id="6b876-204">Use only the training data.</span></span>  
  
-   <span data-ttu-id="6b876-205">包含現有的測試資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-205">Include an existing testing data set.</span></span>  
  
-   <span data-ttu-id="6b876-206">僅使用測試資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-206">Use only the testing data set.</span></span>  
  
-   <span data-ttu-id="6b876-207">將現有的篩選套用至每個模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-207">Apply existing filters to each model.</span></span>  
  
-   <span data-ttu-id="6b876-208">定型集、測試集和模型篩選的任何組合。</span><span class="sxs-lookup"><span data-stu-id="6b876-208">Any combination of the training set, testing set, and model filters.</span></span>  
  
 <span data-ttu-id="6b876-209">若要指定測試資料來源，您會針對預存程序的 `DataSet` 參數提供整數值。</span><span class="sxs-lookup"><span data-stu-id="6b876-209">To specify a testing data source, you provide an integer value for the `DataSet` parameter of the stored procedure.</span></span> <span data-ttu-id="6b876-210">如需引數值的清單，請參閱相關預存程序參考主題的＜備註＞一節。</span><span class="sxs-lookup"><span data-stu-id="6b876-210">For a list of the argument values, see the Remarks section of the relevant stored procedure reference topic.</span></span>  
  
 <span data-ttu-id="6b876-211">如果您使用資料採礦設計師中的 [交叉驗證]\*\*\*\* 報表來執行交叉驗證，就無法變更所使用的資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-211">If you perform cross-validation by using the **Cross-Validation** report in the Data Mining Designer, you cannot change the data set that is used.</span></span> <span data-ttu-id="6b876-212">根據預設，系統會使用每個模型的定型案例。</span><span class="sxs-lookup"><span data-stu-id="6b876-212">By default, the training cases for each model are used.</span></span> <span data-ttu-id="6b876-213">如果某個篩選與某個模型相關聯，就會套用此篩選。</span><span class="sxs-lookup"><span data-stu-id="6b876-213">If a filter is associated with a model, the filter is applied.</span></span>  
  
## <a name="results-of-cross-validation"></a><span data-ttu-id="6b876-214">交叉驗證的結果</span><span class="sxs-lookup"><span data-stu-id="6b876-214">Results of Cross-Validation</span></span>  
 <span data-ttu-id="6b876-215">如果您使用資料採礦設計師，這些結果會顯示在類似方格的 Web 檢視器中。</span><span class="sxs-lookup"><span data-stu-id="6b876-215">If you use the Data Mining Designer, these results are displayed in a grid-like Web viewer.</span></span> <span data-ttu-id="6b876-216">如果您使用交叉驗證預存程序，這些相同的結果會以資料表形式傳回。</span><span class="sxs-lookup"><span data-stu-id="6b876-216">If you use the cross-validation stored procedures, these same results are returned as a table.</span></span>  
  
 <span data-ttu-id="6b876-217">報表包含兩種類型的量值：在分成若干摺疊時，指示資料集變化性的彙總，以及每一個摺疊之精確度的模型特有量值。</span><span class="sxs-lookup"><span data-stu-id="6b876-217">The report contains two types of measures: aggregates that indicate the variability of the data set when divided into folds, and model-specific measures of accuracy for each fold.</span></span> <span data-ttu-id="6b876-218">下列主題提供有關這些量值的詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="6b876-218">The following topics provide more information about these metrics:</span></span>  
  
 [<span data-ttu-id="6b876-219">交叉驗證公式</span><span class="sxs-lookup"><span data-stu-id="6b876-219">Cross-Validation Formulas</span></span>](cross-validation-formulas.md)  
  
 <span data-ttu-id="6b876-220">依測試類型列出所有量值。</span><span class="sxs-lookup"><span data-stu-id="6b876-220">Lists all the measures by test type.</span></span> <span data-ttu-id="6b876-221">描述一般情況下可以解譯量值的方式。</span><span class="sxs-lookup"><span data-stu-id="6b876-221">Describes in general how the measures can be interpreted.</span></span>  
  
 [<span data-ttu-id="6b876-222">交叉驗證報表中的量值</span><span class="sxs-lookup"><span data-stu-id="6b876-222">Measures in the Cross-Validation Report</span></span>](measures-in-the-cross-validation-report.md)  
  
 <span data-ttu-id="6b876-223">描述用來計算每一個量值的公式，並列出可以套用每一個量值的屬性類型。</span><span class="sxs-lookup"><span data-stu-id="6b876-223">Describes the formulas for calculating each measure, and lists the type of attribute that each measure can be applied to.</span></span>  
  
## <a name="restrictions-on-cross-validation"></a><span data-ttu-id="6b876-224">交叉驗證的限制</span><span class="sxs-lookup"><span data-stu-id="6b876-224">Restrictions on Cross-Validation</span></span>  
 <span data-ttu-id="6b876-225">如果使用 SQL Server Development Studio 中的交叉驗證報表來執行交叉驗證，則可測試的模型及可設定的參數就會有些限制。</span><span class="sxs-lookup"><span data-stu-id="6b876-225">If you perform cross-validation by using the cross-validation report in SQL Server Development Studio, there are some limitations on the models that you can test and the parameters you can set.</span></span>  
  
-   <span data-ttu-id="6b876-226">根據預設，所有與選取的採礦結構相關聯的所有模型都會經過交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-226">By default, all models associated with the selected mining structure are cross-validated.</span></span> <span data-ttu-id="6b876-227">您無法指定單一模型或模型清單。</span><span class="sxs-lookup"><span data-stu-id="6b876-227">You cannot specify the model or a list of models.</span></span>  
  
-   <span data-ttu-id="6b876-228">以「Microsoft 時間序列」演算法或「Microsoft 時序叢集」演算法為基礎的模型不支援交叉驗證。</span><span class="sxs-lookup"><span data-stu-id="6b876-228">Cross-validation is not supported for models that are based on the Microsoft Time Series algorithm or the Microsoft Sequence Clustering algorithm.</span></span>  
  
-   <span data-ttu-id="6b876-229">如果採礦結構不包含任何可藉由交叉驗證而測試的模型，就無法建立報表。</span><span class="sxs-lookup"><span data-stu-id="6b876-229">The report cannot be created if your mining structure does not contain any models that can be tested by cross-validation.</span></span>  
  
-   <span data-ttu-id="6b876-230">如果採礦結構同時包含叢集和非叢集模型，而您沒有選擇 **#Cluster** 選項，則兩種模型的結果都會顯示在同一報表中 (即使屬性、狀態和臨界值設定可能並不適合叢集模型)。</span><span class="sxs-lookup"><span data-stu-id="6b876-230">If the mining structure contains both clustering and non-clustering models and you do not choose the **#Cluster** option, results for both types of models are displayed in the same report, even though the attribute, state, and threshold settings might not be appropriate for the clustering models.</span></span>  
  
-   <span data-ttu-id="6b876-231">某些參數值會受到限制。</span><span class="sxs-lookup"><span data-stu-id="6b876-231">Some parameter values are restricted.</span></span> <span data-ttu-id="6b876-232">例如，在摺疊數超過 10 時會顯示警告，因為產生這麼多的模型可能會導致報表顯示緩慢。</span><span class="sxs-lookup"><span data-stu-id="6b876-232">For example, a warning is displayed if the number of folds is more than 10, because generating so many models might cause the report to display slowly.</span></span>  
  
 <span data-ttu-id="6b876-233">如果您要測試多個採礦模型，而且這些模型具有篩選，系統就會個別篩選每個模型。</span><span class="sxs-lookup"><span data-stu-id="6b876-233">If you are testing multiple mining models, and the models have filters, each model is filtered separately.</span></span> <span data-ttu-id="6b876-234">您無法在交叉驗證期間將篩選加入至模型，或變更模型的篩選。</span><span class="sxs-lookup"><span data-stu-id="6b876-234">You cannot add a filter to a model or change the filter for a model during cross-validation.</span></span>  
  
 <span data-ttu-id="6b876-235">由於交叉驗證預設會測試與結構相關聯的所有採礦模型，因此如果某些模型具有篩選而其他沒有，您可能就會收到不一致的結果。</span><span class="sxs-lookup"><span data-stu-id="6b876-235">Because cross-validation by defaults tests all mining models that are associated with a structure, you may receive inconsistent results if some models have a filter and others do not.</span></span> <span data-ttu-id="6b876-236">若要確保您只會比較這些具有相同篩選的模型，您應該使用預存程序並指定採礦模型的清單。</span><span class="sxs-lookup"><span data-stu-id="6b876-236">To ensure that you compare only those models that have the same filter, you should use the stored procedures and specify a list of mining models.</span></span> <span data-ttu-id="6b876-237">或者，請單獨使用沒有篩選的採礦結構測試集來確保系統會針對所有模型使用一致的資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-237">Or, use only the mining structure test set with no filters to ensure that a consistent set of data is used for all models.</span></span>  
  
 <span data-ttu-id="6b876-238">如果您使用預存程序來執行交叉驗證，您有另外一個選擇，也就是選擇測試資料的來源。</span><span class="sxs-lookup"><span data-stu-id="6b876-238">If you perform cross-validation by using the stored procedures, you have the additional option of choosing the source of testing data.</span></span> <span data-ttu-id="6b876-239">如果您使用資料採礦設計師來執行交叉驗證，您必須使用與此模型或結構相關聯的測試資料集 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="6b876-239">If you perform cross-validation by using the Data Mining Designer, you must use the testing data set that is associated with the model or structure, if any.</span></span> <span data-ttu-id="6b876-240">一般來說，如果您想要指定進階設定，則應該使用交叉驗證預存程序。</span><span class="sxs-lookup"><span data-stu-id="6b876-240">Generally, if you want to specify advanced settings, you should use the cross-validation stored procedures.</span></span>  
  
 <span data-ttu-id="6b876-241">交叉驗證無法搭配時間序列或時序叢集模型使用。</span><span class="sxs-lookup"><span data-stu-id="6b876-241">Cross-validation cannot be used with time series or sequence clustering models.</span></span> <span data-ttu-id="6b876-242">具體而言，交叉驗證無法搭配包含 KEY TIME 資料行或 KEY SEQUENCE 資料行的任何模型使用。</span><span class="sxs-lookup"><span data-stu-id="6b876-242">Specifically, no model that contains a KEY TIME column or a KEY SEQUENCE column can be included in cross-validation.</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="6b876-243">相關內容</span><span class="sxs-lookup"><span data-stu-id="6b876-243">Related Content</span></span>  
 <span data-ttu-id="6b876-244">如需有關交叉驗證的詳細資訊，或是有關測試採礦模型之相關方法 (例如，精確度圖表) 的資訊，請參閱以下主題。</span><span class="sxs-lookup"><span data-stu-id="6b876-244">See the following topics for more information about cross-validation, or information about related methods for testing mining models, such as accuracy charts.</span></span>  
  
|<span data-ttu-id="6b876-245">主題</span><span class="sxs-lookup"><span data-stu-id="6b876-245">Topics</span></span>|<span data-ttu-id="6b876-246">連結</span><span class="sxs-lookup"><span data-stu-id="6b876-246">Links</span></span>|  
|------------|-----------|  
|<span data-ttu-id="6b876-247">描述如何在 SQL Server Development Studio 中設定交叉驗證參數。</span><span class="sxs-lookup"><span data-stu-id="6b876-247">Describes how to set cross-validation parameters in SQL Server Development Studio.</span></span>|[<span data-ttu-id="6b876-248">交叉驗證索引標籤 &#40;採礦精確度圖表檢視&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-248">Cross-Validation Tab &#40;Mining Accuracy Chart View&#41;</span></span>](../cross-validation-tab-mining-accuracy-chart-view.md)|  
|<span data-ttu-id="6b876-249">描述交叉驗證所提供的標準</span><span class="sxs-lookup"><span data-stu-id="6b876-249">Describes the metrics that are provided by cross-validation</span></span>|[<span data-ttu-id="6b876-250">交叉驗證公式</span><span class="sxs-lookup"><span data-stu-id="6b876-250">Cross-Validation Formulas</span></span>](cross-validation-formulas.md)|  
|<span data-ttu-id="6b876-251">說明交叉驗證報表格式，並定義針對每一個模型類型提供的統計量值。</span><span class="sxs-lookup"><span data-stu-id="6b876-251">Explains the cross-validation report format and defines the statistical measures provided for each model type.</span></span>|[<span data-ttu-id="6b876-252">交叉驗證報表中的量值</span><span class="sxs-lookup"><span data-stu-id="6b876-252">Measures in the Cross-Validation Report</span></span>](measures-in-the-cross-validation-report.md)|  
|<span data-ttu-id="6b876-253">列出用來計算交叉驗證統計資料的預存程序。</span><span class="sxs-lookup"><span data-stu-id="6b876-253">Lists the stored procedures for computing cross-validation statistics.</span></span>|[<span data-ttu-id="6b876-254">資料採礦預存程序 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-254">Data Mining Stored Procedures &#40;Analysis Services - Data Mining&#41;</span></span>](/sql/analysis-services/data-mining/data-mining-stored-procedures-analysis-services-data-mining)|  
|||  
|<span data-ttu-id="6b876-255">描述如何針對採礦結構和相關模型建立測試資料集。</span><span class="sxs-lookup"><span data-stu-id="6b876-255">Describes how to create a testing data set for mining structures and related models.</span></span>|[<span data-ttu-id="6b876-256">定型和測試資料集</span><span class="sxs-lookup"><span data-stu-id="6b876-256">Training and Testing Data Sets</span></span>](training-and-testing-data-sets.md)|  
|<span data-ttu-id="6b876-257">請參閱其他精確度圖表類型的範例。</span><span class="sxs-lookup"><span data-stu-id="6b876-257">See examples of other accuracy chart types.</span></span>|[<span data-ttu-id="6b876-258">分類矩陣 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-258">Classification Matrix &#40;Analysis Services - Data Mining&#41;</span></span>](classification-matrix-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6b876-259">增益圖 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-259">Lift Chart &#40;Analysis Services - Data Mining&#41;</span></span>](lift-chart-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6b876-260">收益圖 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-260">Profit Chart &#40;Analysis Services - Data Mining&#41;</span></span>](profit-chart-analysis-services-data-mining.md)<br /><br /> [<span data-ttu-id="6b876-261">散佈圖 &#40;Analysis Services - 資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-261">Scatter Plot &#40;Analysis Services - Data Mining&#41;</span></span>](scatter-plot-analysis-services-data-mining.md)|  
|<span data-ttu-id="6b876-262">描述建立各種精確度圖表的步驟。</span><span class="sxs-lookup"><span data-stu-id="6b876-262">Describes steps for creating various accuracy charts.</span></span>|[<span data-ttu-id="6b876-263">測試及驗證工作與操作方法 &#40;資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-263">Testing and Validation Tasks and How-tos &#40;Data Mining&#41;</span></span>](testing-and-validation-tasks-and-how-tos-data-mining.md)|  
  
## <a name="see-also"></a><span data-ttu-id="6b876-264">另請參閱</span><span class="sxs-lookup"><span data-stu-id="6b876-264">See Also</span></span>  
 [<span data-ttu-id="6b876-265">測試及驗證 &#40;資料採礦&#41;</span><span class="sxs-lookup"><span data-stu-id="6b876-265">Testing and Validation &#40;Data Mining&#41;</span></span>](testing-and-validation-data-mining.md)  
  
  
