---
title: 索引的 SORT_IN_TEMPDB 選項 | Microsoft 文件
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- SORT_IN_TEMPDB option
- disk space [SQL Server], indexes
- space [SQL Server], indexes
- tempdb database [SQL Server], indexes
- indexes [SQL Server], tempdb database
- index creation [SQL Server], tempdb database
ms.assetid: 754a003f-fe51-4d10-975a-f6b8c04ebd35
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 8feccc5b1d29617193f481569e10648c6ed77242
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87707533"
---
# <a name="sort_in_tempdb-option-for-indexes"></a><span data-ttu-id="b1c77-102">索引的 SORT_IN_TEMPDB 選項</span><span class="sxs-lookup"><span data-stu-id="b1c77-102">SORT_IN_TEMPDB Option For Indexes</span></span>
  <span data-ttu-id="b1c77-103">當您建立或重建索引時，可將 SORT_IN_TEMPDB 選項設為 ON，以便指示 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] 使用 **tempdb** 來儲存用來建立索引的中繼排序結果。</span><span class="sxs-lookup"><span data-stu-id="b1c77-103">When you create or rebuild an index, by setting the SORT_IN_TEMPDB option to ON you can direct the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] to use **tempdb** to store the intermediate sort results that are used to build the index.</span></span> <span data-ttu-id="b1c77-104">雖然此選項會增加建立索引所使用的暫存磁碟空間數量，但只要 **tempdb** 所在的磁碟集與使用者資料庫不同，該選項就會減少建立或重建索引所需的時間。</span><span class="sxs-lookup"><span data-stu-id="b1c77-104">Although this option increases the amount of temporary disk space that is used to create an index, the option could reduce the time that is required to create or rebuild an index when **tempdb** is on a set of disks different from that of the user database.</span></span> <span data-ttu-id="b1c77-105">如需 **tempdb**的詳細資訊，請參閱 [設定 index create memory 伺服器組態選項](../../database-engine/configure-windows/configure-the-index-create-memory-server-configuration-option.md)。</span><span class="sxs-lookup"><span data-stu-id="b1c77-105">For more information about **tempdb**, see [Configure the index create memory Server Configuration Option](../../database-engine/configure-windows/configure-the-index-create-memory-server-configuration-option.md).</span></span>  
  
## <a name="phases-of-index-building"></a><span data-ttu-id="b1c77-106">索引建立階段</span><span class="sxs-lookup"><span data-stu-id="b1c77-106">Phases of Index Building</span></span>  
 <span data-ttu-id="b1c77-107">當 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 建立索引時，它將經歷下列階段：</span><span class="sxs-lookup"><span data-stu-id="b1c77-107">As the [!INCLUDE[ssDE](../../includes/ssde-md.md)] builds an index, it goes through the following phases:</span></span>  
  
-   <span data-ttu-id="b1c77-108">[!INCLUDE[ssDE](../../includes/ssde-md.md)] 會先掃描基底資料表的資料頁來擷取索引鍵值，然後替每個資料列建立索引分葉資料列。</span><span class="sxs-lookup"><span data-stu-id="b1c77-108">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] first scans the data pages of the base table to retrieve key values and builds an index leaf row for each data row.</span></span> <span data-ttu-id="b1c77-109">當內部的排序緩衝區已填滿分葉索引項目，這些項目將進行排序並寫至磁碟中，作為中間的排序結果。</span><span class="sxs-lookup"><span data-stu-id="b1c77-109">When the internal sort buffers have been filled with leaf index entries, the entries are sorted and written to disk as an intermediate sort run.</span></span> <span data-ttu-id="b1c77-110">接著 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 將繼續進行資料頁掃描，直到排序緩衝區再次填滿為止。</span><span class="sxs-lookup"><span data-stu-id="b1c77-110">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] then resumes the data page scan until the sort buffers are again filled.</span></span> <span data-ttu-id="b1c77-111">此掃描多重資料頁、再跟著排序與寫入排序結果的模式將持續進行，直到基底資料表的所有資料列都處理完畢為止。</span><span class="sxs-lookup"><span data-stu-id="b1c77-111">This pattern of scanning multiple data pages followed by sorting and writing a sort run continues until all the rows of the base table have been processed.</span></span>  
  
     <span data-ttu-id="b1c77-112">在叢集索引中，索引的分葉資料列為資料表的資料列，因此中繼的排序結果將包含所有的資料列。</span><span class="sxs-lookup"><span data-stu-id="b1c77-112">In a clustered index, the leaf rows of the index are the data rows of the table; therefore, the intermediate sort runs contain all the data rows.</span></span> <span data-ttu-id="b1c77-113">在非叢集索引中，雖然分葉資料列可能會包含非索引鍵資料行，但通常還是比叢集索引小。</span><span class="sxs-lookup"><span data-stu-id="b1c77-113">In a nonclustered index, the leaf rows may contain nonkey columns, but are generally smaller than a clustered index.</span></span> <span data-ttu-id="b1c77-114">如果索引鍵很大，或索引中包含數個非索引鍵資料行，則非叢集的排序結果可能會很大。</span><span class="sxs-lookup"><span data-stu-id="b1c77-114">If the index keys are large, or there are several nonkey columns included in the index, a nonclustered sort run can be large.</span></span> <span data-ttu-id="b1c77-115">如需包含非索引鍵資料行的詳細資訊，請參閱 [建立內含資料行的索引](create-indexes-with-included-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="b1c77-115">For more information about including nonkey columns, see [Create Indexes with Included Columns](create-indexes-with-included-columns.md).</span></span>  
  
-   <span data-ttu-id="b1c77-116">[!INCLUDE[ssDE](../../includes/ssde-md.md)] 會將索引分葉資料列的排序結果，合併成一個排序好的資料流。</span><span class="sxs-lookup"><span data-stu-id="b1c77-116">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] merges the sorted runs of index leaf rows into a single, sorted stream.</span></span> <span data-ttu-id="b1c77-117">[!INCLUDE[ssDE](../../includes/ssde-md.md)] 的排序合併元件將開始於每個排序結果的第一頁，找出所有頁面中的最低索引鍵，並將該分葉資料列傳送給索引建立元件。</span><span class="sxs-lookup"><span data-stu-id="b1c77-117">The sort merge component of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] starts with the first page of each sort run, finds the lowest key in all the pages, and passes that leaf row to the index create component.</span></span> <span data-ttu-id="b1c77-118">接著處理第二低的索引鍵，然後處理第三低，其餘依此類推。</span><span class="sxs-lookup"><span data-stu-id="b1c77-118">The next lowest key is processed, and then the next, and so on.</span></span> <span data-ttu-id="b1c77-119">當最後一個分葉索引資料列從排序結果分頁中擷取出來之後，該處理序將切換到該排序結果的下一頁。</span><span class="sxs-lookup"><span data-stu-id="b1c77-119">When the last leaf index row is extracted from a sort run page, the process shifts to the next page from that sort run.</span></span> <span data-ttu-id="b1c77-120">當排序結果範圍的所有分頁都處理好之後，該範圍將被釋出。</span><span class="sxs-lookup"><span data-stu-id="b1c77-120">When all the pages in a sort run extent have been processed, the extent is freed.</span></span> <span data-ttu-id="b1c77-121">當每個分葉索引資料列被傳至索引建立元件之後，將被加入到緩衝區的分葉索引頁面中。</span><span class="sxs-lookup"><span data-stu-id="b1c77-121">As each leaf index row is passed to the index create component, it is included in a leaf index page in the buffer.</span></span> <span data-ttu-id="b1c77-122">每個分葉分頁將在填滿時被寫入。</span><span class="sxs-lookup"><span data-stu-id="b1c77-122">Each leaf page is written as it is filled.</span></span> <span data-ttu-id="b1c77-123">當分葉頁面被寫入時， [!INCLUDE[ssDE](../../includes/ssde-md.md)] 也會建立索引的上層。</span><span class="sxs-lookup"><span data-stu-id="b1c77-123">As leaf pages are written, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] also builds the upper levels of the index.</span></span> <span data-ttu-id="b1c77-124">每個上層索引分頁將在填滿時被寫入。</span><span class="sxs-lookup"><span data-stu-id="b1c77-124">Each upper level index page is written when it is filled.</span></span>  
  
## <a name="sort_in_tempdb-option"></a><span data-ttu-id="b1c77-125">SORT_IN_TEMPDB 選項</span><span class="sxs-lookup"><span data-stu-id="b1c77-125">SORT_IN_TEMPDB Option</span></span>  
 <span data-ttu-id="b1c77-126">若 SORT_IN_TEMPDB 設為 OFF，排序結果將儲存於目標檔案群組中。</span><span class="sxs-lookup"><span data-stu-id="b1c77-126">When SORT_IN_TEMPDB is set to OFF, the default, the sort runs are stored in the destination filegroup.</span></span> <span data-ttu-id="b1c77-127">在建立索引的第一階段中，交替的基底資料表頁面讀取作業與排序結果寫入作業，會將磁碟讀寫頭從一個磁碟區域移到另一個磁碟區域。</span><span class="sxs-lookup"><span data-stu-id="b1c77-127">During the first phase of creating the index, the alternating reads of the base table pages and writes of the sort runs move the disk read/write heads from one area of the disk to another.</span></span> <span data-ttu-id="b1c77-128">掃描資料頁時，讀寫頭將位於資料頁區域中。</span><span class="sxs-lookup"><span data-stu-id="b1c77-128">The heads are in the data page area as the data pages are scanned.</span></span> <span data-ttu-id="b1c77-129">當排序緩衝區已填滿，並且目前的排序結果必須寫入磁碟時，它們將移到可用空間的區域，接著當資料表頁面掃描繼續進行時，再移回資料頁區域。</span><span class="sxs-lookup"><span data-stu-id="b1c77-129">They move to an area of free space when the sort buffers fill and the current sort run has to be written to disk, and then move back to the data page area as the table page scan is resumed.</span></span> <span data-ttu-id="b1c77-130">第二階段中的讀寫頭移動量比較大。</span><span class="sxs-lookup"><span data-stu-id="b1c77-130">The read/write head movement is greater in the second phase.</span></span> <span data-ttu-id="b1c77-131">這時候，排序處理序通常會交替讀取每個排序結果區域。</span><span class="sxs-lookup"><span data-stu-id="b1c77-131">At that time the sort process is typically alternating reads from each sort run area.</span></span> <span data-ttu-id="b1c77-132">目標檔案群組中將會同時建立排序結果和新的索引頁面。</span><span class="sxs-lookup"><span data-stu-id="b1c77-132">Both the sort runs and the new index pages are built in the destination filegroup.</span></span> <span data-ttu-id="b1c77-133">這表示 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 在將讀取分散到各排序結果的同時，還必須定期跳到索引範圍，以在索引頁面填滿時寫入新的索引頁面。</span><span class="sxs-lookup"><span data-stu-id="b1c77-133">This means that at the same time the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is spreading reads across the sort runs, it has to periodically jump to the index extents to write new index pages as they are filled.</span></span>  
  
 <span data-ttu-id="b1c77-134">若 SORT_IN_TEMPDB 選項設定為 ON，並且 **tempdb** 所在的磁碟集與目標檔案群組不同，那麼在第一階段中，發生資料頁讀取的磁碟將與寫入 **tempdb**中之排序工作區域的磁碟不同。</span><span class="sxs-lookup"><span data-stu-id="b1c77-134">If the SORT_IN_TEMPDB option is set to ON and **tempdb** is on a separate set of disks from the destination filegroup, during the first phase, the reads of the data pages occur on a different disk from the writes to the sort work area in **tempdb**.</span></span> <span data-ttu-id="b1c77-135">這代表資料索引鍵的磁碟讀取動作一般會繼續循序地穿過磁碟來進行處理，而寫入 **tempdb** 磁碟的動作一般也是循序，如同建立最後索引的寫入動作一樣。</span><span class="sxs-lookup"><span data-stu-id="b1c77-135">This means the disk reads of the data keys generally continue more serially across the disk, and the writes to the **tempdb** disk also are generally serial, as do the writes to build the final index.</span></span> <span data-ttu-id="b1c77-136">即使其他使用者正在使用資料庫並存取個別的磁碟位址，讀取與寫入的整體模式也會因著指定了 SORT_IN_TEMPDB 而比沒有指定來得有效率。</span><span class="sxs-lookup"><span data-stu-id="b1c77-136">Even if other users are using the database and accessing separate disk addresses, the overall pattern of reads and writes are more efficient when SORT_IN_TEMPDB is specified than when it is not.</span></span>  
  
 <span data-ttu-id="b1c77-137">SORT_IN_TEMPDB 選項可改善索引範圍的接近程度，特別是當 CREATE INDEX 作業並未平行處理時。</span><span class="sxs-lookup"><span data-stu-id="b1c77-137">The SORT_IN_TEMPDB option may improve the contiguity of index extents, especially if the CREATE INDEX operation is not being processed in parallel.</span></span> <span data-ttu-id="b1c77-138">排序工作區域範圍就它們在資料庫中的位置而言，將以有些隨機的方式釋出。</span><span class="sxs-lookup"><span data-stu-id="b1c77-138">The sort work area extents are freed on a somewhat random basis with regard to their location in the database.</span></span> <span data-ttu-id="b1c77-139">若排序工作區域包含於目標檔案群組中，那麼當排序工作範圍釋出時，您可藉由要求來取得它們，以便在建立索引時，使用這些範圍來保存索引結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-139">If the sort work areas are contained in the destination filegroup, as the sort work extents are freed, they can be acquired by the requests for extents to hold the index structure as it is built.</span></span> <span data-ttu-id="b1c77-140">這可將索引範圍的位置隨機化到某個程度。</span><span class="sxs-lookup"><span data-stu-id="b1c77-140">This can randomize the locations of the index extents to a degree.</span></span> <span data-ttu-id="b1c77-141">若排序範圍個別地放在 **tempdb**中，它們的釋出順序將與索引範圍的位置無關。</span><span class="sxs-lookup"><span data-stu-id="b1c77-141">If the sort extents are held separately in **tempdb**, the sequence in which they are freed has no effect on the location of the index extents.</span></span> <span data-ttu-id="b1c77-142">此外，當中繼的排序結果儲存於 **tempdb** 中，而非目標檔案群組時，目標檔案群組中將有更多可用空間。</span><span class="sxs-lookup"><span data-stu-id="b1c77-142">Also, when the intermediate sort runs are stored in **tempdb** instead of the destination filegroup, there is more space available in the destination filegroup.</span></span> <span data-ttu-id="b1c77-143">這可增加索引範圍連續的機會。</span><span class="sxs-lookup"><span data-stu-id="b1c77-143">This increases the chances that index extents will be contiguous.</span></span>  
  
 <span data-ttu-id="b1c77-144">SORT_IN_TEMPDB 選項只會影響目前的陳述式。</span><span class="sxs-lookup"><span data-stu-id="b1c77-144">The SORT_IN_TEMPDB option affects only the current statement.</span></span> <span data-ttu-id="b1c77-145">沒有任何中繼資料記錄索引是否排序於 **tempdb**中。</span><span class="sxs-lookup"><span data-stu-id="b1c77-145">No metadata records that the index was or was not sorted in **tempdb**.</span></span> <span data-ttu-id="b1c77-146">例如，若您使用 SORT_IN_TEMPDB 選項來建立非叢集的索引，之後又以未指定該選項的方式來建立叢集索引，當 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 重新建立非叢集索引時，並不會使用該選項。</span><span class="sxs-lookup"><span data-stu-id="b1c77-146">For example, if you create a nonclustered index using the SORT_IN_TEMPDB option, and at a later time create a clustered index without specifying the option, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] does not use the option when it re-creates the nonclustered index.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b1c77-147">若沒有執行排序作業的必要，或排序可以直接在記憶體中執行，則系統會忽略 SORT_IN_TEMPDB 選項。</span><span class="sxs-lookup"><span data-stu-id="b1c77-147">If a sort operation is not required or if the sort can be performed in memory, the SORT_IN_TEMPDB option is ignored.</span></span>  
  
## <a name="disk-space-requirements"></a><span data-ttu-id="b1c77-148">磁碟空間需求</span><span class="sxs-lookup"><span data-stu-id="b1c77-148">Disk Space Requirements</span></span>  
 <span data-ttu-id="b1c77-149">當您將 SORT_IN_TEMPDB 選項設定為 ON 時， **tempdb** 中必須擁有足夠的可用磁碟空間，才能保存中繼的排序結果，目標檔案群組中也要有足夠的可用磁碟空間才能保存新的索引。</span><span class="sxs-lookup"><span data-stu-id="b1c77-149">When you set the SORT_IN_TEMPDB option to ON, you must have sufficient free disk space available in **tempdb** to hold the intermediate sort runs, and enough free disk space in the destination filegroup to hold the new index.</span></span> <span data-ttu-id="b1c77-150">若沒有足夠的可用空間，並且由於某個原因，資料庫無法自動成長來取得更多空間 (例如磁碟中沒有空間，或自動成長被關閉)，CREATE INDEX 陳述式將會失敗。</span><span class="sxs-lookup"><span data-stu-id="b1c77-150">The CREATE INDEX statement fails if there is insufficient free space and there is some reason the databases cannot autogrow to acquire more space, such as no space on the disk or autogrow is set to off.</span></span>  
  
 <span data-ttu-id="b1c77-151">若 SORT_IN_TEMPDB 設定為 OFF，目標檔案群組中的可用磁碟空間必須大約為最後索引的大小。</span><span class="sxs-lookup"><span data-stu-id="b1c77-151">If SORT_IN_TEMPDB is set to OFF, the available free disk space in the destination filegroup must be roughly the size of the final index.</span></span> <span data-ttu-id="b1c77-152">在第一階段中，排序結果將被建立，並且要求大約與最後索引相同的空間數量。</span><span class="sxs-lookup"><span data-stu-id="b1c77-152">During the first phase, the sort runs are built and require about the same amount of space as the final index.</span></span> <span data-ttu-id="b1c77-153">在第二個階段中，每個排序結果範圍都會在處理過後釋出。</span><span class="sxs-lookup"><span data-stu-id="b1c77-153">During the second phase, each sort run extent is freed after it has been processed.</span></span> <span data-ttu-id="b1c77-154">這代表該排序結果範圍釋出的速度約和範圍被要求去保存最後索引頁面的速度一樣，因此整體的空間需求並不會大幅超過最後索引的大小。</span><span class="sxs-lookup"><span data-stu-id="b1c77-154">This means that sort run extents are freed at about the same rate at which extents are acquired to hold the final index pages; therefore, the overall space requirements do not greatly exceed the size of the final index.</span></span> <span data-ttu-id="b1c77-155">它的一個副作用是若可用空間的數量非常接近最後索引的大小， [!INCLUDE[ssDE](../../includes/ssde-md.md)] 一般將重複使用剛剛才釋出的排序結果範圍。</span><span class="sxs-lookup"><span data-stu-id="b1c77-155">One side effect of this is that if the amount of free space is very close to the size of the final index, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] will generally reuse the sort run extents very quickly after they are freed.</span></span> <span data-ttu-id="b1c77-156">因為排序結果範圍會以有些隨機的方式釋出，這將會減少在此案例中的索引範圍接近程度。</span><span class="sxs-lookup"><span data-stu-id="b1c77-156">Because the sort run extents are freed in a somewhat random manner, this reduces the continuity of the index extents in this scenario.</span></span> <span data-ttu-id="b1c77-157">若 SORT_IN_TEMPDB 設定為 OFF，當目標檔案群組中擁有足夠的可用空間時，索引範圍的接近程度將會改善，這是因為索引範圍可從連續的集區中配置而得，而不用從剛剛取消配置的排序結果範圍來取得。</span><span class="sxs-lookup"><span data-stu-id="b1c77-157">If SORT_IN_TEMPDB is set to OFF, the continuity of the index extents is improved if there is sufficient free space available in the destination filegroup that the index extents can be allocated from a contiguous pool instead of from the freshly deallocated sort run extents.</span></span>  
  
 <span data-ttu-id="b1c77-158">當您建立非叢集的索引時，您必須擁有足夠的可用空間：</span><span class="sxs-lookup"><span data-stu-id="b1c77-158">When you create a nonclustered index, you must have available as free space:</span></span>  
  
-   <span data-ttu-id="b1c77-159">若 SORT_IN_TEMPDB 設定為 ON， **tempdb** 中必須有足夠的可用空間來儲存排序結果，目標檔案群組中也必須有足夠的可用空間來儲存最後的索引結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-159">If SORT_IN_TEMPDB is set to ON, there must be sufficient free space in **tempdb** to store the sort runs, and sufficient free space in the destination filegroup to store the final index structure.</span></span> <span data-ttu-id="b1c77-160">排序結果包含了索引的分葉資料列。</span><span class="sxs-lookup"><span data-stu-id="b1c77-160">The sort runs contain the leaf rows of the index.</span></span>  
  
-   <span data-ttu-id="b1c77-161">若 SORT_IN_TEMPDB 設定為 OFF，目標檔案群組中的可用空間必須足夠儲存最後的索引結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-161">If SORT_IN_TEMPDB is set to OFF, the free space in the destination filegroup must be large enough to store the final index structure.</span></span> <span data-ttu-id="b1c77-162">若有更多的可用空間，索引範圍的接近程度將可改善。</span><span class="sxs-lookup"><span data-stu-id="b1c77-162">The continuity of the index extends may be improved if more free space is available.</span></span>  
  
 <span data-ttu-id="b1c77-163">當您在沒有非叢集索引的資料表上建立叢集索引時，您必須擁有足夠的可用空間：</span><span class="sxs-lookup"><span data-stu-id="b1c77-163">When you create a clustered index on a table that does not have nonclustered indexes, you must have available as free space:</span></span>  
  
-   <span data-ttu-id="b1c77-164">若 SORT_IN_TEMPDB 設定為 ON， **tempdb** 中必須有足夠的可用空間來儲存排序結果。</span><span class="sxs-lookup"><span data-stu-id="b1c77-164">If SORT_IN_TEMPDB is set to ON, there must be sufficient free space in **tempdb** to store the sort runs.</span></span> <span data-ttu-id="b1c77-165">這包括了資料表的資料列。</span><span class="sxs-lookup"><span data-stu-id="b1c77-165">These include the data rows of the table.</span></span> <span data-ttu-id="b1c77-166">目標檔案群組中必須有足夠的空間來儲存最後的索引結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-166">There must be sufficient free space in the destination filegroup to store the final index structure.</span></span> <span data-ttu-id="b1c77-167">這包括了資料表的資料列，以及索引的 B 型樹狀目錄。</span><span class="sxs-lookup"><span data-stu-id="b1c77-167">This includes the data rows of the table and the index B-tree.</span></span> <span data-ttu-id="b1c77-168">您可能必須調整一些因數的估計，例如使用較大型的索引鍵，或是使用較小值的填滿因數。</span><span class="sxs-lookup"><span data-stu-id="b1c77-168">You may have to adjust the estimate for factors such as having a large key size or a fill factor with a low value.</span></span>  
  
-   <span data-ttu-id="b1c77-169">若 SORT_IN_TEMPDB 設定為 OFF，目標檔案群組中的可用空間必須足夠儲存最後的資料表。</span><span class="sxs-lookup"><span data-stu-id="b1c77-169">If SORT_IN_TEMPDB is set to OFF, the free space in the destination filegroup must be large enough to store the final table.</span></span> <span data-ttu-id="b1c77-170">這包括了索引結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-170">This includes the index structure.</span></span> <span data-ttu-id="b1c77-171">若有更多的可用空間，資料表與索引範圍的接近程度將可改善。</span><span class="sxs-lookup"><span data-stu-id="b1c77-171">The continuity of the table and index extents may be improved if more free space is available.</span></span>  
  
 <span data-ttu-id="b1c77-172">當您在具有非叢集索引的資料表上建立叢集索引時，您必須擁有足夠的可用空間：</span><span class="sxs-lookup"><span data-stu-id="b1c77-172">When you create a clustered index on a table that has nonclustered indexes, you must have available as free space:</span></span>  
  
-   <span data-ttu-id="b1c77-173">若 SORT_IN_TEMPDB 設定為 ON， **tempdb** 中必須有足夠的可用空間來儲存最大索引 (通常是叢集索引) 排序結果的集合，目標檔案群組中也必須有足夠的可用空間來儲存所有索引的最後結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-173">If SORT_IN_TEMPDB is set to ON, there must be sufficient free space in **tempdb** to store the collection of sort runs for the largest index, typically the clustered index, and sufficient free space in the destination filegroup to store the final structures of all the indexes.</span></span> <span data-ttu-id="b1c77-174">這包括了包含資料表資料列的叢集索引。</span><span class="sxs-lookup"><span data-stu-id="b1c77-174">This includes the clustered index that contains the data rows of the table.</span></span>  
  
-   <span data-ttu-id="b1c77-175">若 SORT_IN_TEMPDB 設定為 OFF，目標檔案群組中的可用空間必須足夠儲存最後的資料表。</span><span class="sxs-lookup"><span data-stu-id="b1c77-175">If SORT_IN_TEMPDB is set to OFF, the free space in the destination filegroup must be large enough to store the final table.</span></span> <span data-ttu-id="b1c77-176">這包括了所有索引的結構。</span><span class="sxs-lookup"><span data-stu-id="b1c77-176">This includes the structures of all the indexes.</span></span> <span data-ttu-id="b1c77-177">若有更多的可用空間，資料表與索引範圍的接近程度將可改善。</span><span class="sxs-lookup"><span data-stu-id="b1c77-177">The continuity of the table and index extents may be improved if more free space is available.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="b1c77-178">相關工作</span><span class="sxs-lookup"><span data-stu-id="b1c77-178">Related Tasks</span></span>  
 [<span data-ttu-id="b1c77-179">CREATE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b1c77-179">CREATE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-index-transact-sql)  
  
 [<span data-ttu-id="b1c77-180">重新組織與重建索引</span><span class="sxs-lookup"><span data-stu-id="b1c77-180">Reorganize and Rebuild Indexes</span></span>](indexes.md)  
  
## <a name="related-content"></a><span data-ttu-id="b1c77-181">相關內容</span><span class="sxs-lookup"><span data-stu-id="b1c77-181">Related Content</span></span>  
 [<span data-ttu-id="b1c77-182">ALTER INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b1c77-182">ALTER INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-index-transact-sql)  
  
 [<span data-ttu-id="b1c77-183">設定 index create memory 伺服器組態選項</span><span class="sxs-lookup"><span data-stu-id="b1c77-183">Configure the index create memory Server Configuration Option</span></span>](../../database-engine/configure-windows/configure-the-index-create-memory-server-configuration-option.md)  
  
 [<span data-ttu-id="b1c77-184">Disk Space Requirements for Index DDL Operations</span><span class="sxs-lookup"><span data-stu-id="b1c77-184">Disk Space Requirements for Index DDL Operations</span></span>](disk-space-requirements-for-index-ddl-operations.md)  
  
  
