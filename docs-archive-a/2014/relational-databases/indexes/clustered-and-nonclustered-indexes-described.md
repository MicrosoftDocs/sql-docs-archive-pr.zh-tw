---
title: 叢集與非叢集索引說明 | Microsoft 文件
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- query optimizer [SQL Server], index usage
- index concepts [SQL Server]
ms.assetid: b7d6b323-728d-4763-a987-92e6292f6f7a
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: c9eb51a24000b8af4a466fe4330644a722ad325b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708329"
---
# <a name="clustered-and-nonclustered-indexes-described"></a><span data-ttu-id="da4ad-102">叢集與非叢集索引說明</span><span class="sxs-lookup"><span data-stu-id="da4ad-102">Clustered and Nonclustered Indexes Described</span></span>
  <span data-ttu-id="da4ad-103">索引是一種與資料表或檢視有關的磁碟內存結構，它會加快從該資料表或檢視中擷取資料列的速度。</span><span class="sxs-lookup"><span data-stu-id="da4ad-103">An index is an on-disk structure associated with a table or view that speeds retrieval of rows from the table or view.</span></span> <span data-ttu-id="da4ad-104">索引中包含從資料表或檢視中一或多個資料行建出的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="da4ad-104">An index contains keys built from one or more columns in the table or view.</span></span> <span data-ttu-id="da4ad-105">這些索引鍵儲存在結構中 (B 型樹狀目錄)，讓 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可以快速有效地找到與索引鍵值相關的一或多個資料列。</span><span class="sxs-lookup"><span data-stu-id="da4ad-105">These keys are stored in a structure (B-tree) that enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to find the row or rows associated with the key values quickly and efficiently.</span></span>  
  
 <span data-ttu-id="da4ad-106">資料表或檢視可包含下列類型的索引：</span><span class="sxs-lookup"><span data-stu-id="da4ad-106">A table or view can contain the following types of indexes:</span></span>  
  
-   <span data-ttu-id="da4ad-107">叢集</span><span class="sxs-lookup"><span data-stu-id="da4ad-107">Clustered</span></span>  
  
    -   <span data-ttu-id="da4ad-108">叢集索引將資料表或檢視中的資料列依其索引鍵值排序與儲存。</span><span class="sxs-lookup"><span data-stu-id="da4ad-108">Clustered indexes sort and store the data rows in the table or view based on their key values.</span></span> <span data-ttu-id="da4ad-109">這些就是索引定義中包含的資料行。</span><span class="sxs-lookup"><span data-stu-id="da4ad-109">These are the columns included in the index definition.</span></span> <span data-ttu-id="da4ad-110">因為資料列本身只能以一種順序排序，所以每個資料表只能有一個叢集索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-110">There can be only one clustered index per table, because the data rows themselves can be sorted in only one order.</span></span>  
  
    -   <span data-ttu-id="da4ad-111">只有當資料表包含叢集索引時，資料表中的資料列才會以排序順序儲存。</span><span class="sxs-lookup"><span data-stu-id="da4ad-111">The only time the data rows in a table are stored in sorted order is when the table contains a clustered index.</span></span> <span data-ttu-id="da4ad-112">當資料表有叢集索引時，資料表又稱為叢集資料表。</span><span class="sxs-lookup"><span data-stu-id="da4ad-112">When a table has a clustered index, the table is called a clustered table.</span></span> <span data-ttu-id="da4ad-113">如果資料表沒有任何叢集索引，它的資料列就儲存在未排序的結構中，這個結構稱為堆積。</span><span class="sxs-lookup"><span data-stu-id="da4ad-113">If a table has no clustered index, its data rows are stored in an unordered structure called a heap.</span></span>  
  
-   <span data-ttu-id="da4ad-114">非叢集</span><span class="sxs-lookup"><span data-stu-id="da4ad-114">Nonclustered</span></span>  
  
    -   <span data-ttu-id="da4ad-115">非叢集索引有一個與資料列完全分開的結構。</span><span class="sxs-lookup"><span data-stu-id="da4ad-115">Nonclustered indexes have a structure separate from the data rows.</span></span> <span data-ttu-id="da4ad-116">非叢集索引包含非叢集索引鍵值，而每個索引鍵值項目都有一個指標，指向包含索引鍵值的資料列。</span><span class="sxs-lookup"><span data-stu-id="da4ad-116">A nonclustered index contains the nonclustered index key values and each key value entry has a pointer to the data row that contains the key value.</span></span>  
  
    -   <span data-ttu-id="da4ad-117">從非叢集索引中的索引列指向資料列的指標被稱為資料列定位器。</span><span class="sxs-lookup"><span data-stu-id="da4ad-117">The pointer from an index row in a nonclustered index to a data row is called a row locator.</span></span> <span data-ttu-id="da4ad-118">資料列定位器的結構須視資料頁儲存在堆積或叢集資料表而定。</span><span class="sxs-lookup"><span data-stu-id="da4ad-118">The structure of the row locator depends on whether the data pages are stored in a heap or a clustered table.</span></span> <span data-ttu-id="da4ad-119">若是堆積，資料列定位器是指向資料列的指標。</span><span class="sxs-lookup"><span data-stu-id="da4ad-119">For a heap, a row locator is a pointer to the row.</span></span> <span data-ttu-id="da4ad-120">若是叢集資料表，資料列定位器就是叢集索引鍵。</span><span class="sxs-lookup"><span data-stu-id="da4ad-120">For a clustered table, the row locator is the clustered index key.</span></span>  
  
    -   <span data-ttu-id="da4ad-121">您可以將非索引鍵之資料行加入非叢集索引的分葉層級中，以規避現有索引鍵的限制 (900 個位元組和 16 個索引鍵資料行)，並執行完全涵蓋的索引查詢。</span><span class="sxs-lookup"><span data-stu-id="da4ad-121">You can add nonkey columns to the leaf level of the nonclustered index to by-pass existing index key limits, 900 bytes and 16 key columns, and execute fully covered, indexed, queries.</span></span> <span data-ttu-id="da4ad-122">如需詳細資訊，請參閱 [建立內含資料行的索引](create-indexes-with-included-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="da4ad-122">For more information, see [Create Indexes with Included Columns](create-indexes-with-included-columns.md).</span></span>  
  
 <span data-ttu-id="da4ad-123">叢集與非叢集索引都可以是唯一的。</span><span class="sxs-lookup"><span data-stu-id="da4ad-123">Both clustered and nonclustered indexes can be unique.</span></span> <span data-ttu-id="da4ad-124">這表示任何兩個資料列不得以相同的值做為索引鍵。</span><span class="sxs-lookup"><span data-stu-id="da4ad-124">This means no two rows can have the same value for the index key.</span></span> <span data-ttu-id="da4ad-125">否則，索引就不是唯一的，那麼多個資料列就可以共用同一個索引鍵值。</span><span class="sxs-lookup"><span data-stu-id="da4ad-125">Otherwise, the index is not unique and multiple rows can share the same key value.</span></span> <span data-ttu-id="da4ad-126">如需詳細資訊，請參閱 [建立唯一索引](create-unique-indexes.md)。</span><span class="sxs-lookup"><span data-stu-id="da4ad-126">For more information, see [Create Unique Indexes](create-unique-indexes.md).</span></span>  
  
 <span data-ttu-id="da4ad-127">每當修改資料表的資料時，就會自動維護資料表或檢視的索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-127">Indexes are automatically maintained for a table or view whenever the table data is modified.</span></span>  
  
 <span data-ttu-id="da4ad-128">如需其他類型的特殊用途索引，請參閱 [索引](indexes.md) 。</span><span class="sxs-lookup"><span data-stu-id="da4ad-128">See [Indexes](indexes.md) for additional types of special purpose indexes.</span></span>  
  
## <a name="indexes-and-constraints"></a><span data-ttu-id="da4ad-129">索引與條件約束</span><span class="sxs-lookup"><span data-stu-id="da4ad-129">Indexes and Constraints</span></span>  
 <span data-ttu-id="da4ad-130">在資料表的資料行上定義 PRIMARY KEY 與 UNIQUE 條件約束時，會自動建立索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-130">Indexes are automatically created when PRIMARY KEY and UNIQUE constraints are defined on table columns.</span></span> <span data-ttu-id="da4ad-131">例如，當您建立資料表和識別特定資料行做為主索引鍵時， [!INCLUDE[ssDE](../../includes/ssde-md.md)] 會自動為該資料行建立 PRIMARY KEY 條件約束與索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-131">For example, when you create a table and identify a particular column to be the primary key, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] automatically creates a PRIMARY KEY constraint and index on that column.</span></span> <span data-ttu-id="da4ad-132">如需相關資訊，請參閱 [建立主索引鍵](../tables/create-primary-keys.md) 及 [建立唯一的條件約束](../tables/create-unique-constraints.md)。</span><span class="sxs-lookup"><span data-stu-id="da4ad-132">For more information, see [Create Primary Keys](../tables/create-primary-keys.md) and [Create Unique Constraints](../tables/create-unique-constraints.md).</span></span>  
  
## <a name="how-indexes-are-used-by-the-query-optimizer"></a><span data-ttu-id="da4ad-133">查詢最佳化工具如何使用索引</span><span class="sxs-lookup"><span data-stu-id="da4ad-133">How Indexes Are Used by the Query Optimizer</span></span>  
 <span data-ttu-id="da4ad-134">設計精良的索引可以降低磁碟 I/O 作業並耗用較少的系統資源，因此可改善查詢效能。</span><span class="sxs-lookup"><span data-stu-id="da4ad-134">Well-designed indexes can reduce disk I/O operations and consume fewer system resources therefore improving query performance.</span></span> <span data-ttu-id="da4ad-135">索引對於包含 SELECT、UPDATE、DELETE 或 MERGE 陳述式的各種查詢非常有用。</span><span class="sxs-lookup"><span data-stu-id="da4ad-135">Indexes can be helpful for a variety of queries that contain SELECT, UPDATE, DELETE, or MERGE statements.</span></span> <span data-ttu-id="da4ad-136">請考慮在 `SELECT Title, HireDate FROM HumanResources.Employee WHERE EmployeeID = 250` 資料庫中的 [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] 查詢。</span><span class="sxs-lookup"><span data-stu-id="da4ad-136">Consider the query `SELECT Title, HireDate FROM HumanResources.Employee WHERE EmployeeID = 250` in the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="da4ad-137">當執行此查詢時，查詢最佳化工具會評估每個擷取資料的可用方法，並選取最有效的方法。</span><span class="sxs-lookup"><span data-stu-id="da4ad-137">When this query is executed, the query optimizer evaluates each available method for retrieving the data and selects the most efficient method.</span></span> <span data-ttu-id="da4ad-138">該方法可以是資料表掃描，或是掃描一或多個索引 (如果存在的話)。</span><span class="sxs-lookup"><span data-stu-id="da4ad-138">The method may be a table scan, or may be scanning one or more indexes if they exist.</span></span>  
  
 <span data-ttu-id="da4ad-139">當執行資料表掃描時，查詢最佳化工具可以讀取資料表中的所有資料列，並擷取符合查詢條件的資料列。</span><span class="sxs-lookup"><span data-stu-id="da4ad-139">When performing a table scan, the query optimizer reads all the rows in the table, and extracts the rows that meet the criteria of the query.</span></span> <span data-ttu-id="da4ad-140">資料表掃描將產生許多磁碟 I/O 作業，而且可能需要大量資源。</span><span class="sxs-lookup"><span data-stu-id="da4ad-140">A table scan generates many disk I/O operations and can be resource intensive.</span></span> <span data-ttu-id="da4ad-141">不過例如，如果查詢的結果集有很高的百分比是源自於資料表的資料列，則資料表掃描可能是最有效率的方法。</span><span class="sxs-lookup"><span data-stu-id="da4ad-141">However, a table scan could be the most efficient method if, for example, the result set of the query is a high percentage of rows from the table.</span></span>  
  
 <span data-ttu-id="da4ad-142">當查詢最佳化工具使用索引時，它會搜尋索引鍵資料行、尋找查詢所需的資料列之儲存位置，並從該位置擷取符合的資料列。</span><span class="sxs-lookup"><span data-stu-id="da4ad-142">When the query optimizer uses an index, it searches the index key columns, finds the storage location of the rows needed by the query and extracts the matching rows from that location.</span></span> <span data-ttu-id="da4ad-143">一般而言，搜尋索引會比搜尋資料表更快，因為與資料表不同的是，索引的每個資料列通常包含非常少的資料行，而且資料列為排序的順序。</span><span class="sxs-lookup"><span data-stu-id="da4ad-143">Generally, searching the index is much faster than searching the table because unlike a table, an index frequently contains very few columns per row and the rows are in sorted order.</span></span>  
  
 <span data-ttu-id="da4ad-144">查詢最佳化工具在執行查詢時通常會選取最有效率的方法。</span><span class="sxs-lookup"><span data-stu-id="da4ad-144">The query optimizer typically selects the most efficient method when executing queries.</span></span> <span data-ttu-id="da4ad-145">不過，如果沒有可用的索引，則查詢最佳化工具就必須使用資料表掃描。</span><span class="sxs-lookup"><span data-stu-id="da4ad-145">However, if no indexes are available, the query optimizer must use a table scan.</span></span> <span data-ttu-id="da4ad-146">您的工作是設計和建立最符合您環境的索引，因此查詢最佳化工具將會從要選取的索引中選取最有效率的索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-146">Your task is to design and create indexes that are best suited to your environment so that the query optimizer has a selection of efficient indexes from which to select.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="da4ad-147">提供 [Database Engine Tuning Advisor](../performance/database-engine-tuning-advisor.md) 協助您分析資料庫環境並選取適當的索引。</span><span class="sxs-lookup"><span data-stu-id="da4ad-147">provides the [Database Engine Tuning Advisor](../performance/database-engine-tuning-advisor.md) to help with the analysis of your database environment and in the selection of appropriate indexes.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="da4ad-148">相關工作</span><span class="sxs-lookup"><span data-stu-id="da4ad-148">Related Tasks</span></span>  
 [<span data-ttu-id="da4ad-149">建立叢集索引</span><span class="sxs-lookup"><span data-stu-id="da4ad-149">Create Clustered Indexes</span></span>](create-clustered-indexes.md)  
  
 [<span data-ttu-id="da4ad-150">建立非叢集索引</span><span class="sxs-lookup"><span data-stu-id="da4ad-150">Create Nonclustered Indexes</span></span>](create-nonclustered-indexes.md)  
  
  
