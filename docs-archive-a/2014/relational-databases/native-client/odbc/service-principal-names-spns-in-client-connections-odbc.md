---
title: " (ODBC) 的用戶端連接中， (Spn) 的服務主體名稱 |Microsoft Docs"
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 1d60cb30-4c46-49b2-89ab-701e77a330a2
author: rothja
ms.author: jroth
ms.openlocfilehash: 752cbdbf017fac6d086b9493c23ea7a490ac6ef7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87702862"
---
# <a name="service-principal-names-spns-in-client-connections-odbc"></a><span data-ttu-id="39be4-102">用戶端連接 (ODBC) 中的服務主要名稱 (SPN)</span><span class="sxs-lookup"><span data-stu-id="39be4-102">Service Principal Names (SPNs) in Client Connections (ODBC)</span></span>
  <span data-ttu-id="39be4-103">本主題描述可在用戶端應用程式內支援服務主要名稱 (SPN) 的 ODBC 屬性和函數。</span><span class="sxs-lookup"><span data-stu-id="39be4-103">This topic describes ODBC attributes and functions that support service principal names (SPNs) in client applications.</span></span> <span data-ttu-id="39be4-104">如需有關用戶端應用程式中 Spn 的詳細資訊，請參閱[用戶端連線中的服務主體名稱 &#40;spn&#41; 支援](../features/service-principal-name-spn-support-in-client-connections.md)和[取得相互 Kerberos 驗證](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="39be4-104">For more information about SPNs in client applications, see [Service Principal Name &#40;SPN&#41; Support in Client Connections](../features/service-principal-name-spn-support-in-client-connections.md) and [Get Mutual Kerberos Authentication](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md).</span></span>  
  
## <a name="connection-string-keywords"></a><span data-ttu-id="39be4-105">連接字串關鍵字</span><span class="sxs-lookup"><span data-stu-id="39be4-105">Connection String Keywords</span></span>  
 <span data-ttu-id="39be4-106">下列連接字串關鍵字可讓用戶端應用程式指定 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-106">The following connection string keywords enable client applications to specify an SPN.</span></span>  
  
|<span data-ttu-id="39be4-107">關鍵字</span><span class="sxs-lookup"><span data-stu-id="39be4-107">Keyword</span></span>|<span data-ttu-id="39be4-108">值</span><span class="sxs-lookup"><span data-stu-id="39be4-108">Value</span></span>|  
|-------------|-----------|  
|`ServerSPN`|<span data-ttu-id="39be4-109">伺服器的 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-109">The SPN for the server.</span></span> <span data-ttu-id="39be4-110">預設值為空字串，它可讓 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用驅動程式產生的預設 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-110">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
|`FailoverPartnerSPN`|<span data-ttu-id="39be4-111">容錯移轉夥伴的 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-111">The SPN for the failover partner.</span></span> <span data-ttu-id="39be4-112">預設值為空字串，它可讓 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用驅動程式產生的預設 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-112">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
  
## <a name="connection-attributes"></a><span data-ttu-id="39be4-113">連接屬性</span><span class="sxs-lookup"><span data-stu-id="39be4-113">Connection Attributes</span></span>  
 <span data-ttu-id="39be4-114">下列連接屬性可讓用戶端應用程式指定 SPN，並查詢是否有驗證方法。</span><span class="sxs-lookup"><span data-stu-id="39be4-114">The following connection attributes enable client applications to specify an SPN and query for the authentication method.</span></span>  
  
|<span data-ttu-id="39be4-115">名稱</span><span class="sxs-lookup"><span data-stu-id="39be4-115">Name</span></span>|<span data-ttu-id="39be4-116">類型</span><span class="sxs-lookup"><span data-stu-id="39be4-116">Type</span></span>|<span data-ttu-id="39be4-117">使用量</span><span class="sxs-lookup"><span data-stu-id="39be4-117">Usage</span></span>|  
|----------|----------|-----------|  
|<span data-ttu-id="39be4-118">SQL_COPT_SS_SERVER_SPN</span><span class="sxs-lookup"><span data-stu-id="39be4-118">SQL_COPT_SS_SERVER_SPN</span></span><br /><br /> <span data-ttu-id="39be4-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span><span class="sxs-lookup"><span data-stu-id="39be4-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span></span>|<span data-ttu-id="39be4-120">SQLTCHAR，讀取/寫入</span><span class="sxs-lookup"><span data-stu-id="39be4-120">SQLTCHAR, read/write</span></span>|<span data-ttu-id="39be4-121">指定伺服器的 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-121">Specifies the SPN for the server.</span></span> <span data-ttu-id="39be4-122">預設值為空字串，它可讓 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 使用驅動程式產生的預設 SPN。</span><span class="sxs-lookup"><span data-stu-id="39be4-122">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span><br /><br /> <span data-ttu-id="39be4-123">只有當已經以程式設計方式設定這個屬性之後，或是在已經開啟連接之後，才可以查詢這個屬性。</span><span class="sxs-lookup"><span data-stu-id="39be4-123">This attribute can be queried only after it has been set programmatically, or after a connection has been opened.</span></span> <span data-ttu-id="39be4-124">如果嘗試在尚未開啟的連接上查詢這個屬性，而且尚未以程式設計方式設定此屬性，就會傳回 SQL_ERROR，而且會將診斷記錄記錄下來，其中包含 SQLState 08003 和「未開啟連接」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-124">If an attempt is made to query this attribute on a connection that is not open and the attribute has not been set programmatically, SQL_ERROR is returned, and a diagnostic record is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="39be4-125">如果嘗試在已開啟連接時設定這個屬性，就會傳回 SQL_ERROR，而且會將診斷記錄記錄下來，其中包含 SQLState HY011 和「此時作業無效」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-125">If an attempt is made to set this attribute when a connection is open, SQL_ERROR is returned, and a diagnostic record is logged with SQLState HY011 and the message "Operation invalid at this time".</span></span>|  
|<span data-ttu-id="39be4-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span><span class="sxs-lookup"><span data-stu-id="39be4-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span></span>|<span data-ttu-id="39be4-127">SQLTCHAR，唯讀</span><span class="sxs-lookup"><span data-stu-id="39be4-127">SQLTCHAR, read-only</span></span>|<span data-ttu-id="39be4-128">傳回連接所使用的驗證方法。</span><span class="sxs-lookup"><span data-stu-id="39be4-128">Returns the authentication method used for the connection.</span></span> <span data-ttu-id="39be4-129">傳給應用程式的值就是 Windows 傳給 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 的值。</span><span class="sxs-lookup"><span data-stu-id="39be4-129">The value returned to the application is the value that Windows returns to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="39be4-130">可能的值包括：</span><span class="sxs-lookup"><span data-stu-id="39be4-130">Possible values are:</span></span><br /><br /> <span data-ttu-id="39be4-131">-「NTLM」，這是使用 NTLM 驗證開啟連接時所傳回的。</span><span class="sxs-lookup"><span data-stu-id="39be4-131">-   "NTLM", which is returned when a connection is opened using NTLM authentication.</span></span><br /><span data-ttu-id="39be4-132">-"Kerberos"，當使用 Kerberos 驗證開啟連接時所傳回。</span><span class="sxs-lookup"><span data-stu-id="39be4-132">-   "Kerberos", which is returned when a connection is opened using Kerberos authentication.</span></span><br /><br /> <span data-ttu-id="39be4-133">只能針對使用 Windows 驗證的開啟連接來讀取這個屬性。</span><span class="sxs-lookup"><span data-stu-id="39be4-133">This attribute can only be read for an open connection that used Windows Authentication.</span></span> <span data-ttu-id="39be4-134">如果嘗試在開啟連接之前讀取這個屬性，就會傳回 SQL_ERROR，而且會將錯誤記錄下來，其中包含 SQLState 08003 和「未開啟連接」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-134">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="39be4-135">如果在尚未使用 Windows 驗證的連接上查詢這個屬性，就會傳回 SQL_ERROR，而且會將錯誤記錄下來，其中包含 SQLState HY092 和「屬性/選項識別碼無效 (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD 只適用於信任連接)」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-135">If this attribute is queried on a connection that did not use Windows Authentication, SQL_ERROR is returned, and an error is logged with SQLState HY092 and the message "Invalid attribute/option identifier (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD is only available for Trusted Connections)".</span></span><br /><br /> <span data-ttu-id="39be4-136">如果無法判斷驗證方法，就會傳回 SQL_ERROR，而且會將錯誤記錄下來，其中包含 SQLState HY000 和「一般錯誤」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-136">If the authentication method cannot be determined, SQL_ERROR is returned, and an error is logged with SQLState HY000 and the message "General error".</span></span>|  
|<span data-ttu-id="39be4-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span><span class="sxs-lookup"><span data-stu-id="39be4-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span></span>|<span data-ttu-id="39be4-138">SQLSMALLINT，唯讀</span><span class="sxs-lookup"><span data-stu-id="39be4-138">SQLSMALLINT, read-only</span></span>|<span data-ttu-id="39be4-139">如果連接中的伺服器已互相驗證過，則會傳回 SQL_TRUE，否則會傳回 SQL_FALSE。</span><span class="sxs-lookup"><span data-stu-id="39be4-139">Returns SQL_TRUE if the server in the connection was mutually authenticated; otherwise, returns SQL_FALSE.</span></span><br /><br /> <span data-ttu-id="39be4-140">只能針對開啟的連接來讀取這個屬性。</span><span class="sxs-lookup"><span data-stu-id="39be4-140">This attribute can only be read for an open connection.</span></span> <span data-ttu-id="39be4-141">如果嘗試在開啟連接之前讀取這個屬性，就會傳回 SQL_ERROR，而且會將錯誤記錄下來，其中包含 SQLState 08003 和「未開啟連接」訊息。</span><span class="sxs-lookup"><span data-stu-id="39be4-141">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="39be4-142">如果針對未使用 Windows 驗證的連接來查詢這個屬性，就會傳回 SQL_FALSE。</span><span class="sxs-lookup"><span data-stu-id="39be4-142">If this attribute is queried for a connection that did not use Windows Authentication, SQL_FALSE is returned.</span></span>|  
  
## <a name="odbc-function-support-for-specifying-spns"></a><span data-ttu-id="39be4-143">用來指定 SPN 的 ODBC 函數支援</span><span class="sxs-lookup"><span data-stu-id="39be4-143">ODBC Function Support for Specifying SPNs</span></span>  
 <span data-ttu-id="39be4-144">下列 ODBC 函數可支援用戶端應用程式和 SPN：</span><span class="sxs-lookup"><span data-stu-id="39be4-144">The following ODBC functions support client applications and SPNs:</span></span>  
  
-   [<span data-ttu-id="39be4-145">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="39be4-145">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)  
  
-   [<span data-ttu-id="39be4-146">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="39be4-146">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)  
  
-   [<span data-ttu-id="39be4-147">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="39be4-147">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)  
  
-   [<span data-ttu-id="39be4-148">SQLGetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="39be4-148">SQLGetConnectAttr</span></span>](../../native-client-odbc-api/sqlgetconnectattr.md)  
  
-   [<span data-ttu-id="39be4-149">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="39be4-149">SQLSetConnectAttr</span></span>](../../native-client-odbc-api/sqlsetconnectattr.md)  
  
## <a name="see-also"></a><span data-ttu-id="39be4-150">另請參閱</span><span class="sxs-lookup"><span data-stu-id="39be4-150">See Also</span></span>  
 [<span data-ttu-id="39be4-151">SQL Server Native Client &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="39be4-151">SQL Server Native Client &#40;ODBC&#41;</span></span>](sql-server-native-client-odbc.md)  
  
  
