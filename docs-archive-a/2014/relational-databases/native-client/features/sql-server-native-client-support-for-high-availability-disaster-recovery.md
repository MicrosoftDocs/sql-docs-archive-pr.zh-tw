---
title: 高可用性、嚴重損壞修復的 SQL Server Native Client 支援 |Microsoft Docs
ms.custom: ''
ms.date: 08/31/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 2b06186b-4090-4728-b96b-90d6ebd9f66f
author: rothja
ms.author: jroth
ms.openlocfilehash: 43c835d5c0e1c064387aee7fb0db65f577c3aa26
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87599481"
---
# <a name="sql-server-native-client-support-for-high-availability-disaster-recovery"></a><span data-ttu-id="c41c0-102">高可用性/災害復原的 SQL Server Native Client 支援</span><span class="sxs-lookup"><span data-stu-id="c41c0-102">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>
  <span data-ttu-id="c41c0-103">本主題將討論適用於 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] Native Client 支援 (在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 中所新增)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-103">This topic discusses [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client support (added in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]) for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="c41c0-104">如需 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的詳細資訊 , ，請參閱[可用性群組接聽程式、用戶端連接性及應用程式容錯移轉 &#40;SQL Server&#41;](../../../database-engine/listeners-client-connectivity-application-failover.md)、[建立及設定可用性群組 &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md)、[容錯移轉叢集和 AlwaysOn 可用性群組 &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md) 和[使用中次要：可讀取的次要複本 (AlwaysOn 可用性群組)](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-104">For more information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../../database-engine/listeners-client-connectivity-application-failover.md), [Creation and Configuration of Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md), [Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md), and [Active Secondaries: Readable Secondary Replicas (AlwaysOn Availability Groups)](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 <span data-ttu-id="c41c0-105">您可以在連接字串中指定給定可用性群組的可用性群組接聽程式。</span><span class="sxs-lookup"><span data-stu-id="c41c0-105">You can specify the availability group listener of a given availability group in the connection string.</span></span> <span data-ttu-id="c41c0-106">如果 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 應用程式連接到可用性群組中發生容錯移轉的資料庫，則原始連接會中斷，而且應用程式必須在容錯移轉後開啟新連接，才能繼續工作。</span><span class="sxs-lookup"><span data-stu-id="c41c0-106">If a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application is connected to a database in an availability group that fails over, the original connection is broken, and the application must open a new connection to continue work after the failover.</span></span>  
  
 <span data-ttu-id="c41c0-107">如果未連接到可用性群組接聽程式，而且如果多個 IP 位址與主機名稱相關聯，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 會循序逐一查看與 DNS 項目相關聯的所有 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="c41c0-107">If you are not connecting to an availability group listener, and if multiple IP addresses are associated with a hostname, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will iterate sequentially through all IP addresses associated with DNS entry.</span></span> <span data-ttu-id="c41c0-108">如果 DNS 伺服器所傳回的第一個 IP 位址未繫結至任何網路介面卡 (NIC)，這項作業可能會很費時。</span><span class="sxs-lookup"><span data-stu-id="c41c0-108">This can be time consuming if the first IP address returned by DNS server is not bound to any network interface card (NIC).</span></span> <span data-ttu-id="c41c0-109">在連接到可用性群組接聽程式時，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 會嘗試平行建立與所有 IP 位址的連接，如果某個連接嘗試成功，驅動程式就會捨棄任何暫止的連接嘗試。</span><span class="sxs-lookup"><span data-stu-id="c41c0-109">When connecting to an availability group listener, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client attempts to establish connections to all IP addresses in parallel and if a connection attempt succeeds, the driver will discard any pending connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c41c0-110">增加連接逾時並實作連接重試邏輯可提高應用程式連接到可用性群組的機率。</span><span class="sxs-lookup"><span data-stu-id="c41c0-110">Increasing connection timeout and implementing connection retry logic will increase the probability that an application will connect to an availability group.</span></span> <span data-ttu-id="c41c0-111">此外，因為連接可能會由於可用性群組容錯移轉而失敗，所以您應該實作連接重試邏輯，並重試失敗的連接，直到重新連接為止。</span><span class="sxs-lookup"><span data-stu-id="c41c0-111">Also, because a connection can fail because of an availability group failover, you should implement connection retry logic, retrying a failed connection until it reconnects.</span></span>  
  
## <a name="connecting-with-multisubnetfailover"></a><span data-ttu-id="c41c0-112">使用 MultiSubnetFailover 進行連接</span><span class="sxs-lookup"><span data-stu-id="c41c0-112">Connecting With MultiSubnetFailover</span></span>  
 <span data-ttu-id="c41c0-113">在連接到 SQL Server 2012 可用性群組接聽程式或 SQL Server 2012 容錯移轉叢集執行個體時，永遠指定 `MultiSubnetFailover=Yes`。</span><span class="sxs-lookup"><span data-stu-id="c41c0-113">Always specify `MultiSubnetFailover=Yes` when connecting to a SQL Server 2012 availability group listener or SQL Server 2012 Failover Cluster Instance.</span></span> <span data-ttu-id="c41c0-114">`MultiSubnetFailover` 對於 SQL Server 2012 中的所有可用性群組和容錯移轉叢集執行個體可促進更快的容錯移轉，並大幅縮短單一和多重子網路 AlwaysOn 拓撲的容錯移轉時間。</span><span class="sxs-lookup"><span data-stu-id="c41c0-114">`MultiSubnetFailover` enables faster failover for all Availability Groups and failover cluster instance in SQL Server 2012 and will significantly reduce failover time for single and multi-subnet AlwaysOn topologies.</span></span> <span data-ttu-id="c41c0-115">在多重子網路容錯移轉期間，用戶端會平行嘗試連接。</span><span class="sxs-lookup"><span data-stu-id="c41c0-115">During a multi-subnet failover, the client will attempt connections in parallel.</span></span> <span data-ttu-id="c41c0-116">在子網路容錯移轉期間，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 會積極重試 TCP 連接。</span><span class="sxs-lookup"><span data-stu-id="c41c0-116">During a subnet failover, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will aggressively retry the TCP connection.</span></span>  
  
 <span data-ttu-id="c41c0-117">`MultiSubnetFailover` 連接屬性指示，應用程式正在可用性群組或容錯移轉叢集執行個體中部署，而且 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 會透過嘗試連接到所有 IP 位址，嘗試連接到主要 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體的資料庫。</span><span class="sxs-lookup"><span data-stu-id="c41c0-117">The `MultiSubnetFailover` connection property indicates that the application is being deployed in an availability group or Failover Cluster Instance, and that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will try to connect to the database on the primary [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance by trying to connect to all the IP addresses.</span></span> <span data-ttu-id="c41c0-118">當 `MultiSubnetFailover=Yes` 指定連接的時，用戶端會重試 TCP 連線嘗試的速度比作業系統的預設 TCP 重新傳輸間隔更快。</span><span class="sxs-lookup"><span data-stu-id="c41c0-118">When `MultiSubnetFailover=Yes` is specified for a connection, the client retries TCP connection attempts faster than the operating system's default TCP retransmit intervals.</span></span> <span data-ttu-id="c41c0-119">這種方式可在容錯移轉 AlwaysOn 可用性群組或 AlwaysOn 容錯移轉叢集執行個體之後更快重新連線，且同時適用於單一和多重子網路可用性群組和容錯移轉叢集執行個體。</span><span class="sxs-lookup"><span data-stu-id="c41c0-119">This enables faster reconnection after failover of either an AlwaysOn Availability Group or an AlwaysOn Failover Cluster Instance, and is applicable to both single- and multi-subnet Availability Groups and Failover Cluster Instances.</span></span>  
  
 <span data-ttu-id="c41c0-120">如需連接字串關鍵字的詳細資訊，請參閱[搭配 SQL Server Native Client 使用連接字串關鍵字](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-120">For more information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="c41c0-121">當連接到可用性群組接聽程式或容錯移轉叢集執行個體以外的某個項目時，指定 `MultiSubnetFailover=Yes` 將會產生負面效能影響，而且不支援這樣的處理方式。</span><span class="sxs-lookup"><span data-stu-id="c41c0-121">Specifying `MultiSubnetFailover=Yes` when connecting to something other than an availability group listener or Failover Cluster Instance may result in a negative performance impact, and is not supported.</span></span>  
  
 <span data-ttu-id="c41c0-122">請使用下列指導方針，連接到可用性群組或容錯移轉叢集執行個體中的伺服器：</span><span class="sxs-lookup"><span data-stu-id="c41c0-122">Use the following guidelines to connect to a server in an availability group or Failover Cluster Instance:</span></span>  
  
-   <span data-ttu-id="c41c0-123">在連接到單一子網路或多重子網路時，使用 `MultiSubnetFailover` 連接屬性；這會提高這兩種可用性群組接聽程式的效能。</span><span class="sxs-lookup"><span data-stu-id="c41c0-123">Use the `MultiSubnetFailover` connection property when connecting to a single subnet or multi-subnet; it will improve performance for both.</span></span>  
  
-   <span data-ttu-id="c41c0-124">若要連接到可用性群組，在連接字串中指定可用性群組的可用性群組接聽程式做為伺服器。</span><span class="sxs-lookup"><span data-stu-id="c41c0-124">To connect to an availability group, specify the availability group listener of the availability group as the server in your connection string.</span></span>  
  
-   <span data-ttu-id="c41c0-125">連接到設定超過 64 個 IP 位址的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體會導致連接失敗。</span><span class="sxs-lookup"><span data-stu-id="c41c0-125">Connecting to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance configured with more than 64 IP addresses will cause a connection failure.</span></span>  
  
-   <span data-ttu-id="c41c0-126">使用 `MultiSubnetFailover` 連接屬性之應用程式的行為不受驗證類型影響：[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 驗證、Kerberos 驗證或 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="c41c0-126">Behavior of an application that uses the `MultiSubnetFailover` connection property is not affected based on the type of authentication: [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Authentication, Kerberos Authentication, or Windows Authentication.</span></span>  
  
-   <span data-ttu-id="c41c0-127">您可以增加 `loginTimeout` 的值，來容納容錯移轉時間並減少應用程式連接重試次數。</span><span class="sxs-lookup"><span data-stu-id="c41c0-127">You can increase the value of `loginTimeout` to accommodate for failover time and reduce application connection retry attempts.</span></span>  
  
-   <span data-ttu-id="c41c0-128">不支援分散式工作階段。</span><span class="sxs-lookup"><span data-stu-id="c41c0-128">Distributed transactions are not supported.</span></span>  
  
 <span data-ttu-id="c41c0-129">如果唯讀路由不在作用中，在下列狀況下，連接到可用性群組中的次要複本位置將會失敗：</span><span class="sxs-lookup"><span data-stu-id="c41c0-129">If read-only routing is not in effect, connecting to a secondary replica location in an availability group will fail in the following situations:</span></span>  
  
1.  <span data-ttu-id="c41c0-130">如果未設定次要複本位置接受連接。</span><span class="sxs-lookup"><span data-stu-id="c41c0-130">If the secondary replica location is not configured to accept connections.</span></span>  
  
2.  <span data-ttu-id="c41c0-131">如果應用程式使用 `ApplicationIntent=ReadWrite` (下文討論)，而且已針對唯讀存取設定次要複本位置。</span><span class="sxs-lookup"><span data-stu-id="c41c0-131">If an application uses `ApplicationIntent=ReadWrite` (discussed below) and the secondary replica location is configured for read-only access.</span></span>  
  
 <span data-ttu-id="c41c0-132">如果設定主要複本拒絕唯讀工作負載，而且連接字串包含 `ApplicationIntent=ReadOnly`，則連接會失敗。</span><span class="sxs-lookup"><span data-stu-id="c41c0-132">A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains `ApplicationIntent=ReadOnly`.</span></span>  
  
## <a name="upgrading-to-use-multi-subnet-clusters-from-database-mirroring"></a><span data-ttu-id="c41c0-133">從資料庫鏡像升級到使用多子重網路叢集</span><span class="sxs-lookup"><span data-stu-id="c41c0-133">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</span></span>  
 <span data-ttu-id="c41c0-134">如果連接字串中有 `MultiSubnetFailover` 和 `Failover_Partner` 連接關鍵字，則會發生連接錯誤。</span><span class="sxs-lookup"><span data-stu-id="c41c0-134">A connection error will occur if the `MultiSubnetFailover` and `Failover_Partner` connection keywords are present in the connection string.</span></span> <span data-ttu-id="c41c0-135">如果使用 `MultiSubnetFailover` 而且 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 傳回容錯移轉夥伴回應，指出它是資料庫鏡像配對的一部分，也會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="c41c0-135">An error will also occur if `MultiSubnetFailover` is used and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] returns a failover partner response indicating it is part of a database mirroring pair.</span></span>  
  
 <span data-ttu-id="c41c0-136">如果您將目前使用資料庫鏡像的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 應用程式升級為多重子網路案例，應該移除 `Failover_Partner` 連接屬性，以設為 `MultiSubnetFailover` 的 `Yes` 取代它，並以可用性群組接聽程式取代連接字串中的伺服器名稱。</span><span class="sxs-lookup"><span data-stu-id="c41c0-136">If you upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application that currently uses database mirroring to a multi-subnet scenario, you should remove the `Failover_Partner` connection property and replace it with `MultiSubnetFailover` set to `Yes` and replace the server name in the connection string with an availability group listener.</span></span> <span data-ttu-id="c41c0-137">如果連接字串使用 `Failover_Partner` 和 `MultiSubnetFailover=Yes`，驅動程式會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="c41c0-137">If a connection string uses `Failover_Partner` and `MultiSubnetFailover=Yes`, the driver will generate an error.</span></span> <span data-ttu-id="c41c0-138">不過，如果連接字串使用 `Failover_Partner` 和 `MultiSubnetFailover=No` (或 `ApplicationIntent=ReadWrite`)，應用程式就會使用資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="c41c0-138">However, if a connection string uses `Failover_Partner` and `MultiSubnetFailover=No` (or `ApplicationIntent=ReadWrite`), the application will use database mirroring.</span></span>  
  
 <span data-ttu-id="c41c0-139">如果可用性群組中的主要資料庫使用資料庫鏡像，而且如果在連接到主要資料庫 (而不是可用性群組接聽程式) 的連接字串中使用 `MultiSubnetFailover=Yes`，驅動程式會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="c41c0-139">The driver will return an error if database mirroring is used on the primary database in the availability group, and if `MultiSubnetFailover=Yes` is used in the connection string that connects to a primary database instead of to an availability group listener.</span></span>  
  
## <a name="specifying-application-intent"></a><span data-ttu-id="c41c0-140">指定應用程式意圖</span><span class="sxs-lookup"><span data-stu-id="c41c0-140">Specifying Application Intent</span></span>  
 <span data-ttu-id="c41c0-141">當 `ApplicationIntent=ReadOnly` 時，用戶端在連接到啟用 AlwaysOn 的資料庫時會要求讀取工作負載。</span><span class="sxs-lookup"><span data-stu-id="c41c0-141">When `ApplicationIntent=ReadOnly`, the client requests a read workload when connecting to an AlwaysOn enabled database.</span></span> <span data-ttu-id="c41c0-142">伺服器會在連接時和在 USE 資料庫陳述式期間，只針對啟用 AlwaysOn 的資料庫強制執行此意圖。</span><span class="sxs-lookup"><span data-stu-id="c41c0-142">The server will enforce the intent at connection time and during a USE database statement but only to an Always On enabled database.</span></span>  
  
 <span data-ttu-id="c41c0-143">`ApplicationIntent` 關鍵字不適用於舊版唯讀資料庫。</span><span class="sxs-lookup"><span data-stu-id="c41c0-143">The `ApplicationIntent` keyword does not work with legacy, read-only databases.</span></span>  
  
 <span data-ttu-id="c41c0-144">資料庫可以允許或不允許 AlwaysOn 目標資料庫上的讀取工作負載</span><span class="sxs-lookup"><span data-stu-id="c41c0-144">A database can allow or disallow read workloads on the targeted AlwaysOn database.</span></span> <span data-ttu-id="c41c0-145">(此作業會透過 `ALLOW_CONNECTIONS` 和 `PRIMARY_ROLE``SECONDARY_ROLE` 陳述式的 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 子句來完成)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-145">(This is done with the `ALLOW_CONNECTIONS` clause of the `PRIMARY_ROLE` and `SECONDARY_ROLE`[!INCLUDE[tsql](../../../includes/tsql-md.md)] statements.)</span></span>  
  
 <span data-ttu-id="c41c0-146">`ApplicationIntent` 關鍵字用於啟用唯讀路由。</span><span class="sxs-lookup"><span data-stu-id="c41c0-146">The `ApplicationIntent` keyword is used to enable read-only routing.</span></span>  
  
## <a name="read-only-routing"></a><span data-ttu-id="c41c0-147">唯讀路由</span><span class="sxs-lookup"><span data-stu-id="c41c0-147">Read-Only Routing</span></span>  
 <span data-ttu-id="c41c0-148">唯讀路由是可確保資料庫的唯讀複本之可用性的功能。</span><span class="sxs-lookup"><span data-stu-id="c41c0-148">Read-only routing is a feature that can ensure the availability of a read only replica of a database.</span></span> <span data-ttu-id="c41c0-149">若要啟用唯讀路由：</span><span class="sxs-lookup"><span data-stu-id="c41c0-149">To enable read-only routing:</span></span>  
  
1.  <span data-ttu-id="c41c0-150">您必須連接到 AlwaysOn 可用性群組的可用性群組接聽程式。</span><span class="sxs-lookup"><span data-stu-id="c41c0-150">You must connect to an Always On Availability Group availability group listener.</span></span>  
  
2.  <span data-ttu-id="c41c0-151">`ApplicationIntent` 連接字串關鍵字必須設為 `ReadOnly`。</span><span class="sxs-lookup"><span data-stu-id="c41c0-151">The `ApplicationIntent` connection string keyword must be set to `ReadOnly`.</span></span>  
  
3.  <span data-ttu-id="c41c0-152">可用性群組必須由資料庫管理員設定為啟用唯讀路由。</span><span class="sxs-lookup"><span data-stu-id="c41c0-152">The Availability Group must be configured by the database administrator to enable read-only routing.</span></span>  
  
 <span data-ttu-id="c41c0-153">使用唯讀路由的多個連接可能不會連接至相同的唯讀複本。</span><span class="sxs-lookup"><span data-stu-id="c41c0-153">It is possible that multiple connections using read-only routing will not all connect to the same read-only replica.</span></span> <span data-ttu-id="c41c0-154">資料庫同步處理的變更或伺服器路由組態的變更，可能會導致用戶端連接至不同的唯讀複本。</span><span class="sxs-lookup"><span data-stu-id="c41c0-154">Changes in database synchronization or changes in the server's routing configuration can result in client connections to different read-only replicas.</span></span> <span data-ttu-id="c41c0-155">若要確保所有唯讀要求連接至相同的唯讀複本，請勿將可用性群組接聽程式傳遞給 `Server` 連接字串關鍵字。</span><span class="sxs-lookup"><span data-stu-id="c41c0-155">To ensure that all read-only requests connect to the same read-only replica, do not pass an availability group listener to the `Server` connection string keyword.</span></span> <span data-ttu-id="c41c0-156">請改為指定唯讀執行個體的名稱。</span><span class="sxs-lookup"><span data-stu-id="c41c0-156">Instead, specify the name of the read-only instance.</span></span>  
  
 <span data-ttu-id="c41c0-157">唯讀路由可能比連接到主要複本的時間更長，因為唯讀路由先連接到主要複本，再尋找最佳的可讀取次要複本。</span><span class="sxs-lookup"><span data-stu-id="c41c0-157">Read-only routing may take longer than connecting to the primary because read only routing first connects to the primary and then looks for the best available readable secondary.</span></span> <span data-ttu-id="c41c0-158">因此，您應該增加登入逾時。</span><span class="sxs-lookup"><span data-stu-id="c41c0-158">Because of this, you should increase your login timeout.</span></span>  
  
## <a name="odbc"></a><span data-ttu-id="c41c0-159">ODBC</span><span class="sxs-lookup"><span data-stu-id="c41c0-159">ODBC</span></span>  
 <span data-ttu-id="c41c0-160">已加入兩個 ODBC 連接字串關鍵字來支援 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] Native Client 中的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="c41c0-160">Two ODBC connection string keywords were added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `ApplicationIntent`  
  
-   `MultiSubnetFailover`  
  
 <span data-ttu-id="c41c0-161">如需 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中 ODBC 連接字串關鍵字的詳細資訊，請參閱[搭配 SQL Server Native Client 使用連接字串關鍵字](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-161">For more information about ODBC connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="c41c0-162">同等的連接屬性如下：</span><span class="sxs-lookup"><span data-stu-id="c41c0-162">The equivalent connection properties are:</span></span>  
  
-   `SQL_COPT_SS_APPLICATION_INTENT`  
  
-   `SQL_COPT_SS_MULTISUBNET_FAILOVER`  
  
 <span data-ttu-id="c41c0-163">如需 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中 ODBC 連接屬性的詳細資訊，請參閱 [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-163">For more information about ODBC connection properties in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md).</span></span>  
  
 <span data-ttu-id="c41c0-164">從 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 開始，`ApplicationIntent` 和 `MultiSubnetFailover` 關鍵字的功能將會公開在使用 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] Native Client 驅動程式之 DSN 的 ODBC 資料來源管理員中。</span><span class="sxs-lookup"><span data-stu-id="c41c0-164">The functionality of the `ApplicationIntent` and `MultiSubnetFailover` keywords will be exposed in the ODBC Data Source Administrator for DSNs that use the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client driver, beginning in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
 <span data-ttu-id="c41c0-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC 應用程式可以使用三個函數的其中一個進行連接：</span><span class="sxs-lookup"><span data-stu-id="c41c0-165">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC application can use one of three functions to make the connection:</span></span>  
  
|<span data-ttu-id="c41c0-166">函式</span><span class="sxs-lookup"><span data-stu-id="c41c0-166">Function</span></span>|<span data-ttu-id="c41c0-167">描述</span><span class="sxs-lookup"><span data-stu-id="c41c0-167">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="c41c0-168">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="c41c0-168">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)|<span data-ttu-id="c41c0-169">`SQLBrowseConnect` 傳回的伺服器清單不包括 VNN。</span><span class="sxs-lookup"><span data-stu-id="c41c0-169">The list of servers returned by `SQLBrowseConnect` will not include VNNs.</span></span> <span data-ttu-id="c41c0-170">您只會看到伺服器清單，無從得知伺服器是否為獨立伺服器或是 Windows Server 容錯移轉叢集 (WSFC) 中，包含兩個或多個已啟用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 之 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 執行個體的主要或次要伺服器。</span><span class="sxs-lookup"><span data-stu-id="c41c0-170">You will only see a list of servers without any indication if the server is a standalone server, or a primary or secondary server in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="c41c0-171">如果您連接到伺服器而且發生失敗狀況，可能是因為您已經連接到伺服器，而且 `ApplicationIntent` 設定與伺服器組態不相容。</span><span class="sxs-lookup"><span data-stu-id="c41c0-171">If you connect to a server and get a failure, it may be because you have connected to a server, and the `ApplicationIntent` setting is not compatible with the server configuration.</span></span><br /><br /> <span data-ttu-id="c41c0-172">因為 `SQLBrowseConnect` 無法辨識 Windows Server 容錯移轉叢集 (WSFC) 中，包含兩個或多個已啟用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 之 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 執行個體的伺服器，所以 `SQLBrowseConnect` 會忽略 `MultiSubnetFailover` 連接字串關鍵字。</span><span class="sxs-lookup"><span data-stu-id="c41c0-172">Because `SQLBrowseConnect` does not recognize servers in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], `SQLBrowseConnect` ignores the `MultiSubnetFailover` connection string keyword.</span></span>|  
|[<span data-ttu-id="c41c0-173">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="c41c0-173">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)|<span data-ttu-id="c41c0-174">`SQLConnect` 透過資料來源名稱 (DSN) 或連接屬性來支援 `ApplicationIntent` 和 `MultiSubnetFailover`。</span><span class="sxs-lookup"><span data-stu-id="c41c0-174">`SQLConnect` supports both `ApplicationIntent` and `MultiSubnetFailover` via a data source name (DSN) or connection properties.</span></span>|  
|[<span data-ttu-id="c41c0-175">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="c41c0-175">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)|<span data-ttu-id="c41c0-176">`SQLDriverConnect` 透過連接字串關鍵字、連接屬性或 DSN 來支援 `ApplicationIntent` 和 `MultiSubnetFailover`。</span><span class="sxs-lookup"><span data-stu-id="c41c0-176">`SQLDriverConnect` supports `ApplicationIntent` and `MultiSubnetFailover` via connection string keywords, connection properties, or DSN.</span></span>|  
  
## <a name="ole-db"></a><span data-ttu-id="c41c0-177">OLE DB</span><span class="sxs-lookup"><span data-stu-id="c41c0-177">OLE DB</span></span>  
 <span data-ttu-id="c41c0-178">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中的 OLE DB 不支援 `MultiSubnetFailover` 關鍵字。</span><span class="sxs-lookup"><span data-stu-id="c41c0-178">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not support the `MultiSubnetFailover` keyword.</span></span>  
  
 <span data-ttu-id="c41c0-179">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中的 OLE DB 將會支援應用程式意圖。</span><span class="sxs-lookup"><span data-stu-id="c41c0-179">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will support application intent.</span></span> <span data-ttu-id="c41c0-180">OLE DB 應用程式與 ODBC 應用程式的應用程式意圖將會有相同的行為 (請參閱上面的內容)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-180">Application intent will behave the same for OLE DB applications as ODBC applications (see above).</span></span>  
  
 <span data-ttu-id="c41c0-181">已加入一個 OLE DB 連接字串關鍵字來支援 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] Native Client 中的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="c41c0-181">One OLE DB connection string keyword added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `Application Intent`  
  
 <span data-ttu-id="c41c0-182">如需 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client 中連接字串關鍵字的詳細資訊，請參閱[搭配 SQL Server Native Client 使用連接字串關鍵字](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="c41c0-182">For more information about connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="c41c0-183">同等的連接屬性如下：</span><span class="sxs-lookup"><span data-stu-id="c41c0-183">The equivalent connection properties are:</span></span>  
  
-   `SSPROP_INIT_APPLICATIONINTENT`  
  
-   `DBPROP_INIT_PROVIDERSTRING`  
  
 <span data-ttu-id="c41c0-184">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB 應用程式可以使用其中一個方法來指定應用程式意圖：</span><span class="sxs-lookup"><span data-stu-id="c41c0-184">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB application can use one of the methods to specify application intent:</span></span>  
  
 `IDBInitialize::Initialize`  
 <span data-ttu-id="c41c0-185">`IDBInitialize::Initialize` 會使用之前設定的屬性集合來初始化資料來源及建立資料來源物件。</span><span class="sxs-lookup"><span data-stu-id="c41c0-185">`IDBInitialize::Initialize` uses the previously configured set of properties to initialize the data source and create the data source object.</span></span> <span data-ttu-id="c41c0-186">將應用程式意圖指定為提供者屬性或是擴充屬性字串的一部分。</span><span class="sxs-lookup"><span data-stu-id="c41c0-186">Specify application intent as a provider property or as part of the extended properties string.</span></span>  
  
 `IDataInitialize::GetDataSource`  
 <span data-ttu-id="c41c0-187">`IDataInitialize::GetDataSource` 會採用可包含 `Application Intent` 關鍵字的輸入連接字串。</span><span class="sxs-lookup"><span data-stu-id="c41c0-187">`IDataInitialize::GetDataSource` takes an input connection string that can contain the `Application Intent` keyword.</span></span>  
  
 `IDBProperties::GetProperties`  
 <span data-ttu-id="c41c0-188">`IDBProperties::GetProperties` 會擷取目前在資料來源上設定的屬性值。</span><span class="sxs-lookup"><span data-stu-id="c41c0-188">`IDBProperties::GetProperties` retrieves the value of the property that is currently set on the data source.</span></span>  <span data-ttu-id="c41c0-189">您可以透過 DBPROP_INIT_PROVIDERSTRING 屬性和 SSPROP_INIT_APPLICATIONINTENT 屬性擷取 `Application Intent` 值。</span><span class="sxs-lookup"><span data-stu-id="c41c0-189">You can retrieve the `Application Intent` value through the DBPROP_INIT_PROVIDERSTRING property and SSPROP_INIT_APPLICATIONINTENT property.</span></span>  
  
 `IDBProperties::SetProperties`  
 <span data-ttu-id="c41c0-190">若要設定 `ApplicationIntent` 屬性值，請呼叫 `IDBProperties::SetProperties` 來傳入 `SSPROP_INIT_APPLICATIONINTENT` 屬性 (該屬性的值為 "`ReadWrite`" 或 "`ReadOnly`")，或是傳入 `DBPROP_INIT_PROVIDERSTRING` 屬性 (該屬性的值包含 "`ApplicationIntent=ReadOnly`" 或 "`ApplicationIntent=ReadWrite`")。</span><span class="sxs-lookup"><span data-stu-id="c41c0-190">To set the `ApplicationIntent` property value, call `IDBProperties::SetProperties` passing in the `SSPROP_INIT_APPLICATIONINTENT` property with value "`ReadWrite`" or "`ReadOnly`" or `DBPROP_INIT_PROVIDERSTRING` property with value containing "`ApplicationIntent=ReadOnly`" or "`ApplicationIntent=ReadWrite`".</span></span>  
  
 <span data-ttu-id="c41c0-191">您可以在 [資料連結屬性]\*\*\*\* 對話方塊中，[全部] 索引標籤的 [應用程式的意圖屬性] 欄位內指定應用程式意圖。</span><span class="sxs-lookup"><span data-stu-id="c41c0-191">You can specify application intent in the Application Intent Properties field of the All tab in the **Data Link Properties** dialog box.</span></span>  
  
 <span data-ttu-id="c41c0-192">當建立隱含連接時，隱含連接將會使用父連接的應用程式意圖設定。</span><span class="sxs-lookup"><span data-stu-id="c41c0-192">When implicit connections are established, the implicit connection will use the application intent setting of the parent connection.</span></span> <span data-ttu-id="c41c0-193">同樣地，從相同資料來源建立的多個工作階段將會繼承資料來源的應用程式意圖設定。</span><span class="sxs-lookup"><span data-stu-id="c41c0-193">Similarly, multiple sessions created from the same data source will inherit the data source's application intent setting.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c41c0-194">另請參閱</span><span class="sxs-lookup"><span data-stu-id="c41c0-194">See Also</span></span>  
 <span data-ttu-id="c41c0-195">[SQL Server Native Client 功能](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="c41c0-195">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="c41c0-196">搭配 SQL Server Native Client 使用連接字串關鍵字</span><span class="sxs-lookup"><span data-stu-id="c41c0-196">Using Connection String Keywords with SQL Server Native Client</span></span>](../applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
  
