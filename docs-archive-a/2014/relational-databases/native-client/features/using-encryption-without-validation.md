---
title: 使用加密而不需驗證 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], encryption
- cryptography [SQL Server Native Client]
- SQLNCLI, encryption
- encryption [SQL Server Native Client]
- SQL Server Native Client, encryption
ms.assetid: f4c63206-80bb-4d31-84ae-ccfcd563effa
author: rothja
ms.author: jroth
ms.openlocfilehash: 0a6d2e8b3d696a92e3fa3e1b7de7604551d4f9ce
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87592660"
---
# <a name="using-encryption-without-validation"></a><span data-ttu-id="7804b-102">使用加密而不需驗證</span><span class="sxs-lookup"><span data-stu-id="7804b-102">Using Encryption Without Validation</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="7804b-103">一律會加密與登入有關的網路封包。</span><span class="sxs-lookup"><span data-stu-id="7804b-103">always encrypts network packets associated with logging in.</span></span> <span data-ttu-id="7804b-104">如果當它啟動時未在伺服器上提供任何憑證，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 會產生自行簽署的憑證，該憑證會用來加密登入封包。</span><span class="sxs-lookup"><span data-stu-id="7804b-104">If no certificate has been provisioned on the server when it starts up, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a self-signed certificate which is used to encrypt login packets.</span></span>  
  
 <span data-ttu-id="7804b-105">應用程式也可要求加密所有網路流量，其方式是使用連接字串關鍵字或連接屬性。</span><span class="sxs-lookup"><span data-stu-id="7804b-105">Applications may also request encryption of all network traffic by using connection string keywords or connection properties.</span></span> <span data-ttu-id="7804b-106">當搭配**IDbInitialize：： Initialize**使用提供者字串時，關鍵字為 "Encrypt OLE DB"，或在搭配使用初始化字串與**IDataInitialize**時，使用 ADO 和 OLE DB 的 "Encryption for Data"。</span><span class="sxs-lookup"><span data-stu-id="7804b-106">The keywords are "Encrypt" for ODBC and OLE DB when using a provider string with **IDbInitialize::Initialize**, or "Use Encryption for Data" for ADO and OLE DB when using an initialization string with **IDataInitialize**.</span></span> <span data-ttu-id="7804b-107">這也可以透過 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 使用 [**強制通訊協定加密**] 選項 Configuration Manager 來設定。</span><span class="sxs-lookup"><span data-stu-id="7804b-107">This may also be configured by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager using the **Force Protocol Encryption** option.</span></span> <span data-ttu-id="7804b-108">根據預設，加密連接的所有網路流量會要求在伺服器上提供憑證。</span><span class="sxs-lookup"><span data-stu-id="7804b-108">By default, encryption of all network traffic for a connection requires that a certificate be provisioned on the server.</span></span>  
  
 <span data-ttu-id="7804b-109">如需連接字串關鍵字的詳細資訊，請參閱搭配[使用連接字串關鍵字與 SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md)。</span><span class="sxs-lookup"><span data-stu-id="7804b-109">For information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="7804b-110">若要在伺服器上尚未佈建憑證時使用加密，[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 組態管理員可用來設定 [強制通訊協定加密]\*\*\*\* 和 [信任伺服器憑證]\*\*\*\* 選項。</span><span class="sxs-lookup"><span data-stu-id="7804b-110">To enable encryption to be used when a certificate has not been provisioned on the server, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager can be used to set both the **Force Protocol Encryption** and the **Trust Server Certificate** options.</span></span> <span data-ttu-id="7804b-111">在此情況下，如果伺服器上未提供任何可驗證的憑證，加密將會使用自行簽署的伺服器憑證，而不需驗證。</span><span class="sxs-lookup"><span data-stu-id="7804b-111">In this case, encryption will use a self-signed server certificate without validation if no verifiable certificate has been provisioned on the server.</span></span>  
  
 <span data-ttu-id="7804b-112">應用程式可能也會使用 "TrustServerCertificate" 關鍵字或它的關聯連接屬性，以便保證加密將會發生。</span><span class="sxs-lookup"><span data-stu-id="7804b-112">Applications may also use the "TrustServerCertificate" keyword or its associated connection attribute to guarantee that encryption takes place.</span></span> <span data-ttu-id="7804b-113">應用程式設定絕對不會減少 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 用戶端組態管理員所設定的安全性層級，但是可能會強化它。</span><span class="sxs-lookup"><span data-stu-id="7804b-113">Application settings never reduce the level of security set by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Client Configuration Manager, but may strengthen it.</span></span> <span data-ttu-id="7804b-114">例如，如果未針對用戶端設定 [強制通訊協定加密]\*\*\*\*，應用程式可能會自行要求加密。</span><span class="sxs-lookup"><span data-stu-id="7804b-114">For example, if **Force Protocol Encryption** is not set for the client, an application may request encryption itself.</span></span> <span data-ttu-id="7804b-115">如果要保證加密，甚至是在尚未提供伺服器憑證時，應用程式可能會要求加密和 "TrustServerCertificate"。</span><span class="sxs-lookup"><span data-stu-id="7804b-115">To guarantee encryption even when a server certificate has not been provisioned, an application may request encryption and "TrustServerCertificate".</span></span> <span data-ttu-id="7804b-116">但是，如果用戶端組態中未啟用 "TrustServerCertificate"，仍然需要提供的伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="7804b-116">However, if "TrustServerCertificate" is not enabled in the client configuration, a provisioned server certificate is still required.</span></span> <span data-ttu-id="7804b-117">下表描述所有的案例：</span><span class="sxs-lookup"><span data-stu-id="7804b-117">The following table describes all cases:</span></span>  
  
|<span data-ttu-id="7804b-118">強制通訊協定加密用戶端設定</span><span class="sxs-lookup"><span data-stu-id="7804b-118">Force Protocol Encryption client setting</span></span>|<span data-ttu-id="7804b-119">信任伺服器憑證用戶端設定</span><span class="sxs-lookup"><span data-stu-id="7804b-119">Trust Server Certificate client setting</span></span>|<span data-ttu-id="7804b-120">資料的連接字串/連接屬性加密/使用加密</span><span class="sxs-lookup"><span data-stu-id="7804b-120">Connection string/connection attribute Encrypt/Use Encryption for Data</span></span>|<span data-ttu-id="7804b-121">連接字串/連接屬性信任伺服器憑證</span><span class="sxs-lookup"><span data-stu-id="7804b-121">Connection string/connection attribute Trust Server Certificate</span></span>|<span data-ttu-id="7804b-122">結果</span><span class="sxs-lookup"><span data-stu-id="7804b-122">Result</span></span>|  
|----------------------------------------------|---------------------------------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|------------|  
|<span data-ttu-id="7804b-123">否</span><span class="sxs-lookup"><span data-stu-id="7804b-123">No</span></span>|<span data-ttu-id="7804b-124">N/A</span><span class="sxs-lookup"><span data-stu-id="7804b-124">N/A</span></span>|<span data-ttu-id="7804b-125">無 (預設值)</span><span class="sxs-lookup"><span data-stu-id="7804b-125">No (default)</span></span>|<span data-ttu-id="7804b-126">忽略</span><span class="sxs-lookup"><span data-stu-id="7804b-126">Ignored</span></span>|<span data-ttu-id="7804b-127">不發生任何加密。</span><span class="sxs-lookup"><span data-stu-id="7804b-127">No encryption occurs.</span></span>|  
|<span data-ttu-id="7804b-128">否</span><span class="sxs-lookup"><span data-stu-id="7804b-128">No</span></span>|<span data-ttu-id="7804b-129">N/A</span><span class="sxs-lookup"><span data-stu-id="7804b-129">N/A</span></span>|<span data-ttu-id="7804b-130">是</span><span class="sxs-lookup"><span data-stu-id="7804b-130">Yes</span></span>|<span data-ttu-id="7804b-131">無 (預設值)</span><span class="sxs-lookup"><span data-stu-id="7804b-131">No (default)</span></span>|<span data-ttu-id="7804b-132">只有當有可驗證的伺服器憑證時才會發生加密，否則連接嘗試會失敗。</span><span class="sxs-lookup"><span data-stu-id="7804b-132">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="7804b-133">否</span><span class="sxs-lookup"><span data-stu-id="7804b-133">No</span></span>|<span data-ttu-id="7804b-134">N/A</span><span class="sxs-lookup"><span data-stu-id="7804b-134">N/A</span></span>|<span data-ttu-id="7804b-135">是</span><span class="sxs-lookup"><span data-stu-id="7804b-135">Yes</span></span>|<span data-ttu-id="7804b-136">是</span><span class="sxs-lookup"><span data-stu-id="7804b-136">Yes</span></span>|<span data-ttu-id="7804b-137">加密一定會發生，但是可能會使用自行簽署的伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="7804b-137">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="7804b-138">是</span><span class="sxs-lookup"><span data-stu-id="7804b-138">Yes</span></span>|<span data-ttu-id="7804b-139">否</span><span class="sxs-lookup"><span data-stu-id="7804b-139">No</span></span>|<span data-ttu-id="7804b-140">忽略</span><span class="sxs-lookup"><span data-stu-id="7804b-140">Ignored</span></span>|<span data-ttu-id="7804b-141">忽略</span><span class="sxs-lookup"><span data-stu-id="7804b-141">Ignored</span></span>|<span data-ttu-id="7804b-142">只有當有可驗證的伺服器憑證時才會發生加密，否則連接嘗試會失敗。</span><span class="sxs-lookup"><span data-stu-id="7804b-142">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="7804b-143">是</span><span class="sxs-lookup"><span data-stu-id="7804b-143">Yes</span></span>|<span data-ttu-id="7804b-144">是</span><span class="sxs-lookup"><span data-stu-id="7804b-144">Yes</span></span>|<span data-ttu-id="7804b-145">無 (預設值)</span><span class="sxs-lookup"><span data-stu-id="7804b-145">No (default)</span></span>|<span data-ttu-id="7804b-146">忽略</span><span class="sxs-lookup"><span data-stu-id="7804b-146">Ignored</span></span>|<span data-ttu-id="7804b-147">加密一定會發生，但是可能會使用自行簽署的伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="7804b-147">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="7804b-148">是</span><span class="sxs-lookup"><span data-stu-id="7804b-148">Yes</span></span>|<span data-ttu-id="7804b-149">是</span><span class="sxs-lookup"><span data-stu-id="7804b-149">Yes</span></span>|<span data-ttu-id="7804b-150">是</span><span class="sxs-lookup"><span data-stu-id="7804b-150">Yes</span></span>|<span data-ttu-id="7804b-151">無 (預設值)</span><span class="sxs-lookup"><span data-stu-id="7804b-151">No (default)</span></span>|<span data-ttu-id="7804b-152">只有當有可驗證的伺服器憑證時才會發生加密，否則連接嘗試會失敗。</span><span class="sxs-lookup"><span data-stu-id="7804b-152">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="7804b-153">是</span><span class="sxs-lookup"><span data-stu-id="7804b-153">Yes</span></span>|<span data-ttu-id="7804b-154">是</span><span class="sxs-lookup"><span data-stu-id="7804b-154">Yes</span></span>|<span data-ttu-id="7804b-155">是</span><span class="sxs-lookup"><span data-stu-id="7804b-155">Yes</span></span>|<span data-ttu-id="7804b-156">是</span><span class="sxs-lookup"><span data-stu-id="7804b-156">Yes</span></span>|<span data-ttu-id="7804b-157">加密一定會發生，但是可能會使用自行簽署的伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="7804b-157">Encryption always occurs, but might use a self-signed server certificate.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="7804b-158">SQL Server Native Client OLE DB 提供者</span><span class="sxs-lookup"><span data-stu-id="7804b-158">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="7804b-159">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB 提供者透過新增 SSPROP_INIT_TRUST_SERVER_CERTIFICATE 資料來源初始化屬性（在 DBPROPSET_SQLSERVERDBINIT 屬性集內執行），而不需驗證，即可支援加密。</span><span class="sxs-lookup"><span data-stu-id="7804b-159">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports encryption without validation through the addition of the SSPROP_INIT_TRUST_SERVER_CERTIFICATE data source initialization property, which is implemented in the DBPROPSET_SQLSERVERDBINIT property set.</span></span> <span data-ttu-id="7804b-160">此外，也已經加入新的連接字串關鍵字 "TrustServerCertificate"。</span><span class="sxs-lookup"><span data-stu-id="7804b-160">In addition, a new connection string keyword, "TrustServerCertificate", as been added.</span></span> <span data-ttu-id="7804b-161">它可接受 yes 或 no 值；預設值是 no。</span><span class="sxs-lookup"><span data-stu-id="7804b-161">It accepts yes or no values; no is the default.</span></span> <span data-ttu-id="7804b-162">當使用服務元件時，它可接受 true 或 false 值；false 是預設值。</span><span class="sxs-lookup"><span data-stu-id="7804b-162">When using service components, it accepts true or false values; false is the default.</span></span>  
  
 <span data-ttu-id="7804b-163">如需對 DBPROPSET_SQLSERVERDBINIT 屬性集所做之增強功能的詳細資訊，請參閱[初始化和授權屬性](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7804b-163">For more information about enhancements made to the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="7804b-164">SQL Server Native Client ODBC 驅動程式</span><span class="sxs-lookup"><span data-stu-id="7804b-164">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="7804b-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC 驅動程式透過[SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)和[SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md)函式的新增功能，支援加密而不進行驗證。</span><span class="sxs-lookup"><span data-stu-id="7804b-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports encryption without validation through additions to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions.</span></span> <span data-ttu-id="7804b-166">已經加入 SQL_COPT_SS_TRUST_SERVER_CERTIFICATE 來接受 SQL_TRUST_SERVER_CERTIFICATE_YES 或 SQL_TRUST_SERVER_CERTIFICATE_NO，預設值為 SQL_TRUST_SERVER_CERTIFICATE_NO。</span><span class="sxs-lookup"><span data-stu-id="7804b-166">SQL_COPT_SS_TRUST_SERVER_CERTIFICATE has been added to accept either SQL_TRUST_SERVER_CERTIFICATE_YES or SQL_TRUST_SERVER_CERTIFICATE_NO, with SQL_TRUST_SERVER_CERTIFICATE_NO being the default.</span></span> <span data-ttu-id="7804b-167">此外，也已經加入新的連接字串關鍵字 "TrustServerCertificate"。</span><span class="sxs-lookup"><span data-stu-id="7804b-167">In addition, a new connection string keyword, "TrustServerCertificate", has been added.</span></span> <span data-ttu-id="7804b-168">它可接受 yes 或 no 值；預設值是 "no"。</span><span class="sxs-lookup"><span data-stu-id="7804b-168">It accepts yes or no values; "no" is the default.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7804b-169">另請參閱</span><span class="sxs-lookup"><span data-stu-id="7804b-169">See Also</span></span>  
 [<span data-ttu-id="7804b-170">SQL Server Native Client 功能</span><span class="sxs-lookup"><span data-stu-id="7804b-170">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
