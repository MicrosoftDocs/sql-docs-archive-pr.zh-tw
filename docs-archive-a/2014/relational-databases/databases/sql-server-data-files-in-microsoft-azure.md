---
title: 在 Azure 中 SQL Server 資料檔案 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87686967"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="5407f-102">Azure 中的 SQL Server 資料檔案</span><span class="sxs-lookup"><span data-stu-id="5407f-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="5407f-103">在 Azure 中 SQL Server 資料檔案可對儲存為 Azure Blob 的 SQL Server 資料庫檔案提供原生支援。</span><span class="sxs-lookup"><span data-stu-id="5407f-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="5407f-104">它可讓您在內部部署或 Azure 虛擬機器中執行的 SQL Server 中建立資料庫，其具有 Azure Blob 儲存體中資料的專用儲存位置。</span><span class="sxs-lookup"><span data-stu-id="5407f-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="5407f-105">此增強功能特別簡化了使用卸離和附加作業，在電腦之間移動資料庫的工作。</span><span class="sxs-lookup"><span data-stu-id="5407f-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="5407f-106">此外，它也可讓您從或 Azure 儲存體還原，為您的資料庫備份檔案提供替代儲存位置。</span><span class="sxs-lookup"><span data-stu-id="5407f-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="5407f-107">因此，它會針對資料虛擬化、資料移動、安全性和可用性提供許多優點，進而實現許多混合式方案，而且成本低廉、維護簡單，即可達到高可用性和彈性調整的效果。</span><span class="sxs-lookup"><span data-stu-id="5407f-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="5407f-108">本主題介紹將 SQL Server 資料檔案儲存在 Azure 儲存體服務中的核心概念與考慮。</span><span class="sxs-lookup"><span data-stu-id="5407f-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="5407f-109">如需如何使用這項新功能的實際操作體驗，請參閱[教學課程： SQL Server Azure 儲存體服務中的資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)。</span><span class="sxs-lookup"><span data-stu-id="5407f-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="5407f-110">下圖說明這項增強功能可讓您將 SQL Server 資料庫檔案儲存為 Azure 儲存體中的 Azure blob，不論伺服器所在的位置。</span><span class="sxs-lookup"><span data-stu-id="5407f-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="5407f-111">![SQL Server 與 Azure 儲存體整合](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server 與 Azure 儲存體整合")</span><span class="sxs-lookup"><span data-stu-id="5407f-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="5407f-112">在 Azure 中使用 SQL Server 資料檔案的優點</span><span class="sxs-lookup"><span data-stu-id="5407f-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="5407f-113">**簡單快速移轉優點：** 這項功能會在內部部署的電腦之間以及內部部署與雲端環境之間一次移動一個資料庫來藉以簡化移轉程序，且不需要變更任何應用程式。</span><span class="sxs-lookup"><span data-stu-id="5407f-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="5407f-114">因此，它支援累加式移轉，同時就地維護您現有的內部部署基礎結構。</span><span class="sxs-lookup"><span data-stu-id="5407f-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="5407f-115">此外，當應用程式需要在內部部署環境中的多個位置執行時，存取集中式資料儲存體可簡化應用程式邏輯。</span><span class="sxs-lookup"><span data-stu-id="5407f-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="5407f-116">在某些情況下，您可能需要快速地設定散佈於不同地理位置的電腦中心，以便蒐集許多不同來源的資料。</span><span class="sxs-lookup"><span data-stu-id="5407f-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="5407f-117">藉由使用這項新的增強功能，您可以將許多資料庫儲存為 Azure blob，然後執行 Transact-sql 腳本，在本機電腦或虛擬機器上建立資料庫，而不是將資料從一個位置移到另一個位置。</span><span class="sxs-lookup"><span data-stu-id="5407f-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="5407f-118">**成本和無限制的儲存體優點：** 這項功能可讓您在 Azure 中擁有無限制的異地儲存體，同時運用內部部署計算資源。</span><span class="sxs-lookup"><span data-stu-id="5407f-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="5407f-119">當您使用 Azure 做為儲存位置時，您可以輕鬆地將焦點放在應用程式邏輯上，而不會產生硬體管理的負擔。</span><span class="sxs-lookup"><span data-stu-id="5407f-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="5407f-120">如果您遺失了某個內部部署的計算節點，不需要移動任何資料，就可以設定新的節點。</span><span class="sxs-lookup"><span data-stu-id="5407f-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="5407f-121">**高可用性和嚴重損壞修復的優點：** 使用 Azure 功能中 SQL Server 資料檔案可簡化高可用性和嚴重損壞修復解決方案。</span><span class="sxs-lookup"><span data-stu-id="5407f-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="5407f-122">例如，如果 Azure 中的虛擬機器或 SQL Server 的實例損毀，您只要重新建立 Azure Blob 的連結，就可以在新的機器中重新建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="5407f-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="5407f-123">**安全性優點：** 這項新的增強功能可讓您分隔計算執行個體與儲存執行個體。</span><span class="sxs-lookup"><span data-stu-id="5407f-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="5407f-124">您可以擁有完整加密的資料庫，而且只針對計算執行個體進行解密，但不在儲存執行個體中進行解密。</span><span class="sxs-lookup"><span data-stu-id="5407f-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="5407f-125">換言之，使用這項新的增強功能時，您可以使用透明資料加密 (TDE) 憑證 (與資料實體分隔) 來加密公用雲端中的所有資料。</span><span class="sxs-lookup"><span data-stu-id="5407f-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="5407f-126">TDE 金鑰可以儲存在 master 資料庫中，而這個資料庫會儲存在實體安全的內部部署電腦本機並且進行本機備份。</span><span class="sxs-lookup"><span data-stu-id="5407f-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="5407f-127">您可以使用這些本機密鑰來加密位於 Azure 儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="5407f-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="5407f-128">如果您的雲端儲存體帳戶認證遭竊，您的資料仍然保持安全，因為 TDE 憑證永遠位於內部部署。</span><span class="sxs-lookup"><span data-stu-id="5407f-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="5407f-129">概念和需求</span><span class="sxs-lookup"><span data-stu-id="5407f-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="5407f-130">Azure 儲存體概念</span><span class="sxs-lookup"><span data-stu-id="5407f-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="5407f-131">使用 Azure 功能中的 SQL Server 資料檔案時，您必須在 Azure 中建立儲存體帳戶和容器。</span><span class="sxs-lookup"><span data-stu-id="5407f-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="5407f-132">然後，您必須建立 SQL Server 認證，其中包括容器原則的相關資訊以及存取容器所需的共用存取簽章。</span><span class="sxs-lookup"><span data-stu-id="5407f-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="5407f-133">在 Azure 中，儲存體帳戶代表存取 Blob 之命名空間的最高層級。</span><span class="sxs-lookup"><span data-stu-id="5407f-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="5407f-134">儲存體帳戶可以包含不限制數目的容器，只要其總大小低於 500 TB 即可。</span><span class="sxs-lookup"><span data-stu-id="5407f-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="5407f-135">如需有關儲存體限制的最新資訊，請參閱 [Azure 訂閱與服務限制、配額及條件約束](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/)。</span><span class="sxs-lookup"><span data-stu-id="5407f-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="5407f-136">容器會提供一組 Blob 的群組。</span><span class="sxs-lookup"><span data-stu-id="5407f-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="5407f-137">所有 Blob 都必須位於容器中。</span><span class="sxs-lookup"><span data-stu-id="5407f-137">All Blobs must be in a container.</span></span> <span data-ttu-id="5407f-138">帳戶可以包含不限制數目的容器。</span><span class="sxs-lookup"><span data-stu-id="5407f-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="5407f-139">同樣地，容器也可以儲存不限制數目的 Blob。</span><span class="sxs-lookup"><span data-stu-id="5407f-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="5407f-140">Azure 儲存體可以儲存的 Blob 類型有兩種：區塊和分頁 Blob。</span><span class="sxs-lookup"><span data-stu-id="5407f-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="5407f-141">這項新功能使用的是分頁 Blob (大小最高可達 1TB)，而且當檔案中的位元組範圍經常修改時，更有效率。</span><span class="sxs-lookup"><span data-stu-id="5407f-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="5407f-142">您可以使用以下 URL 格式存取 Blob： `http://storageaccount.blob.core.windows.net/<container>/<blob>`。</span><span class="sxs-lookup"><span data-stu-id="5407f-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="5407f-143">Azure 計費考量</span><span class="sxs-lookup"><span data-stu-id="5407f-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="5407f-144">在決策和規劃程序中，估計使用 Azure 服務的成本是很重要的事項。</span><span class="sxs-lookup"><span data-stu-id="5407f-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="5407f-145">將 SQL Server 資料檔案儲存在 Azure 儲存體中時，需要支付與儲存體和交易相關聯的成本。</span><span class="sxs-lookup"><span data-stu-id="5407f-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="5407f-146">此外，實作 Azure 儲存體功能中的 SQL Server 資料檔案時，還需要每隔 45 至 60 秒，隱含地更新 Blob 租用一次。</span><span class="sxs-lookup"><span data-stu-id="5407f-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="5407f-147">這也會產生每個資料庫檔案 (例如 .mdf 或 .ldf) 的交易成本。</span><span class="sxs-lookup"><span data-stu-id="5407f-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="5407f-148">根據我們的估計，按照目前的定價模式，兩個資料庫檔案 (.mdf 和 .ldf) 更新租用的成本大約是每月 2 美分。</span><span class="sxs-lookup"><span data-stu-id="5407f-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="5407f-149">建議您使用 [Azure 價格](https://azure.microsoft.com/pricing/) 頁面上的資訊來協助估計與使用 Azure 儲存體和 Azure 虛擬機器的每月相關成本。</span><span class="sxs-lookup"><span data-stu-id="5407f-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="5407f-150">SQL 伺服器概念</span><span class="sxs-lookup"><span data-stu-id="5407f-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="5407f-151">使用這項新的增強功能時，您必須執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="5407f-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="5407f-152">您必須在容器上建立原則，同時產生共用存取簽章 (SAS) 金鑰。</span><span class="sxs-lookup"><span data-stu-id="5407f-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="5407f-153">對於資料或記錄檔所使用的每一個容器，您都必須建立名稱符合容器路徑的 SQL Server 認證。</span><span class="sxs-lookup"><span data-stu-id="5407f-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="5407f-154">您必須將 Azure 儲存體容器的相關資訊、其相關聯的原則名稱以及 SAS 金鑰，儲存在 SQL Server 認證存放區中。</span><span class="sxs-lookup"><span data-stu-id="5407f-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="5407f-155">下列範例假設已建立 Azure 儲存體容器，而且已建立具有讀取、寫入、列出許可權的原則。</span><span class="sxs-lookup"><span data-stu-id="5407f-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="5407f-156">在容器上建立原則會產生 SAS 金鑰，這個金鑰會以未加密狀態安全地保存在記憶體中，而且 SQL Server 需要此金鑰才能存取容器中的 Blob 檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="5407f-157">在下列程式碼片段中，使用與下列類似的項目取代 `'your SAS key'` ： `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`。</span><span class="sxs-lookup"><span data-stu-id="5407f-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="5407f-158">如需詳細資訊，請參閱[建立和使用共用存取](https://msdn.microsoft.com/library/azure/jj721951.aspx)簽章</span><span class="sxs-lookup"><span data-stu-id="5407f-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="5407f-159">如果有任何作用中參考指向容器中的資料檔案，則嘗試刪除相對應的 SQL Server 認證會失敗。</span><span class="sxs-lookup"><span data-stu-id="5407f-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="5407f-160">安全性</span><span class="sxs-lookup"><span data-stu-id="5407f-160">Security</span></span>  
 <span data-ttu-id="5407f-161">以下是將 SQL Server 資料檔案儲存在 Azure 儲存體中的安全性考量和需求。</span><span class="sxs-lookup"><span data-stu-id="5407f-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="5407f-162">建立 Azure Blob 儲存體服務的容器時，建議您將存取設為私用。</span><span class="sxs-lookup"><span data-stu-id="5407f-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="5407f-163">當您將存取設為私用時，只有 Azure 帳戶擁有者才能讀取容器和 Blob 資料。</span><span class="sxs-lookup"><span data-stu-id="5407f-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="5407f-164">在 Azure 儲存體中儲存 SQL Server 資料庫檔案時，您必須使用共用存取簽章，這是針對容器、Blob、佇列和資料表授與有限存取權限的 URI。</span><span class="sxs-lookup"><span data-stu-id="5407f-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="5407f-165">您可以使用共用存取簽章，讓 SQL Server 存取儲存體帳戶中的資源，而不需要共用您的 Azure 儲存體帳戶金鑰。</span><span class="sxs-lookup"><span data-stu-id="5407f-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="5407f-166">此外，我們建議您繼續針對資料庫實作傳統的內部部署安全性作法。</span><span class="sxs-lookup"><span data-stu-id="5407f-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="5407f-167">安裝必要條件</span><span class="sxs-lookup"><span data-stu-id="5407f-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="5407f-168">以下是在 Azure 中儲存 SQL Server 資料檔案時的安裝必要條件。</span><span class="sxs-lookup"><span data-stu-id="5407f-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="5407f-169">**SQL Server 內部部署：** SQL Server 2014 版本包含這項功能。</span><span class="sxs-lookup"><span data-stu-id="5407f-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="5407f-170">若要了解如何下載 SQL Server 2014，請參閱＜ [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx)＞。</span><span class="sxs-lookup"><span data-stu-id="5407f-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="5407f-171">在 Azure 虛擬機器中執行的 SQL Server：如果您要將 SQL Server 安裝在 Azure 虛擬機器上，請安裝 SQL Server 2014，或是更新現有的執行個體。</span><span class="sxs-lookup"><span data-stu-id="5407f-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="5407f-172">同樣地，您也可以使用 SQL Server 2014 平臺映射在 Azure 中建立新的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="5407f-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="5407f-173">若要了解如何下載 SQL Server 2014，請參閱＜ [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx)＞。</span><span class="sxs-lookup"><span data-stu-id="5407f-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="5407f-174">限制</span><span class="sxs-lookup"><span data-stu-id="5407f-174">Limitations</span></span>  
  
-   <span data-ttu-id="5407f-175">在此功能的目前版本中， `FileStream` 不支援將資料儲存在 Azure 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="5407f-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="5407f-176">您可以將 `Filestream` 資料儲存在 Azure 儲存體整合的本機資料庫中，但是您無法使用 Azure 儲存體在電腦之間移動 Filestream 資料。</span><span class="sxs-lookup"><span data-stu-id="5407f-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="5407f-177">對於 `FileStream` 資料，我們建議您繼續使用傳統的技術，在不同的電腦之間移動與 Filestream 相關聯的檔案 (.mdf 和 .ldf)。</span><span class="sxs-lookup"><span data-stu-id="5407f-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="5407f-178">目前，這項新增強功能不支援多個 SQL Server 執行個體同時存取 Azure 儲存體中的相同資料庫檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="5407f-179">如果 ServerA 在線上且具有作用中的資料庫檔案，而 ServerB 意外啟動，而且也有指向相同資料檔案的資料庫，則第二部伺服器將無法啟動資料庫，錯誤碼為 5120 **無法開啟實體檔案 "%.\*ls"。作業系統錯誤 %d: "%ls"** 。</span><span class="sxs-lookup"><span data-stu-id="5407f-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="5407f-180">透過使用 Azure 功能中的 SQL Server 資料檔案，僅能將 .mdf、.ldf 和 .ndf 檔案儲存在 Azure 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="5407f-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="5407f-181">使用 Azure 功能中的 SQL Server 資料檔案時，您的儲存體帳戶不支援異地備援。</span><span class="sxs-lookup"><span data-stu-id="5407f-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="5407f-182">如果儲存體帳戶進行異地備援，然後進行異地容錯移轉，可能會發生資料庫損毀。</span><span class="sxs-lookup"><span data-stu-id="5407f-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="5407f-183">每個 Blob 的大小最高可達 1 TB。</span><span class="sxs-lookup"><span data-stu-id="5407f-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="5407f-184">這會針對 Azure 儲存體可儲存的個別資料庫資料和記錄檔建立上限。</span><span class="sxs-lookup"><span data-stu-id="5407f-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="5407f-185">您無法使用 Azure 儲存體功能中的 SQL Server 資料檔案，將記憶體內部 OLTP 資料儲存在 Azure Blob 中。</span><span class="sxs-lookup"><span data-stu-id="5407f-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="5407f-186">這是因為記憶體內部 OLTP 相依于 `FileStream` 和，而在目前版本的這項功能中， `FileStream` 不支援將資料儲存在 Azure 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="5407f-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="5407f-187">使用 Azure 功能中 SQL Server 資料檔案時，SQL Server 會使用資料庫中設定的定序來執行所有 URL 或檔案路徑比較 `master` 。</span><span class="sxs-lookup"><span data-stu-id="5407f-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="5407f-188">只要您不要將新的資料庫檔案加入至主要資料庫，就支援 `AlwaysOn Availability Groups`。</span><span class="sxs-lookup"><span data-stu-id="5407f-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="5407f-189">如果資料庫作業需要在主要資料庫中建立新的檔案，請先在次要節點中停用 AlwaysOn 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="5407f-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="5407f-190">然後，在主要資料庫上執行資料庫作業，並且備份主要節點中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="5407f-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="5407f-191">接著，將資料庫還原到次要節點，並且在次要節點中啟用 AlwaysOn 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="5407f-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="5407f-192">請注意，使用 Azure 功能中的 SQL Server 資料檔案時，不支援 AlwaysOn 容錯移轉叢集實例。</span><span class="sxs-lookup"><span data-stu-id="5407f-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="5407f-193">一般作業期間，SQL Server 會使用暫時租用來保留 Blob 進行儲存，而且每隔 45 至 60 秒就會更新每個 Blob 租用。</span><span class="sxs-lookup"><span data-stu-id="5407f-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="5407f-194">如果伺服器當機，而且設定為使用相同 Blob 的另一個 SQL Server 執行個體啟動，新的執行個體最多會等候 60 秒，讓現有的 Blob 租用過期。</span><span class="sxs-lookup"><span data-stu-id="5407f-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="5407f-195">如果您想要將資料庫附加至另一個執行個體，而且您無法等候租用在 60 秒內過期，可以明確中斷 Blob 租用，避免附加作業發生任何失敗。</span><span class="sxs-lookup"><span data-stu-id="5407f-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="5407f-196">工具和程式設計參考支援</span><span class="sxs-lookup"><span data-stu-id="5407f-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="5407f-197">本節說明將 SQL Server 資料檔案儲存在 Azure 儲存體中時，可以使用哪些工具和程式設計參考程式庫。</span><span class="sxs-lookup"><span data-stu-id="5407f-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="5407f-198">PowerShell 支援</span><span class="sxs-lookup"><span data-stu-id="5407f-198">PowerShell support</span></span>  
 <span data-ttu-id="5407f-199">在 SQL Server 2014 中，您可以使用 PowerShell Cmdlet，藉由參考 Blob 儲存體 URL 路徑而非檔案路徑，在 Azure Blob 儲存體服務中儲存 SQL Server 的資料檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="5407f-200">您可以使用下列 URL 格式來存取 Blob`: http://storageaccount.blob.core.windows.net/<container>/<blob>` 。</span><span class="sxs-lookup"><span data-stu-id="5407f-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="5407f-201">SQL Server 物件和效能計數器支援</span><span class="sxs-lookup"><span data-stu-id="5407f-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="5407f-202">從 SQL Server 2014 開始，已加入新的 SQL Server 物件，以用於 Azure 儲存體功能中的 SQL Server 資料檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="5407f-203">這個新的 SQL Server 物件稱為 [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md)，而且系統監視器可以在使用 Azure 儲存體執行 SQL Server 時，使用此物件來監視活動。</span><span class="sxs-lookup"><span data-stu-id="5407f-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="5407f-204">SQL Server Management Studio 支援</span><span class="sxs-lookup"><span data-stu-id="5407f-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="5407f-205">SQL Server Management Studio 可讓您經由許多對話方塊視窗使用此功能。</span><span class="sxs-lookup"><span data-stu-id="5407f-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="5407f-206">例如，您可以在許多對話方塊視窗 (例如 [新增資料庫] `https://teststorageaccnt.blob.core.windows.net/testcontainer/` 、 **[附加資料庫]** 和 **[還原資料庫]**) 中，輸入儲存體容器的 URL 路徑 (例如 \*\*\*\*) 做為 **[路徑]**。</span><span class="sxs-lookup"><span data-stu-id="5407f-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="5407f-207">如需詳細資訊，請參閱[教學課程： SQL Server Azure 儲存體服務中的資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)。</span><span class="sxs-lookup"><span data-stu-id="5407f-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="5407f-208">SQL Server 管理物件支援</span><span class="sxs-lookup"><span data-stu-id="5407f-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="5407f-209">使用 Azure 功能中的 SQL Server 資料檔案時，可支援所有 SQL Server 管理物件 (SMO)。</span><span class="sxs-lookup"><span data-stu-id="5407f-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="5407f-210">如果 SMO 物件需要檔案路徑，請使用 BLOB URL 格式而非本機檔案路徑，例如 `https://teststorageaccnt.blob.core.windows.net/testcontainer/`。</span><span class="sxs-lookup"><span data-stu-id="5407f-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="5407f-211">如需 SQL Server 管理物件 (SMO) 的詳細資訊，請參閱《SQL Server 線上叢書》中的 [SQL Server 管理物件 &#40;SMO&#41; 程式設計指南](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md)。</span><span class="sxs-lookup"><span data-stu-id="5407f-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="5407f-212">Transact-SQL 支援</span><span class="sxs-lookup"><span data-stu-id="5407f-212">Transact-SQL support</span></span>  
 <span data-ttu-id="5407f-213">這項新功能已經在 Transact-SQL 介面區中導入下列變更：</span><span class="sxs-lookup"><span data-stu-id="5407f-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="5407f-214">**sys.master_files** 系統檢視中的新 **int**資料行： **credential_id** 。</span><span class="sxs-lookup"><span data-stu-id="5407f-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="5407f-215">**credential_id** 資料行是用來讓啟用 Azure 儲存體的資料檔案能夠交互參考 sys.credentials，以便取得針對它們建立的認證。</span><span class="sxs-lookup"><span data-stu-id="5407f-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="5407f-216">您可以使用此資料行進行疑難排解，例如某個資料庫檔案正在使用認證，導致無法刪除認證時。</span><span class="sxs-lookup"><span data-stu-id="5407f-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="5407f-217">針對 Azure 中的 SQL Server 資料檔案進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="5407f-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="5407f-218">為了避免因為功能不支援或有限制而發生錯誤，請先檢閱＜ [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations)＞。</span><span class="sxs-lookup"><span data-stu-id="5407f-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="5407f-219">使用 Azure 儲存體功能中的 SQL Server 資料檔案時，可能會收到的錯誤清單如下。</span><span class="sxs-lookup"><span data-stu-id="5407f-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="5407f-220">**驗證錯誤**</span><span class="sxs-lookup"><span data-stu-id="5407f-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="5407f-221">*無法卸除認證 '%.\*ls'，因為作用中的資料庫檔案正在使用它。*  </span><span class="sxs-lookup"><span data-stu-id="5407f-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="5407f-222">解決方案：當您嘗試卸除的認證仍然由 Azure 儲存體作用中資料庫檔案使用時，就可能會看見此錯誤。</span><span class="sxs-lookup"><span data-stu-id="5407f-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="5407f-223">若要卸除認證，您必須先刪除具有此資料庫檔案的相關聯 Blob。</span><span class="sxs-lookup"><span data-stu-id="5407f-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="5407f-224">若要刪除擁有使用中租用的 Blob，您必須先中斷租用。</span><span class="sxs-lookup"><span data-stu-id="5407f-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="5407f-225">*尚未在容器上正確建立共用存取簽章。*  </span><span class="sxs-lookup"><span data-stu-id="5407f-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="5407f-226">解決方案：請確定您已經在容器上正確建立共用存取簽章。</span><span class="sxs-lookup"><span data-stu-id="5407f-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="5407f-227">請參閱[教學課程： SQL Server Azure 儲存體服務中的資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)中的第2課所提供的指示。</span><span class="sxs-lookup"><span data-stu-id="5407f-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="5407f-228">*尚未正確建立 SQL Server 認證。*  </span><span class="sxs-lookup"><span data-stu-id="5407f-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="5407f-229">解決方案：請確定您已經針對 [識別] 欄位使用「共用存取簽章」，並正確建立密碼。</span><span class="sxs-lookup"><span data-stu-id="5407f-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="5407f-230">請參閱[教學課程：在 Azure 儲存體服務中 SQL Server 資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)中的第3課所提供的指示。</span><span class="sxs-lookup"><span data-stu-id="5407f-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="5407f-231">**租用 Blob 錯誤：**</span><span class="sxs-lookup"><span data-stu-id="5407f-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="5407f-232">在另一個使用相同 Blob 檔案的執行個體已經當機之後，嘗試啟動 SQL Server 時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="5407f-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="5407f-233">解決方式：一般作業期間，SQL Server 會使用暫時租用來保留 Blob 進行儲存，而且每隔 45 至 60 秒就會更新每個 Blob 租用。</span><span class="sxs-lookup"><span data-stu-id="5407f-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="5407f-234">如果伺服器當機，而且設定為使用相同 Blob 的另一個 SQL Server 執行個體啟動，新的執行個體最多會等候 60 秒，讓現有的 Blob 租用過期。</span><span class="sxs-lookup"><span data-stu-id="5407f-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="5407f-235">如果您想要將資料庫附加至另一個執行個體，而且您無法等候租用在 60 秒內過期，可以明確中斷 Blob 租用，避免附加作業發生任何失敗。</span><span class="sxs-lookup"><span data-stu-id="5407f-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="5407f-236">**資料庫錯誤**</span><span class="sxs-lookup"><span data-stu-id="5407f-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="5407f-237">*建立資料庫時發生錯誤* </span><span class="sxs-lookup"><span data-stu-id="5407f-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="5407f-238">解決方式：請參閱[教學課程： SQL Server Azure 儲存體服務中的資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)中的第4課所提供的指示。</span><span class="sxs-lookup"><span data-stu-id="5407f-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="5407f-239">*執行 Alter 陳述式時發生錯誤* </span><span class="sxs-lookup"><span data-stu-id="5407f-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="5407f-240">解決方案：請務必在資料庫上線時執行 Alter Database 陳述式。</span><span class="sxs-lookup"><span data-stu-id="5407f-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="5407f-241">將資料檔案複製到 Azure 儲存體時，一定要建立分頁 Blob 而非區塊 Blob。</span><span class="sxs-lookup"><span data-stu-id="5407f-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="5407f-242">否則，ALTER Database 將會失敗。</span><span class="sxs-lookup"><span data-stu-id="5407f-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="5407f-243">請參閱[教學課程：在 Azure 儲存體服務中 SQL Server 資料檔案](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)中的第7課所提供的指示。</span><span class="sxs-lookup"><span data-stu-id="5407f-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="5407f-244">*錯誤碼5120無法開啟實體檔案 "%. \*ls "。作業系統錯誤% d： "% ls"* </span><span class="sxs-lookup"><span data-stu-id="5407f-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="5407f-245">解決方案：目前，這項新增強功能不支援多個 SQL Server 執行個體同時存取 Azure 儲存體中的相同資料庫檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="5407f-246">如果 ServerA 在線上且具有作用中的資料庫檔案，而 ServerB 意外啟動，而且也有指向相同資料檔案的資料庫，則第二部伺服器將無法啟動資料庫，錯誤碼為 5120 *無法開啟實體檔案 "%.\*ls"。作業系統錯誤 %d: "%ls"* 。</span><span class="sxs-lookup"><span data-stu-id="5407f-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="5407f-247">若要解決此問題，請先判斷您是否需要讓 ServerA 存取 Azure 儲存體中的資料庫檔案。</span><span class="sxs-lookup"><span data-stu-id="5407f-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="5407f-248">如果不需要，只要移除 ServerA 與 Azure 儲存體中資料庫檔案之間的任何連接即可。</span><span class="sxs-lookup"><span data-stu-id="5407f-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="5407f-249">若要這樣做，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="5407f-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="5407f-250">使用 ALTER Database 陳述式，將 Server A 的檔案路徑設定為本機資料夾。</span><span class="sxs-lookup"><span data-stu-id="5407f-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="5407f-251">將 Server A 中的資料庫設為離線。</span><span class="sxs-lookup"><span data-stu-id="5407f-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="5407f-252">然後，將資料庫檔案從 Azure 儲存體複製到 ServerA 中的本機資料夾。這樣可確保 ServerA 在本機仍然具有資料庫的複本。</span><span class="sxs-lookup"><span data-stu-id="5407f-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="5407f-253">將資料庫設為上線。</span><span class="sxs-lookup"><span data-stu-id="5407f-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5407f-254">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5407f-254">See Also</span></span>  
 [<span data-ttu-id="5407f-255">教學課程：Azure 儲存體服務中的 SQL Server 資料檔案</span><span class="sxs-lookup"><span data-stu-id="5407f-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
