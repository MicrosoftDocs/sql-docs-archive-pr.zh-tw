---
title: 在另一個伺服器實例上提供可用的資料庫時，管理中繼資料 (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- cross-database queries [SQL Server]
- logins [SQL Server], recreating on another server instance
- triggers [SQL Server], DLL
- user-defined error messages [SQL Server]
- permissions [SQL Server], metadata access
- Full-Text Engine [SQL Server]
- metadata [SQL Server], databases available to other instances
- jobs [SQL Server Agent], recreating on another server instance
- failover [SQL Server], managing metadata
- event notifications [SQL Server], metadata
- database mirroring [SQL Server], metadata
- startup options [SQL Server]
- restoring [SQL Server], onto another server instance
- linked servers [SQL Server], metadata
- WMI Provider for Server Events, metadata
- attaching databases [SQL Server]
- log shipping [SQL Server], metadata
- encryption [SQL Server], metadata
- server configuration [SQL Server]
- distributed queries [SQL Server], metadata
- extended stored procedures [SQL Server], metadata
- credentials [SQL Server], metadata
- copying databases
ms.assetid: 5d98cf2a-9fc2-4610-be72-b422b8682681
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5087a925ac163281f4326a5f952c11ce2953c6dd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709530"
---
# <a name="manage-metadata-when-making-a-database-available-on-another-server-instance-sql-server"></a><span data-ttu-id="5d74d-102">在另一個伺服器執行個體上提供可用的資料庫時，管理中繼資料 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="5d74d-102">Manage Metadata When Making a Database Available on Another Server Instance (SQL Server)</span></span>
  <span data-ttu-id="5d74d-103">此主題與下列情況有關：</span><span class="sxs-lookup"><span data-stu-id="5d74d-103">This topic is relevant in the following situations:</span></span>  
  
-   <span data-ttu-id="5d74d-104">設定 [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] 可用性群組的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="5d74d-104">Configuring the availability replicas of an [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] availability group.</span></span>  
  
-   <span data-ttu-id="5d74d-105">設定資料庫的資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="5d74d-105">Setting up database mirroring for a database.</span></span>  
  
-   <span data-ttu-id="5d74d-106">當您準備在記錄傳送組態中變更主要和次要伺服器的角色時。</span><span class="sxs-lookup"><span data-stu-id="5d74d-106">When preparing to change roles between primary and secondary servers in a log shipping configuration.</span></span>  
  
-   <span data-ttu-id="5d74d-107">將資料庫還原至另一個伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-107">Restoring a database to another server instance.</span></span>  
  
-   <span data-ttu-id="5d74d-108">在另一個伺服器執行個體上附加資料庫的副本。</span><span class="sxs-lookup"><span data-stu-id="5d74d-108">Attaching a copy of a database on another server instance.</span></span>  
  
 <span data-ttu-id="5d74d-109">某些應用程式會相依於超出單一使用者資料庫範圍之外的資訊、實體和/或物件。</span><span class="sxs-lookup"><span data-stu-id="5d74d-109">Some applications depend on information, entities, and/or objects that are outside of the scope of a single user database.</span></span> <span data-ttu-id="5d74d-110">一般而言，應用程式相依於 **master** 和 **msdb** 資料庫以及使用者資料庫。</span><span class="sxs-lookup"><span data-stu-id="5d74d-110">Typically, an application has dependencies on the **master** and **msdb** databases, and also on the user database.</span></span> <span data-ttu-id="5d74d-111">如果有資料庫正確運作所需的任何項目儲存在使用者資料庫外部，則必須設法讓目的地伺服器執行個體也能提供。</span><span class="sxs-lookup"><span data-stu-id="5d74d-111">Anything stored outside of a user database that is required for the correct functioning of that database must be made available on the destination server instance.</span></span> <span data-ttu-id="5d74d-112">例如，應用程式的登入在 **master** 資料庫中儲存為中繼資料，就必須在目的地伺服器上加以重新建立。</span><span class="sxs-lookup"><span data-stu-id="5d74d-112">For example, the logins for an application are stored as metadata in the **master** database, and they must be re-created on the destination server.</span></span> <span data-ttu-id="5d74d-113">如果應用程式或資料庫維護計畫相依於 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 作業，而其中繼資料儲存於 **msdb** 資料庫，則必須在目的地伺服器執行個體上重新建立那些作業。</span><span class="sxs-lookup"><span data-stu-id="5d74d-113">If an application or database maintenance plan depends on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, whose metadata is stored in the **msdb** database, you must re-create those jobs on the destination server instance.</span></span> <span data-ttu-id="5d74d-114">同樣的，伺服器層級觸發程序的中繼資料會儲存在 **master**中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-114">Similarly, the metadata for a server-level trigger is stored in **master**.</span></span>  
  
 <span data-ttu-id="5d74d-115">當您將應用程式的資料庫移至其他伺服器執行個體時，您必須在目的地伺服器執行個體上重新建立 **master** 和 **msdb** 中相依實體及物件的所有中繼資料。</span><span class="sxs-lookup"><span data-stu-id="5d74d-115">When you move the database for an application to another server instance, you must re-create all the metadata of the dependent entities and objects in **master** and **msdb** on the destination server instance.</span></span> <span data-ttu-id="5d74d-116">例如，如果資料庫應用程式使用伺服器層級觸發程序，僅在新系統上附加或還原資料庫是不夠的。</span><span class="sxs-lookup"><span data-stu-id="5d74d-116">For example, if a database application uses server-level triggers, just attaching or restoring the database on the new system is not enough.</span></span> <span data-ttu-id="5d74d-117">除非您以手動方式為 **master** 資料庫中的那些觸發程序重新建立中繼資料，否則資料庫無法如預期一般運作。</span><span class="sxs-lookup"><span data-stu-id="5d74d-117">The database will not work as expected unless you manually re-create the metadata for those triggers in the **master** database.</span></span>  
  
##  <a name="information-entities-and-objects-that-are-stored-outside-of-user-databases"></a><a name="information_entities_and_objects"></a> <span data-ttu-id="5d74d-118">儲存在使用者資料庫外部的資訊、實體和物件</span><span class="sxs-lookup"><span data-stu-id="5d74d-118">Information, Entities, and Objects That Are Stored Outside of User Databases</span></span>  
 <span data-ttu-id="5d74d-119">本主題剩下的篇幅將摘要說明在其他伺服器執行個體上提供資料庫時，可能對該資料庫造成影響的潛在問題。</span><span class="sxs-lookup"><span data-stu-id="5d74d-119">The remainder of this topic summarizes the potential issues that might affect a database that is being made available on another server instance.</span></span> <span data-ttu-id="5d74d-120">您可能需要重新建立下列清單列出的其中一個或多個資訊、實體或物件類型。</span><span class="sxs-lookup"><span data-stu-id="5d74d-120">You might have to re-create one or more of the types of information, entities, or objects listed in the following list.</span></span> <span data-ttu-id="5d74d-121">若要查看摘要，請按一下各項目的連結。</span><span class="sxs-lookup"><span data-stu-id="5d74d-121">To see a summary, click the link for the item.</span></span>  
  
-   [<span data-ttu-id="5d74d-122">伺服器組態設定</span><span class="sxs-lookup"><span data-stu-id="5d74d-122">Server configuration settings</span></span>](#server_configuration_settings)  
  
-   [<span data-ttu-id="5d74d-123">認證</span><span class="sxs-lookup"><span data-stu-id="5d74d-123">Credentials</span></span>](#credentials)  
  
-   [<span data-ttu-id="5d74d-124">跨資料庫查詢</span><span class="sxs-lookup"><span data-stu-id="5d74d-124">Cross-database queries</span></span>](#cross_database_queries)  
  
-   [<span data-ttu-id="5d74d-125">資料庫擁有權</span><span class="sxs-lookup"><span data-stu-id="5d74d-125">Database ownership</span></span>](#database_ownership)  
  
-   [<span data-ttu-id="5d74d-126">分散式查詢/連結的伺服器</span><span class="sxs-lookup"><span data-stu-id="5d74d-126">Distributed queries/linked servers</span></span>](#distributed_queries_and_linked_servers)  
  
-   [<span data-ttu-id="5d74d-127">加密的資料</span><span class="sxs-lookup"><span data-stu-id="5d74d-127">Encrypted data</span></span>](#encrypted_data)  
  
-   [<span data-ttu-id="5d74d-128">使用者自訂錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="5d74d-128">User-defined error messages</span></span>](#user_defined_error_messages)  
  
-   [<span data-ttu-id="5d74d-129">事件通知和 Windows Management Instrumentation (WMI) 事件 (伺服器層級)</span><span class="sxs-lookup"><span data-stu-id="5d74d-129">Event notifications and Windows Management Instrumentation (WMI) events (at server level)</span></span>](#event_notif_and_wmi_events)  
  
-   [<span data-ttu-id="5d74d-130">擴充預存程序</span><span class="sxs-lookup"><span data-stu-id="5d74d-130">Extended stored procedures</span></span>](#extended_stored_procedures)  
  
-   [<span data-ttu-id="5d74d-131">Full-Text Engine for SQL Server 屬性</span><span class="sxs-lookup"><span data-stu-id="5d74d-131">Full-text engine for SQL Server properties</span></span>](#ifts_service_properties)  
  
-   [<span data-ttu-id="5d74d-132">作業</span><span class="sxs-lookup"><span data-stu-id="5d74d-132">Jobs</span></span>](#jobs)  
  
-   [<span data-ttu-id="5d74d-133">登入</span><span class="sxs-lookup"><span data-stu-id="5d74d-133">Logins</span></span>](#logins)  
  
-   [<span data-ttu-id="5d74d-134">權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-134">Permissions</span></span>](#permissions)  
  
-   [<span data-ttu-id="5d74d-135">複寫設定</span><span class="sxs-lookup"><span data-stu-id="5d74d-135">Replication settings</span></span>](#replication_settings)  
  
-   [<span data-ttu-id="5d74d-136">Service Broker 應用程式</span><span class="sxs-lookup"><span data-stu-id="5d74d-136">Service Broker applications</span></span>](#sb_applications)  
  
-   [<span data-ttu-id="5d74d-137">啟動程序</span><span class="sxs-lookup"><span data-stu-id="5d74d-137">Startup procedures</span></span>](#startup_procedures)  
  
-   [<span data-ttu-id="5d74d-138">觸發程序 (伺服器層級)</span><span class="sxs-lookup"><span data-stu-id="5d74d-138">Triggers (at server level)</span></span>](#triggers)  
  
##  <a name="server-configuration-settings"></a><a name="server_configuration_settings"></a> <span data-ttu-id="5d74d-139">Server Configuration Settings</span><span class="sxs-lookup"><span data-stu-id="5d74d-139">Server Configuration Settings</span></span>  
 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] <span data-ttu-id="5d74d-140">和更新版本會選擇性地安裝並啟動主要服務與功能。</span><span class="sxs-lookup"><span data-stu-id="5d74d-140">and later versions selectively install and starts key services and features.</span></span> <span data-ttu-id="5d74d-141">這可有助於減少系統易受攻擊的介面區。</span><span class="sxs-lookup"><span data-stu-id="5d74d-141">This helps reduce the attackable surface area of a system.</span></span> <span data-ttu-id="5d74d-142">在新安裝的預設組態中，許多功能都不會啟用。</span><span class="sxs-lookup"><span data-stu-id="5d74d-142">In the default configuration of new installations, many features are not enabled.</span></span> <span data-ttu-id="5d74d-143">如果資料庫仰賴預設關閉的任何服務或功能，您就必須在目的地伺服器執行個體上啟用這項服務或功能。</span><span class="sxs-lookup"><span data-stu-id="5d74d-143">If the database relies on any service or feature that is off by default, this service or feature must be enabled on the destination server instance.</span></span>  
  
 <span data-ttu-id="5d74d-144">如需設定和啟用或停用服務或功能的詳細資訊，請參閱[伺服器組態選項 &#40;SQL Server&#41;](../../database-engine/configure-windows/server-configuration-options-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-144">For more information about these settings and enabling or disabling them, see [Server Configuration Options &#40;SQL Server&#41;](../../database-engine/configure-windows/server-configuration-options-sql-server.md).</span></span>  
  
 <span data-ttu-id="5d74d-145">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-145">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="credentials"></a><a name="credentials"></a><span data-ttu-id="5d74d-146">憑證</span><span class="sxs-lookup"><span data-stu-id="5d74d-146">Credentials</span></span>  
 <span data-ttu-id="5d74d-147">認證是包含驗證資訊的記錄，該項資訊是連接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]外部資源時所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="5d74d-147">A credential is a record that contains the authentication information that is required to connect to a resource outside [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5d74d-148">大部分認證由 Windows 登入和密碼組成。</span><span class="sxs-lookup"><span data-stu-id="5d74d-148">Most credentials consist of a Windows login and password.</span></span>  
  
 <span data-ttu-id="5d74d-149">如需此功能的詳細資訊，請參閱[認證 &#40;Database Engine&#41;](../security/authentication-access/credentials-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-149">For more information about this feature, see [Credentials &#40;Database Engine&#41;](../security/authentication-access/credentials-database-engine.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-150">Agent Proxy 帳戶使用認證。</span><span class="sxs-lookup"><span data-stu-id="5d74d-150">Agent Proxy accounts use credentials.</span></span> <span data-ttu-id="5d74d-151">若要了解 Proxy 帳戶的認證識別碼，請使用 [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) 系統資料表。</span><span class="sxs-lookup"><span data-stu-id="5d74d-151">To learn the credential ID of a proxy account, use the [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) system table.</span></span>  
  
 <span data-ttu-id="5d74d-152">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-152">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="cross-database-queries"></a><a name="cross_database_queries"></a><span data-ttu-id="5d74d-153">跨資料庫查詢</span><span class="sxs-lookup"><span data-stu-id="5d74d-153">Cross-Database Queries</span></span>  
 <span data-ttu-id="5d74d-154">DB_CHAINING 和 TRUSTWORTHY 資料庫選項預設是 OFF。</span><span class="sxs-lookup"><span data-stu-id="5d74d-154">The DB_CHAINING and TRUSTWORTHY database options are OFF by default.</span></span> <span data-ttu-id="5d74d-155">如果原始資料庫的其中一個選項設定為 ON，您就必須在目的地伺服器執行個體的資料庫上啟用該選項。</span><span class="sxs-lookup"><span data-stu-id="5d74d-155">If either of these is set to ON for the original database, you may have to enable them on the database on the destination server instance.</span></span> <span data-ttu-id="5d74d-156">如需詳細資訊，請參閱 [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-156">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
 <span data-ttu-id="5d74d-157">附加與卸離作業會停用資料庫的跨資料庫擁有權鏈結。</span><span class="sxs-lookup"><span data-stu-id="5d74d-157">Attach-and-detach operations disable cross-database ownership chaining for the database.</span></span> <span data-ttu-id="5d74d-158">如需如何啟用鏈結的相關資訊，請參閱 [跨資料庫擁有權鏈結伺服器組態選項](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-158">For information about how to enable chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="5d74d-159">如需詳細資訊，另請參閱[設定鏡像資料庫可使用 Trustworthy 屬性 &#40;Transact-SQL&#41;](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-159">For more information, see also [Set Up a Mirror Database to Use the Trustworthy Property &#40;Transact-SQL&#41;](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)</span></span>  
  
 <span data-ttu-id="5d74d-160">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-160">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="database-ownership"></a><a name="database_ownership"></a><span data-ttu-id="5d74d-161">資料庫擁有權</span><span class="sxs-lookup"><span data-stu-id="5d74d-161">Database Ownership</span></span>  
 <span data-ttu-id="5d74d-162">當資料庫在另一部電腦上還原時，起始還原作業的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登入或 Windows 使用者會自動變成新資料庫的擁有者。</span><span class="sxs-lookup"><span data-stu-id="5d74d-162">When a database is restored on another computer, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login or Windows user who initiated the restore operation becomes the owner of the new database automatically.</span></span> <span data-ttu-id="5d74d-163">還原資料庫時，系統管理員或新的資料庫擁有者可以變更資料庫擁有權。</span><span class="sxs-lookup"><span data-stu-id="5d74d-163">When the database is restored, the system administrator or the new database owner can change database ownership.</span></span>  
  
##  <a name="distributed-queries-and-linked-servers"></a><a name="distributed_queries_and_linked_servers"></a> <span data-ttu-id="5d74d-164">分散式查詢和連結的伺服器</span><span class="sxs-lookup"><span data-stu-id="5d74d-164">Distributed Queries and Linked Servers</span></span>  
 <span data-ttu-id="5d74d-165">OLE DB 應用程式支援分散式查詢和連結的伺服器。</span><span class="sxs-lookup"><span data-stu-id="5d74d-165">Distributed queries and linked servers are supported for OLE DB applications.</span></span> <span data-ttu-id="5d74d-166">分散式查詢會從相同或不同電腦上的多重異質資料來源存取資料。</span><span class="sxs-lookup"><span data-stu-id="5d74d-166">Distributed queries access data from multiple heterogeneous data sources on either the same or different computers.</span></span> <span data-ttu-id="5d74d-167">連結伺服器的組態可讓 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 對遠端伺服器上的 OLE DB 資料來源執行命令。</span><span class="sxs-lookup"><span data-stu-id="5d74d-167">A linked server configuration enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute commands against OLE DB data sources on remote servers.</span></span> <span data-ttu-id="5d74d-168">如需這些功能的詳細資訊，請參閱[連結的伺服器 &#40;Database Engine&#41;](../linked-servers/linked-servers-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-168">For more information about these features, see [Linked Servers &#40;Database Engine&#41;](../linked-servers/linked-servers-database-engine.md).</span></span>  
  
 <span data-ttu-id="5d74d-169">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-169">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="encrypted-data"></a><a name="encrypted_data"></a><span data-ttu-id="5d74d-170">加密的資料</span><span class="sxs-lookup"><span data-stu-id="5d74d-170">Encrypted Data</span></span>  
 <span data-ttu-id="5d74d-171">如果您在另一個伺服器執行個體上提供的可用資料庫包含加密的資料，而且資料庫主要金鑰受到原始伺服器的服務主要金鑰保護時，可能就必須重新建立服務主要金鑰加密。</span><span class="sxs-lookup"><span data-stu-id="5d74d-171">If the database you are making available on another server instance contains encrypted data and if the database master key is protected by the service master key on the original server, it might be necessary to re-create the service master key encryption.</span></span> <span data-ttu-id="5d74d-172">*「資料庫主要金鑰」* 是一個用來保護加密資料庫中憑證私密金鑰和非對稱金鑰的對稱金鑰。</span><span class="sxs-lookup"><span data-stu-id="5d74d-172">The *database master key* is a symmetric key that is used to protect the private keys of certificates and asymmetric keys in an encrypted database.</span></span> <span data-ttu-id="5d74d-173">建立資料庫主要金鑰時，會利用三重 DES 演算法和使用者提供的密碼來加密資料主要金鑰。</span><span class="sxs-lookup"><span data-stu-id="5d74d-173">When created, the database master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span>  
  
 <span data-ttu-id="5d74d-174">若要在伺服器執行個體上啟用資料庫主要金鑰的自動解密，就要使用服務主要金鑰來加密此金鑰的副本。</span><span class="sxs-lookup"><span data-stu-id="5d74d-174">To enable the automatic decryption of the database master key on a server instance, a copy of this key is encrypted by using the service master key.</span></span> <span data-ttu-id="5d74d-175">這個加密的副本會同時存放在資料庫和 **master**中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-175">This encrypted copy is stored in both the database and in **master**.</span></span> <span data-ttu-id="5d74d-176">通常，每當主要金鑰變更時，儲存在**master**中的副本就會以無訊息模式更新。</span><span class="sxs-lookup"><span data-stu-id="5d74d-176">Typically, the copy stored in **master** is silently updated whenever the master key is changed.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-177">會先嘗試使用執行個體的服務主要金鑰來解密資料庫主要金鑰。</span><span class="sxs-lookup"><span data-stu-id="5d74d-177">first tries to decrypt the database master key with the service master key of the instance.</span></span> <span data-ttu-id="5d74d-178">如果該解密失敗， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 會從認證存放區中搜尋主要金鑰認證，這些主要金鑰認證具有與它需要其主要金鑰之資料庫相同的家族 GUID。</span><span class="sxs-lookup"><span data-stu-id="5d74d-178">If that decryption fails, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] searches the credential store for master key credentials that have the same family GUID as the database for which it requires the master key.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-179">會嘗試利用每個相符的認證來將資料庫主要金鑰解密，直到解密成功或沒有其他認證為止。</span><span class="sxs-lookup"><span data-stu-id="5d74d-179">then tries to decrypt the database master key with each matching credential until the decryption succeeds or there are no more credentials.</span></span> <span data-ttu-id="5d74d-180">未以服務主要金鑰加密的主要金鑰必須使用 OPEN MASTER KEY 陳述式和密碼來開啟。</span><span class="sxs-lookup"><span data-stu-id="5d74d-180">A master key that is not encrypted by the service master key must be opened by using the OPEN MASTER KEY statement and a password.</span></span>  
  
 <span data-ttu-id="5d74d-181">當加密的資料庫複製、還原或附加至新的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體時，以服務主要金鑰加密的資料庫主要金鑰副本並不會存放在目的地伺服器執行個體的 **master** 中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-181">When an encrypted database is copied, restored, or attached to a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a copy of the database master key encrypted by the service master key is not stored in **master** on the destination server instance.</span></span> <span data-ttu-id="5d74d-182">您必須在目的地伺服器執行個體上，開啟資料庫的主要金鑰。</span><span class="sxs-lookup"><span data-stu-id="5d74d-182">On the destination server instance, you must open the master key of the database.</span></span> <span data-ttu-id="5d74d-183">若要開啟主要金鑰，請執行下列陳述式：OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'**。</span><span class="sxs-lookup"><span data-stu-id="5d74d-183">To open the master key, execute the following statement: OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'**.</span></span> <span data-ttu-id="5d74d-184">建議您接著執行下列陳述式來啟用資料庫主要金鑰的自動解密：ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY。</span><span class="sxs-lookup"><span data-stu-id="5d74d-184">We recommend that you then enable automatic decryption of the database master key by executing the following statement: ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY.</span></span> <span data-ttu-id="5d74d-185">這個 ALTER MASTER KEY 陳述式會將以服務主要金鑰加密的資料庫主要金鑰副本提供給伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-185">This ALTER MASTER KEY statement provisions the server instance with a copy of the database master key that is encrypted with the service master key.</span></span> <span data-ttu-id="5d74d-186">如需詳細資訊，請參閱 [OPEN MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-master-key-transact-sql) 和 [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-186">For more information, see [OPEN MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-master-key-transact-sql) and [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span>  
  
 <span data-ttu-id="5d74d-187">如需如何啟用鏡像資料庫之資料庫主要金鑰的自動解密相關資訊，請參閱 [設定加密鏡像資料庫](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-187">For information about how to enable automatic decryption of the database master key of a mirror database, see [Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md).</span></span>  
  
 <span data-ttu-id="5d74d-188">如需詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="5d74d-188">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="5d74d-189">加密階層</span><span class="sxs-lookup"><span data-stu-id="5d74d-189">Encryption Hierarchy</span></span>](../security/encryption/encryption-hierarchy.md)  
  
-   [<span data-ttu-id="5d74d-190">設定加密鏡像資料庫</span><span class="sxs-lookup"><span data-stu-id="5d74d-190">Set Up an Encrypted Mirror Database</span></span>](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)  
  
-   [<span data-ttu-id="5d74d-191">在兩部伺服器上建立相同的對稱金鑰</span><span class="sxs-lookup"><span data-stu-id="5d74d-191">Create Identical Symmetric Keys on Two Servers</span></span>](../security/encryption/create-identical-symmetric-keys-on-two-servers.md)  
  
 <span data-ttu-id="5d74d-192">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-192">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="user-defined-error-messages"></a><a name="user_defined_error_messages"></a><span data-ttu-id="5d74d-193">使用者定義的錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="5d74d-193">User-defined Error Messages</span></span>  
 <span data-ttu-id="5d74d-194">使用者定義錯誤訊息位於 [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) 目錄檢視中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-194">User-defined error messages reside in the [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) catalog view.</span></span> <span data-ttu-id="5d74d-195">此目錄檢視會存放在 **master**內。</span><span class="sxs-lookup"><span data-stu-id="5d74d-195">This catalog view is stored in **master**.</span></span> <span data-ttu-id="5d74d-196">如果資料庫應用程式仰賴使用者定義錯誤訊息，而且此資料庫可在另一個伺服器執行個體上使用時，請使用 [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) ，在目的地伺服器執行個體上加入這些使用者定義訊息。</span><span class="sxs-lookup"><span data-stu-id="5d74d-196">If a database application depends on user-defined error messages and the database is made available on another server instance, use [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) to add those user-defined messages on the destination server instance.</span></span>  
  
 <span data-ttu-id="5d74d-197">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-197">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="event-notifications-and-windows-management-instrumentation-wmi-events-at-server-level"></a><a name="event_notif_and_wmi_events"></a> <span data-ttu-id="5d74d-198">事件通知和 Windows Management Instrumentation (WMI) 事件 （伺服器層級）</span><span class="sxs-lookup"><span data-stu-id="5d74d-198">Event Notifications and Windows Management Instrumentation (WMI) Events (at Server Level)</span></span>  
  
### <a name="server-level-event-notifications"></a><span data-ttu-id="5d74d-199">伺服器層級事件通知</span><span class="sxs-lookup"><span data-stu-id="5d74d-199">Server-Level Event Notifications</span></span>  
 <span data-ttu-id="5d74d-200">伺服器層級事件通知會存放在 **msdb**中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-200">Server-level event notifications are stored in **msdb**.</span></span> <span data-ttu-id="5d74d-201">因此，如果資料庫應用程式依賴伺服器層級事件通知，就必須在目的地伺服器執行個體上重新建立該事件通知。</span><span class="sxs-lookup"><span data-stu-id="5d74d-201">Therefore, if a database application relies on a server-level event notifications, that event notification must be re-created on the destination server instance.</span></span> <span data-ttu-id="5d74d-202">若要檢視伺服器執行個體上的事件通知，請使用 [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) 目錄檢視。</span><span class="sxs-lookup"><span data-stu-id="5d74d-202">To view the event notifications on a server instance, use the [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) catalog view.</span></span> <span data-ttu-id="5d74d-203">如需詳細資訊，請參閱 [Event Notifications](../service-broker/event-notifications.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-203">For more information, see [Event Notifications](../service-broker/event-notifications.md).</span></span>  
  
 <span data-ttu-id="5d74d-204">此外，事件通知是使用 [!INCLUDE[ssSB](../../includes/sssb-md.md)]進行傳送。</span><span class="sxs-lookup"><span data-stu-id="5d74d-204">Additionally, event notifications are delivered by using [!INCLUDE[ssSB](../../includes/sssb-md.md)].</span></span> <span data-ttu-id="5d74d-205">包含服務的資料庫中不包括內送訊息路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-205">Routes for incoming messages are not included in the database that contains a service.</span></span> <span data-ttu-id="5d74d-206">但是，外顯路由會儲存在 **msdb**中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-206">Instead, explicit routes are stored in **msdb**.</span></span> <span data-ttu-id="5d74d-207">如果服務使用 **msdb** 資料庫中的外顯路由將內送訊息傳送至服務，當您在不同執行個體中附加資料庫時，就必須重新建立此路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-207">If your service uses an explicit route in the **msdb** database to route incoming messages to the service, when you attach a database in a different instance, you must re-create this route.</span></span>  
  
### <a name="windows-management-instrumentation-wmi-events"></a><span data-ttu-id="5d74d-208">Windows Management Instrumentation (WMI) 事件</span><span class="sxs-lookup"><span data-stu-id="5d74d-208">Windows Management Instrumentation (WMI) Events</span></span>  
 <span data-ttu-id="5d74d-209">WMI Provider for Server Events 可讓您使用 Windows Management Instrumentation (WMI) 在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中監視事件。</span><span class="sxs-lookup"><span data-stu-id="5d74d-209">The WMI Provider for Server Events lets you use the Windows Management Instrumentation (WMI) to monitor events in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5d74d-210">如果伺服器層級事件要透過資料庫所依賴的 WMI 提供者來公開，則任何依賴此事件的應用程式必須定義有目的地伺服器執行個體的電腦。</span><span class="sxs-lookup"><span data-stu-id="5d74d-210">Any application that relies on server-level events exposed through the WMI provider on which a database relies must be defined the computer of the destination server instance.</span></span> <span data-ttu-id="5d74d-211">WMI 事件提供者會以 **msdb**中定義的目標服務來建立事件通知。</span><span class="sxs-lookup"><span data-stu-id="5d74d-211">WMI Event provider creates event notifications with a target service that is defined in **msdb**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d74d-212">如需詳細資訊，請參閱 [伺服器事件的 WMI 提供者概念](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-212">For more information, see [WMI Provider for Server Events Concepts](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md).</span></span>  
  
 <span data-ttu-id="5d74d-213">**若要使用 SQL Server Management Studio 建立 WMI 警示**</span><span class="sxs-lookup"><span data-stu-id="5d74d-213">**To create a WMI alert using SQL Server Management Studio**</span></span>  
  
-   [<span data-ttu-id="5d74d-214">建立 WMI 事件警示</span><span class="sxs-lookup"><span data-stu-id="5d74d-214">Create a WMI Event Alert</span></span>](../../ssms/agent/create-a-wmi-event-alert.md)  
  
### <a name="how-event-notifications-work-for-a-mirrored-database"></a><span data-ttu-id="5d74d-215">鏡像資料庫如何使用事件通知</span><span class="sxs-lookup"><span data-stu-id="5d74d-215">How Event Notifications Work for a Mirrored Database</span></span>  
 <span data-ttu-id="5d74d-216">根據定義，若涉及鏡像資料庫時，跨資料庫傳送事件通知為遠端作業，因為鏡像資料庫可以容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="5d74d-216">Cross-database delivery of event notifications that involves a mirrored database is remote, by definition, because the mirrored database can fail over.</span></span> [!INCLUDE[ssSB](../../includes/sssb-md.md)]<span data-ttu-id="5d74d-217">以*鏡像路由*的形式提供鏡像資料庫的特殊支援。</span><span class="sxs-lookup"><span data-stu-id="5d74d-217">provides special support for mirrored databases, in the form of *mirrored routes*.</span></span> <span data-ttu-id="5d74d-218">鏡像路由有兩個位址：一個是主體伺服器執行個體的位址，另一個是鏡像伺服器執行個體的位址。</span><span class="sxs-lookup"><span data-stu-id="5d74d-218">A mirrored route has two addresses: one for the principal server instance and one for the mirror server instance.</span></span>  
  
 <span data-ttu-id="5d74d-219">透過設定鏡像路由，可以讓 [!INCLUDE[ssSB](../../includes/sssb-md.md)] 路由知道資料庫鏡像的存在。</span><span class="sxs-lookup"><span data-stu-id="5d74d-219">By setting up mirrored routes, you make [!INCLUDE[ssSB](../../includes/sssb-md.md)] routing aware of database mirroring.</span></span> <span data-ttu-id="5d74d-220">鏡像路由可讓 [!INCLUDE[ssSB](../../includes/sssb-md.md)] 將交談明確地重新導向至目前的主體伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-220">The mirrored routes enable [!INCLUDE[ssSB](../../includes/sssb-md.md)] to transparently redirect conversations to the current principal server instance.</span></span> <span data-ttu-id="5d74d-221">例如，假設有一個服務 Service_A 是由鏡像資料庫 Database_A 所裝載。</span><span class="sxs-lookup"><span data-stu-id="5d74d-221">For example, consider a service, Service_A, which is hosted by a mirrored database, Database_A.</span></span> <span data-ttu-id="5d74d-222">假設您需要另一個服務 Service_B (由 Database_B 所裝載) 與 Service_A 對話。</span><span class="sxs-lookup"><span data-stu-id="5d74d-222">Assume that you need another service, Service_B, which is hosted by Database_B, to have a dialog with Service_A.</span></span> <span data-ttu-id="5d74d-223">為了要讓這個對話可行，Database_B 必須包含 Service_A 的鏡像路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-223">For this dialog to be possible, Database_B must contain a mirrored route for Service_A.</span></span> <span data-ttu-id="5d74d-224">此外，Database_A 也必須包含與 Service_B 之間的非鏡像 TCP 傳輸路由，此路由在容錯移轉之後會維持有效狀態，與本機路由不同。</span><span class="sxs-lookup"><span data-stu-id="5d74d-224">In addition, Database_A must contain a nonmirrored TCP transport route to Service_B, which, unlike a local route, remains valid after failover.</span></span> <span data-ttu-id="5d74d-225">這些路由可讓 ACK 在容錯移轉之後傳送回來。</span><span class="sxs-lookup"><span data-stu-id="5d74d-225">These routes enable ACKs to come back after a failover.</span></span> <span data-ttu-id="5d74d-226">因為傳送者的服務永遠是以相同方式來命名，所以路由必須指定 Broker 執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-226">Because the service of the sender is always named in the same manner, the route must specify the broker instance.</span></span>  
  
 <span data-ttu-id="5d74d-227">不論鏡像資料庫中的服務是起始端服務，或是目標服務，鏡像路由的需求都適用：</span><span class="sxs-lookup"><span data-stu-id="5d74d-227">The requirement for mirrored routes applies for regardless of whether the service in the mirrored database is the initiator service or the target service:</span></span>  
  
-   <span data-ttu-id="5d74d-228">如果目標服務在鏡像資料庫中，則起始端服務必須有回到目標的鏡像路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-228">If target service is in the mirrored database, the initiator service must have a mirrored route back to the target.</span></span> <span data-ttu-id="5d74d-229">不過，目標可以有回到起始端的一般路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-229">However, the target can have a regular route back to initiator.</span></span>  
  
-   <span data-ttu-id="5d74d-230">如果起始端服務在鏡像資料庫中，則目標服務必須有回到起始端的鏡像路由，才能傳送收條與回應。</span><span class="sxs-lookup"><span data-stu-id="5d74d-230">If initiator service is in the mirrored database, the target service must have a mirrored route back to initiator to deliver acknowledgements and replies.</span></span> <span data-ttu-id="5d74d-231">不過，起始端可以有指向目標的一般路由。</span><span class="sxs-lookup"><span data-stu-id="5d74d-231">However, the initiator can have a regular route to the target.</span></span>  
  
 <span data-ttu-id="5d74d-232">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-232">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="extended-stored-procedures"></a><a name="extended_stored_procedures"></a><span data-ttu-id="5d74d-233">擴充預存程式</span><span class="sxs-lookup"><span data-stu-id="5d74d-233">Extended Stored Procedures</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)]<span data-ttu-id="5d74d-234">請改用[CLR 整合](../clr-integration/common-language-runtime-integration-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-234">Use [CLR Integration](../clr-integration/common-language-runtime-integration-overview.md) instead.</span></span>  
  
 <span data-ttu-id="5d74d-235">擴充預存程序是使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 擴充預存程序 API 進行程式設計的。</span><span class="sxs-lookup"><span data-stu-id="5d74d-235">Extended stored procedures are programmed by using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Extended Stored Procedure API.</span></span> <span data-ttu-id="5d74d-236">**sysadmin** 固定伺服器角色的成員可以使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體來註冊擴充預存程序並授與使用者執行該程序的權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-236">A member of the **sysadmin** fixed server role can register an extended stored procedure with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and grant permission to users to execute the procedure.</span></span> <span data-ttu-id="5d74d-237">擴充預存程序只能加入 **master** 資料庫。</span><span class="sxs-lookup"><span data-stu-id="5d74d-237">Extended stored procedures can be added only to the **master** database.</span></span>  
  
 <span data-ttu-id="5d74d-238">擴充預存程序會直接在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體的位址空間中執行，而且它們可能會產生降低伺服器效能和可靠性的記憶體遺漏或其他問題。</span><span class="sxs-lookup"><span data-stu-id="5d74d-238">Extended stored procedures run directly in the address space of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and they may produce memory leaks or other problems that reduce the performance and reliability of the server.</span></span> <span data-ttu-id="5d74d-239">您應考慮將擴充預存程序與參考資料儲存在不同的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-239">You should consider storing extended stored procedures in an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is separate from the instance that contains the referenced data.</span></span> <span data-ttu-id="5d74d-240">同時應考慮使用分散式查詢來存取資料庫。</span><span class="sxs-lookup"><span data-stu-id="5d74d-240">You should also consider using distributed queries to access the database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="5d74d-241">將擴充預存程序加入伺服器並將 EXECUTE 權限授與其他使用者之前，系統管理員應徹底檢閱每個擴充預存程序，確定其中不含任何有害或惡意的程式碼。</span><span class="sxs-lookup"><span data-stu-id="5d74d-241">Before adding extended stored procedures to the server and granting EXECUTE permissions to other users, the system administrator should thoroughly review each extended stored procedure to make sure that it does not contain harmful or malicious code.</span></span>  
  
 <span data-ttu-id="5d74d-242">如需詳細資訊，請參閱 [GRANT 物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-object-permissions-transact-sql)、[DENY 物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-object-permissions-transact-sql) 和 [REVOKE 物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-242">For more information, see [GRANT Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-object-permissions-transact-sql), [DENY Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-object-permissions-transact-sql), and [REVOKE Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-object-permissions-transact-sql).</span></span>  
  
 <span data-ttu-id="5d74d-243">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-243">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="full-text-engine-for-sql-server-properties"></a><a name="ifts_service_properties"></a><span data-ttu-id="5d74d-244">SQL Server 屬性的全文檢索引擎</span><span class="sxs-lookup"><span data-stu-id="5d74d-244">Full-Text Engine for SQL Server Properties</span></span>  
 <span data-ttu-id="5d74d-245">全文檢索引擎的屬性是由 [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql)所設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-245">Properties are set on the Full-Text Engine by [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span> <span data-ttu-id="5d74d-246">請確定目的地伺服器執行個體具有這些屬性的必要設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-246">Make sure that the destination server instance has the required settings for these properties.</span></span> <span data-ttu-id="5d74d-247">如需這些屬性的詳細資訊，請參閱 [FULLTEXTSERVICEPROPERTY &#40;Transact-SQL&#41;](/sql/t-sql/functions/fulltextserviceproperty-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-247">For more information about these properties, see [FULLTEXTSERVICEPROPERTY &#40;Transact-SQL&#41;](/sql/t-sql/functions/fulltextserviceproperty-transact-sql).</span></span>  
  
 <span data-ttu-id="5d74d-248">此外，如果 [斷詞工具與字幹分析器](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) 元件或 [全文檢索搜尋篩選](../search/configure-and-manage-filters-for-search.md) 元件在原始和目的地伺服器執行個體上具有不同的版本，全文檢索索引和查詢就可能會有不同的行為方式。</span><span class="sxs-lookup"><span data-stu-id="5d74d-248">Additionally, if the [word breakers and stemmers](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) component or [full-text search filters](../search/configure-and-manage-filters-for-search.md) component have different versions on the original and destination server instances, full-text index and queries may behave differently.</span></span> <span data-ttu-id="5d74d-249">而且， [同義字](../search/full-text-search.md) 會存放在執行個體專用的檔案中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-249">Also, the [thesaurus](../search/full-text-search.md) is stored in instance-specific files.</span></span> <span data-ttu-id="5d74d-250">您必須將這些檔案的副本傳送至目的地伺服器執行個體上的對等位置，或在新執行個體上重新建立這些檔案。</span><span class="sxs-lookup"><span data-stu-id="5d74d-250">You must either transfer a copy of those files to an equivalent location on the destination server instance or re-create them on new instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d74d-251">當您將包含全文檢索目錄檔案的 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 資料庫附加至 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 伺服器執行個體時，系統就會從先前的位置附加這些目錄檔案以及其他資料庫檔案，此行為與 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]的行為相同。</span><span class="sxs-lookup"><span data-stu-id="5d74d-251">When you attach a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] database that contains full-text catalog files onto a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] server instance, the catalog files are attached from their previous location along with the other database files, the same as in [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="5d74d-252">如需詳細資訊，請參閱 [升級全文檢索搜尋](../search/upgrade-full-text-search.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-252">For more information, see [Upgrade Full-Text Search](../search/upgrade-full-text-search.md).</span></span>  
  
 <span data-ttu-id="5d74d-253">如需詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="5d74d-253">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="5d74d-254">備份並還原全文檢索目錄與索引</span><span class="sxs-lookup"><span data-stu-id="5d74d-254">Back Up and Restore Full-Text Catalogs and Indexes</span></span>](../search/back-up-and-restore-full-text-catalogs-and-indexes.md)  
  
-   [<span data-ttu-id="5d74d-255">資料庫鏡像和全文檢索目錄 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-255">Database Mirroring and Full-Text Catalogs &#40;SQL Server&#41;</span></span>](../../database-engine/database-mirroring/database-mirroring-and-full-text-catalogs-sql-server.md)  
  
 <span data-ttu-id="5d74d-256">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-256">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="jobs"></a><a name="jobs"></a><span data-ttu-id="5d74d-257">作業</span><span class="sxs-lookup"><span data-stu-id="5d74d-257">Jobs</span></span>  
 <span data-ttu-id="5d74d-258">如果資料庫仰賴 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 作業，您就必須在目的地伺服器執行個體上重新建立這些作業。</span><span class="sxs-lookup"><span data-stu-id="5d74d-258">If the database relies on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you will have to re-create them on the destination server instance.</span></span> <span data-ttu-id="5d74d-259">作業會仰賴所屬的環境。</span><span class="sxs-lookup"><span data-stu-id="5d74d-259">Jobs depend on their environments.</span></span> <span data-ttu-id="5d74d-260">如果您打算在目的地伺服器執行個體上重新建立現有的作業，可能必須修改目的地伺服器執行個體，以便符合該作業在原始伺服器執行個體上的環境。</span><span class="sxs-lookup"><span data-stu-id="5d74d-260">If you plan to re-create an existing job on the destination server instance, the destination server instance might have to be modified to match the environment of that job on the original server instance.</span></span> <span data-ttu-id="5d74d-261">下列環境因素相當重要：</span><span class="sxs-lookup"><span data-stu-id="5d74d-261">The following environmental factors are significant:</span></span>  
  
-   <span data-ttu-id="5d74d-262">作業使用的登入</span><span class="sxs-lookup"><span data-stu-id="5d74d-262">The login used by the job</span></span>  
  
     <span data-ttu-id="5d74d-263">若要建立或執行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 作業，您必須先將作業所需的任何 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登入加入至目的地伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-263">To create or execute [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you must first add any [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins required by the job to the destination server instance.</span></span> <span data-ttu-id="5d74d-264">如需詳細資訊，請參閱 [設定使用者可建立及管理 SQL Server Agent 作業](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-264">For more information, see [Configure a User to Create and Manage SQL Server Agent Jobs](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-265">Agent 服務啟動帳戶</span><span class="sxs-lookup"><span data-stu-id="5d74d-265">Agent service startup account</span></span>  
  
     <span data-ttu-id="5d74d-266">服務啟動帳戶會定義 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Agent 用來執行的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Windows 帳戶及其網路權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-266">The service startup account defines the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent runs and its network permissions.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-267">Agent 會以指定的使用者帳戶執行。</span><span class="sxs-lookup"><span data-stu-id="5d74d-267">Agent runs as a specified user account.</span></span> <span data-ttu-id="5d74d-268">Agent 服務的內容會影響作業及其執行環境的設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-268">The context of the Agent service affects the settings for the job and its run environment.</span></span> <span data-ttu-id="5d74d-269">此帳戶必須具有作業所需之資源 (例如，網路共用) 的存取權。</span><span class="sxs-lookup"><span data-stu-id="5d74d-269">The account must have access to the resources, such as network shares, required by the job.</span></span> <span data-ttu-id="5d74d-270">如需如何選取和修改服務啟動帳戶的相關資訊，請參閱 [選取 SQL Server Agent 服務的帳戶](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-270">For information about how to select and modify the service startup account, see [Select an Account for the SQL Server Agent Service](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md).</span></span>  
  
     <span data-ttu-id="5d74d-271">為了正確運作，服務啟動帳戶必須設定成具有正確的網域、檔案系統和登錄權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-271">To operate correctly, the service startup account must be configured to have the correct domain, file system, and registry permissions.</span></span> <span data-ttu-id="5d74d-272">此外，作業可能會需要使用必須針對服務帳戶設定的共用網路資源。</span><span class="sxs-lookup"><span data-stu-id="5d74d-272">Also, a job might require a shared network resource that must be configured for the service account.</span></span> <span data-ttu-id="5d74d-273">如需相關資訊，請參閱 [設定 Windows 服務帳戶與權限](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-273">For information, see [Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-274">Agent 服務 (與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的特定執行個體相關聯) 具有自己的登錄區，而且它的作業通常會相依於此登錄區中的一或多項設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-274">Agent service, which is associated with a specific instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], has its own registry hive, and its jobs typically have dependencies on one or more of the settings in this registry hive.</span></span> <span data-ttu-id="5d74d-275">為了如預期方式運作，作業會需要使用這些登錄設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-275">To behave as intended, a job requires those registry settings.</span></span> <span data-ttu-id="5d74d-276">如果您使用指令碼在另一個 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 服務中重新建立作業，其登錄可能不會有該作業的正確設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-276">If you use a script to re-create a job in another [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, its registry might not have the correct settings for that job.</span></span> <span data-ttu-id="5d74d-277">為了讓重新建立的作業在目的地伺服器執行個體上正確運作，原始和目的地 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 服務都應該具有相同的登錄設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-277">For re-created jobs to behave correctly on a destination server instance, the original and destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent services should have the same registry settings.</span></span>  
  
    > [!CAUTION]  
    >  <span data-ttu-id="5d74d-278">如果目前的設定是其他作業所需，在目的地 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 服務上變更登錄設定以便處理重新建立的作業可能會產生問題。</span><span class="sxs-lookup"><span data-stu-id="5d74d-278">Changing registry settings on the destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service to handle a re-created job could be problematic if the current settings are required by other jobs.</span></span> <span data-ttu-id="5d74d-279">此外，不當編輯登錄可能會造成系統嚴重受損。</span><span class="sxs-lookup"><span data-stu-id="5d74d-279">Furthermore, incorrectly editing the registry can severely damage your system.</span></span> <span data-ttu-id="5d74d-280">在變更登錄之前，我們建議您先備份電腦上所有重要的資料。</span><span class="sxs-lookup"><span data-stu-id="5d74d-280">Before you make changes to the registry, we recommend that you back up any valued data on the computer.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d74d-281">Agent Proxy</span><span class="sxs-lookup"><span data-stu-id="5d74d-281">Agent Proxies</span></span>  
  
     <span data-ttu-id="5d74d-282">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Proxy 可定義指定之作業步驟的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="5d74d-282">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy defines the security context for a specified job step.</span></span> <span data-ttu-id="5d74d-283">為了讓作業在目的地伺服器執行個體上執行，您必須在該執行個體上手動重新建立此作業所需的所有 Proxy。</span><span class="sxs-lookup"><span data-stu-id="5d74d-283">For a job to run on the destination server instance, all the proxies it requires must be manually re-created on that instance.</span></span> <span data-ttu-id="5d74d-284">如需詳細資訊，請參閱 [建立 SQL Server Agent Proxy](../../ssms/agent/create-a-sql-server-agent-proxy.md) 和 [疑難排解使用 Proxy 的多伺服器作業](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-284">For more information, see [Create a SQL Server Agent Proxy](../../ssms/agent/create-a-sql-server-agent-proxy.md) and [Troubleshoot Multiserver Jobs That Use Proxies](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md).</span></span>  
  
 <span data-ttu-id="5d74d-285">如需詳細資訊，請參閱：</span><span class="sxs-lookup"><span data-stu-id="5d74d-285">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="5d74d-286">實作作業</span><span class="sxs-lookup"><span data-stu-id="5d74d-286">Implement Jobs</span></span>](../../ssms/agent/implement-jobs.md)  
  
-   <span data-ttu-id="5d74d-287">[角色切換後針對登入和作業進行管理 &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md) (適用於資料庫鏡像)</span><span class="sxs-lookup"><span data-stu-id="5d74d-287">[Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md) (for database mirroring)</span></span>  
  
-   <span data-ttu-id="5d74d-288">[設定 Windows 服務帳戶與權限](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) (當您安裝 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的執行個體時)</span><span class="sxs-lookup"><span data-stu-id="5d74d-288">[Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   <span data-ttu-id="5d74d-289">[設定 SQL Server Agent](../../ssms/agent/sql-server-agent.md) (當您安裝 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的執行個體時)</span><span class="sxs-lookup"><span data-stu-id="5d74d-289">[Configure SQL Server Agent](../../ssms/agent/sql-server-agent.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   [<span data-ttu-id="5d74d-290">實作 SQL Server Agent 安全性</span><span class="sxs-lookup"><span data-stu-id="5d74d-290">Implement SQL Server Agent Security</span></span>](../../ssms/agent/implement-sql-server-agent-security.md)  
  
 <span data-ttu-id="5d74d-291">**若要檢視現有的作業及其屬性**</span><span class="sxs-lookup"><span data-stu-id="5d74d-291">**To view existing jobs and their properties**</span></span>  
  
-   [<span data-ttu-id="5d74d-292">監視作業活動</span><span class="sxs-lookup"><span data-stu-id="5d74d-292">Monitor Job Activity</span></span>](../../ssms/agent/monitor-job-activity.md)  
  
-   [<span data-ttu-id="5d74d-293">sp_help_job &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-293">sp_help_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-job-transact-sql)  
  
-   [<span data-ttu-id="5d74d-294">View Job Step Information</span><span class="sxs-lookup"><span data-stu-id="5d74d-294">View Job Step Information</span></span>](../../ssms/agent/view-job-step-information.md)  
  
-   [<span data-ttu-id="5d74d-295">dbo.sysjobs &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-295">dbo.sysjobs &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-tables/dbo-sysjobs-transact-sql)  
  
 <span data-ttu-id="5d74d-296">**若要建立作業**</span><span class="sxs-lookup"><span data-stu-id="5d74d-296">**To create a job**</span></span>  
  
-   [<span data-ttu-id="5d74d-297">建立作業</span><span class="sxs-lookup"><span data-stu-id="5d74d-297">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
-   [<span data-ttu-id="5d74d-298">建立作業</span><span class="sxs-lookup"><span data-stu-id="5d74d-298">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
#### <a name="best-practices-for-using-a-script-to-re-create-a-job"></a><span data-ttu-id="5d74d-299">使用指令碼來重新建立作業的最佳作法</span><span class="sxs-lookup"><span data-stu-id="5d74d-299">Best Practices for Using a Script to Re-create a Job</span></span>  
 <span data-ttu-id="5d74d-300">我們建議您先編寫簡單作業的指令碼、在其他 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 服務上重新建立作業，然後執行該作業，看看是否如預期方式運作。</span><span class="sxs-lookup"><span data-stu-id="5d74d-300">We recommend that you start by scripting a simple job, re-creating the job on the other [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, and running the job to see whether it works as intended.</span></span> <span data-ttu-id="5d74d-301">這項作法可讓您識別不相容性並嘗試加以解決。</span><span class="sxs-lookup"><span data-stu-id="5d74d-301">This will let you to identify incompatibilities and try to resolve them.</span></span> <span data-ttu-id="5d74d-302">如果以指令碼編寫的作業無法如預期方式在新環境中運作，建議您建立可在該環境下正確運作的對等作業。</span><span class="sxs-lookup"><span data-stu-id="5d74d-302">If a scripted job does not work as intended in its new environment, we recommend that you create an equivalent job that works correctly in that environment.</span></span>  
  
 <span data-ttu-id="5d74d-303">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-303">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="logins"></a><a name="logins"></a><span data-ttu-id="5d74d-304">登錄</span><span class="sxs-lookup"><span data-stu-id="5d74d-304">Logins</span></span>  
 <span data-ttu-id="5d74d-305">登入 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的執行個體需要有效的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登入。</span><span class="sxs-lookup"><span data-stu-id="5d74d-305">Logging into an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires a valid [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login.</span></span> <span data-ttu-id="5d74d-306">此登入是用於驗證處理序，可確認主體是否能連接到 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-306">This login is used in the authentication process that verifies whether the principal can connect to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5d74d-307">在伺服器執行個體上未定義或定義不正確之對應 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 登入的資料庫使用者無法登入此執行個體。</span><span class="sxs-lookup"><span data-stu-id="5d74d-307">A database user for which the corresponding [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login is undefined or is incorrectly defined on a server instance cannot log in to the instance.</span></span> <span data-ttu-id="5d74d-308">這類使用者就是伺服器執行個體上的資料庫 *「被遺棄使用者」* (Orphaned User)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-308">Such a user is said to be an *orphaned user* of the database on that server instance.</span></span> <span data-ttu-id="5d74d-309">當資料庫還原、附加或複製到不同的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體後，資料庫使用者就可能會成為被遺棄使用者。</span><span class="sxs-lookup"><span data-stu-id="5d74d-309">A database user can become orphaned if after a database is restored, attached, or copied to a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="5d74d-310">若要在原始資料庫副本中產生部分或所有物件的指令碼，您可以使用「產生指令碼精靈」，然後在 **[選擇指令碼選項]** 對話方塊中，將 **[編寫登入的指令碼]** 選項設定為 **[True]**。</span><span class="sxs-lookup"><span data-stu-id="5d74d-310">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Logins** option to **True**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d74d-311">如需如何設定鏡像資料庫登入的相關資訊，請參閱[設定資料庫鏡像或 AlwaysOn 可用性群組的登入帳戶 &#40;SQL Server&#41;](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md) 和[角色切換後針對登入和作業進行管理 &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-311">For information about how to set up logins for a mirrored database, see [Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md) and [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
 <span data-ttu-id="5d74d-312">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-312">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="permissions"></a><a name="permissions"></a> <span data-ttu-id="5d74d-313">權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-313">Permissions</span></span>  
 <span data-ttu-id="5d74d-314">當您在其他伺服器執行個體上提供資料庫時，可能會影響下列類型的權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-314">The following types of permissions might be affected when a database is made available on another server instance.</span></span>  
  
-   <span data-ttu-id="5d74d-315">系統物件的 GRANT、REVOKE 或 DENY 權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-315">GRANT, REVOKE, or DENY permissions on system objects</span></span>  
  
-   <span data-ttu-id="5d74d-316">伺服器執行個體的 GRANT、REVOKE 或 DENY 權限 (*「伺服器層級權限」*)</span><span class="sxs-lookup"><span data-stu-id="5d74d-316">GRANT, REVOKE, or DENY permissions on server instance (*server-level permissions*)</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-system-objects"></a><span data-ttu-id="5d74d-317">系統物件的 GRANT、REVOKE 及 DENY 權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-317">GRANT, REVOKE, and DENY Permissions on System Objects</span></span>  
 <span data-ttu-id="5d74d-318">系統物件 (例如，預存程序、擴充預存程序、函數和檢視) 的權限會存放在 **master** 資料庫中，而且您必須在目的地伺服器執行個體上設定這些權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-318">Permissions on system objects such as stored procedures, extended stored procedures, functions, and views, are stored in the **master** database and must be configured on the destination server instance.</span></span>  
  
 <span data-ttu-id="5d74d-319">若要在原始資料庫副本中產生部分或所有物件的指令碼，您可以使用「產生指令碼精靈」，然後在 [選擇指令碼選項]\*\*\*\* 對話方塊中，將 [編寫物件層級權限的指令碼]\*\*\*\* 選項設定為 [True]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="5d74d-319">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Object-Level Permissions** option to **True**.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="5d74d-320">當您在編寫登入的指令碼時，密碼並不會編寫在指令碼中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-320">If you script logins, the passwords are not scripted.</span></span> <span data-ttu-id="5d74d-321">如果您具有使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證的登入，就必須修改目的地上的指令碼。</span><span class="sxs-lookup"><span data-stu-id="5d74d-321">If you have logins that use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication, you have to modify the script on the destination.</span></span>  
  
 <span data-ttu-id="5d74d-322">您可以在 [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) 目錄檢視中看到系統物件。</span><span class="sxs-lookup"><span data-stu-id="5d74d-322">System objects are visible in the [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) catalog view.</span></span> <span data-ttu-id="5d74d-323">系統物件的許可權會顯示在**master**資料庫的[database_permissions](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql)目錄檢視中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-323">The permissions on system objects are visible in the [sys.database_permissions](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql) catalog view in the **master** database.</span></span> <span data-ttu-id="5d74d-324">如需查詢這些目錄檢視和授與系統物件權限的詳細資訊，請參閱 [GRANT 系統物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-system-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-324">For information about querying these catalog views and granting system-object permissions, see [GRANT System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-system-object-permissions-transact-sql).</span></span> <span data-ttu-id="5d74d-325">如需詳細資訊，請參閱 [REVOKE 系統物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql) 和 [DENY 系統物件權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-system-object-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-325">For more information, see [REVOKE System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql) and [DENY System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-system-object-permissions-transact-sql).</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-a-server-instance"></a><span data-ttu-id="5d74d-326">伺服器執行個體的 GRANT、REVOKE 及 DENY 權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-326">GRANT, REVOKE, and DENY Permissions on a Server Instance</span></span>  
 <span data-ttu-id="5d74d-327">伺服器範圍的權限會存放在 **master** 資料庫中，而且您必須在目的地伺服器執行個體上設定這些權限。</span><span class="sxs-lookup"><span data-stu-id="5d74d-327">Permissions at the server scope are stored in the **master** database and must be configured on the destination server instance.</span></span> <span data-ttu-id="5d74d-328">如需伺服器執行個體之伺服器權限的詳細資訊，請查詢 [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) 目錄檢視。如需伺服器主體的詳細資訊，請查詢 [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)目錄檢視。如需伺服器角色之成員資格的詳細資訊，請查詢 [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) 目錄檢視。</span><span class="sxs-lookup"><span data-stu-id="5d74d-328">For information about the server permissions of a server instance, query the [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) catalog view, for information about server principals query the [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)s catalog view, and for information about membership of server roles query the [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="5d74d-329">如需詳細資訊，請參閱 [GRANT 伺服器權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-server-permissions-transact-sql)、[REVOKE 伺服器權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-server-permissions-transact-sql) 和 [DENY 伺服器權限 &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-server-permissions-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-329">For more information, see [GRANT Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-server-permissions-transact-sql), [REVOKE Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-server-permissions-transact-sql), and [DENY Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-server-permissions-transact-sql).</span></span>  
  
#### <a name="server-level-permissions-for-a-certificate-or-asymmetric-key"></a><span data-ttu-id="5d74d-330">憑證或非對稱金鑰的伺服器層級權限</span><span class="sxs-lookup"><span data-stu-id="5d74d-330">Server-Level Permissions for a Certificate or Asymmetric Key</span></span>  
 <span data-ttu-id="5d74d-331">您無法直接將伺服器層級權限授與憑證或非對稱金鑰。</span><span class="sxs-lookup"><span data-stu-id="5d74d-331">Server-level permissions cannot be granted directly to a certificate or asymmetric key.</span></span> <span data-ttu-id="5d74d-332">不過，伺服器層級權限會授與專為特定憑證或非對稱金鑰建立的對應登入。</span><span class="sxs-lookup"><span data-stu-id="5d74d-332">Instead, server-level permissions are granted to a mapped login that is created exclusively for a specific certificate or asymmetric key.</span></span> <span data-ttu-id="5d74d-333">因此，需要伺服器層級權限的每個憑證或非對稱金鑰都會需要自己的 *「憑證對應登入」* 或 *「非對稱金鑰對應登入」*。</span><span class="sxs-lookup"><span data-stu-id="5d74d-333">Therefore, each certificate or asymmetric key that requires server-level permissions, requires its own *certificate-mapped login* or *asymmetric key-mapped login*.</span></span> <span data-ttu-id="5d74d-334">若要授與憑證或非對稱金鑰的伺服器層級權限，請將這些權限授與對應的登入。</span><span class="sxs-lookup"><span data-stu-id="5d74d-334">To grant server-level permissions for a certificate or asymmetric key, grant the permissions to its mapped login.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d74d-335">對應的登入只會用於授權以對應憑證或非對稱金鑰簽署的程式碼。</span><span class="sxs-lookup"><span data-stu-id="5d74d-335">A mapped login is used only for authorization of code signed with the corresponding certificate or asymmetric key.</span></span> <span data-ttu-id="5d74d-336">對應的登入無法用於驗證。</span><span class="sxs-lookup"><span data-stu-id="5d74d-336">Mapped logins cannot be used for authentication.</span></span>  
  
 <span data-ttu-id="5d74d-337">對應的登入及其權限都位於 **master**中。</span><span class="sxs-lookup"><span data-stu-id="5d74d-337">The mapped login and its permissions both reside in **master**.</span></span> <span data-ttu-id="5d74d-338">如果憑證或非對稱金鑰位於 **master**以外的資料庫中，您就必須在 **master** 中重新建立此項目並將它對應至登入。</span><span class="sxs-lookup"><span data-stu-id="5d74d-338">If a certificate or asymmetric key resides in a database other than **master**, you must re-create it in **master** and map it to a login.</span></span> <span data-ttu-id="5d74d-339">如果您將資料庫移動、複製或還原至另一個伺服器執行個體，就必須在目的地伺服器執行個體的 **master** 資料庫中重新建立其憑證或非對稱金鑰、將它對應至登入，然後將所需的伺服器層級權限授與此登入。</span><span class="sxs-lookup"><span data-stu-id="5d74d-339">If you move, copy, or restore the database to another server instance, you must re-create its certificate or asymmetric key in the **master** database of the destination server instance, map to a login, and grant the required server-level permissions to the login.</span></span>  
  
 <span data-ttu-id="5d74d-340">**若要建立憑證或非對稱金鑰**</span><span class="sxs-lookup"><span data-stu-id="5d74d-340">**To create a certificate or asymmetric key**</span></span>  
  
-   [<span data-ttu-id="5d74d-341">CREATE CERTIFICATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-341">CREATE CERTIFICATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-certificate-transact-sql)  
  
-   [<span data-ttu-id="5d74d-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-asymmetric-key-transact-sql)  
  
 <span data-ttu-id="5d74d-343">**若要將憑證或非對稱金鑰對應至登入**</span><span class="sxs-lookup"><span data-stu-id="5d74d-343">**To map a certificate or asymmetric key to a login**</span></span>  
  
-   [<span data-ttu-id="5d74d-344">CREATE LOGIN &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-344">CREATE LOGIN &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-login-transact-sql)  
  
 <span data-ttu-id="5d74d-345">**若要將權限指派給對應的登入**</span><span class="sxs-lookup"><span data-stu-id="5d74d-345">**To assign permissions to the mapped login**</span></span>  
  
-   [<span data-ttu-id="5d74d-346">GRANT 伺服器權限 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-346">GRANT Server Permissions &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/grant-server-permissions-transact-sql)  
  
 <span data-ttu-id="5d74d-347">如需憑證和非對稱金鑰的詳細資訊，請參閱＜ [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md)＞。</span><span class="sxs-lookup"><span data-stu-id="5d74d-347">For more information about certificates and asymmetric keys, see [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md).</span></span>  
  
 <span data-ttu-id="5d74d-348">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-348">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="replication-settings"></a><a name="replication_settings"></a><span data-ttu-id="5d74d-349">複寫設定</span><span class="sxs-lookup"><span data-stu-id="5d74d-349">Replication Settings</span></span>  
 <span data-ttu-id="5d74d-350">如果您將複寫資料庫的備份還原到另一個伺服器或資料庫，將無法保留複寫設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-350">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="5d74d-351">在此情況下，您必須在還原備份之後，重新建立所有發行集和訂閱。</span><span class="sxs-lookup"><span data-stu-id="5d74d-351">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span> <span data-ttu-id="5d74d-352">若要讓此程序更簡單，請針對目前的複寫設定和啟用及停用複寫，建立指令碼。</span><span class="sxs-lookup"><span data-stu-id="5d74d-352">To make this process easier, create scripts for your current replication settings and, also, for the enabling and disabling of replication.</span></span> <span data-ttu-id="5d74d-353">若要協助重新建立複寫設定，請複製這些指令碼並變更伺服器名稱參考，以便針對目的地伺服器執行個體運作。</span><span class="sxs-lookup"><span data-stu-id="5d74d-353">To help re-create your replication settings, copy these scripts and change the server name references to work for the destination server instance.</span></span>  
  
 <span data-ttu-id="5d74d-354">如需詳細資訊，請參閱[備份及還原複寫的資料庫](../replication/administration/back-up-and-restore-replicated-databases.md)、[資料庫鏡像和複寫 &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md) 和[記錄傳送和複寫 &#40;SQL Server&#41;](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5d74d-354">For more information, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md), [Database Mirroring and Replication &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md), and [Log Shipping and Replication &#40;SQL Server&#41;](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md).</span></span>  
  
 <span data-ttu-id="5d74d-355">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-355">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="service-broker-applications"></a><a name="sb_applications"></a><span data-ttu-id="5d74d-356">Service Broker 應用程式</span><span class="sxs-lookup"><span data-stu-id="5d74d-356">Service Broker Applications</span></span>  
 <span data-ttu-id="5d74d-357">[!INCLUDE[ssSB](../../includes/sssb-md.md)] 應用程式的許多部分都會隨資料庫移動。</span><span class="sxs-lookup"><span data-stu-id="5d74d-357">Many aspects of a [!INCLUDE[ssSB](../../includes/sssb-md.md)] application move with the database.</span></span> <span data-ttu-id="5d74d-358">不過，此應用程式的某些部分則必須在新位置中重新建立或重新設定。</span><span class="sxs-lookup"><span data-stu-id="5d74d-358">However, some aspects of the application must be re-created or reconfigured in the new location.</span></span>  
  
 <span data-ttu-id="5d74d-359">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-359">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="startup-procedures"></a><a name="startup_procedures"></a><span data-ttu-id="5d74d-360">啟動程式</span><span class="sxs-lookup"><span data-stu-id="5d74d-360">Startup Procedures</span></span>  
 <span data-ttu-id="5d74d-361">啟動程序是指標示為自動執行而且每次 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 啟動時都會執行的預存程序。</span><span class="sxs-lookup"><span data-stu-id="5d74d-361">A startup procedure is a stored procedure that is marked for automatic execution and is executed every time [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] starts.</span></span> <span data-ttu-id="5d74d-362">如果資料庫仰賴任何啟動程序，您就必須在目的地伺服器執行個體上定義這些程序，並將它們設定為啟動時自動執行。</span><span class="sxs-lookup"><span data-stu-id="5d74d-362">If the database depends on any startup procedures, they must be defined on the destination server instance and be configured to be automatically executed at startup.</span></span>  
  
 <span data-ttu-id="5d74d-363">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-363">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
##  <a name="triggers-at-server-level"></a><a name="triggers"></a><span data-ttu-id="5d74d-364">伺服器層級) 的觸發程式 (</span><span class="sxs-lookup"><span data-stu-id="5d74d-364">Triggers (at Server Level)</span></span>  
 <span data-ttu-id="5d74d-365">DDL 觸發程序會引發預存程序，以便回應各種資料定義語言 (DDL) 事件。</span><span class="sxs-lookup"><span data-stu-id="5d74d-365">DDL triggers fire stored procedures in response to a variety of Data Definition Language (DDL) events.</span></span> <span data-ttu-id="5d74d-366">這些事件主要對應至以 CREATE、ALTER 和 DROP 關鍵字開頭的 [!INCLUDE[tsql](../../includes/tsql-md.md)] 陳述式。</span><span class="sxs-lookup"><span data-stu-id="5d74d-366">These events primarily correspond to [!INCLUDE[tsql](../../includes/tsql-md.md)] statements that start with the keywords CREATE, ALTER, and DROP.</span></span> <span data-ttu-id="5d74d-367">執行類似 DDL 作業的某些系統預存程序也可能引發 DDL 觸發程序。</span><span class="sxs-lookup"><span data-stu-id="5d74d-367">Certain system stored procedures that perform DDL-like operations can also fire DDL triggers.</span></span>  
  
 <span data-ttu-id="5d74d-368">如需有關這項功能的詳細資訊，請參閱＜ [DDL Triggers](../triggers/ddl-triggers.md)＞。</span><span class="sxs-lookup"><span data-stu-id="5d74d-368">For more information about this feature, see [DDL Triggers](../triggers/ddl-triggers.md).</span></span>  
  
 <span data-ttu-id="5d74d-369">[[頁首]](#information_entities_and_objects)</span><span class="sxs-lookup"><span data-stu-id="5d74d-369">[&#91;Top&#93;](#information_entities_and_objects)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5d74d-370">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5d74d-370">See Also</span></span>  
 <span data-ttu-id="5d74d-371">[自主資料庫](contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-371">[Contained Databases](contained-databases.md) </span></span>  
 <span data-ttu-id="5d74d-372">[複製資料庫至其他伺服器](copy-databases-to-other-servers.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-372">[Copy Databases to Other Servers](copy-databases-to-other-servers.md) </span></span>  
 <span data-ttu-id="5d74d-373">[資料庫卸離和附加 &#40;SQL Server&#41;](database-detach-and-attach-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-373">[Database Detach and Attach &#40;SQL Server&#41;](database-detach-and-attach-sql-server.md) </span></span>  
 <span data-ttu-id="5d74d-374">[故障切換至記錄傳送次要 &#40;SQL Server&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-374">[Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span></span>  
 <span data-ttu-id="5d74d-375">[資料庫鏡像工作階段期間的角色切換 &#40;SQL Server&#41;](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-375">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="5d74d-376">[設定加密鏡像資料庫](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-376">[Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span></span>  
 <span data-ttu-id="5d74d-377">[SQL Server 組態管理員](../sql-server-configuration-manager.md) </span><span class="sxs-lookup"><span data-stu-id="5d74d-377">[SQL Server Configuration Manager](../sql-server-configuration-manager.md) </span></span>  
 [<span data-ttu-id="5d74d-378">孤立的使用者疑難排解 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5d74d-378">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md)  
  
  
