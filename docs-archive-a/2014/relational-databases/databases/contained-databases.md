---
title: 自主資料庫 | Microsoft 文件
ms.custom: ''
ms.date: 07/17/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- contained database
- database_uncontained_usage event
- partially contained database
- contained database, understanding
ms.assetid: 36af59d7-ce96-4a02-8598-ffdd78cdc948
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3efd231a1aa4d2b348bcfe887bd05825fcd40c90
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87702973"
---
# <a name="contained-databases"></a><span data-ttu-id="33019-102">自主資料庫</span><span class="sxs-lookup"><span data-stu-id="33019-102">Contained Databases</span></span>
  <span data-ttu-id="33019-103">*「自主資料庫」* (Contained Database) 是與其他資料庫和裝載資料庫的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體隔離的資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-103">A*contained database* is a database that is isolated from other databases and from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts the database.</span></span>  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="33019-104">以四種方式協助使用者將其資料庫與執行個體隔離。</span><span class="sxs-lookup"><span data-stu-id="33019-104">helps user to isolate their database from the instance in 4 ways.</span></span>  
  
-   <span data-ttu-id="33019-105">描述資料庫的中繼資料大多是在資料庫中維護</span><span class="sxs-lookup"><span data-stu-id="33019-105">Much of the metadata that describes a database is maintained in the database.</span></span> <span data-ttu-id="33019-106">(加上或取代在 master 資料庫中維護中繼資料)。</span><span class="sxs-lookup"><span data-stu-id="33019-106">(In addition to, or instead of, maintaining metadata in the master database.)</span></span>  
  
-   <span data-ttu-id="33019-107">所有中繼資料都是使用相同定序來定義。</span><span class="sxs-lookup"><span data-stu-id="33019-107">All metadata are defined using the same collation.</span></span>  
  
-   <span data-ttu-id="33019-108">使用者驗證可由資料庫執行，減少 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體登入的資料庫相依性。</span><span class="sxs-lookup"><span data-stu-id="33019-108">User authentication can be performed by the database, reducing the databases dependency on the logins of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="33019-109">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 環境 (DMV、XEvent 等) 會報告內含項目資訊並對其作用。</span><span class="sxs-lookup"><span data-stu-id="33019-109">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] environment (DMV's, XEvents, etc.) reports and can act upon containment information.</span></span>  
  
 <span data-ttu-id="33019-110">部分自主資料庫的某些功能，例如將中繼資料儲存在資料庫中，適用於所有 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-110">Some features of partially contained databases, such as storing metadata in the database, apply to all [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] databases.</span></span> <span data-ttu-id="33019-111">部分自主資料庫的某些優點，例如資料庫層級驗證和目錄定序，必須先啟用才可供使用。</span><span class="sxs-lookup"><span data-stu-id="33019-111">Some benefits of partially contained databases, such as database level authentication and catalog collation, must be enabled before they are available.</span></span> <span data-ttu-id="33019-112">部分內含項目是透過使用 `CREATE DATABASE` 和 `ALTER DATABASE` 陳述式或使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 來啟用。</span><span class="sxs-lookup"><span data-stu-id="33019-112">Partial containment is enabled using the `CREATE DATABASE` and `ALTER DATABASE` statements or by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="33019-113">如需有關如何啟用部分資料庫內含項目的詳細資訊，請參閱＜ [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md)＞。</span><span class="sxs-lookup"><span data-stu-id="33019-113">For more information about how to enable partial database containment, see [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md).</span></span>  
  
 <span data-ttu-id="33019-114">本主題包含下列各節。</span><span class="sxs-lookup"><span data-stu-id="33019-114">This topic contains the following sections.</span></span>  
  
-   [<span data-ttu-id="33019-115">部分自主資料庫概念</span><span class="sxs-lookup"><span data-stu-id="33019-115">Partially Contained Database Concepts</span></span>](#Concepts)  
  
-   [<span data-ttu-id="33019-116">抑制</span><span class="sxs-lookup"><span data-stu-id="33019-116">Containment</span></span>](#containment)  
  
-   [<span data-ttu-id="33019-117">使用部分自主資料庫的優點</span><span class="sxs-lookup"><span data-stu-id="33019-117">Benefits of using Partially Contained Databases</span></span>](#benefits)  
  
-   [<span data-ttu-id="33019-118">限制</span><span class="sxs-lookup"><span data-stu-id="33019-118">Limitations</span></span>](#Limitations)  
  
-   [<span data-ttu-id="33019-119">識別資料庫內含專案</span><span class="sxs-lookup"><span data-stu-id="33019-119">Identifying Database Containment</span></span>](#Identifying)  
  
##  <a name="partially-contained-database-concepts"></a><a name="Concepts"></a> <span data-ttu-id="33019-120">部分自主資料庫概念</span><span class="sxs-lookup"><span data-stu-id="33019-120">Partially Contained Database Concepts</span></span>  
 <span data-ttu-id="33019-121">完全自主資料庫包含了定義資料庫所需的所有設定和中繼資料，而且對於已安裝資料庫的 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] 執行個體沒有組態相依性。</span><span class="sxs-lookup"><span data-stu-id="33019-121">A fully contained database includes all the settings and metadata required to define the database and has no configuration dependencies on the instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] where the database is installed.</span></span> <span data-ttu-id="33019-122">在舊版 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中，分隔資料庫與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體既耗時又需要資料庫與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體之間關聯性的詳細知識。</span><span class="sxs-lookup"><span data-stu-id="33019-122">In previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], separating a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] could be time consuming and required detailed knowledge of the relationship between the database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="33019-123">部分自主資料庫讓分隔 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體中的資料庫與其他資料庫變得更容易。</span><span class="sxs-lookup"><span data-stu-id="33019-123">Partially contained databases make it easier to separate a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and other databases.</span></span>  
  
 <span data-ttu-id="33019-124">自主資料庫會將功能視為與內含項目相關。</span><span class="sxs-lookup"><span data-stu-id="33019-124">The contained database considers features with regard to containment.</span></span> <span data-ttu-id="33019-125">只仰賴位於資料庫內部之功能的任何使用者定義實體會被視為完全自主。</span><span class="sxs-lookup"><span data-stu-id="33019-125">Any user-defined entity that relies only on functions that reside in the database is considered fully contained.</span></span> <span data-ttu-id="33019-126">仰賴位於資料庫外部之功能的任何使用者定義實體會被視為非內含性</span><span class="sxs-lookup"><span data-stu-id="33019-126">Any user-defined entity that relies on functions that reside outside the database is considered uncontained.</span></span> <span data-ttu-id="33019-127">(如需詳細資訊，請參閱本主題稍後的 [內含項目](#containment) 一節)。</span><span class="sxs-lookup"><span data-stu-id="33019-127">(For more information, see the [Containment](#containment) section later in this topic.)</span></span>  
  
 <span data-ttu-id="33019-128">下列詞彙適用於自主資料庫模型。</span><span class="sxs-lookup"><span data-stu-id="33019-128">The following terms apply to the contained database model.</span></span>  
  
 <span data-ttu-id="33019-129">資料庫界限</span><span class="sxs-lookup"><span data-stu-id="33019-129">Database boundary</span></span>  
 <span data-ttu-id="33019-130">資料庫與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體之間的界限。</span><span class="sxs-lookup"><span data-stu-id="33019-130">The boundary between a database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="33019-131">某個資料庫與其他資料庫之間的界限。</span><span class="sxs-lookup"><span data-stu-id="33019-131">The boundary between a database and other databases.</span></span>  
  
 <span data-ttu-id="33019-132">包含</span><span class="sxs-lookup"><span data-stu-id="33019-132">Contained</span></span>  
 <span data-ttu-id="33019-133">完全存在於資料庫界限內的元素。</span><span class="sxs-lookup"><span data-stu-id="33019-133">An element that exists entirely in the database boundary.</span></span>  
  
 <span data-ttu-id="33019-134">未包含</span><span class="sxs-lookup"><span data-stu-id="33019-134">Uncontained</span></span>  
 <span data-ttu-id="33019-135">跨資料庫界限的元素。</span><span class="sxs-lookup"><span data-stu-id="33019-135">An element that crosses the database boundary.</span></span>  
  
 <span data-ttu-id="33019-136">非自主資料庫</span><span class="sxs-lookup"><span data-stu-id="33019-136">Non-contained database</span></span>  
 <span data-ttu-id="33019-137">內含項目設定為 **NONE**的資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-137">A database that has containment set to **NONE**.</span></span> <span data-ttu-id="33019-138">在 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 之前的版本中，所有資料庫都是非自主資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-138">All databases in versions earlier than [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] are non-contained.</span></span> <span data-ttu-id="33019-139">根據預設，所有 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 及更新版本的資料庫都會將內含項目設定為 **NONE**。</span><span class="sxs-lookup"><span data-stu-id="33019-139">By default, all [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] and later databases have a containment set to **NONE**.</span></span>  
  
 <span data-ttu-id="33019-140">部分自主資料庫</span><span class="sxs-lookup"><span data-stu-id="33019-140">Partially contained database</span></span>  
 <span data-ttu-id="33019-141">部分自主資料庫就是允許跨越資料庫界限之某些功能的自主資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-141">A partially contained database is a contained database that can allow some features that cross the database boundary.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="33019-142">包含判斷何時跨越內含項目界限的功能。</span><span class="sxs-lookup"><span data-stu-id="33019-142">includes the ability to determine when the containment boundary is crossed.</span></span>  
  
 <span data-ttu-id="33019-143">包含的使用者</span><span class="sxs-lookup"><span data-stu-id="33019-143">Contained user</span></span>  
 <span data-ttu-id="33019-144">自主資料庫具有兩種使用者類型。</span><span class="sxs-lookup"><span data-stu-id="33019-144">There are two types of users for contained databases.</span></span>  
  
-   <span data-ttu-id="33019-145">**具有密碼之自主資料庫使用者**</span><span class="sxs-lookup"><span data-stu-id="33019-145">**Contained database user with password**</span></span>  
  
     <span data-ttu-id="33019-146">具有密碼之自主資料庫使用者是由資料庫驗證。</span><span class="sxs-lookup"><span data-stu-id="33019-146">Contained database users with passwords are authenticated by the database.</span></span>  
  
-   <span data-ttu-id="33019-147">**Windows 主體**</span><span class="sxs-lookup"><span data-stu-id="33019-147">**Windows principals**</span></span>  
  
     <span data-ttu-id="33019-148">已授權的 Windows 使用者和已授權之 Windows 群組的成員可以直接連接至資料庫，而且不需要 **master** 資料庫的登入。</span><span class="sxs-lookup"><span data-stu-id="33019-148">Authorized Windows users and members of authorized Windows groups can connect directly to the database and do not need logins in the **master** database.</span></span> <span data-ttu-id="33019-149">資料庫信任 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="33019-149">The database trusts the authentication by Windows.</span></span>  
  
 <span data-ttu-id="33019-150">以 **master** 資料庫中之登入為基礎的使用者可被授與自主資料庫的存取權，不過這樣做會建立 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體的相依性。</span><span class="sxs-lookup"><span data-stu-id="33019-150">Users based on logins in the **master** database can be granted access to a contained database, but that would create a dependency on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="33019-151">因此不建議建立以登入為基礎的使用者；請參閱部分自主資料庫的註解。</span><span class="sxs-lookup"><span data-stu-id="33019-151">Therefore, creating users based on logins see comment for partially contained databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="33019-152">若啟用部分自主資料庫，會將 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體的存取控制權委派給資料庫擁有者。</span><span class="sxs-lookup"><span data-stu-id="33019-152">Enabling partially contained databases delegates control over access to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the owners of the database.</span></span> <span data-ttu-id="33019-153">如需詳細資訊，請參閱 [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="33019-153">For more information, see [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md).</span></span>  
  
 <span data-ttu-id="33019-154">資料庫界限</span><span class="sxs-lookup"><span data-stu-id="33019-154">Database Boundary</span></span>  
 <span data-ttu-id="33019-155">因為部分自主資料庫會分隔資料庫功能與執行個體功能，所以兩個元素之間有一條明確定義的線，稱為 *「資料庫界限」* (Database Boundary)。</span><span class="sxs-lookup"><span data-stu-id="33019-155">Because partially contained databases separate the database functionality from those of the instance, there is a clearly defined line between these two elements called the *database boundary*.</span></span>  
  
 <span data-ttu-id="33019-156">*「資料庫模型」* (Database Model) 位於資料庫界限內部，其中進行資料庫的開發和管理作業。</span><span class="sxs-lookup"><span data-stu-id="33019-156">Inside of the database boundary is the *database model*, where the databases are developed and managed.</span></span> <span data-ttu-id="33019-157">位於資料庫內部的實體範例包括 **sys.tables**等系統資料表、具有密碼之自主資料庫使用者，以及目前資料庫中由兩部分名稱所參考的使用者資料表。</span><span class="sxs-lookup"><span data-stu-id="33019-157">Examples of entities located inside of the database include, system tables like **sys.tables**, contained database users with passwords, and user tables in the current database referenced by a two-part name.</span></span>  
  
 <span data-ttu-id="33019-158">*「管理模型」* (Management Model) 位於資料庫界限外部，它與執行個體層級功能和管理有關。</span><span class="sxs-lookup"><span data-stu-id="33019-158">Outside of the database boundary is the *management model*, which pertains to instance-level functions and management.</span></span> <span data-ttu-id="33019-159">位於資料庫界限外部的實體範例包括 **sys.endpoints**等系統資料表、對應至登入的使用者，以及另一個資料庫中由三部分名稱所參考的使用者資料表。</span><span class="sxs-lookup"><span data-stu-id="33019-159">Examples of entities located outside of the database boundary include, system tables like **sys.endpoints**, users mapped to logins, and user tables in another database referenced by a three-part-name.</span></span>  
  
##  <a name="containment"></a><a name="containment"></a> <span data-ttu-id="33019-160">內含項目</span><span class="sxs-lookup"><span data-stu-id="33019-160">Containment</span></span>  
 <span data-ttu-id="33019-161">完全位於資料庫內部的使用者實體會被視為 *「自主」* (Contained)。</span><span class="sxs-lookup"><span data-stu-id="33019-161">User entities that reside entirely within the database are considered *contained*.</span></span> <span data-ttu-id="33019-162">位於資料庫外部或仰賴與資料庫外部之功能互動的任何實體會被視為 *「非內含性」* (Uncontained)。</span><span class="sxs-lookup"><span data-stu-id="33019-162">Any entities that reside outside of the database, or rely on interaction with functions outside of the database, are considered *uncontained*.</span></span>  
  
 <span data-ttu-id="33019-163">一般而言，使用者實體可分為下列內含項目類別：</span><span class="sxs-lookup"><span data-stu-id="33019-163">In general, user entities fall into the following categories of containment:</span></span>  
  
-   <span data-ttu-id="33019-164">完全自主使用者實體 (絕對不會跨越資料庫界限的實體)，例如 sys.indexes。</span><span class="sxs-lookup"><span data-stu-id="33019-164">Fully contained user entities (those that never cross the database boundary), for example sys.indexes.</span></span> <span data-ttu-id="33019-165">任何使用這些功能的程式碼或任何只參考這些實體的物件也完全包含。</span><span class="sxs-lookup"><span data-stu-id="33019-165">Any code that uses these features or any object that references only these entities is also fully contained.</span></span>  
  
-   <span data-ttu-id="33019-166">非內含性使用者實體 (跨越資料庫界限的實體)，例如 sys.server_principals 或伺服器主體 (登入) 本身。</span><span class="sxs-lookup"><span data-stu-id="33019-166">Uncontained user entities (those that cross the database boundary), for example sys.server_principals or a server principal (login) itself.</span></span> <span data-ttu-id="33019-167">任何使用這些實體的程式碼或任何參考這些實體的功能為非內含性。</span><span class="sxs-lookup"><span data-stu-id="33019-167">Any code that uses these entities or any functions that references these entities are uncontained.</span></span>  
  
###  <a name="partially-contained-database"></a><a name="partial"></a> <span data-ttu-id="33019-168">Partially Contained Database</span><span class="sxs-lookup"><span data-stu-id="33019-168">Partially Contained Database</span></span>  
 <span data-ttu-id="33019-169">自主資料庫功能目前只能在部分包含的狀態下使用。</span><span class="sxs-lookup"><span data-stu-id="33019-169">The contained database feature is currently available only in a partially contained state.</span></span> <span data-ttu-id="33019-170">部分自主資料庫就是允許使用未自主功能的自主資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-170">A partially contained database is a contained database that allows the use of uncontained features.</span></span>  
  
 <span data-ttu-id="33019-171">您可以使用 [sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) 和 [sys.sql_modules &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) 檢視以傳回有關非內含性物件或功能的資訊。</span><span class="sxs-lookup"><span data-stu-id="33019-171">Use the [sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) and [sys.sql_modules &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) view to return information about uncontained objects or features.</span></span> <span data-ttu-id="33019-172">透過判斷資料庫元素的自主狀態，您就可以找出必須取代或改變哪些物件或功能，以升級內含項目。</span><span class="sxs-lookup"><span data-stu-id="33019-172">By determining the containment status of the elements of your database, you can discover what objects or features must be replaced or altered to promote containment.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="33019-173">因為某些物件的預設內含項目設定為 **NONE**，所以此檢視可能會傳回誤判。</span><span class="sxs-lookup"><span data-stu-id="33019-173">Because certain objects have a default containment setting of **NONE**, this view can return false positives.</span></span>  
  
 <span data-ttu-id="33019-174">部分自主資料庫行為與非自主資料庫行為最明確的差異在於定序。</span><span class="sxs-lookup"><span data-stu-id="33019-174">The behavior of partially contained databases differs most distinctly from that of non-contained databases with regard to collation.</span></span> <span data-ttu-id="33019-175">如需有關定序問題的詳細資訊，請參閱＜ [Contained Database Collations](contained-database-collations.md)＞。</span><span class="sxs-lookup"><span data-stu-id="33019-175">For more information about collation issues, see [Contained Database Collations](contained-database-collations.md).</span></span>  
  
##  <a name="benefits-of-using-partially-contained-databases"></a><a name="benefits"></a> <span data-ttu-id="33019-176">使用部分自主資料庫的優點</span><span class="sxs-lookup"><span data-stu-id="33019-176">Benefits of using Partially Contained Databases</span></span>  
 <span data-ttu-id="33019-177">您可以使用部分自主資料庫來解決一些與非自主資料庫相關聯的問題和複雜性。</span><span class="sxs-lookup"><span data-stu-id="33019-177">There are issues and complications associated with the non-contained databases that can be resolved by using a partially contained database.</span></span>  
  
### <a name="database-movement"></a><span data-ttu-id="33019-178">資料庫移動</span><span class="sxs-lookup"><span data-stu-id="33019-178">Database Movement</span></span>  
 <span data-ttu-id="33019-179">在移動資料庫時所面臨的其中一個問題就是，當資料庫從某個執行個體移至另一個執行個體時，某些重要資訊可能無法使用。</span><span class="sxs-lookup"><span data-stu-id="33019-179">One of the problems that occurs when moving databases, is that some important information can be unavailable when a database is moved from one instance to another.</span></span> <span data-ttu-id="33019-180">例如，登入資訊儲存在執行個體而不是在資料庫中。</span><span class="sxs-lookup"><span data-stu-id="33019-180">For example, login information is stored within the instance instead of in the database.</span></span> <span data-ttu-id="33019-181">當您將非自主資料庫從某個 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體移至另一個執行個體時，就會遺留這項資訊。</span><span class="sxs-lookup"><span data-stu-id="33019-181">When you move a non-contained database from one instance to another instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], this information is left behind.</span></span> <span data-ttu-id="33019-182">您必須識別遺失的資料，並且將這項資料與資料庫一起移至新的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體。</span><span class="sxs-lookup"><span data-stu-id="33019-182">You must identify the missing information and move it with your database to the new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="33019-183">這個程序可能既困難又耗時。</span><span class="sxs-lookup"><span data-stu-id="33019-183">This process can be difficult and time-consuming.</span></span>  
  
 <span data-ttu-id="33019-184">部分自主資料庫可將重要資訊儲存在資料庫中，因此在移動後資料庫仍然有此項資訊。</span><span class="sxs-lookup"><span data-stu-id="33019-184">The partially contained database can store important information in the database so the database still has the information after it is moved.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="33019-185">部分自主資料庫可以提供有關資料庫所用、不能與執行個體分隔之功能的文件集。</span><span class="sxs-lookup"><span data-stu-id="33019-185">A partially contained database can provide documentation describing those features that are used by a database that cannot be separated from the instance.</span></span> <span data-ttu-id="33019-186">這包含其他彼此相關的資料庫、資料庫所需要但無法包含的系統設定等的清單。</span><span class="sxs-lookup"><span data-stu-id="33019-186">This includes a list of other interrelated databases, system settings that the database requires but cannot be contained, and so on.</span></span>  
  
### <a name="benefit-of-contained-database-users-with-alwayson"></a><span data-ttu-id="33019-187">搭配使用自主資料庫使用者與 AlwaysOn 的優點</span><span class="sxs-lookup"><span data-stu-id="33019-187">Benefit of Contained Database Users with AlwaysOn</span></span>  
 <span data-ttu-id="33019-188">透過減少與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體的關聯，在使用 [!INCLUDE[ssHADR](../../includes/sshadr-md.md)]時，部分自主資料庫在容錯移轉期間就很有用。</span><span class="sxs-lookup"><span data-stu-id="33019-188">By reducing the ties to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], partially contained databases can be useful during failover when you use [!INCLUDE[ssHADR](../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="33019-189">建立包含的使用者可讓使用者直接連接到自主資料庫。</span><span class="sxs-lookup"><span data-stu-id="33019-189">Creating contained users enables the user to connect directly to the contained database.</span></span> <span data-ttu-id="33019-190">在高可用性和災害復原案例 (例如 AlwaysOn 方案) 中，這是非常重要的功能。</span><span class="sxs-lookup"><span data-stu-id="33019-190">This is a very significant feature in high availability and disaster recovery scenarios such as in an AlwaysOn solution.</span></span> <span data-ttu-id="33019-191">如果使用者是包含的使用者，萬一發生容錯移轉時，使用者無需在裝載次要副本的執行個體上建立登入，就能夠連接到次要副本。</span><span class="sxs-lookup"><span data-stu-id="33019-191">If the users are contained users, in case of failover, people would be able to connect to the secondary without creating logins on the instance hosting the secondary.</span></span> <span data-ttu-id="33019-192">這為使用者提供直接的好處。</span><span class="sxs-lookup"><span data-stu-id="33019-192">This provides an immediate benefit.</span></span> <span data-ttu-id="33019-193">如需詳細資訊，請參閱 [AlwaysOn 可用性群組概觀 &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) 和 [AlwaysOn 可用性群組的必要條件、限制和建議 &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="33019-193">For more information, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) and [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="initial-database-development"></a><span data-ttu-id="33019-194">初始資料庫開發</span><span class="sxs-lookup"><span data-stu-id="33019-194">Initial Database Development</span></span>  
 <span data-ttu-id="33019-195">因為開發人員可能不知道新資料庫的部署位置，所以限制資料庫的部署環境影響會減少開發人員的工作和顧慮。</span><span class="sxs-lookup"><span data-stu-id="33019-195">Because a developer may not know where a new database will be deployed, limiting the deployed environmental impacts on the database lessens the work and concern for the developer.</span></span> <span data-ttu-id="33019-196">在非自主模型中，開發人員必須據此考慮新資料庫和程式的可能環境影響。</span><span class="sxs-lookup"><span data-stu-id="33019-196">In the non-contained model, the developer must consider possible environmental impacts on the new database and program accordingly.</span></span> <span data-ttu-id="33019-197">但是，透過使用部分自主資料庫，開發人員可以偵測資料庫的執行個體層級影響以及開發人員的執行個體層級顧慮。</span><span class="sxs-lookup"><span data-stu-id="33019-197">However, by using partially contained databases, developers can detect instance-level impacts on the database and instance-level concerns for the developer.</span></span>  
  
### <a name="database-administration"></a><span data-ttu-id="33019-198">資料庫管理</span><span class="sxs-lookup"><span data-stu-id="33019-198">Database Administration</span></span>  
 <span data-ttu-id="33019-199">在資料庫而不是在 master 資料庫中維護資料庫設定，讓每個資料庫擁有者對其資料庫有較多的控制，而不需要將 **系統管理員 (sysadmin)** 權限授與資料庫擁有者。</span><span class="sxs-lookup"><span data-stu-id="33019-199">Maintaining database settings in the database, instead of in the master database, lets each database owner have more control over their database, without giving the database owner **sysadmin** permission.</span></span>  
  
##  <a name="limitations"></a><a name="Limitations"></a> <span data-ttu-id="33019-200">限制</span><span class="sxs-lookup"><span data-stu-id="33019-200">Limitations</span></span>  
 <span data-ttu-id="33019-201">部分自主資料庫不允許下列功能。</span><span class="sxs-lookup"><span data-stu-id="33019-201">Partially contained databases do not allow the following features.</span></span>  
  
-   <span data-ttu-id="33019-202">部分自主資料庫無法使用複寫、異動資料擷取，或變更追蹤。</span><span class="sxs-lookup"><span data-stu-id="33019-202">Partially contained databases cannot use replication, change data capture, or change tracking.</span></span>  
  
-   <span data-ttu-id="33019-203">編號程序。</span><span class="sxs-lookup"><span data-stu-id="33019-203">Numbered procedures</span></span>  
  
-   <span data-ttu-id="33019-204">相依於具有定序變更之內建功能的結構描述繫結物件。</span><span class="sxs-lookup"><span data-stu-id="33019-204">Schema-bound objects that depend on built-in functions with collation changes</span></span>  
  
-   <span data-ttu-id="33019-205">定序變更所產生的繫結變更，包括物件、資料行、符號或類型的參考。</span><span class="sxs-lookup"><span data-stu-id="33019-205">Binding change resulting from collation changes, including references to objects, columns, symbols, or types.</span></span>  
  
-   <span data-ttu-id="33019-206">複寫、異動資料擷取與變更追蹤。</span><span class="sxs-lookup"><span data-stu-id="33019-206">Replication, change data capture, and change tracking.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="33019-207">目前允許暫存預存程序。</span><span class="sxs-lookup"><span data-stu-id="33019-207">Temporary stored procedures are currently permitted.</span></span> <span data-ttu-id="33019-208">由於暫存預存程序違反內含項目，因此預計未來自主資料庫版本中不會支援這些預存程序。</span><span class="sxs-lookup"><span data-stu-id="33019-208">Because temporary stored procedures breach containment, they are not expected to be supported in future versions of contained database.</span></span>  
  
##  <a name="identifying-database-containment"></a><a name="Identifying"></a> <span data-ttu-id="33019-209">識別資料庫內含項目</span><span class="sxs-lookup"><span data-stu-id="33019-209">Identifying Database Containment</span></span>  
 <span data-ttu-id="33019-210">有兩項工具可協助識別資料庫的內含項目狀態。</span><span class="sxs-lookup"><span data-stu-id="33019-210">There are two tools to help identify the containment status of the database.</span></span> <span data-ttu-id="33019-211">[sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) 是顯示資料庫中所有可能非內含性實體的檢視。</span><span class="sxs-lookup"><span data-stu-id="33019-211">The [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) is a view that shows all the potentially uncontained entities in the database.</span></span> <span data-ttu-id="33019-212">在執行階段中識別任何實際非內含性實體時，就會發生 database_uncontained_usage 事件。</span><span class="sxs-lookup"><span data-stu-id="33019-212">The database_uncontained_usage event occurs when any actual uncontained entity is identified at run time.</span></span>  
  
### <a name="sysdm_db_uncontained_entities"></a><span data-ttu-id="33019-213">sys.dm_db_uncontained_entities</span><span class="sxs-lookup"><span data-stu-id="33019-213">sys.dm_db_uncontained_entities</span></span>  
 <span data-ttu-id="33019-214">這個檢視會顯示資料庫中任何可能的非內含性實體，例如跨越資料庫界限的實體。</span><span class="sxs-lookup"><span data-stu-id="33019-214">This view shows any entities in the database that have the potential to be uncontained, such as those that cross-the database boundary.</span></span> <span data-ttu-id="33019-215">這包括可能使用資料庫模型外部之物件的使用者實體。</span><span class="sxs-lookup"><span data-stu-id="33019-215">This includes those user entities that may use objects outside the database model.</span></span> <span data-ttu-id="33019-216">不過，因為某些實體 (例如，使用動態 SQL 的實體) 的內含項目要等到執行階段才能判斷，所以此檢視可能會顯示一些實際上包含的實體。</span><span class="sxs-lookup"><span data-stu-id="33019-216">However, because the containment of some entities (for example, those using dynamic SQL) cannot be determined until run time, the view may show some entities that are not actually uncontained.</span></span> <span data-ttu-id="33019-217">如需詳細資訊，請參閱 [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="33019-217">For more information, see [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql).</span></span>  
  
### <a name="database_uncontained_usage-event"></a><span data-ttu-id="33019-218">database_uncontained_usage 事件</span><span class="sxs-lookup"><span data-stu-id="33019-218">database_uncontained_usage event</span></span>  
 <span data-ttu-id="33019-219">在執行階段識別非內含性實體時，會發生此 XEvent。</span><span class="sxs-lookup"><span data-stu-id="33019-219">This XEvent occurs whenever an uncontained entity is identified at run time.</span></span> <span data-ttu-id="33019-220">這包括起源自用戶端程式碼的實體。</span><span class="sxs-lookup"><span data-stu-id="33019-220">This includes entities originated in client code.</span></span> <span data-ttu-id="33019-221">這個 XEvent 只會針對實際非內含性實體發生。</span><span class="sxs-lookup"><span data-stu-id="33019-221">This XEvent will occur only for actual uncontained entities.</span></span> <span data-ttu-id="33019-222">不過，此事件只會在執行階段中發生。</span><span class="sxs-lookup"><span data-stu-id="33019-222">However, the event only occurs at run time.</span></span> <span data-ttu-id="33019-223">因此，這個 XEvent 不會識別您尚未執行的任何非內含性使用者實體。</span><span class="sxs-lookup"><span data-stu-id="33019-223">Therefore, any uncontained user entities you have not run will not be identified by this XEvent</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="33019-224">相關內容</span><span class="sxs-lookup"><span data-stu-id="33019-224">Related Content</span></span>  
 [<span data-ttu-id="33019-225">修改的功能 &#40;自主資料庫&#41;</span><span class="sxs-lookup"><span data-stu-id="33019-225">Modified Features &#40;Contained Database&#41;</span></span>](modified-features-contained-database.md)  
  
 [<span data-ttu-id="33019-226">自主資料庫定序</span><span class="sxs-lookup"><span data-stu-id="33019-226">Contained Database Collations</span></span>](contained-database-collations.md)  
  
 [<span data-ttu-id="33019-227">自主資料庫的安全性最佳做法</span><span class="sxs-lookup"><span data-stu-id="33019-227">Security Best Practices with Contained Databases</span></span>](security-best-practices-with-contained-databases.md)  
  
 [<span data-ttu-id="33019-228">移轉至部分自主資料庫</span><span class="sxs-lookup"><span data-stu-id="33019-228">Migrate to a Partially Contained Database</span></span>](migrate-to-a-partially-contained-database.md)  
  
  
