---
title: 對發行集資料庫進行結構描述變更 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], schema changes
- snapshot replication [SQL Server], replicating schema changes
- merge replication [SQL Server replication], replicating schema changes
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
- publishing [SQL Server replication], schema changes
ms.assetid: 926c88d7-a844-402f-bcb9-db49e5013b69
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26d3e89fcba41d474ca56637f9e465f17127348
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585286"
---
# <a name="make-schema-changes-on-publication-databases"></a><span data-ttu-id="d4aa6-102">對發行集資料庫進行結構描述變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-102">Make Schema Changes on Publication Databases</span></span>
  <span data-ttu-id="d4aa6-103">複寫支援對已發行物件進行大範圍的結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-103">Replication supports a wide range of schema changes to published objects.</span></span> <span data-ttu-id="d4aa6-104">當您對「[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 發行者」端適當的已發行物件進行下列任何結構描述變更時，依預設，該變更會傳播給所有的「[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 訂閱者」：</span><span class="sxs-lookup"><span data-stu-id="d4aa6-104">When you make any of the following schema changes on the appropriate published object at a [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, that change is propagated by default to all [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers:</span></span>  
  
-   <span data-ttu-id="d4aa6-105">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="d4aa6-105">ALTER TABLE</span></span>  
  
-   <span data-ttu-id="d4aa6-106">ALTER TABLE SET LOCK ESCALATION (如果結構描述變更複寫已啟用，且有拓撲包含 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或 [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] 訂閱者，則不應使用。) ALTER VIEW</span><span class="sxs-lookup"><span data-stu-id="d4aa6-106">ALTER TABLE SET LOCK ESCALATION should not be used if schema change replication is enabled and a topology includes [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW</span></span>  
  
-   <span data-ttu-id="d4aa6-107">ALTER PROCEDURE</span><span class="sxs-lookup"><span data-stu-id="d4aa6-107">ALTER PROCEDURE</span></span>  
  
-   <span data-ttu-id="d4aa6-108">ALTER FUNCTION</span><span class="sxs-lookup"><span data-stu-id="d4aa6-108">ALTER FUNCTION</span></span>  
  
-   <span data-ttu-id="d4aa6-109">ALTER TRIGGER</span><span class="sxs-lookup"><span data-stu-id="d4aa6-109">ALTER TRIGGER</span></span>  
  
     <span data-ttu-id="d4aa6-110">ALTER TRIGGER (僅可用於資料管理語言 [DML] 觸發器，因為無法複寫資料定義語言 [DDL] 觸發器。)</span><span class="sxs-lookup"><span data-stu-id="d4aa6-110">ALTER TRIGGER can be used only for data manipulation language [DML] triggers because data definition language [DDL] triggers cannot be replicated.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d4aa6-111">必須使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 或 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Management Objects (SMO) 對資料表進行結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-111">Schema changes to tables must be made by using [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Management Objects (SMO).</span></span> <span data-ttu-id="d4aa6-112">在 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]中進行結構描述變更時， [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] 會嘗試卸除並重新建立資料表。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-112">When schema changes are made in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] attempts to drop and re-create the table.</span></span> <span data-ttu-id="d4aa6-113">您無法卸除已發行的物件，因此結構描述變更會失敗。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-113">You cannot drop published objects, therefore the schema change fails.</span></span>  
  
 <span data-ttu-id="d4aa6-114">對於異動複寫與合併式複寫，結構描述變更會在「散發代理程式」或「合併代理程式」執行時進行累加傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-114">For transactional replication and merge replication, schema changes are propagated incrementally when the Distribution Agent or Merge Agent runs.</span></span> <span data-ttu-id="d4aa6-115">對於快照式複寫，結構描述變更則在「訂閱者」套用新的快照集時進行傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-115">For snapshot replication, schema changes are propagated when a new snapshot is applied at the Subscriber.</span></span> <span data-ttu-id="d4aa6-116">在快照式複寫中，每次發生同步處理時，結構描述的新副本便會傳送至「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-116">In snapshot replication, a new copy of the schema is sent to the Subscriber each time synchronization occurs.</span></span> <span data-ttu-id="d4aa6-117">因此，對先前已發行物件進行的所有結構描述變更 (不僅僅是以上所列的變更) 會與每個同步處理一起自動傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-117">Therefore, all schema changes (not just those listed above) to previously published objects are automatically propagated with each synchronization.</span></span>  
  
 <span data-ttu-id="d4aa6-118">如需新增及移除發行集發行項的資訊，請參閱[在現有發行集中新增和卸除發行項](add-articles-to-and-drop-articles-from-existing-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-118">For information about adding and removing articles from publications, see [Add Articles to and Drop Articles from Existing Publications](add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
 <span data-ttu-id="d4aa6-119">**若要複寫結構描述變更**</span><span class="sxs-lookup"><span data-stu-id="d4aa6-119">**To replicate schema changes**</span></span>  
  
 <span data-ttu-id="d4aa6-120">依預設，會複寫以上所列的結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-120">The schema changes listed above are replicated by default.</span></span> <span data-ttu-id="d4aa6-121">如需有關停用結構描述變更複寫的詳細資訊，請參閱＜ [Replicate Schema Changes](replicate-schema-changes.md)＞。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-121">For information about disabling the replication of schema changes, see [Replicate Schema Changes](replicate-schema-changes.md).</span></span>  
  
## <a name="considerations-for-schema-changes"></a><span data-ttu-id="d4aa6-122">結構描述變更之考量</span><span class="sxs-lookup"><span data-stu-id="d4aa6-122">Considerations for Schema Changes</span></span>  
 <span data-ttu-id="d4aa6-123">複寫結構描述變更時，請記住下列考量。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-123">Keep the following considerations in mind when replicating schema changes.</span></span>  
  
### <a name="general-considerations"></a><span data-ttu-id="d4aa6-124">一般考量</span><span class="sxs-lookup"><span data-stu-id="d4aa6-124">General Considerations</span></span>  
  
-   <span data-ttu-id="d4aa6-125">結構描述變更必須遵從由 [!INCLUDE[tsql](../../../includes/tsql-md.md)]規定的任何條件約束。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-125">Schema changes are subject to any restrictions imposed by [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="d4aa6-126">例如，ALTER TABLE 不允許對主索引鍵資料行執行 ALTER。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-126">For example, ALTER TABLE does not allow you to ALTER primary key columns.</span></span>  
  
-   <span data-ttu-id="d4aa6-127">資料類型對應只會針對初始快照集執行。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-127">Data type mapping is performed only for the initial snapshot.</span></span> <span data-ttu-id="d4aa6-128">結構描述變更並不會對應到舊版的資料類型。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-128">Schema changes are not mapped to previous versions of data types.</span></span> <span data-ttu-id="d4aa6-129">例如，如果在 [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] 內使用陳述式 `ALTER TABLE ADD datetime2 column`，則資料類型不會針對 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 訂閱者轉譯成 `nvarchar`。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-129">For example, if the statement `ALTER TABLE ADD datetime2 column` is used in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the data type is not translated to `nvarchar` for [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] Subscribers.</span></span> <span data-ttu-id="d4aa6-130">在某些案例中，發行者上會封鎖結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-130">In some cases, schema changes are blocked on the Publisher.</span></span>  
  
-   <span data-ttu-id="d4aa6-131">如果發行集設定為允許傳播結構描述變更，則不論發行集中發行項的相關結構描述選項如何設定，結構描述都會傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-131">If a publication is set to allow the propagation of schema changes, schema changes are propagated regardless of how the related schema option is set for an article in the publication.</span></span> <span data-ttu-id="d4aa6-132">例如，如果選取不對資料表發行項的外部索引鍵條件約束進行複寫，但是接著發出 ALTER TABLE 命令，將外部索引鍵新增至「發行者」端的資料表，則外部索引鍵會新增至「訂閱者」端的資料表。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-132">For example, if you select not to replicate foreign key constraints for a table article, but then issue an ALTER TABLE command that adds a foreign key to the table at the Publisher, the foreign key is added to the table at the Subscriber.</span></span> <span data-ttu-id="d4aa6-133">若要防止發生這種情況，則在發出 ALTER TABLE 命令前停用結構描述變更的傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-133">To prevent this, disable the propagation of schema changes before issuing the ALTER TABLE command.</span></span>  
  
-   <span data-ttu-id="d4aa6-134">僅應在「發行者」而不是「訂閱者」端 (包括重新發行「訂閱者」) 進行結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-134">Schema changes should be made only at the Publisher, not at Subscribers (including republishing Subscribers).</span></span> <span data-ttu-id="d4aa6-135">合併式複寫防止在「訂閱者」端的結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-135">Merge replication prevents schema changes at the Subscriber.</span></span> <span data-ttu-id="d4aa6-136">異動複寫不會防止變更，但是變更會造成複寫失敗。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-136">Transactional replication does not prevent the changes, but the changes can cause replication to fail.</span></span>  
  
-   <span data-ttu-id="d4aa6-137">依預設，傳播至重新發行訂閱者的變更會傳播至其訂閱者。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-137">Changes propagated to a republishing Subscriber are by default propagated to its Subscribers.</span></span>  
  
-   <span data-ttu-id="d4aa6-138">如果結構描述變更參考了存在於「發行者」而不是「訂閱者」上的物件或條件約束，則結構描述變更會在「發行者」上成功，但會在「訂閱者」上失敗。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-138">If the schema change references objects or constraints existing on the Publisher but not on the Subscriber, the schema change will succeed on the Publisher but will fail on the Subscriber.</span></span>  
  
-   <span data-ttu-id="d4aa6-139">新增外部索引鍵時所參考之「訂閱者」上所有物件的名稱和擁有者，必須與「發行者」上對應的物件相同。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-139">All objects on the Subscriber that are referenced when adding a foreign key must have the same name and owner as the corresponding object on the Publisher.</span></span>  
  
-   <span data-ttu-id="d4aa6-140">不支援明確地新增、卸除或改變索引。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-140">Explicitly adding, dropping, or altering indexes is not supported.</span></span> <span data-ttu-id="d4aa6-141">支援為條件約束 (例如主索引鍵條件約束) 隱含建立的索引。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-141">Indexes created implicitly for constraints (such as a primary key constraint) are supported.</span></span>  
  
-   <span data-ttu-id="d4aa6-142">不支援改變或卸除由複寫管理的識別欄位。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-142">Altering or dropping identity columns that are managed by replication is not supported.</span></span> <span data-ttu-id="d4aa6-143">如需自動管理識別欄位的詳細資訊，請參閱[複寫識別欄位](replicate-identity-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-143">For more information about automatic management of identity columns, see [Replicate Identity Columns](replicate-identity-columns.md).</span></span>  
  
-   <span data-ttu-id="d4aa6-144">不支援包括非決定性函數的結構描述變更，因為該變更會導致「發行者」和「訂閱者」上的資料各不相同 (稱為非聚合)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-144">Schema changes that include nondeterministic functions are not supported because they can result in data at the Publisher and Subscriber being different (referred to as non-convergence).</span></span> <span data-ttu-id="d4aa6-145">例如，如果在「發行者」端發出下列命令： `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`，則將命令複寫至「訂閱者」並執行此命令時，值會各不相同。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-145">For example, if you issue the following command at the Publisher: `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`, the values are different when the command is replicated to the Subscriber and executed.</span></span> <span data-ttu-id="d4aa6-146">如需有關不具決定性函數的詳細資訊，請參閱＜ [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md)＞。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-146">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="d4aa6-147">建議對條件約束進行明確命名。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-147">It is recommended that constraints be explicitly named.</span></span> <span data-ttu-id="d4aa6-148">如果條件約束沒有明確命名， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 會產生條件約束的名稱，並且這些名稱在發行者及每個訂閱者會有所不同。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-148">If a constraint is not explicitly named, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a name for the constraint, and these names will be different on the Publisher and each Subscriber.</span></span> <span data-ttu-id="d4aa6-149">在結構描述變更的複寫期間，這可能會造成問題。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-149">This can cause issues during the replication of schema changes.</span></span> <span data-ttu-id="d4aa6-150">例如，如果您卸除發行者端的資料行，並且卸除相依性條件約束，複寫便會嘗試卸除訂閱者端的條件約束。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-150">For example, if you drop a column at the Publisher and a dependent constraint is dropped, replication will attempt to drop the constraint at the Subscriber.</span></span> <span data-ttu-id="d4aa6-151">因為條件約束名稱不同，所以訂閱者端的卸除動作會失敗。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-151">The drop at the Subscriber will fail because the name of the constraint is different.</span></span> <span data-ttu-id="d4aa6-152">如果同步處理因條件約束名稱問題而失敗，請手動卸除訂閱者端的條件約束，然後重新執行合併代理程式。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-152">If synchronization fails because of a constraint naming issue, manually drop the constraint at the Subscriber and then rerun the Merge Agent.</span></span>  
  
-   <span data-ttu-id="d4aa6-153">發行資料表來進行複寫時，如果已產生發行集快照集，則無法將該資料表中的資料行改為 XML 資料類型。若要改變此資料行，您必須先移除複寫。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-153">If a table is published for replication, it is not possible to alter a column in that table to a data type of XML if a publication snapshot has already been generated To alter the column, you must first remove replication.</span></span>  
  
-   <span data-ttu-id="d4aa6-154">在已發行的資料表上執行 DDL 時，讀取未認可不是一個支援的隔離等級。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-154">Read uncommitted is not a supported isolation level when doing DDL on a published table.</span></span>  
  
-   <span data-ttu-id="d4aa6-155">如果針對已發行的物件執行結構描述變更，就不應該使用 `SET CONTEXT_INFO` 來修改交易的內容。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-155">`SET CONTEXT_INFO` should not be used to modify the context of transactions where schema changes are performed against published objects.</span></span>  
  
#### <a name="adding-columns"></a><span data-ttu-id="d4aa6-156">新增資料行</span><span class="sxs-lookup"><span data-stu-id="d4aa6-156">Adding Columns</span></span>  
  
-   <span data-ttu-id="d4aa6-157">若要將新資料行新增至資料表，並將該資料行包含在現有的發行集中，請執行 ALTER TABLE \<Table> ADD \<Column>。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-157">To add a new column to a table and include that column in an existing publication, execute ALTER TABLE \<Table> ADD \<Column>.</span></span> <span data-ttu-id="d4aa6-158">依預設，資料行然後便會寫至所有「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-158">By default, the column is then replicated to all Subscribers.</span></span> <span data-ttu-id="d4aa6-159">資料行必須允許 NULL 值或包含預設條件約束。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-159">The column must allow NULL values or include a default constraint.</span></span> <span data-ttu-id="d4aa6-160">如需有關加入資料行的詳細資訊，請參閱本主題中的「合併式複寫」一節。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-160">For more information about adding columns, see the "Merge Replication" section in this topic.</span></span>  
  
-   <span data-ttu-id="d4aa6-161">若要將新資料行新增至資料表，且不在現有的發行集中包含該資料行，則請停用結構描述變更的複寫，然後執行 ALTER TABLE \<Table> ADD \<Column>。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-161">To add a new column to a table and not include that column in an existing publication, disable the replication of schema changes, and then execute ALTER TABLE \<Table> ADD \<Column>.</span></span>  
  
-   <span data-ttu-id="d4aa6-162">若要在現有發行集中包含現有的資料行，請使用 [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) 或 [發行集屬性 - \<Publication>] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-162">To include an existing column in an existing publication, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="d4aa6-163">如需詳細資訊，請參閱 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-163">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="d4aa6-164">這需要重新初始化訂閱。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-164">This will require subscriptions to be reinitialized.</span></span>  
  
-   <span data-ttu-id="d4aa6-165">不支援在已發行的資料表上加入識別欄位，因為可能在資料行複寫至「訂閱者」時，導致無法聚合。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-165">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="d4aa6-166">簽發者端識別欄位中的值，隨著受影響的資料表之資料列的實際儲存順序而不同。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-166">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="d4aa6-167">資料列可能以不同方式儲存在訂閱者端；因此識別欄位的值可能與同資料列的不同。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-167">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
#### <a name="dropping-columns"></a><span data-ttu-id="d4aa6-168">卸除資料行</span><span class="sxs-lookup"><span data-stu-id="d4aa6-168">Dropping Columns</span></span>  
  
-   <span data-ttu-id="d4aa6-169">若要從現有的發行集卸除資料行，並從發行者端的資料表卸除該資料行，請執行 ALTER TABLE \<Table> DROP \<Column>。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-169">To drop a column from an existing publication and drop the column from the table at the Publisher, execute ALTER TABLE \<Table> DROP \<Column>.</span></span> <span data-ttu-id="d4aa6-170">依預設，資料行然後便會從所有「訂閱者」端的資料表中卸除。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-170">By default, the column is then dropped from the table at all Subscribers.</span></span>  
  
-   <span data-ttu-id="d4aa6-171">若要從現有的發行集卸除資料行，但要在發行者端的資料表中保留該資料行，請使用 [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) 或 [發行集屬性 - \<Publication>] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-171">To drop a column from an existing publication but retain the column in the table at the Publisher, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="d4aa6-172">如需詳細資訊，請參閱 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-172">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="d4aa6-173">這需要產生新的快照集。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-173">This will require a new snapshot to be generated.</span></span>  
  
-   <span data-ttu-id="d4aa6-174">要卸除的資料行不可以用於資料庫內任何發行集，任何發行項的篩選子句。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-174">The column to be dropped cannot be used in the filter clauses of any article of any publication in the database.</span></span>  
  
-   <span data-ttu-id="d4aa6-175">卸除已發行之發行項的資料行時，請考慮會影響資料庫的任何條件約束、索引或資料行屬性。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-175">When dropping a column from a published article, take into consideration any constraints, indexes, or properties of the column that could affect the database.</span></span> <span data-ttu-id="d4aa6-176">例如：</span><span class="sxs-lookup"><span data-stu-id="d4aa6-176">For example:</span></span>  
  
    -   <span data-ttu-id="d4aa6-177">您無法從交易式發行集的發行項中卸除使用於主索引鍵的資料行，因為它們由複寫使用。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-177">You cannot drop columns used in a primary key from articles in transactional publications, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="d4aa6-178">無法從合併式發行集的發行項中卸除 rowguid 資料行，或從支援更新訂閱之交易式發行集的發行項中卸除 mstran_repl_version 資料行，因為它們由複寫使用。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-178">You cannot drop the rowguid column from articles in merge publications or the mstran_repl_version column from articles in transactional publications that support updating subscriptions, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="d4aa6-179">索引變更不會傳播至訂閱者：如果您卸除發行者端的資料行，並且卸除相依性條件約束，則不會複寫索引卸除。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-179">Index changes are not propagated to Subscribers: if you drop a column at the Publisher and a dependent index is dropped, the index drop is not replicated.</span></span> <span data-ttu-id="d4aa6-180">您必須先卸除訂閱者端的索引，然後卸除發行者端的資料行，如此一來，從發行者複寫至訂閱者時才會成功將資料行卸除。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-180">You should drop the index at the Subscriber before dropping the column at the Publisher, so that the column drop succeeds when it is replicated from the Publisher to the Subscriber.</span></span> <span data-ttu-id="d4aa6-181">如果同步處理因訂閱者端的索引而失敗，請手動卸除索引，然後重新執行合併代理程式。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-181">If synchronization fails because of an index at the Subscriber, manually drop the index and then rerun the Merge Agent.</span></span>  
  
    -   <span data-ttu-id="d4aa6-182">條件約束應明確命名，才能允許卸除。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-182">Constraints should be explicitly named to allow for dropping.</span></span> <span data-ttu-id="d4aa6-183">如需詳細資訊，請參閱本主題中的「一般考量」一節。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-183">For more information, see the "General Considerations" section earlier in this topic.</span></span>  
  
### <a name="transactional-replication"></a><span data-ttu-id="d4aa6-184">異動複寫</span><span class="sxs-lookup"><span data-stu-id="d4aa6-184">Transactional Replication</span></span>  
  
-   <span data-ttu-id="d4aa6-185">結構描述變更傳播至執行舊版 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]的「訂閱者」，但是 DDL 陳述式應僅包含「訂閱者」端版本所支援的語法。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-185">Schema changes are propagated to Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], but the DDL statement should only include syntax supported by the version at the Subscriber.</span></span>  
  
     <span data-ttu-id="d4aa6-186">如果「訂閱者」重新發行資料，則唯一受支援的結構描述變更會新增及卸除資料行。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-186">If the Subscriber republishes data, the only supported schema changes are adding and dropping a column.</span></span> <span data-ttu-id="d4aa6-187">應該在「發行者」端使用 [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) 和 [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) 進行這些變更，而不是使用 ALTER TABLE DDL 語法。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-187">These changes should be made on the Publisher using [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) rather than ALTER TABLE DDL syntax.</span></span>  
  
-   <span data-ttu-id="d4aa6-188">結構描述變更不會複寫到非 SQL Server 訂閱者。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-188">Schema changes are not replicated to non-SQL Server Subscribers.</span></span>  
  
-   <span data-ttu-id="d4aa6-189">結構描述變更不會從非[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 發行者傳播。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-189">Schema changes are not propagated from non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publishers.</span></span>  
  
-   <span data-ttu-id="d4aa6-190">您無法改變複寫為資料表的索引檢視表。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-190">You cannot alter indexed views that are replicated as tables.</span></span> <span data-ttu-id="d4aa6-191">複寫為索引檢視的索引檢視可以改變，但是改變它們會使其變成一般的檢視而不是索引檢視。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-191">Indexed views that are replicated as indexed views can be altered, but altering them will cause them to become regular views, rather than indexed views.</span></span>  
  
-   <span data-ttu-id="d4aa6-192">如果發行集支援立即更新或佇列更新訂閱，則在進行結構描述變更之前必須停止系統：已發行資料表上的所有活動必須在「發行者」或「訂閱者」端停止，且暫止資料變更必須傳播至所有節點。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-192">If the publication supports immediate updating or queued updating subscriptions, the system must be quiesced before making schema changes: all activity on the published table must be stopped at the Publisher and Subscribers, and pending data changes must be propagated to all nodes.</span></span> <span data-ttu-id="d4aa6-193">結構描述變更傳播至所有節點之後，可於已發行的資料表上繼續進行活動。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-193">After the schema changes have propagated to all nodes, activity can resume on the published tables.</span></span>  
  
-   <span data-ttu-id="d4aa6-194">如果發行集在點對點拓撲中，則進行結構描述變更前必須停止系統。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-194">If the publication is in a peer-to-peer topology, the system must be quiesced before making schema changes.</span></span> <span data-ttu-id="d4aa6-195">如需詳細資訊，請參閱[停止複寫拓撲 &#40;複寫 Transact-SQL 程式設計&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-195">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
-   <span data-ttu-id="d4aa6-196">將時間戳記資料行新增至資料表並將時間戳記對應至 binary(8)，會造成所有作用中訂閱的發行項重新初始化。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-196">Adding a timestamp column to a table and mapping the timestamp to binary(8) causes the article to be reinitialized for all active subscriptions.</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="d4aa6-197">合併式複寫</span><span class="sxs-lookup"><span data-stu-id="d4aa6-197">Merge Replication</span></span>  
  
-   <span data-ttu-id="d4aa6-198">合併式複寫如何處理結構描述變更是由發行集相容性層級以及快照集是設定為原生模式 (預設值) 還是字元模式而定：</span><span class="sxs-lookup"><span data-stu-id="d4aa6-198">How merge replication handles schema changes is determined by the publication compatibility level, and whether the snapshot is set to native mode (default) or character mode:</span></span>  
  
    -   <span data-ttu-id="d4aa6-199">若要複寫結構描述變更，則發行集的相容性層級必須至少為 90RTM。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-199">To replicate schema changes, the compatibility level of the publication must be at least 90RTM.</span></span> <span data-ttu-id="d4aa6-200">如果訂閱者端執行舊版 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 或相容性層級小於 90RTM，則可以使用 [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) 和 [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) 新增及卸除資料行。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-200">If Subscribers are running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or the compatibility level is less than 90RTM you can use [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) to add and drop columns.</span></span> <span data-ttu-id="d4aa6-201">不過，這些程序都已被取代。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-201">However, these procedures are deprecated.</span></span>  
  
    -   <span data-ttu-id="d4aa6-202">如果您嘗試將具有 [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)]中導入之資料類型的資料行加入到現有發行項， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 便具有以下行為：</span><span class="sxs-lookup"><span data-stu-id="d4aa6-202">If you try to add to an existing article a column with a data type that was introduced in [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has the following behavior:</span></span>  
  
        ||<span data-ttu-id="d4aa6-203">100RTM，原生快照集</span><span class="sxs-lookup"><span data-stu-id="d4aa6-203">100RTM, native snapshot</span></span>|<span data-ttu-id="d4aa6-204">100RTM，字元快照集</span><span class="sxs-lookup"><span data-stu-id="d4aa6-204">100RTM, character snapshot</span></span>|<span data-ttu-id="d4aa6-205">所有其他相容性層級</span><span class="sxs-lookup"><span data-stu-id="d4aa6-205">All other compatibility levels</span></span>|  
        |-|-----------------------------|--------------------------------|------------------------------------|  
        |`hierarchyid`|<span data-ttu-id="d4aa6-206">允許變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-206">Allow change</span></span>|<span data-ttu-id="d4aa6-207">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-207">Block change</span></span>|<span data-ttu-id="d4aa6-208">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-208">Block change</span></span>|  
        |<span data-ttu-id="d4aa6-209">`geography` 和 `geometry`</span><span class="sxs-lookup"><span data-stu-id="d4aa6-209">`geography` and `geometry`</span></span>|<span data-ttu-id="d4aa6-210">允許變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-210">Allow change</span></span>|<span data-ttu-id="d4aa6-211">允許變更<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="d4aa6-211">Allow change<sup>1</sup></span></span>|<span data-ttu-id="d4aa6-212">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-212">Block change</span></span>|  
        |`filestream`|<span data-ttu-id="d4aa6-213">允許變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-213">Allow change</span></span>|<span data-ttu-id="d4aa6-214">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-214">Block change</span></span>|<span data-ttu-id="d4aa6-215">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-215">Block change</span></span>|  
        |<span data-ttu-id="d4aa6-216">`date`、`time`、`datetime2` 和 `datetimeoffset`</span><span class="sxs-lookup"><span data-stu-id="d4aa6-216">`date`, `time`, `datetime2`, and `datetimeoffset`</span></span>|<span data-ttu-id="d4aa6-217">允許變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-217">Allow change</span></span>|<span data-ttu-id="d4aa6-218">允許變更<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="d4aa6-218">Allow change<sup>1</sup></span></span>|<span data-ttu-id="d4aa6-219">封鎖變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-219">Block change</span></span>|  
  
         <span data-ttu-id="d4aa6-220"><sup>1</sup> SQL Server Compact 訂閱者在訂閱者端轉換這些資料類型。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-220"><sup>1</sup> SQL Server Compact Subscribers convert these data types at the Subscriber.</span></span>  
  
-   <span data-ttu-id="d4aa6-221">如果套用結構描述變更時發生錯誤 (例如，因為新增參考了「訂閱者」端上不可用之資料表的外部索引鍵而發生的錯誤)，則同步處理會失敗且必須重新初始化訂閱)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-221">If an error occurs when applying a schema change (such as an error resulting from adding a foreign key that references a table not available at the Subscriber), synchronization fails and the subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="d4aa6-222">如果在聯結篩選或參數化篩選涉及的資料行上進行結構描述變更，則必須重新初始化所有訂閱並重新產生快照集。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-222">If a schema change is made on a column involved in a join filter or parameterized filter, you must reinitialize all subscriptions and regenerate the snapshot.</span></span>  
  
-   <span data-ttu-id="d4aa6-223">合併式複寫會提供預存程序，以在疑難排解期間略過結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-223">Merge replication provides stored procedures to skip schema changes during troubleshooting.</span></span> <span data-ttu-id="d4aa6-224">如需詳細資訊，請參閱 [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) 和 [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d4aa6-224">For more information, see [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) and [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d4aa6-225">另請參閱</span><span class="sxs-lookup"><span data-stu-id="d4aa6-225">See Also</span></span>  
 <span data-ttu-id="d4aa6-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span></span>  
 <span data-ttu-id="d4aa6-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span></span>  
 <span data-ttu-id="d4aa6-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span></span>  
 <span data-ttu-id="d4aa6-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span></span>  
 <span data-ttu-id="d4aa6-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span></span>  
 <span data-ttu-id="d4aa6-231">[發行資料和資料庫物件](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="d4aa6-231">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 [<span data-ttu-id="d4aa6-232">重新產生自訂交易程序以反映結構描述變更</span><span class="sxs-lookup"><span data-stu-id="d4aa6-232">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>](../transactional/transactional-articles-regenerate-to-reflect-schema-changes.md)  
  
  
