---
title: 透過 FTP 傳遞快照集 | Microsoft 文件
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], FTP snapshots
- FTP snapshots [SQL Server replication]
- snapshot replication [SQL Server], FTP
ms.assetid: 99872c4f-40ce-4405-8fd4-44052d3bd827
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2e6700e6989a5a7e32202a0710bc663978a136cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87592617"
---
# <a name="deliver-a-snapshot-through-ftp"></a><span data-ttu-id="51d5b-102">透過 FTP 傳遞快照集</span><span class="sxs-lookup"><span data-stu-id="51d5b-102">Deliver a Snapshot Through FTP</span></span>
  <span data-ttu-id="51d5b-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 或 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ，在 [!INCLUDE[tsql](../../../includes/tsql-md.md)]中透過 FTP 傳遞快照集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-103">This topic describes how to deliver a snapshot through FTP in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span>  
  
##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="51d5b-104">限制事項</span><span class="sxs-lookup"><span data-stu-id="51d5b-104">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="51d5b-105">快照集代理程式必須有您指定之目錄的寫入權限，而散發代理程式或合併代理程式則必須有讀取權限。</span><span class="sxs-lookup"><span data-stu-id="51d5b-105">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="51d5b-106">如果使用提取訂閱，則您必須指定共用目錄為通用命名慣例 (UNC) 路徑，例如 \\\ftpserver\home\snapshots。</span><span class="sxs-lookup"><span data-stu-id="51d5b-106">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="51d5b-107">如需詳細資訊，請參閱[保護快照集資料夾](../security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-107">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="51d5b-108">必要條件</span><span class="sxs-lookup"><span data-stu-id="51d5b-108">Prerequisites</span></span>  
  
-   <span data-ttu-id="51d5b-109">若要使用「檔案傳輸通訊協定」(FTP) 傳送快照集檔案，您必須先設定 FTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="51d5b-109">To transfer snapshot files using File Transfer Protocol (FTP), you must first configure an FTP server.</span></span> <span data-ttu-id="51d5b-110">如需詳細資訊，請參閱 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) 文件集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-110">For more information, see the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) documentation.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="51d5b-111">Security</span><span class="sxs-lookup"><span data-stu-id="51d5b-111">Security</span></span>  
 <span data-ttu-id="51d5b-112">若要改善安全性，我們建議您在透過網際網路使用 FTP 快照集傳遞時，實作虛擬私人網路 (VPN)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-112">To help improve security, we recommend that you implement a virtual private network (VPN) when using FTP snapshot delivery over the Internet.</span></span> <span data-ttu-id="51d5b-113">如需詳細資訊，請參閱[使用 VPN 透過網際網路發行資料](../publish-data-over-the-internet-using-vpn.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-113">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
 <span data-ttu-id="51d5b-114">最佳安全性作法是不允許匿名登入 FTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="51d5b-114">As a security best practice, do not allow anonymous logins to the FTP server.</span></span> <span data-ttu-id="51d5b-115">快照集代理程式必須有您指定之目錄的寫入權限，而散發代理程式或合併代理程式則必須有讀取權限。</span><span class="sxs-lookup"><span data-stu-id="51d5b-115">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="51d5b-116">如果使用提取訂閱，則您必須指定共用目錄為通用命名慣例 (UNC) 路徑，例如 \\\ftpserver\home\snapshots。</span><span class="sxs-lookup"><span data-stu-id="51d5b-116">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="51d5b-117">如需詳細資訊，請參閱[保護快照集資料夾](../security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-117">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="51d5b-118">可能的話，會在執行階段提示使用者輸入其認證。</span><span class="sxs-lookup"><span data-stu-id="51d5b-118">When possible, prompt users to enter their credentials at runtime.</span></span> <span data-ttu-id="51d5b-119">如果將認證儲存在指令碼檔案中，您必須維護此檔案的安全。</span><span class="sxs-lookup"><span data-stu-id="51d5b-119">If you store credentials in a script file, you must secure the file.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="51d5b-120">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="51d5b-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="51d5b-121">設定 FTP 伺服器之後，請在 [發行集屬性 \<Publication>] 對話方塊中，指定此伺服器的目錄與安全性資訊。</span><span class="sxs-lookup"><span data-stu-id="51d5b-121">After the FTP server is configured, specify directory and security information for this server in the **Publication Properties \<Publication>** dialog box.</span></span> <span data-ttu-id="51d5b-122">如需有關存取這個對話方塊的詳細資訊，請參閱＜ [View and Modify Publication Properties](view-and-modify-publication-properties.md)＞。</span><span class="sxs-lookup"><span data-stu-id="51d5b-122">For more information about accessing this dialog box, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-ftp-information"></a><span data-ttu-id="51d5b-123">若要指定 FTP 資訊</span><span class="sxs-lookup"><span data-stu-id="51d5b-123">To specify FTP information</span></span>  
  
1.  <span data-ttu-id="51d5b-124">從下列其中一個頁面的 [發行集屬性 - \<Publication>]  對話方塊中，選取 [允許訂閱者使用 FTP 下載快照集檔案]：</span><span class="sxs-lookup"><span data-stu-id="51d5b-124">In the **Publication Properties - \<Publication>** dialog box, select **Allow Subscribers to download snapshot files using FTP** from one of the following pages:</span></span>   
    -   <span data-ttu-id="51d5b-125">[FTP 快照集] 頁面，適用於快照式和交易式發行集，以及執行 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 之前版本的「發行者」所用合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-125">The **FTP Snapshot** page, for snapshot and transactional publications, and merge publications for Publishers running versions prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>    
    -   <span data-ttu-id="51d5b-126">**[FTP 快照集和網際網路]** 頁面，適用於執行 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本「發行者」的合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-126">The **FTP Snapshot and Internet** page, for merge publications from Publishers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>    
2.  <span data-ttu-id="51d5b-127">指定 **[FTP 伺服器名稱]** 、 **[通訊埠編號]** 、 **[FTP 根資料夾的路徑]** 、 **[登入]** 以及 **[密碼]** 的值。</span><span class="sxs-lookup"><span data-stu-id="51d5b-127">Specify values for **FTP server name**, **Port number**, **Path from the FTP root folder**, **Login**, and **Password**.</span></span>    
     <span data-ttu-id="51d5b-128">例如，如果 FTP 伺服器根目錄為 \\\ftpserver\home，而您想將快照集儲存在 \\\ftpserver\home\snapshots 中，請將 [FTP 根資料夾的路徑] 屬性指定為 \snapshots\ftp (複寫會在建立快照集檔案時，在快照集資料夾路徑後加上 'ftp')。</span><span class="sxs-lookup"><span data-stu-id="51d5b-128">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify \snapshots\ftp for the property **Path from the FTP root folder** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
3.  <span data-ttu-id="51d5b-129">指定快照集代理程式應該將快照集檔案複製到步驟 2 中指定的目錄。</span><span class="sxs-lookup"><span data-stu-id="51d5b-129">Specify that the Snapshot Agent should write the snapshot files to the directory specified in step 2.</span></span> <span data-ttu-id="51d5b-130">例如，若要讓快照集代理程式將快照集檔案寫入到 \\\ftpserver\home\snapshots\ftp 中，您必須在以下兩處位置的其中一處指定路徑 \\\ftpserver\home\snapshots：</span><span class="sxs-lookup"><span data-stu-id="51d5b-130">For example, to have the Snapshot Agent write the snapshot files to \\\ftpserver\home\snapshots\ftp, you must specify the path \\\ftpserver\home\snapshots in one of two places:</span></span>    
    -   <span data-ttu-id="51d5b-131">與此發行集相關的「散發者」的預設快照集位置。</span><span class="sxs-lookup"><span data-stu-id="51d5b-131">The default snapshot location for the Distributor associated with this publication.</span></span>    
         <span data-ttu-id="51d5b-132">如需指定預設快照集位置的詳細資訊，請參閱[指定預設快照集位置](../snapshot-options.md#snapshot-folder-locations)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-132">For more information about specifying the default snapshot location, see [Specify the Default Snapshot Location](../snapshot-options.md#snapshot-folder-locations).</span></span>    
    -   <span data-ttu-id="51d5b-133">此發行集的替代快照集資料夾位置。</span><span class="sxs-lookup"><span data-stu-id="51d5b-133">An alternate snapshot folder location for this publication.</span></span> <span data-ttu-id="51d5b-134">如果壓縮快照集，則需要替代位置。</span><span class="sxs-lookup"><span data-stu-id="51d5b-134">An alternate location is required if the snapshot is compressed.</span></span>    
         <span data-ttu-id="51d5b-135">在 [**發行集屬性- \<Publication> \*\* ] 對話方塊的 [快照集] 頁面上，于 [將檔案**放在下列資料夾\*\*中] 文字方塊中輸入路徑。</span><span class="sxs-lookup"><span data-stu-id="51d5b-135">Enter the path in the **Put files in the following folder** textbox on the Snapshot page of the **Publication Properties - \<Publication>** dialog box.</span></span>   
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="51d5b-136">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="51d5b-136">Using Transact-SQL</span></span>  
 <span data-ttu-id="51d5b-137">可以設定讓快照集檔案可在 FTP 伺服器上使用的選項，而且可以透過程式設計方式使用複寫預存程序來修改這些 FTP 設定。</span><span class="sxs-lookup"><span data-stu-id="51d5b-137">The option to make snapshot files available on an FTP server can be set and these FTP settings can be modified programmatically using replication stored procedures.</span></span> <span data-ttu-id="51d5b-138">使用的程序取決於發行集的類型而定。</span><span class="sxs-lookup"><span data-stu-id="51d5b-138">The procedure used depends on the type of publication.</span></span> <span data-ttu-id="51d5b-139">FTP 快照集傳遞只會搭配提取訂閱一起使用。</span><span class="sxs-lookup"><span data-stu-id="51d5b-139">FTP snapshot delivery is only used with pull subscriptions.</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="51d5b-140">針對快照式或交易式發行集啟用 FTP 快照集傳遞</span><span class="sxs-lookup"><span data-stu-id="51d5b-140">To enable FTP snapshot delivery for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="51d5b-141">在發行集資料庫的發行者上，執行 [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-141">At the Publisher on the publication database, execute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="51d5b-142">指定 **@publication** 、的值 `true` **@enabled_for_internet** ，以及下列參數的適當值：</span><span class="sxs-lookup"><span data-stu-id="51d5b-142">Specify **@publication**, a value of `true` for **@enabled_for_internet**, and appropriate values for the following parameters:</span></span>    
    -   <span data-ttu-id="51d5b-143">**@ftp_address**-用來傳遞快照集之 FTP 伺服器的位址。</span><span class="sxs-lookup"><span data-stu-id="51d5b-143">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="51d5b-144"> (選擇性) **@ftp_port** -FTP 伺服器所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="51d5b-144">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-145"> (選擇性) **@ftp_subdirectory** -指派給 ftp 登入之預設 ftp 目錄的子目錄。</span><span class="sxs-lookup"><span data-stu-id="51d5b-145">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="51d5b-146">例如，如果 FTP 伺服器根目錄是 \ftpserver\home， \\ 而您想要將快照集儲存在 \\ \ftpserver\home\snapshots 上，請指定**為 \snapshots\ftp**做為 (複寫在建立快照集檔案時，將 **@ftp_subdirectory** ' FTP ' 附加至快照集資料夾路徑) 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-146">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="51d5b-147"> (選用 **@ftp_login** 的) -連接到 FTP 伺服器時所使用的登入帳戶。</span><span class="sxs-lookup"><span data-stu-id="51d5b-147">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-148"> (選擇性) **@ftp_password** -FTP 登入的密碼。</span><span class="sxs-lookup"><span data-stu-id="51d5b-148">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="51d5b-149">這會建立使用 FTP 的發行集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-149">This creates a publication that uses FTP.</span></span> <span data-ttu-id="51d5b-150">如需詳細資訊，請參閱[建立發行集](create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-150">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-merge-publication"></a><span data-ttu-id="51d5b-151">針對合併式發行集啟用 FTP 快照集傳遞</span><span class="sxs-lookup"><span data-stu-id="51d5b-151">To enable FTP snapshot delivery for a merge publication</span></span>  
  
1.  <span data-ttu-id="51d5b-152">在發行集資料庫的發行者上，執行 [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-152">At the Publisher on the publication database, execute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="51d5b-153">**@publication**針對下列參數指定、的值 `true` **@enabled_for_internet** 和適當的值：</span><span class="sxs-lookup"><span data-stu-id="51d5b-153">Specify **@publication**, a value of `true` for **@enabled_for_internet** and appropriate values for the following parameters:</span></span>  
  
    -   <span data-ttu-id="51d5b-154">**@ftp_address**-用來傳遞快照集之 FTP 伺服器的位址。</span><span class="sxs-lookup"><span data-stu-id="51d5b-154">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="51d5b-155"> (選擇性) **@ftp_port** -FTP 伺服器所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="51d5b-155">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-156"> (選擇性) **@ftp_subdirectory** -指派給 ftp 登入之預設 ftp 目錄的子目錄。</span><span class="sxs-lookup"><span data-stu-id="51d5b-156">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="51d5b-157">例如，如果 FTP 伺服器根目錄是 \ftpserver\home， \\ 而您想要將快照集儲存在 \\ \ftpserver\home\snapshots 上，請指定**為 \snapshots\ftp**做為 (複寫在建立快照集檔案時，將 **@ftp_subdirectory** ' FTP ' 附加至快照集資料夾路徑) 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-157">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="51d5b-158"> (選用 **@ftp_login** 的) -連接到 FTP 伺服器時所使用的登入帳戶。</span><span class="sxs-lookup"><span data-stu-id="51d5b-158">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-159"> (選擇性) **@ftp_password** -FTP 登入的密碼。</span><span class="sxs-lookup"><span data-stu-id="51d5b-159">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="51d5b-160">這會建立使用 FTP 的發行集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-160">This creates a publication that uses FTP.</span></span> <span data-ttu-id="51d5b-161">如需詳細資訊，請參閱[建立發行集](create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-161">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="51d5b-162">針對使用 FTP 快照集傳遞的快照式或交易式發行集建立提取訂閱</span><span class="sxs-lookup"><span data-stu-id="51d5b-162">To create a pull subscription to a snapshot or transactional publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="51d5b-163">在訂閱資料庫的訂閱者上，執行 [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-163">At the Subscriber on the subscription database, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="51d5b-164">指定 **@publisher** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-164">Specify **@publisher** and **@publication**.</span></span>  
  
    -   <span data-ttu-id="51d5b-165">在訂閱資料庫的訂閱者上，執行 [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-165">At the Subscriber on the subscription database, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="51d5b-166">指定 **@publisher** 、 **@publisher_db** 、 **@publication** 、在 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 訂閱者上執行散發代理程式的 Windows 認證，以及的 **@job_login** **@job_password** 值 `true` **@use_ftp** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-166">Specify **@publisher**, **@publisher_db**, **@publication**, the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>  
  
2.  <span data-ttu-id="51d5b-167">在發行集資料庫的發行者上，執行 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) ，以註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="51d5b-167">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="51d5b-168">如需詳細資訊，請參閱 [建立提取訂閱](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-168">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="51d5b-169">針對使用 FTP 快照集傳遞的合併式發行集建立提取訂閱</span><span class="sxs-lookup"><span data-stu-id="51d5b-169">To create a pull subscription to a merge publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="51d5b-170">在訂閱資料庫的訂閱者上，執行 [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-170">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="51d5b-171">指定 **@publisher** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-171">Specify **@publisher** and **@publication**.</span></span>   
2.  <span data-ttu-id="51d5b-172">在訂閱資料庫的訂閱者上，執行 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-172">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="51d5b-173">指定 **@publisher** 、 **@publisher_db** 、 **@publication** 、在訂閱者上執行散發代理程式的 Windows 認證，以及的 **@job_login** **@job_password** 值 `true` **@use_ftp** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-173">Specify **@publisher**, **@publisher_db**, **@publication**, the Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>    
3.  <span data-ttu-id="51d5b-174">在發行集資料庫的發行者上，執行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) ，以註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="51d5b-174">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="51d5b-175">如需詳細資訊，請參閱 [建立提取訂閱](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-175">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-change-one-or-more-ftp-snapshot-delivery-settings-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="51d5b-176">針對快照式或交易式發行集變更一個或多個 FTP 快照集傳遞設定</span><span class="sxs-lookup"><span data-stu-id="51d5b-176">To change one or more FTP snapshot delivery settings for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="51d5b-177">在發行集資料庫的發行者上，執行 [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-177">At the Publisher on the publication database, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span></span> <span data-ttu-id="51d5b-178">針對指定下列其中一個值 **@property** ，並針對使用此設定的新值 **@value** ：</span><span class="sxs-lookup"><span data-stu-id="51d5b-178">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>    
    -   <span data-ttu-id="51d5b-179">`ftp_address` - 用於傳遞快照集之 FTP 伺服器的位址。</span><span class="sxs-lookup"><span data-stu-id="51d5b-179">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="51d5b-180">`ftp_port` - FTP 伺服器所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="51d5b-180">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-181">`ftp_subdirectory` - 用於 FTP 快照集之預設 FTP 目錄的子目錄。</span><span class="sxs-lookup"><span data-stu-id="51d5b-181">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>    
    -   <span data-ttu-id="51d5b-182">`ftp_login` - 用於連接 FTP 伺服器的登入。</span><span class="sxs-lookup"><span data-stu-id="51d5b-182">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-183">`ftp_password` - FTP 登入的密碼。</span><span class="sxs-lookup"><span data-stu-id="51d5b-183">`ftp_password` - the password for the FTP login.</span></span>  
  
2.  <span data-ttu-id="51d5b-184">(選擇性) 針對變更的每一個 FTP 設定重複步驟 1。</span><span class="sxs-lookup"><span data-stu-id="51d5b-184">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="51d5b-185">(選擇性) 若要停用 FTP 快照集傳遞，請在發行集資料庫的發行者上執行 [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-185">(Optional) To disable FTP snapshot delivery, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="51d5b-186">針對指定的值 `enabled_for_internet` **@property** ，並將的值指定 `false` 為 **@value** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-186">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
#### <a name="to-change-ftp-snapshot-delivery-settings-for-a-merge-publication"></a><span data-ttu-id="51d5b-187">針對合併式發行集變更 FTP 快照集傳遞設定</span><span class="sxs-lookup"><span data-stu-id="51d5b-187">To change FTP snapshot delivery settings for a merge publication</span></span>  
  
1.  <span data-ttu-id="51d5b-188">在發行集資料庫的發行者上，執行 [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-188">At the Publisher on the publication database, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span></span> <span data-ttu-id="51d5b-189">針對指定下列其中一個值 **@property** ，並針對使用此設定的新值 **@value** ：</span><span class="sxs-lookup"><span data-stu-id="51d5b-189">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>  
  
    -   <span data-ttu-id="51d5b-190">`ftp_address` - 用於傳遞快照集之 FTP 伺服器的位址。</span><span class="sxs-lookup"><span data-stu-id="51d5b-190">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="51d5b-191">`ftp_port` - FTP 伺服器所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="51d5b-191">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-192">`ftp_subdirectory` - 用於 FTP 快照集之預設 FTP 目錄的子目錄。</span><span class="sxs-lookup"><span data-stu-id="51d5b-192">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>   
    -   <span data-ttu-id="51d5b-193">`ftp_login` - 用於連接 FTP 伺服器的登入。</span><span class="sxs-lookup"><span data-stu-id="51d5b-193">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="51d5b-194">`ftp_password` - FTP 登入的密碼。</span><span class="sxs-lookup"><span data-stu-id="51d5b-194">`ftp_password` - the password for the FTP login.</span></span>    
2.  <span data-ttu-id="51d5b-195">(選擇性) 針對變更的每一個 FTP 設定重複步驟 1。</span><span class="sxs-lookup"><span data-stu-id="51d5b-195">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="51d5b-196">(選擇性) 若要停用 FTP 快照集傳遞，請在發行集資料庫的發行者上執行 [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-196">(Optional) To disable FTP snapshot delivery, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="51d5b-197">針對指定的值 `enabled_for_internet` **@property** ，並將的值指定 `false` 為 **@value** 。</span><span class="sxs-lookup"><span data-stu-id="51d5b-197">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="51d5b-198">範例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="51d5b-198">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="51d5b-199">下列範例會建立允許訂閱者的合併式發行集，以使用 FTP 存取快照集資料。</span><span class="sxs-lookup"><span data-stu-id="51d5b-199">The following example creates a merge publication that allows Subscribers to access the snapshot data using FTP.</span></span> <span data-ttu-id="51d5b-200">當訂閱者存取 FTP 共用位置時，應該使用安全 VPN 連接。</span><span class="sxs-lookup"><span data-stu-id="51d5b-200">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="51d5b-201">**sqlcmd** 指令碼變數是用來提供登入和密碼值。</span><span class="sxs-lookup"><span data-stu-id="51d5b-201">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="51d5b-202">如需詳細資訊，請參閱[以指令碼變數使用 sqlcmd](../../scripting/sqlcmd-use-with-scripting-variables.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-202">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubftp.sql#sp_createmergepub_ftp)]  
  
 <span data-ttu-id="51d5b-203">下列範例會建立合併式發行集的訂閱，其中的訂閱者會使用 FTP 取得快照集。</span><span class="sxs-lookup"><span data-stu-id="51d5b-203">The following example creates a subscription to a merge publication, where the Subscriber obtains the snapshot using FTP.</span></span> <span data-ttu-id="51d5b-204">當訂閱者存取 FTP 共用位置時，應該使用安全 VPN 連接。</span><span class="sxs-lookup"><span data-stu-id="51d5b-204">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="51d5b-205">**sqlcmd** 指令碼變數是用來提供登入和密碼值。</span><span class="sxs-lookup"><span data-stu-id="51d5b-205">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="51d5b-206">如需詳細資訊，請參閱[以指令碼變數使用 sqlcmd](../../scripting/sqlcmd-use-with-scripting-variables.md)。</span><span class="sxs-lookup"><span data-stu-id="51d5b-206">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepullsub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsub_ftp)]  
  
 [!code-sql[HowTo#sp_createmergepullsubagent_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsubagent_ftp)]  
  
## <a name="see-also"></a><span data-ttu-id="51d5b-207">另請參閱</span><span class="sxs-lookup"><span data-stu-id="51d5b-207">See Also</span></span>  
 <span data-ttu-id="51d5b-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="51d5b-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="51d5b-209">[透過 FTP 傳送快照集](../transfer-snapshots-through-ftp.md) </span><span class="sxs-lookup"><span data-stu-id="51d5b-209">[Transfer Snapshots Through FTP](../transfer-snapshots-through-ftp.md) </span></span>  
 <span data-ttu-id="51d5b-210">[變更發行集與發行項屬性](change-publication-and-article-properties.md) </span><span class="sxs-lookup"><span data-stu-id="51d5b-210">[Change Publication and Article Properties](change-publication-and-article-properties.md) </span></span>  
 [<span data-ttu-id="51d5b-211">使用快照集初始化訂閱</span><span class="sxs-lookup"><span data-stu-id="51d5b-211">Initialize a Subscription with a Snapshot</span></span>](../initialize-a-subscription-with-a-snapshot.md)  
  
  
