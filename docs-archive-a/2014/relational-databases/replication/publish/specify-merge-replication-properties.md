---
title: 指定合併式複寫屬性 |Microsoft Docs
ms.custom: ''
ms.date: 11/29/2018
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication [SQL Server replication], about merge replication
- merge replication [SQL Server replication]
ms.assetid: ff87c368-4c00-4e48-809d-ea752839551e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3b2e66b7ed26420093166445a478bfec7f1dd21d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87704042"
---
# <a name="specify-merge-replication-properties"></a><span data-ttu-id="7b33c-102">指定合併式複寫屬性</span><span class="sxs-lookup"><span data-stu-id="7b33c-102">Specify Merge Replication Properties</span></span>
<span data-ttu-id="7b33c-103">本主題說明如何為合併式複寫指定各種屬性。</span><span class="sxs-lookup"><span data-stu-id="7b33c-103">This topic explains how to specify various properties for your merge replication.</span></span> 


## <a name="download-only"></a><span data-ttu-id="7b33c-104">僅限下載</span><span class="sxs-lookup"><span data-stu-id="7b33c-104">Download-only</span></span>
  <span data-ttu-id="7b33c-105">本節描述如何使用或，在中指定合併資料表發行項僅限下載 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] [!INCLUDE[tsql](../../../includes/tsql-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-105">This section describes how to specify that a merge table article is download-only in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="7b33c-106">僅限下載發行項的設計是要供包含未在訂閱者上更新之資料的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="7b33c-106">Download-only articles are designed for applications with data that is not updated at Subscribers.</span></span> <span data-ttu-id="7b33c-107">如需詳細資訊，請參閱[使用僅限下載的發行項最佳化合併式複寫效能](../merge/optimize-merge-replication-performance-with-download-only-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-107">For more information, see [Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span></span>  
 
  
###  <a name="limitations-and-restrictions"></a><span data-ttu-id="7b33c-108">限制事項</span><span class="sxs-lookup"><span data-stu-id="7b33c-108">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="7b33c-109">如果您在初始化訂閱之後指定發行項僅限下載，則所有收到該發行項的客訂閱都必須重新初始化。</span><span class="sxs-lookup"><span data-stu-id="7b33c-109">If you specify that an article is download-only after subscriptions have been initialized, all client subscriptions that received the article must be reinitialized.</span></span> <span data-ttu-id="7b33c-110">主訂閱則不需要重新初始化。</span><span class="sxs-lookup"><span data-stu-id="7b33c-110">Server subscriptions do not have to be reinitialized.</span></span> <span data-ttu-id="7b33c-111">如需屬性變更效果的詳細資訊，請參閱[變更發行集與發行項屬性](change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-111">For more information on the effects of property changes, see [Change Publication and Article Properties](change-publication-and-article-properties.md).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="7b33c-112">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="7b33c-112">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="7b33c-113">在 [新增發行集嚮導] 或 [發行項**屬性- \<Article> \*\* ] 對話方塊的 [**屬性\*\*] 索引標籤的 [發行項 **] 頁面上，指定**發行項僅限下載。</span><span class="sxs-lookup"><span data-stu-id="7b33c-113">Specify that an article is download-only on the **Articles** page of the New Publication Wizard or the **Properties** tab of the **Article Properties - \<Article>** dialog box.</span></span> <span data-ttu-id="7b33c-114">[新增發行集精靈] 與 [發行集屬性 - \<Publication>] 對話方塊中都有此對話方塊。</span><span class="sxs-lookup"><span data-stu-id="7b33c-114">This dialog box is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="7b33c-115">如需使用精靈及存取對話方塊的詳細資訊，請參閱[建立發行集](../publish/create-a-publication.md)和[檢視及修改發行集屬性](../publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-115">For more information about using the wizard and accessing the dialog box, see [Create a Publication](../publish/create-a-publication.md) and [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-that-an-article-is-download-only-on-the-articles-page"></a><span data-ttu-id="7b33c-116">在發行項頁面上指定發行項僅限下載</span><span class="sxs-lookup"><span data-stu-id="7b33c-116">To specify that an article is download-only on the Articles page</span></span>  
  
-   <span data-ttu-id="7b33c-117">在「新增發行集精靈」的 **[發行項]** 頁面上選取資料表，然後選取 **[反白的資料表僅限下載]** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-117">On the **Articles** page of the New Publication Wizard select a table, and then select the checkbox **Highlighted table is download-only**.</span></span> 
  
#### <a name="to-specify-that-an-article-is-download-only-on-the-properties-tab-of-the-article-properties---article-dialog-box"></a><span data-ttu-id="7b33c-118">若要在 [發行項屬性-] 對話方塊的 [屬性] 索引標籤上指定發行項僅限下載 \<Article></span><span class="sxs-lookup"><span data-stu-id="7b33c-118">To specify that an article is download-only on the Properties tab of the Article Properties - \<Article> dialog box</span></span>  
  
1.  <span data-ttu-id="7b33c-119">在 [新增發行集] 精靈的 [發行項] 頁面上，或是在 [發行集屬性 - \<Publication>] 對話方塊中，選取一個資料表，然後按一下 [發行項屬性]。</span><span class="sxs-lookup"><span data-stu-id="7b33c-119">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table, and then click **Article Properties**.</span></span>    
2.  <span data-ttu-id="7b33c-120">按一下 **[設定反白顯示資料表發行項的屬性]** 或 **[設定所有資料表發行項的屬性]** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-120">Click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>    
3.  <span data-ttu-id="7b33c-121">在 [發行項屬性 - \<Article>] 對話方塊之 [屬性] 索引標籤的 [目的地物件] 區段中，針對 [同步處理方向] 指定下列其中一個值：</span><span class="sxs-lookup"><span data-stu-id="7b33c-121">In the **Destination Object** section of the **Properties** tab of the **Article Properties - \<Article>** dialog box, specify one of the following values for **Synchronization direction**:</span></span>    
    -   <span data-ttu-id="7b33c-122">**[下載至訂閱者，禁止訂閱者變更]**</span><span class="sxs-lookup"><span data-stu-id="7b33c-122">**Download to Subscriber, prohibit Subscriber changes**</span></span>    
    -   <span data-ttu-id="7b33c-123">**[下載至訂閱者，允許訂閱者變更]**</span><span class="sxs-lookup"><span data-stu-id="7b33c-123">**Download to Subscriber, allow Subscriber changes**</span></span>  
  
4.  <span data-ttu-id="7b33c-124">如果您位於 [發行集屬性 - \<Publication>] 對話方塊中，請按一下 [確定] 以儲存並關閉對話方塊。</span><span class="sxs-lookup"><span data-stu-id="7b33c-124">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>    

###  <a name="using-transact-sql"></a><span data-ttu-id="7b33c-125">使用 TRANSACT-SQL</span><span class="sxs-lookup"><span data-stu-id="7b33c-125">Using Transact-SQL</span></span>  
  
#### <a name="to-specify-that-a-new-merge-table-article-is-download-only"></a><span data-ttu-id="7b33c-126">將新的合併資料表發行項指定為僅限下載</span><span class="sxs-lookup"><span data-stu-id="7b33c-126">To specify that a new merge table article is download-only</span></span>    
1.  <span data-ttu-id="7b33c-127">執行[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)，為參數指定**1**或**2**的值\*\* \@ subscriber_upload_options\*\*。</span><span class="sxs-lookup"><span data-stu-id="7b33c-127">Execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), specifying a value of **1** or **2** for the parameter **\@subscriber_upload_options**.</span></span> <span data-ttu-id="7b33c-128">這些數字對應到下列行為：</span><span class="sxs-lookup"><span data-stu-id="7b33c-128">The numbers correspond to the following behavior:</span></span>  
  
    -   <span data-ttu-id="7b33c-129">**0** - 無限制 (預設值)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-129">**0** - No restrictions (default).</span></span> <span data-ttu-id="7b33c-130">在訂閱者端進行的變更會上傳到發行者</span><span class="sxs-lookup"><span data-stu-id="7b33c-130">Changes made at the Subscriber are uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="7b33c-131">**1** - 允許在訂閱者端進行變更，但變更不會上傳到發行者。</span><span class="sxs-lookup"><span data-stu-id="7b33c-131">**1** - Changes are allowed at the Subscriber, but they are not uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="7b33c-132">**2** - 不允許在訂閱者端進行變更。</span><span class="sxs-lookup"><span data-stu-id="7b33c-132">**2** - Changes are not allowed at the Subscriber.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="7b33c-133">如果發行項的來源資料表已經在另一個發行集中發行，則這兩篇文章的\*\* \@ subscriber_upload_options\*\*值必須相同。</span><span class="sxs-lookup"><span data-stu-id="7b33c-133">If the source table for an article is already published in another publication, the value of **\@subscriber_upload_options** must be the same for both articles.</span></span>  
  
#### <a name="to-modify-an-existing-merge-table-article-to-be-download-only"></a><span data-ttu-id="7b33c-134">將現有的合併資料表發行項修改為僅限下載</span><span class="sxs-lookup"><span data-stu-id="7b33c-134">To modify an existing merge table article to be download-only</span></span>  
  
1.  <span data-ttu-id="7b33c-135">若要判斷發行項是否為僅限下載，請執行 [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-135">To determine if an article is download-only, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-136">請記下結果集中發行項的 **upload_options** 值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-136">Note the value of **upload_options** for the article in the result set.</span></span>    
2.  <span data-ttu-id="7b33c-137">如果步驟1中傳回的值為**0**，請[執行 sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)，為\*\* \@ 屬性**指定**subscriber_upload_options**的值，針對** \@ force_invalidate_snapshot**和** \@ force_reinit_subscription**指定**1**的值，並針對** \@ value**使用**1**或**2\*\*的值，其對應于下列行為：</span><span class="sxs-lookup"><span data-stu-id="7b33c-137">If the value returned in step 1 is **0**, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql), specifying a value of **subscriber_upload_options** for **\@property**, a value of **1** for **\@force_invalidate_snapshot** and **\@force_reinit_subscription**, and a value of **1** or **2** for **\@value**, which corresponds to the following behavior:</span></span>  
  
    -   <span data-ttu-id="7b33c-138">**1** - 允許在訂閱者端進行變更，但變更不會上傳到發行者。</span><span class="sxs-lookup"><span data-stu-id="7b33c-138">**1** - Changes are allowed at the Subscriber, but they are not uploaded to the Publisher.</span></span>    
    -   <span data-ttu-id="7b33c-139">**2** - 不允許在訂閱者端進行變更。</span><span class="sxs-lookup"><span data-stu-id="7b33c-139">**2** - Changes are not allowed at the Subscriber.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="7b33c-140">如果發行項的來源資料表已在另一個發行集中發行，則兩個發行項的僅限下載行為必須相同。</span><span class="sxs-lookup"><span data-stu-id="7b33c-140">If the source table for an article is already published in another publication, the download-only behavior must be the same for both articles.</span></span>  
 
## <a name=""></a><span data-ttu-id="7b33c-141"><a name="interactive-conflict-resolution">互動式衝突解決</a></span><span class="sxs-lookup"><span data-stu-id="7b33c-141"><a name="interactive-conflict-resolution">Interactive conflict resolution</a></span></span>
[!INCLUDE[msCoName](../../../includes/msconame-md.md)]<span data-ttu-id="7b33c-142">複寫 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 提供互動式解決器，可讓您在中 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 依需求同步處理期間手動解決衝突Windows 同步處理管理員。</span><span class="sxs-lookup"><span data-stu-id="7b33c-142">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] replication provides an Interactive Resolver, which allows you to resolve conflicts manually during on-demand synchronization in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Synchronization Manager.</span></span> <span data-ttu-id="7b33c-143">在啟用互動式解決方案之後，在同步處理期間會使用「互動解決器」以互動方式解決衝突。</span><span class="sxs-lookup"><span data-stu-id="7b33c-143">After interactive resolution is enabled, resolve conflicts interactively during synchronization, using the Interactive Resolver.</span></span> <span data-ttu-id="7b33c-144">互動解決器可以從 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Synchronization Manager 使用。</span><span class="sxs-lookup"><span data-stu-id="7b33c-144">The Interactive Resolver is available through the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Synchronization Manager.</span></span> <span data-ttu-id="7b33c-145">如需詳細資訊，請參閱[使用 Windows Synchronization Manager 同步處理訂閱 &#40;Windows Synchronization Manager&#41;](../synchronize-a-subscription-using-windows-synchronization-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-145">For more information, see [Synchronize a Subscription Using Windows Synchronization Manager &#40;Windows Synchronization Manager&#41;](../synchronize-a-subscription-using-windows-synchronization-manager.md).</span></span>  
  
    
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="7b33c-146">建議</span><span class="sxs-lookup"><span data-stu-id="7b33c-146">Recommendations</span></span>  
  
-   <span data-ttu-id="7b33c-147">如果是在 Windows Synchronization Manager 之外執行同步處理 (如 SQL Server Management Studio 或複寫監視器中已排程的同步處理或視需要同步處理)，則不需要使用者的介入，就會使用針對發行項指定的預設衝突解決方式來自動解決衝突。</span><span class="sxs-lookup"><span data-stu-id="7b33c-147">If a synchronization is performed outside of Windows Synchronization Manager (as a scheduled synchronization or an on demand synchronization in SQL Server Management Studio or Replication Monitor), conflicts are resolved automatically without user intervention, using the default conflict resolution specified for the article.</span></span> <span data-ttu-id="7b33c-148">如需詳細資訊，請參閱 [Interactive Conflict Resolution](../merge/advanced-merge-replication-conflict-interactive-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-148">For more information, see [Interactive Conflict Resolution](../merge/advanced-merge-replication-conflict-interactive-resolution.md).</span></span>  
  
###  <a name="using-sql-server-management-studio"></a><span data-ttu-id="7b33c-149">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="7b33c-149">Using SQL Server Management Studio</span></span>  
  
#### <a name="enable-interactive-conflict-resolution-for-an-article"></a><span data-ttu-id="7b33c-150">為發行項啟用互動式衝突解決</span><span class="sxs-lookup"><span data-stu-id="7b33c-150">Enable interactive conflict resolution for an article</span></span>  
  
1.  <span data-ttu-id="7b33c-151">在 [新增發行集] 精靈的 [發行項] 頁面上，或是在 [發行集屬性 - \<Publication>] 對話方塊中，選取一個資料表。</span><span class="sxs-lookup"><span data-stu-id="7b33c-151">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table.</span></span> <span data-ttu-id="7b33c-152">如需使用精靈及存取對話方塊的詳細資訊，請參閱[建立發行集](create-a-publication.md)和[檢視及修改發行集屬性](view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-152">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>    
2.  <span data-ttu-id="7b33c-153">按一下 **[發行項屬性]** ，然後按一下 **[設定反白顯示資料表發行項的屬性]** 或 **[設定所有資料表發行項的屬性]** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-153">Click **Article Properties**, and then click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>    
3.  <span data-ttu-id="7b33c-154">在 [發行項屬性 - \<Article>] 或 [發行項屬性 - \<ArticleType>] 頁面上，按一下 [解析程式] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="7b33c-154">On the **Article Properties - \<Article>** or **Article Properties - \<ArticleType>** page, click the **Resolver** tab.</span></span>    
4.  <span data-ttu-id="7b33c-155">選取 **[允許訂閱者在依要求同步期間，以互動方式解決衝突]** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-155">Select **Allow Subscriber to resolve conflicts interactively during on-demand synchronization**.</span></span>    
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]    
6.  <span data-ttu-id="7b33c-156">如果您位於 [發行集屬性 - \<Publication>] 對話方塊中，請按一下 [確定] 以儲存並關閉對話方塊。</span><span class="sxs-lookup"><span data-stu-id="7b33c-156">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
#### <a name="to-specify-that-a-subscription-should-use-interactive-conflict-resolution"></a><span data-ttu-id="7b33c-157">若要指定訂閱應使用互動式衝突解決方案</span><span class="sxs-lookup"><span data-stu-id="7b33c-157">To specify that a subscription should use interactive conflict resolution</span></span>  
  
1.  <span data-ttu-id="7b33c-158">在 [訂閱屬性 - \<Subscriber>: \<SubscriptionDatabase>] 對話方塊中，將 [以互動方式解決衝突] 選項的值指定為 **True**。</span><span class="sxs-lookup"><span data-stu-id="7b33c-158">In the **Subscription Properties - \<Subscriber>: \<SubscriptionDatabase>** dialog box, specify a value of **True** for the **Resolve conflicts interactively** option.</span></span> <span data-ttu-id="7b33c-159">如需有關存取這個對話方塊的詳細資訊，請參閱＜ [View and Modify Push Subscription Properties](../view-and-modify-push-subscription-properties.md) ＞與＜ [View and Modify Pull Subscription Properties](../view-and-modify-pull-subscription-properties.md)＞。</span><span class="sxs-lookup"><span data-stu-id="7b33c-159">For more information about accessing this dialog box, see [View and Modify Push Subscription Properties](../view-and-modify-push-subscription-properties.md) and [View and Modify Pull Subscription Properties](../view-and-modify-pull-subscription-properties.md).</span></span> 
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
### <a name="using-transact-sql"></a><span data-ttu-id="7b33c-160">使用 TRANSACT-SQL</span><span class="sxs-lookup"><span data-stu-id="7b33c-160">Using Transact-SQL</span></span>  
 <span data-ttu-id="7b33c-161">您可以透過程式設計方式指定在建立合併式發行集的提取訂閱時，訂閱者將使用此圖形化介面來解決發行項衝突。</span><span class="sxs-lookup"><span data-stu-id="7b33c-161">You can programmatically specify that a Subscriber will use this graphical interface to resolve article conflicts when a pull subscription to a merge publication is created.</span></span> <span data-ttu-id="7b33c-162">只有支援此選項之發行項中的衝突才會顯示在互動式解決器中。</span><span class="sxs-lookup"><span data-stu-id="7b33c-162">Only conflicts in articles that support this option will be displayed in the Interactive Resolver.</span></span>  
  
#### <a name="create-a-merge-pull-subscription-that-uses-the-interactive-resolver"></a><span data-ttu-id="7b33c-163">建立使用互動解析程式的合併提取訂閱</span><span class="sxs-lookup"><span data-stu-id="7b33c-163">Create a merge pull subscription that uses the Interactive Resolver</span></span>  
  
1.  <span data-ttu-id="7b33c-164">在發行集資料庫的發行者上，執行[sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)，並指定\*\* \@ 發行\*\*集。</span><span class="sxs-lookup"><span data-stu-id="7b33c-164">At the Publisher on the publication database, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying **\@publication**.</span></span> <span data-ttu-id="7b33c-165">請記下結果集中每一個發行項的 **allow_interactive_resolver** 值 (互動式解決器將針對它來使用)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-165">Note the value of **allow_interactive_resolver** for each article in the result set for which the Interactive Resolver will be used.</span></span>    
    -   <span data-ttu-id="7b33c-166">如果這個值是 **1**，將會使用互動式解決器。</span><span class="sxs-lookup"><span data-stu-id="7b33c-166">If this value is **1**, the Interactive Resolver will be used.</span></span>    
    -   <span data-ttu-id="7b33c-167">如果這個值是 **0**，您必須先針對每一個發行項啟用互動式解決器。</span><span class="sxs-lookup"><span data-stu-id="7b33c-167">If this value is **0**, you must first enable the Interactive Resolver for each article.</span></span> <span data-ttu-id="7b33c-168">若要執行這項操作，請執行[sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)、指定\*\* \@ 發行**集、發行項、 \*\* \@ 屬性**的**allow_interactive_resolver**值， \*\* \@ **以及** \@ value**的**true\*\*值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-168">To do this, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql), specifying **\@publication**, **\@article**, a value of **allow_interactive_resolver** for **\@property**, and a value of **true** for **\@value**.</span></span>    
2.  <span data-ttu-id="7b33c-169">在訂閱資料庫的訂閱者上，執行 [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-169">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="7b33c-170">如需詳細資訊，請參閱 [建立提取訂閱](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-170">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>    
3.  <span data-ttu-id="7b33c-171">在訂閱資料庫的訂閱者上，執行 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)並指定下列參數：</span><span class="sxs-lookup"><span data-stu-id="7b33c-171">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="7b33c-172">\*\* \@ 發行者**、 \*\* \@ publisher_db** (已發行的資料庫) 和\*\* \@ 發行集。\*\*</span><span class="sxs-lookup"><span data-stu-id="7b33c-172">**\@publisher**, **\@publisher_db** (the published database), and **\@publication**.</span></span>    
    -   <span data-ttu-id="7b33c-173">\*\* \@ Enabled_for_syncmgr**的**true\*\*值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-173">A value of **true** for **\@enabled_for_syncmgr**.</span></span>    
    -   <span data-ttu-id="7b33c-174">\*\* \@ Use_interactive_resolver**的**true\*\*值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-174">A value of **true** for **\@use_interactive_resolver**.</span></span>    
    -   <span data-ttu-id="7b33c-175">合併代理程式所需的安全性帳戶資訊。</span><span class="sxs-lookup"><span data-stu-id="7b33c-175">The security account information required by the Merge Agent.</span></span> <span data-ttu-id="7b33c-176">如需詳細資訊，請參閱 [建立提取訂閱](../create-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-176">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>    
4.  <span data-ttu-id="7b33c-177">在發行集資料庫的發行者上，執行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-177">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span>  
  
#### <a name="define-an-article-that-supports-the-interactive-resolver"></a><span data-ttu-id="7b33c-178">定義支援互動解析程式的發行項</span><span class="sxs-lookup"><span data-stu-id="7b33c-178">Define an article that supports the Interactive Resolver</span></span>  
  
<span data-ttu-id="7b33c-179">在發行集資料庫的發行者上，執行 [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-179">At the Publisher on the publication database, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-180">指定發行項所屬的發行集\*\* \@ 名稱、發行\*\*\*\*項的名稱、用於 \@ \*\* \*\* \@ source_object**的資料庫物件，以及** \@ allow_interactive_resolver**的**true\*\*值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-180">Specify the name of the publication to which the article belongs for **\@publication**, a name for the article for **\@article**, the database object being published for **\@source_object**, and a value of **true** for **\@allow_interactive_resolver**.</span></span> <span data-ttu-id="7b33c-181">如需詳細資訊，請參閱 [定義發行項](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-181">For more information, see [Define an Article](define-an-article.md).</span></span>  

## <a name="specify-the-conflict-tracking-and-resolution-level"></a><span data-ttu-id="7b33c-182">指定衝突追蹤和解決層級</span><span class="sxs-lookup"><span data-stu-id="7b33c-182">Specify the Conflict Tracking and Resolution Level</span></span> 
<span data-ttu-id="7b33c-183">如果同步處理合併式發行集的訂閱，複寫會檢查在發行者和訂閱者上，是否有對相同資料所做之變更所造成的衝突。</span><span class="sxs-lookup"><span data-stu-id="7b33c-183">When a subscription to a merge publication is synchronized, replication checks for conflicts caused by changes to the same data made at both the Publisher and the Subscriber.</span></span> <span data-ttu-id="7b33c-184">您可以指定要在資料列層級偵測衝突 (此時會將資料列的任何變更視為衝突)，或是在資料行層級偵測衝突 (此時只會將相同資料列和資料行的任何變更視為衝突)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-184">You can specify whether conflicts are detected at the row-level, where any change to the row is considered a conflict, or column-level, where only changes to the same row and column are considered a conflict.</span></span> <span data-ttu-id="7b33c-185">發行項的衝突解決會在資料列層級執行。</span><span class="sxs-lookup"><span data-stu-id="7b33c-185">Conflict resolution for articles is performed at the row-level.</span></span> <span data-ttu-id="7b33c-186">如需有關使用邏輯記錄時衝突偵測及解決的詳細資訊，請參閱＜ [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md)＞。</span><span class="sxs-lookup"><span data-stu-id="7b33c-186">For more information about conflict detection and resolution when logical records are used, see [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span></span>  
  

  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="7b33c-187">限制事項</span><span class="sxs-lookup"><span data-stu-id="7b33c-187">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="7b33c-188">如果您在訂閱初始化之後要修改追蹤層級，則這些訂閱必須重新初始化。</span><span class="sxs-lookup"><span data-stu-id="7b33c-188">If you modify the tracking level after subscriptions have been initialized, those subscriptions must be reinitialized.</span></span> <span data-ttu-id="7b33c-189">如需屬性變更效果的詳細資訊，請參閱[變更發行集與發行項屬性](../publish/change-publication-and-article-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-189">For more information about the effects of property changes, see [Change Publication and Article Properties](../publish/change-publication-and-article-properties.md).</span></span>    
-   <span data-ttu-id="7b33c-190">若使用資料列層級追蹤和資料行層級追蹤，則衝突解決始終在資料列層級執行：優先資料列會覆寫失敗資料列。</span><span class="sxs-lookup"><span data-stu-id="7b33c-190">With row- and column-level tracking, conflict resolution is always performed at the row-level: the winning row overwrites the losing row.</span></span> <span data-ttu-id="7b33c-191">合併式複寫還允許您指定在邏輯記錄層級追蹤並解決衝突，但是 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]中並未提供這些選項。</span><span class="sxs-lookup"><span data-stu-id="7b33c-191">Merge replication also allows you to specify that conflicts be tracked and resolved at the logical record level, but these options are not available from [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="7b33c-192">如需這些設定複寫預存程序之選項的詳細資訊，請參閱＜ [定義合併資料表發行項之間的邏輯記錄關聯性](../publish/define-a-logical-record-relationship-between-merge-table-articles.md)＞。</span><span class="sxs-lookup"><span data-stu-id="7b33c-192">For information about setting these options from replication stored procedures, see [Define a Logical Record Relationship Between Merge Table Articles](../publish/define-a-logical-record-relationship-between-merge-table-articles.md).</span></span>  
  
###  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="7b33c-193">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="7b33c-193">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="7b33c-194">在 [發行項屬性] 對話方塊的 [屬性] 索引標籤上，指定合併發行項的資料列層級追蹤或資料行層級追蹤，其會在 [新增發行集] 精靈和 [發行集屬性 - \<Publication>] 對話方塊中提供。</span><span class="sxs-lookup"><span data-stu-id="7b33c-194">Specify row- or column-level tracking for merge articles on the **Properties** tab of the **Article Properties** dialog box, which is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="7b33c-195">如需使用精靈及存取對話方塊的詳細資訊，請參閱[建立發行集](create-a-publication.md)和[檢視及修改發行集屬性](../publish/view-and-modify-publication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-195">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](../publish/view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="specify-row--or-column-level-tracking"></a><span data-ttu-id="7b33c-196">指定資料列層級或資料行層級的追蹤</span><span class="sxs-lookup"><span data-stu-id="7b33c-196">Specify row- or column-level tracking</span></span>  
  
1.  <span data-ttu-id="7b33c-197">在 [新增發行集] 精靈的 [發行項] 頁面上，或是在 [發行集屬性 - \<Publication>] 對話方塊中，選取一個資料表。</span><span class="sxs-lookup"><span data-stu-id="7b33c-197">On the **Articles** page of the New Publication Wizard or the **Publication Properties - \<Publication>** dialog box, select a table.</span></span>    
2.  <span data-ttu-id="7b33c-198">按一下 **[發行項屬性]** ，然後按一下 **[設定反白顯示資料表發行項的屬性]** 或 **[設定所有資料表發行項的屬性]** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-198">Click **Article Properties**, and then click **Set Properties of Highlighted Table Article** or **Set Properties of All Table Articles**.</span></span>   
3.  <span data-ttu-id="7b33c-199">在 [發行項屬性 \<Article>] 對話方塊的 [屬性] 索引標籤上，針對 [追蹤層級] 屬性選取下列其中一個值：[資料列層級追蹤] 或 [資料行層級追蹤]。</span><span class="sxs-lookup"><span data-stu-id="7b33c-199">On the **Properties** tab of the **Article Properties \<Article>** dialog box, select one of the following values for the **Tracking level** property: **Row-level tracking** or **Column-level tracking**.</span></span>    
4.  <span data-ttu-id="7b33c-200">如果您位於 [發行集屬性 - \<Publication>] 對話方塊中，請按一下 [確定] 以儲存並關閉對話方塊。</span><span class="sxs-lookup"><span data-stu-id="7b33c-200">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
###  <a name="using-transact-sql"></a><span data-ttu-id="7b33c-201">使用 TRANSACT-SQL</span><span class="sxs-lookup"><span data-stu-id="7b33c-201">Using Transact-SQL</span></span>  
  
#### <a name="specify-conflict-tracking-options-for-a-new-merge-article"></a><span data-ttu-id="7b33c-202">為新的合併發行項指定衝突追蹤選項</span><span class="sxs-lookup"><span data-stu-id="7b33c-202">Specify conflict tracking options for a new merge article</span></span>  
  
1.  <span data-ttu-id="7b33c-203">在發行集資料庫的發行者上，執行[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) ，並為\*\* \@ column_tracking\*\*指定下列其中一個值：</span><span class="sxs-lookup"><span data-stu-id="7b33c-203">At the Publisher on the publication database, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) and specify one of the following values for **\@column_tracking**:</span></span>  
  
    -   <span data-ttu-id="7b33c-204">**true** - 針對發行項使用資料行層級追蹤。</span><span class="sxs-lookup"><span data-stu-id="7b33c-204">**true** - Use column-level tracking for the article.</span></span>    
    -   <span data-ttu-id="7b33c-205">**false** - 使用資料列層級追蹤，這是預設值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-205">**false** - Use row-level tracking, which is the default.</span></span>  
  
#### <a name="change-conflict-tracking-options-for-a-merge-article"></a><span data-ttu-id="7b33c-206">為合併發行項變更衝突追蹤選項</span><span class="sxs-lookup"><span data-stu-id="7b33c-206">Change conflict tracking options for a merge article</span></span>  
  
1.  <span data-ttu-id="7b33c-207">若要為合併發行項判斷衝突追蹤選項，請執行 [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-207">To determine the conflict tracking options for a merge article, execute [sp_helpmergearticle](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-208">請注意結果集中發行項的 **column_tracking** 選項值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-208">Note the value of the **column_tracking** option in the result set for the article.</span></span> <span data-ttu-id="7b33c-209">**1** 的值表示使用資料行層級追蹤， **0** 的值表示使用資料列層級追蹤。</span><span class="sxs-lookup"><span data-stu-id="7b33c-209">A value of **1** means that column-level tracking is being used, and a value of **0** means that row-level tracking is being used.</span></span>    
2.  <span data-ttu-id="7b33c-210">在發行集資料庫的發行者上，執行 [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-210">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-211">為 [ \*\* \@ 屬性**] 指定 [ **column_tracking** ] 的值，並為 [ \*\* \@ 值**] 指定下列其中一個值：</span><span class="sxs-lookup"><span data-stu-id="7b33c-211">Specify a value of **column_tracking** for **\@property** and one of the following values for **\@value**:</span></span>
    -   <span data-ttu-id="7b33c-212">**true** - 針對發行項使用資料行層級追蹤。</span><span class="sxs-lookup"><span data-stu-id="7b33c-212">**true** - Use column-level tracking for the article.</span></span>
    -   <span data-ttu-id="7b33c-213">**false** - 使用資料列層級追蹤，這是預設值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-213">**false** - Use row-level tracking, which is the default.</span></span>  
  
     <span data-ttu-id="7b33c-214">請為\*\* \@ force_invalidate_snapshot**和** \@ force_reinit_subscription**指定**1\*\*的值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-214">Specify a value of **1** for both **\@force_invalidate_snapshot** and **\@force_reinit_subscription**.</span></span>  

## <a name="tracking-deletes"></a><span data-ttu-id="7b33c-215">追蹤刪除</span><span class="sxs-lookup"><span data-stu-id="7b33c-215">Tracking deletes</span></span>

> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)]  
  
 <span data-ttu-id="7b33c-216">依預設，合併式複寫會同步處理發行者與散發者之間的 DELETE 命令。</span><span class="sxs-lookup"><span data-stu-id="7b33c-216">By default, merge replication synchronizes DELETE commands between the Publisher and Subscriber.</span></span> <span data-ttu-id="7b33c-217">合併式複寫可讓您保留訂閱資料庫中的資料列，即時已從發行集中刪除資料列 (反之亦然)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-217">Merge replication enables you to retain rows in the subscription database even when they have been deleted from the publication, and vice versa.</span></span> <span data-ttu-id="7b33c-218">您可透過程式設計方式指定在建立新的發行項時要忽略 DELETE 命令，或是可以在稍後使用複寫預存程序來啟用這項功能。</span><span class="sxs-lookup"><span data-stu-id="7b33c-218">You can programmatically specify that DELETE commands be ignored when creating a new article or you can enable this functionality at a later time using replication stored procedures.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="7b33c-219">啟用這項功能將會導致非聚合的情況，這表示訂閱者上的資料將不會正確反映發行者上的資料。</span><span class="sxs-lookup"><span data-stu-id="7b33c-219">Enabling this functionality will result in non-convergence, which means that data present at the Subscriber will not accurately reflect data at the Publisher.</span></span> <span data-ttu-id="7b33c-220">您必須實作自己的機制，以手動移除刪除的資料列。</span><span class="sxs-lookup"><span data-stu-id="7b33c-220">You must implement your own mechanism for manually removing deleted rows.</span></span>  
  
### <a name="specify-that-deletes-be-ignored-for-a-new-merge-article"></a><span data-ttu-id="7b33c-221">指定針對新的合併發行項忽略刪除</span><span class="sxs-lookup"><span data-stu-id="7b33c-221">Specify that deletes be ignored for a new merge article</span></span>  
  
1.  <span data-ttu-id="7b33c-222">在發行集資料庫的發行者端，執行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-222">At the Publisher on the publication database, execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-223">針對 [delete_tracking] 指定的值 `false` 。 \*\* \@ \*\*</span><span class="sxs-lookup"><span data-stu-id="7b33c-223">Specify a value of `false` for **\@delete_tracking**.</span></span> <span data-ttu-id="7b33c-224">如需詳細資訊，請參閱 [定義發行項](../publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-224">For more information, see [Define an Article](../publish/define-an-article.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="7b33c-225">如果發行項的來源資料表已在另一個發行集中發行，則兩個發行項的 **delete_tracking** 值必須相同。</span><span class="sxs-lookup"><span data-stu-id="7b33c-225">If the source table for an article is already published in another publication, the value of **delete_tracking** must be the same for both articles.</span></span>  
  
### <a name="specify-that-deletes-be-ignored-for-an-existing-merge-article"></a><span data-ttu-id="7b33c-226">指定針對現有的合併發行項忽略刪除</span><span class="sxs-lookup"><span data-stu-id="7b33c-226">Specify that deletes be ignored for an existing merge article</span></span>  
  
1.  <span data-ttu-id="7b33c-227">若要判斷是否已針對發行項啟用錯誤補償，請執行 [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)，並記下結果集中的 **delete_tracking** 值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-227">To determine if error compensation is enabled for an article, execute [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql) and note the value of **delete_tracking** in the result set.</span></span> <span data-ttu-id="7b33c-228">如果這個值是 **0**，就表示已經忽略刪除。</span><span class="sxs-lookup"><span data-stu-id="7b33c-228">If this value is **0**, deletes are already being ignored.</span></span>    
2.  <span data-ttu-id="7b33c-229">如果步驟 1 的值是 **1**，請在發行集資料庫的發行者端執行 [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-229">If the value from step 1 is **1**, execute [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="7b33c-230">為 [ \*\* \@ 屬性**] 指定 [ **delete_tracking** ] 的值，並 `false` 為 [ \*\* \@ 值**] 指定值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-230">Specify a value of **delete_tracking** for **\@property**, and a value of `false` for **\@value**.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="7b33c-231">如果發行項的來源資料表已在另一個發行集中發行，則兩個發行項的 **delete_tracking** 值必須相同。</span><span class="sxs-lookup"><span data-stu-id="7b33c-231">If the source table for an article is already published in another publication, the value of **delete_tracking** must be the same for both articles.</span></span>  
  
## <a name="processing-order"></a><span data-ttu-id="7b33c-232">處理順序</span><span class="sxs-lookup"><span data-stu-id="7b33c-232">Processing Order</span></span>
  <span data-ttu-id="7b33c-233">合併式複寫可讓您指定在同步處理期間，合併代理程式處理發行項的順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-233">Merge replication enables you to specify the order in which articles are processed by the Merge Agent during the synchronization process.</span></span> <span data-ttu-id="7b33c-234">當您使用複寫預存程序建立發行項時，可以透過程式設計方式對每一個發行項指派順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-234">You can assign an order to each article programmatically when creating an article using replication stored procedures.</span></span> <span data-ttu-id="7b33c-235">發行項會依照從最低值到最高值的順序來處理。</span><span class="sxs-lookup"><span data-stu-id="7b33c-235">Articles are processed in order from lowest to highest value.</span></span> <span data-ttu-id="7b33c-236">如果兩個發行項有相同的值，就會同時處理它們。</span><span class="sxs-lookup"><span data-stu-id="7b33c-236">If two articles have the same value, they are processed concurrently.</span></span> <span data-ttu-id="7b33c-237">如需詳細資訊，請參閱[指定合併式複寫屬性](../publish/specify-merge-replication-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-237">For more information, see [Specify Merge Replication properties](../publish/specify-merge-replication-properties.md).</span></span>  

  <span data-ttu-id="7b33c-238">從開始 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ，可以覆寫合併式發行集之發行項處理的預設順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-238">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], it is possible to override the default order of article processing for merge publications.</span></span> <span data-ttu-id="7b33c-239">這非常有用，例如，如果您透過觸發程序定義參考完整性，並且那些觸發程序必須以特定順序引發。</span><span class="sxs-lookup"><span data-stu-id="7b33c-239">This is useful, for example, if you define referential integrity through triggers and those triggers must fire in a certain order.</span></span> 

### <a name="how-processing-order-is-determined"></a><span data-ttu-id="7b33c-240">如何確定處理順序</span><span class="sxs-lookup"><span data-stu-id="7b33c-240">How Processing Order is Determined</span></span>  
 <span data-ttu-id="7b33c-241">在合併同步處理期間，依預設，發行項將按物件間相依性所需的順序處理，包括在基底資料表上定義的宣告式參考完整性 (DRI) 條件約束。</span><span class="sxs-lookup"><span data-stu-id="7b33c-241">During merge synchronization, articles are, by default, processed in the order required by the dependencies between objects, including the declarative referential integrity (DRI) constraints defined on the base tables.</span></span> <span data-ttu-id="7b33c-242">處理包括列舉對資料表所作的變更，然後套用這些變更。</span><span class="sxs-lookup"><span data-stu-id="7b33c-242">Processing involves enumerating the changes to a table and then applying those changes.</span></span> <span data-ttu-id="7b33c-243">如果沒有 DRI，但資料表發行項之間存在聯結篩選或邏輯記錄，發行項將以篩選和邏輯記錄所需的順序處理。</span><span class="sxs-lookup"><span data-stu-id="7b33c-243">If no DRI is present but join filters or logical records exist between table articles, the articles are processed in the order required by the filters and logical records.</span></span> <span data-ttu-id="7b33c-244">透過 DRI、聯結篩選、邏輯記錄或其他相依性與任何其他發行項無關的發行項，按照 [sysmergearticles &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/sysmergearticles-transact-sql) 系統資料表中的發行項暱稱處理。</span><span class="sxs-lookup"><span data-stu-id="7b33c-244">Articles not related to any other article through DRI, join filters, logical records, or other dependencies are processed according to the article nickname in the [sysmergearticles &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/sysmergearticles-transact-sql) system table.</span></span>  
  
 <span data-ttu-id="7b33c-245">假設發行集包含在 **SalesOrderHeader** 資料表中含主索引鍵資料行 **SalesOrderID** ，並且在 **SalesOrderDetail** 資料表中含相應外部索引鍵資料行 **SalesOrderID** 的資料表 **SalesOrderHeader** 與 **SalesOrderDetail** 。</span><span class="sxs-lookup"><span data-stu-id="7b33c-245">Consider a publication that includes the tables **SalesOrderHeader** and **SalesOrderDetail** with a primary key column **SalesOrderID** in the **SalesOrderHeader** table and a corresponding foreign key column **SalesOrderID** in the **SalesOrderDetail** table.</span></span> <span data-ttu-id="7b33c-246">在同步處理期間，合併式複寫透過在 **SalesOrderDetail** 中插入相關資料列之前於 **SalesOrderHeader**中插入任何新資料列，以防止外部索引鍵違規。</span><span class="sxs-lookup"><span data-stu-id="7b33c-246">During synchronization, merge replication prevents foreign key violations by inserting any new rows in **SalesOrderHeader** before inserting associated rows in **SalesOrderDetail**.</span></span> <span data-ttu-id="7b33c-247">同樣地，在從 **SalesOrderHeader** 中刪除關聯資料列之前，可從 **SalesOrderDetail**決定中刪除資料列。</span><span class="sxs-lookup"><span data-stu-id="7b33c-247">Similarly, rows are deleted from **SalesOrderDetail** before the associated row is deleted from **SalesOrderHeader**.</span></span>  
  
 <span data-ttu-id="7b33c-248">但是，在某些應用程式中，參照完整性透過資料庫觸發程序強化，或使用應用程式層級而不是透過 DRI 來強化。</span><span class="sxs-lookup"><span data-stu-id="7b33c-248">However, in some applications referential integrity is enforced through database triggers, or at the application level, rather than through DRI.</span></span> <span data-ttu-id="7b33c-249">以上所述的指定發行集 (而不是 DRI)， **SalesOrderDetail** 資料表具有插入觸發程序，可確保在允許插入前於 **SalesOrderHeader** 資料表中存在關聯資料列。</span><span class="sxs-lookup"><span data-stu-id="7b33c-249">Given the publication described above, instead of DRI, the **SalesOrderDetail** table could have an insert trigger that ensures the associated row in the **SalesOrderHeader** table exists before allowing an insert.</span></span> <span data-ttu-id="7b33c-250">**SalesOrderHeader** 具有刪除觸發程序，可確保在允許刪除前於 **SalesOrderDetail** 中沒有關聯資料列。</span><span class="sxs-lookup"><span data-stu-id="7b33c-250">**SalesOrderHeader** could have a delete trigger that ensures there are no associated rows in **SalesOrderDetail** before allowing a delete.</span></span> <span data-ttu-id="7b33c-251">合併式複寫在確定發行項處理順序時，不會考慮觸發程序，因為它無法在引發觸發程序前確定其結果。</span><span class="sxs-lookup"><span data-stu-id="7b33c-251">Merge replication does not take into account triggers when determining processing order of articles because it cannot determine what the result of the trigger will be until it has fired.</span></span> <span data-ttu-id="7b33c-252">同樣地，複寫不會考慮在應用程式層級上定義的條件約束。</span><span class="sxs-lookup"><span data-stu-id="7b33c-252">Similarly, replication cannot take into account constraints defined at the application level.</span></span>  
  
 <span data-ttu-id="7b33c-253">當透過觸發程序或在應用程式層級上維護參考完整性時，您應該指定處理發行項的順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-253">When referential integrity is maintained through triggers or at the application level, you should specify the order in which the articles should be processed.</span></span> <span data-ttu-id="7b33c-254">在使用觸發程序的範例中，您應該指定在處理 **SalesOrderDetail** 之前處理 **SalesOrderHeader**資料表，因為發行項排序是以插入順序為基礎的。</span><span class="sxs-lookup"><span data-stu-id="7b33c-254">In the example with triggers, you would specify that the **SalesOrderHeader** table should be processed before **SalesOrderDetail**, because article ordering is based on insert order.</span></span> <span data-ttu-id="7b33c-255">合併式複寫將自動反轉刪除順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-255">Merge replication will automatically reverse the order for deletes.</span></span> <span data-ttu-id="7b33c-256">沒有發行項排序，合併式複寫也不會失敗，因為如果條件約束出現違規，「合併代理程式」會繼續處理發行項；然後重試在處理其他發行項後失敗的任何作業。</span><span class="sxs-lookup"><span data-stu-id="7b33c-256">Merge replication will not fail without article ordering, because the Merge Agent continues to process articles if a constraint violation occurs; it then retries any operations that failed after other articles have been processed.</span></span> <span data-ttu-id="7b33c-257">只需指定發行項順序即可避免重試以及與其相關的其他處理。</span><span class="sxs-lookup"><span data-stu-id="7b33c-257">Specifying article order simply avoids retries and the additional processing associated with them.</span></span> <span data-ttu-id="7b33c-258">如果您指定了錯誤順序 (例如，導致在標頭記錄前處理詳細記錄的順序)，合併式複寫將會重試處理，直到它成功。</span><span class="sxs-lookup"><span data-stu-id="7b33c-258">If you specify an incorrect order (for example, one that results in detail records being processed before header records), merge replication will retry processing until it succeeds.</span></span>  

### <a name="new-article"></a><span data-ttu-id="7b33c-259">新文章</span><span class="sxs-lookup"><span data-stu-id="7b33c-259">New Article</span></span>
  
1.  <span data-ttu-id="7b33c-260">在發行集資料庫的發行者端，執行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-260">At the Publisher on the publication database, execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-261">指定一個整數值，代表\*\* \@ processing_order\*\*發行項的處理順序。</span><span class="sxs-lookup"><span data-stu-id="7b33c-261">Specify an integer value that represents the processing order for the article for **\@processing_order**.</span></span> <span data-ttu-id="7b33c-262">如需詳細資訊，請參閱 [定義發行項](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-262">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="7b33c-263">當建立排序的發行項時，您應該在發行項順序值之間留一些間距。</span><span class="sxs-lookup"><span data-stu-id="7b33c-263">When creating ordered articles, you should leave gaps between the article order values.</span></span> <span data-ttu-id="7b33c-264">這樣可讓您在將來更容易設定新的值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-264">This makes it easier to set new values in the future.</span></span> <span data-ttu-id="7b33c-265">例如，如果您有三個發行項需要指定固定的處理順序，請分別將\*\* \@ processing_order\*\*的值設定為10、20和30，而不是1、2和3。</span><span class="sxs-lookup"><span data-stu-id="7b33c-265">For example, if you have three articles for which you need to specify a fixed processing order, set the value of **\@processing_order** to 10, 20, and 30 rather than 1, 2, and 3, respectively.</span></span>  
  
### <a name="existing-article"></a><span data-ttu-id="7b33c-266">現有發行項</span><span class="sxs-lookup"><span data-stu-id="7b33c-266">Existing article</span></span>
  
1.  <span data-ttu-id="7b33c-267">若要決定發行項的處理順序，請執行 [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql)，並記下結果集中的 **processing_order** 值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-267">To determine processing order of an article, execute [sp_helpmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergearticle-transact-sql) and note the value of **processing_order** in the result set.</span></span>  
  
2.  <span data-ttu-id="7b33c-268">在發行集資料庫的發行者端，執行 [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="7b33c-268">At the Publisher on the publication database, execute [sp_changemergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="7b33c-269">針對 [ \*\* \@ 屬性**] 指定 [ **processing_order** ] 的值，並針對 [ \*\* \@ 值**] 表示處理順序的整數值。</span><span class="sxs-lookup"><span data-stu-id="7b33c-269">Specify a value of **processing_order** for **\@property** and an integer value that represents the processing order for **\@value**.</span></span>  



## <a name="see-also"></a><span data-ttu-id="7b33c-270">另請參閱</span><span class="sxs-lookup"><span data-stu-id="7b33c-270">See Also</span></span>  
 [<span data-ttu-id="7b33c-271">使用條件式刪除追蹤最佳化合併式複寫效能</span><span class="sxs-lookup"><span data-stu-id="7b33c-271">Optimize Merge Replication Performance with Conditional Delete Tracking</span></span>](../merge/optimize-merge-replication-performance-with-conditional-delete-tracking.md)  
 <span data-ttu-id="7b33c-272">[偵測和解決邏輯記錄中的衝突](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md) </span><span class="sxs-lookup"><span data-stu-id="7b33c-272">[Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md) </span></span>  
 <span data-ttu-id="7b33c-273">[定義合併資料表發行項之間的邏輯記錄關聯性](define-a-logical-record-relationship-between-merge-table-articles.md) </span><span class="sxs-lookup"><span data-stu-id="7b33c-273">[Define a Logical Record Relationship Between Merge Table Articles](define-a-logical-record-relationship-between-merge-table-articles.md) </span></span>  
 <span data-ttu-id="7b33c-274">[偵測及解決合併式複寫衝突](../merge/advanced-merge-replication-conflict-detection-and-resolution.md) </span><span class="sxs-lookup"><span data-stu-id="7b33c-274">[Detect and Resolve Merge Replication Conflicts](../merge/advanced-merge-replication-conflict-detection-and-resolution.md) </span></span>  
 <span data-ttu-id="7b33c-275">[使用僅限下載的發行項最佳化合併式複寫效能](../merge/optimize-merge-replication-performance-with-download-only-articles.md) </span><span class="sxs-lookup"><span data-stu-id="7b33c-275">[Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md) </span></span>  
 <span data-ttu-id="7b33c-276">[Define an Article](define-an-article.md) </span><span class="sxs-lookup"><span data-stu-id="7b33c-276">[Define an Article](define-an-article.md) </span></span>  
 [<span data-ttu-id="7b33c-277">檢視和修改發行項屬性</span><span class="sxs-lookup"><span data-stu-id="7b33c-277">View and Modify Article Properties</span></span>](view-and-modify-article-properties.md)  