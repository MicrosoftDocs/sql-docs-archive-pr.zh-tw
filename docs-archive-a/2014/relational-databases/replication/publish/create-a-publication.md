---
title: 建立發行集 | Microsoft 文件
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], creating
- articles [SQL Server replication], defining
- adding articles
- articles [SQL Server replication], adding
ms.assetid: 52ee6de9-1d58-4cb9-8711-372bddbe7154
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 14d8b3f1a998b18ae0153c1771fa11afd925da9c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87606764"
---
# <a name="create-a-publication"></a><span data-ttu-id="e48c1-102">建立發行集</span><span class="sxs-lookup"><span data-stu-id="e48c1-102">Create a Publication</span></span>
  <span data-ttu-id="e48c1-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO) 來建立 [!INCLUDE[tsql](../../../includes/tsql-md.md)]中的發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-103">This topic describes how to create a publication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="e48c1-104">**本主題內容**</span><span class="sxs-lookup"><span data-stu-id="e48c1-104">**In This Topic**</span></span>  
  
-   <span data-ttu-id="e48c1-105">**開始之前：**</span><span class="sxs-lookup"><span data-stu-id="e48c1-105">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="e48c1-106">限制事項</span><span class="sxs-lookup"><span data-stu-id="e48c1-106">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="e48c1-107">安全性</span><span class="sxs-lookup"><span data-stu-id="e48c1-107">Security</span></span>](#Security)  
  
-   <span data-ttu-id="e48c1-108">**若要建立發行集並定義發行項，請使用：**</span><span class="sxs-lookup"><span data-stu-id="e48c1-108">**To create a publication and define articles, using:**</span></span>  
  
     [<span data-ttu-id="e48c1-109">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="e48c1-109">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="e48c1-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="e48c1-110">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="e48c1-111">Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="e48c1-111">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="e48c1-112">開始之前</span><span class="sxs-lookup"><span data-stu-id="e48c1-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="e48c1-113">限制事項</span><span class="sxs-lookup"><span data-stu-id="e48c1-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="e48c1-114">發行集與發行項名稱不能包含下列任何字元：%、\*、[、]、|、:、"、?</span><span class="sxs-lookup"><span data-stu-id="e48c1-114">Publication and article names cannot include any of the following characters: % , \* , [ , ] , | , : , " , ?</span></span> <span data-ttu-id="e48c1-115">, ' , \ , / , \< , >.</span><span class="sxs-lookup"><span data-stu-id="e48c1-115">, ' , \ , / , \< , >.</span></span> <span data-ttu-id="e48c1-116">如果資料庫中物件包含這些字元的任何一個，且想要複寫這些字元，則必須指定一個不同於 [發行項屬性 - \<Article>] 對話方塊中物件名稱的發行項名稱，您可從精靈的 [發行項] 頁面存取此對話方塊。</span><span class="sxs-lookup"><span data-stu-id="e48c1-116">If objects in the database include any of these characters and you want to replicate them, you must specify an article name that is different from the object name in the **Article Properties - \<Article>** dialog box, which is available from the **Articles** page in the wizard.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="e48c1-117">Security</span><span class="sxs-lookup"><span data-stu-id="e48c1-117">Security</span></span>  
 <span data-ttu-id="e48c1-118">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-118">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="e48c1-119">如果您必須儲存認證，請使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) 密碼編譯服務 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="e48c1-119">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="e48c1-120">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="e48c1-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="e48c1-121">使用「新增發行集精靈」建立發行集並定義發行項。</span><span class="sxs-lookup"><span data-stu-id="e48c1-121">Create publications and define articles with the New Publication Wizard.</span></span> <span data-ttu-id="e48c1-122">建立發行集之後，您可以在 [發行集屬性 - \<Publication>] 對話方塊中，檢視及修改發行集屬性。</span><span class="sxs-lookup"><span data-stu-id="e48c1-122">After a publication is created, view and modify publication properties in the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="e48c1-123">如需從 Oracle 資料庫建立發行集的詳細資訊，請參閱[從 Oracle 資料庫建立發行集](create-a-publication-from-an-oracle-database.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-123">For information about creating a publication from an Oracle database, see [Create a Publication from an Oracle Database](create-a-publication-from-an-oracle-database.md).</span></span>  
  
#### <a name="to-create-a-publication-and-define-articles"></a><span data-ttu-id="e48c1-124">建立發行集並定義發行項</span><span class="sxs-lookup"><span data-stu-id="e48c1-124">To create a publication and define articles</span></span>  
  
1.  <span data-ttu-id="e48c1-125">連線至 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] 的發行者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="e48c1-125">Connect to the Publisher in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="e48c1-126">展開 **[複寫]** 資料夾，然後以滑鼠右鍵按一下 **[本機發行集]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="e48c1-126">Expand the **Replication** folder, and then right-click the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="e48c1-127">按一下 **[新增發行集]** 。</span><span class="sxs-lookup"><span data-stu-id="e48c1-127">Click **New Publication**.</span></span>  
  
4.  <span data-ttu-id="e48c1-128">遵循「新增發行集精靈」中的頁面，執行：</span><span class="sxs-lookup"><span data-stu-id="e48c1-128">Follow the pages in the New Publication Wizard to:</span></span>  
  
    -   <span data-ttu-id="e48c1-129">如果尚未在伺服器上設定散發，則請指定「散發者」。</span><span class="sxs-lookup"><span data-stu-id="e48c1-129">Specify a Distributor if distribution has not been configured on the server.</span></span> <span data-ttu-id="e48c1-130">如需設定散發的詳細資訊，請參閱[設定發行和散發](../configure-publishing-and-distribution.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-130">For more information about configuring distribution, see [Configure Publishing and Distribution](../configure-publishing-and-distribution.md).</span></span>  
  
         <span data-ttu-id="e48c1-131">如果在 **[散發者]** 頁面指定「發行者」伺服器做為自己的「散發者」(本機散發者)，而不將伺服器設定為「散發者」，則「新增發行集精靈」會設定該伺服器。</span><span class="sxs-lookup"><span data-stu-id="e48c1-131">If you specify on the **Distributor** page that the Publisher server will act as its own Distributor (a local Distributor), and the server is not configured as a Distributor, the New Publication Wizard will configure the server.</span></span> <span data-ttu-id="e48c1-132">您將在 **[快照集資料夾]** 頁面，為「散發者」指定預設快照集資料夾。</span><span class="sxs-lookup"><span data-stu-id="e48c1-132">You will specify a default snapshot folder for the Distributor on the **Snapshot Folder** page.</span></span> <span data-ttu-id="e48c1-133">快照集資料夾只是指定為共用的目錄；讀取並寫入此資料夾的代理程式必須具有足夠的權限才能對其進行存取。</span><span class="sxs-lookup"><span data-stu-id="e48c1-133">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="e48c1-134">如需適當地保護資料夾的詳細資訊，請參閱[保護快照集資料夾](../security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-134">For more information about securing the folder appropriately, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
         <span data-ttu-id="e48c1-135">如果指定另一台伺服器扮演「散發者」角色，則必須在 **[管理密碼]** 頁面輸入密碼才能從「發行者」連接到「散發者」。</span><span class="sxs-lookup"><span data-stu-id="e48c1-135">If you specify that another server should act as the Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="e48c1-136">此密碼必須符合發行者於遠端散發者啟用時所指定的密碼。</span><span class="sxs-lookup"><span data-stu-id="e48c1-136">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
         <span data-ttu-id="e48c1-137">如需詳細資訊，請參閱 [Configure Distribution](../configure-distribution.md)＞。</span><span class="sxs-lookup"><span data-stu-id="e48c1-137">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-138">選擇發行集資料庫。</span><span class="sxs-lookup"><span data-stu-id="e48c1-138">Choose a publication database.</span></span>  
  
    -   <span data-ttu-id="e48c1-139">選取發行集類型。</span><span class="sxs-lookup"><span data-stu-id="e48c1-139">Select a publication type.</span></span> <span data-ttu-id="e48c1-140">如需詳細資訊，請參閱[複寫類型](../types-of-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-140">For more information, see [Types of Replication](../types-of-replication.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-141">指定要發行的資料和資料庫物件；從資料表發行項選擇性地篩選資料行，並設定發行項屬性。</span><span class="sxs-lookup"><span data-stu-id="e48c1-141">Specify data and database objects to publish; optionally filter columns from table articles, and set article properties.</span></span>  
  
    -   <span data-ttu-id="e48c1-142">從資料表發行項中選擇性地篩選資料列。</span><span class="sxs-lookup"><span data-stu-id="e48c1-142">Optionally filter rows from table articles.</span></span> <span data-ttu-id="e48c1-143">如需詳細資訊，請參閱[篩選發行的資料](filter-published-data.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-143">For more information, see [Filter Published Data](filter-published-data.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-144">設定「快照集代理程式」的排程。</span><span class="sxs-lookup"><span data-stu-id="e48c1-144">Set the Snapshot Agent schedule.</span></span>  
  
    -   <span data-ttu-id="e48c1-145">指定下列複寫代理程式執行時使用的認證，並建立連接：</span><span class="sxs-lookup"><span data-stu-id="e48c1-145">Specify the credentials under which the following replication agents run and make connections:</span></span>  
  
         <span data-ttu-id="e48c1-146">\- 快照集代理程式 (針對所有發行集)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-146">\- Snapshot Agent for all publications.</span></span>  
  
         <span data-ttu-id="e48c1-147">\- 記錄讀取器代理程式 (針對所有交易式發行集)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-147">\- Log Reader Agent for all transactional publications.</span></span>  
  
         <span data-ttu-id="e48c1-148">\- 佇列讀取器代理程式 (針對允許更新訂閱的交易式發行集)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-148">\- Queue Reader Agent for transactional publications that allow updating subscriptions.</span></span>  
  
         <span data-ttu-id="e48c1-149">如需相關資訊，請參閱 [Replication Agent Security Model](../security/replication-agent-security-model.md) 以及 [Replication Security Best Practices](../security/replication-security-best-practices.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-149">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md) and [Replication Security Best Practices](../security/replication-security-best-practices.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-150">選擇性地編寫發行集的指令碼。</span><span class="sxs-lookup"><span data-stu-id="e48c1-150">Optionally script the publication.</span></span> <span data-ttu-id="e48c1-151">如需詳細資訊，請參閱 [Scripting Replication](../scripting-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-151">For more information, see [Scripting Replication](../scripting-replication.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-152">指定發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-152">Specify a name for the publication.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="e48c1-153">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="e48c1-153">Using Transact-SQL</span></span>  
 <span data-ttu-id="e48c1-154">您可以使用複寫預存程序以程式設計的方式建立發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-154">Publications can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="e48c1-155">使用哪些預存程序取決於所要建立的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="e48c1-155">The stored procedures that are used will depend on the type of publication being created.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="e48c1-156">建立快照式或交易式發行集</span><span class="sxs-lookup"><span data-stu-id="e48c1-156">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="e48c1-157">在發行集資料庫的發行者端執行 [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)，以便使用快照式或異動複寫來啟用目前資料庫的發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-157">At the Publisher on the publication database, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using snapshot or transactional replication.</span></span>  
  
2.  <span data-ttu-id="e48c1-158">如果是交易式發行集，請判斷發行集資料庫是否有記錄讀取器代理程式作業存在</span><span class="sxs-lookup"><span data-stu-id="e48c1-158">For a transactional publication, determine whether a Log Reader Agent job exists for the publication database.</span></span> <span data-ttu-id="e48c1-159">(快照式發行集不需要這個步驟)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-159">(This step is not required for snapshot publications.)</span></span>  
  
    -   <span data-ttu-id="e48c1-160">如果記錄讀取器代理程式作業已存在發行集資料庫中，請繼續進行步驟 3。</span><span class="sxs-lookup"><span data-stu-id="e48c1-160">If a Log Reader Agent job exists for the publication database, proceed to step 3.</span></span>  
  
    -   <span data-ttu-id="e48c1-161">如果您不確定發行的資料庫是否有記錄讀取器代理程式作業存在，請在發行集資料庫的發行者端執行 [sp_helplogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-161">If you are unsure whether a Log Reader Agent job exists for a published database, execute [sp_helplogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql) at the Publisher on the publication database.</span></span>  
  
    -   <span data-ttu-id="e48c1-162">如果結果集是空的，請建立記錄讀取器代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-162">If the result set is empty, create a Log Reader Agent job.</span></span> <span data-ttu-id="e48c1-163">在發行者端，執行 [sp_addlogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-163">At the Publisher, execute [sp_addlogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql).</span></span> <span data-ttu-id="e48c1-164">為 **\@job_name** 和 **\@password** 指定執行代理程式所使用的 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-164">Specify the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the agent runs for **\@job_name** and **\@password**.</span></span> <span data-ttu-id="e48c1-165">如果代理程式會在連接到發行者時使用 SQL Server 驗證，您也必須為 **\@publisher_security_mode** 指定 **0** 值，並為 **\@publisher_login** 和 **\@publisher_password**指定 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="e48c1-165">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="e48c1-166">請繼續進行步驟 3。</span><span class="sxs-lookup"><span data-stu-id="e48c1-166">Proceed to step 3.</span></span>  
  
3.  <span data-ttu-id="e48c1-167">在發行者端，執行 [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-167">At the Publisher, execute [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="e48c1-168">指定\*\* \@ 發行**集的發行集名稱，並針對** \@ repl_freq\*\*參數，針對快照式發行集指定的值， `snapshot` 或針對交易式發行集指定的值 `continuous` 。</span><span class="sxs-lookup"><span data-stu-id="e48c1-168">Specify a publication name for **\@publication**, and, for the **\@repl_freq** parameter, specify a value of `snapshot` for a snapshot publication or a value of `continuous` for a transactional publication.</span></span> <span data-ttu-id="e48c1-169">指定任何其他發行集選項。</span><span class="sxs-lookup"><span data-stu-id="e48c1-169">Specify any other publication options.</span></span> <span data-ttu-id="e48c1-170">這樣會定義此發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-170">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e48c1-171">發行集名稱不能包含下列字元：</span><span class="sxs-lookup"><span data-stu-id="e48c1-171">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="e48c1-172">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="e48c1-172">% \* [ ] | : " ?</span></span> <span data-ttu-id="e48c1-173">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="e48c1-173">\ / \< ></span></span>  
  
4.  <span data-ttu-id="e48c1-174">在發行者端，執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-174">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="e48c1-175">為 **\@publication** 指定步驟 3 中所使用的發行集名稱，並為 **\@snapshot_job_name** 和 **\@password** 指定快照集代理程式執行時所使用的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-175">Specify the publication name used in step 3 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="e48c1-176">如果代理程式會在連接到發行者時使用 SQL Server 驗證，您也必須為 **\@publisher_security_mode** 指定 **0** 值，並為 **\@publisher_login** 和 **\@publisher_password** 指定 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="e48c1-176">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="e48c1-177">這麼做會為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-177">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="e48c1-178">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="e48c1-178">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="e48c1-179">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="e48c1-179">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="e48c1-180">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-180">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
5.  <span data-ttu-id="e48c1-181">將發行項加入至發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-181">Add articles to the publication.</span></span> <span data-ttu-id="e48c1-182">如需詳細資訊，請參閱 [定義發行項](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-182">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
6.  <span data-ttu-id="e48c1-183">啟動快照集代理程式作業來產生此發行集的初始快照集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-183">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="e48c1-184">如需詳細資訊，請參閱 [建立和套用初始快照集](../create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-184">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="e48c1-185">建立合併式發行集</span><span class="sxs-lookup"><span data-stu-id="e48c1-185">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="e48c1-186">在發行者端執行 [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)，以便使用合併式複寫來啟用目前資料庫的發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-186">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using merge replication.</span></span>  
  
2.  <span data-ttu-id="e48c1-187">在發行集資料庫的發行者端，執行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-187">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="e48c1-188">為 **\@publication** 指定發行集的名稱，並指定其他任何發行集選項。</span><span class="sxs-lookup"><span data-stu-id="e48c1-188">Specify a name for the publication for **\@publication** and any other publication options.</span></span> <span data-ttu-id="e48c1-189">這樣會定義此發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-189">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e48c1-190">發行集名稱不能包含下列字元：</span><span class="sxs-lookup"><span data-stu-id="e48c1-190">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="e48c1-191">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="e48c1-191">% \* [ ] | : " ?</span></span> <span data-ttu-id="e48c1-192">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="e48c1-192">\ / \< ></span></span>  
  
3.  <span data-ttu-id="e48c1-193">在發行者端，執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-193">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="e48c1-194">為 **\@publication** 指定步驟 2 中所使用的發行集名稱，並為 **\@snapshot_job_name** 和 **\@password** 指定快照集代理程式執行時所使用的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-194">Specify the publication name used in step 2 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="e48c1-195">如果代理程式會在連接到發行者時使用 SQL Server 驗證，您也必須為 **\@publisher_security_mode** 指定 **0** 值，並為 **\@publisher_login** 和 **\@publisher_password** 指定 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="e48c1-195">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="e48c1-196">這麼做會為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-196">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="e48c1-197">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="e48c1-197">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="e48c1-198">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="e48c1-198">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="e48c1-199">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-199">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
4.  <span data-ttu-id="e48c1-200">將發行項加入至發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-200">Add articles to the publication.</span></span> <span data-ttu-id="e48c1-201">如需詳細資訊，請參閱 [定義發行項](define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-201">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
5.  <span data-ttu-id="e48c1-202">啟動快照集代理程式作業來產生此發行集的初始快照集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-202">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="e48c1-203">如需詳細資訊，請參閱 [建立和套用初始快照集](../create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-203">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="e48c1-204">範例 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e48c1-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="e48c1-205">此範例會建立交易式發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-205">This example creates a transactional publication.</span></span> <span data-ttu-id="e48c1-206">指令碼變數是用來傳遞建立快照集代理程式作業和記錄讀取器代理程式作業所需的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-206">Scripting variables are used to pass Windows credentials that are needed to create jobs for the Snapshot Agent and Log Reader Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddTranPub](../../../snippets/tsql/SQL15/replication/howto/tsql/createtranpub.sql#sp_addtranpub)]  
  
 <span data-ttu-id="e48c1-207">此範例會建立合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-207">This example creates a merge publication.</span></span> <span data-ttu-id="e48c1-208">指令碼變數是用來傳遞建立快照集代理程式作業所需的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-208">Scripting variables are used to pass Windows credentials that are needed to create the job for the Snapshot Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddMergePub](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepub.sql#sp_addmergepub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="e48c1-209">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="e48c1-209">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="e48c1-210">您可以使用 Replication Management Objects (RMO) 以程式設計的方式建立發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-210">You can create publications programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="e48c1-211">用來建立發行集的 RMO 類別，將取決於所建立的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="e48c1-211">The RMO classes that you use to create a publication depend on the type of publication you create.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="e48c1-212">建立快照式或交易式發行集</span><span class="sxs-lookup"><span data-stu-id="e48c1-212">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="e48c1-213">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="e48c1-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="e48c1-214">為發行集資料庫建立 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> 類別的執行個體、將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 執行個體，並呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="e48c1-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="e48c1-215">如果 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 傳回 `false`，請確認此資料庫確實存在。</span><span class="sxs-lookup"><span data-stu-id="e48c1-215">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="e48c1-216">如果 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> 屬性為 `false`，請將它設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="e48c1-216">If the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> property is `false`, set it to `true`.</span></span>  
  
4.  <span data-ttu-id="e48c1-217">如果是交易式發行集，請檢查 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="e48c1-217">For a transactional publication, check the value of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> property.</span></span> <span data-ttu-id="e48c1-218">如果這個屬性為 `true`，則表示記錄讀取器代理程式作業已存在此資料庫中。</span><span class="sxs-lookup"><span data-stu-id="e48c1-218">If this property is `true`, a Log Read Agent job already exists for this database.</span></span> <span data-ttu-id="e48c1-219">如果這個屬性為 `false`，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="e48c1-219">If this property is `false`, do the following:</span></span>  
  
    -   <span data-ttu-id="e48c1-220">設定 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> 或 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> 欄位，以提供執行記錄讀取器代理程式所使用之 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 帳戶的認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-220">Set the <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows account under which the Log Reader Agent runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="e48c1-221">當發行集是由 `sysadmin` 固定伺服器角色的成員所建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-221">Setting <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="e48c1-222">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="e48c1-222">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="e48c1-223">如需詳細資訊，請參閱 [複寫代理程式安全性模型](../security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-223">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-224">(選擇性) 在使用「SQL Server 驗證」連接到「發行者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="e48c1-224">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="e48c1-225">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> 方法來為資料庫建立記錄讀取器代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-225">Call the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> method to create the Log Reader Agent job for the database.</span></span>  
  
5.  <span data-ttu-id="e48c1-226">建立 <xref:Microsoft.SqlServer.Replication.TransPublication> 類別的執行個體，並為此物件設定下列屬性：</span><span class="sxs-lookup"><span data-stu-id="e48c1-226">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="e48c1-227">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設定為步驟 1 中的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-227">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-228">將 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>設為發行的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-228">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-229">將 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>設定為發行集名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-229">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-230"><xref:Microsoft.SqlServer.Replication.PublicationType> 或 <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> 的 <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-230">A <xref:Microsoft.SqlServer.Replication.PublicationType> of either <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>.</span></span>  
  
    -   <span data-ttu-id="e48c1-231"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> 欄位，可提供執行快照集代理程式所使用之 Windows 帳戶的認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-231">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="e48c1-232">當快照集代理程式要連接本機散發者及進行任何遠端連接 (使用 Windows 驗證) 時，也會使用此帳戶。</span><span class="sxs-lookup"><span data-stu-id="e48c1-232">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="e48c1-233">當發行集是由 `sysadmin` 固定伺服器角色的成員所建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-233">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="e48c1-234">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="e48c1-234">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="e48c1-235">如需詳細資訊，請參閱 [複寫代理程式安全性模型](../security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-235">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-236">(選擇性) 在使用「SQL Server 驗證」連接到發行者時，請設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="e48c1-236">(Optional) The <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="e48c1-237">(選擇性) 使用包含的邏輯 OR 運算子 (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`)，並使用排除的邏輯 OR 運算子 (Visual C# 中的 `^` 和 Visual Basic 中的 `Xor`)，為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes> 屬性設定 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 值。</span><span class="sxs-lookup"><span data-stu-id="e48c1-237">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
    -   <span data-ttu-id="e48c1-238">(選擇性) 當散發者為非 SQL Server 散發者時，將 <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> 設定為散發者的名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-238">(Optional) The name of the Publisher for <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> when the Publisher is a non-SQL Server Publisher.</span></span>  
  
6.  <span data-ttu-id="e48c1-239">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法來建立發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-239">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="e48c1-240">當利用遠端散發者來設定發行者時，提供給所有屬性的值 (包括 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="e48c1-240">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="e48c1-241">您應該先加密「發行者」及其遠端「散發者」之間的連線，然後再呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="e48c1-241">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="e48c1-242">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-242">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
7.  <span data-ttu-id="e48c1-243">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 方法來為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-243">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="e48c1-244">建立合併式發行集</span><span class="sxs-lookup"><span data-stu-id="e48c1-244">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="e48c1-245">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="e48c1-245">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="e48c1-246">為發行集資料庫建立 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> 類別的執行個體、將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 執行個體，並呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="e48c1-246">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="e48c1-247">如果 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 傳回 `false`，請確認此資料庫確實存在。</span><span class="sxs-lookup"><span data-stu-id="e48c1-247">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="e48c1-248">如果 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> 屬性為 `false`，請將它設定為 `true` 然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-248">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> Property is `false`, set it to `true`, and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="e48c1-249">建立 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體，並為此物件設定下列屬性：</span><span class="sxs-lookup"><span data-stu-id="e48c1-249">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="e48c1-250">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設定為步驟 1 中的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-250">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-251">將 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>設為發行的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-251">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-252">將 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>設定為發行集名稱。</span><span class="sxs-lookup"><span data-stu-id="e48c1-252">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="e48c1-253"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> 欄位，可提供執行快照集代理程式所使用之 Windows 帳戶的認證。</span><span class="sxs-lookup"><span data-stu-id="e48c1-253">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="e48c1-254">當快照集代理程式要連接本機散發者及進行任何遠端連接 (使用 Windows 驗證) 時，也會使用此帳戶。</span><span class="sxs-lookup"><span data-stu-id="e48c1-254">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="e48c1-255">當發行集是由 `sysadmin` 固定伺服器角色的成員所建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>。</span><span class="sxs-lookup"><span data-stu-id="e48c1-255">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="e48c1-256">如需詳細資訊，請參閱 [複寫代理程式安全性模型](../security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-256">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="e48c1-257">(選擇性) 使用包含的邏輯 OR 運算子 (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`)，並使用排除的邏輯 OR 運算子 (Visual C# 中的 `^` 和 Visual Basic 中的 `Xor`)，為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes> 屬性設定 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 值。</span><span class="sxs-lookup"><span data-stu-id="e48c1-257">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
5.  <span data-ttu-id="e48c1-258">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法來建立發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-258">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="e48c1-259">當利用遠端散發者來設定發行者時，提供給所有屬性的值 (包括 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="e48c1-259">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="e48c1-260">您應該先加密「發行者」及其遠端「散發者」之間的連線，然後再呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="e48c1-260">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="e48c1-261">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="e48c1-261">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="e48c1-262">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 方法來為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="e48c1-262">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="e48c1-263">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="e48c1-263">Examples (RMO)</span></span>  
 <span data-ttu-id="e48c1-264">此範例會針對交易式發行啟用 AdventureWorks 資料庫、定義記錄讀取器代理程式作業，並建立 AdvWorksProductTran 發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-264">This example enables the AdventureWorks database for transactional publishing, defines a Log Reader Agent job, and creates the AdvWorksProductTran publication.</span></span> <span data-ttu-id="e48c1-265">必須為此發行集定義發行項。</span><span class="sxs-lookup"><span data-stu-id="e48c1-265">An article must be defined for this publication.</span></span> <span data-ttu-id="e48c1-266">建立記錄讀取器代理程式作業和快照集代理程式作業所需的 Windows 帳戶認證是在執行階段所傳遞。</span><span class="sxs-lookup"><span data-stu-id="e48c1-266">The Windows account credentials that are needed to create the Log Reader Agent job and the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="e48c1-267">若要了解如何使用 RMO 來定義快照發行項和交易式發行項，請參閱＜ [Define an Article](define-an-article.md)＞。</span><span class="sxs-lookup"><span data-stu-id="e48c1-267">To learn how to use RMO to define snapshot and transactional articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpub)]  
  
 <span data-ttu-id="e48c1-268">此範例會針對合併發行啟用 AdventureWorks 資料庫，並建立 AdvWorksSalesOrdersMerge 發行集。</span><span class="sxs-lookup"><span data-stu-id="e48c1-268">This example enables the AdventureWorks database for merge publishing and creates the AdvWorksSalesOrdersMerge publication.</span></span> <span data-ttu-id="e48c1-269">仍然必須為此發行集定義發行項。</span><span class="sxs-lookup"><span data-stu-id="e48c1-269">Articles must still be defined for this publication.</span></span> <span data-ttu-id="e48c1-270">建立快照集代理程式作業所需的 Windows 帳戶認證是在執行階段所傳遞。</span><span class="sxs-lookup"><span data-stu-id="e48c1-270">The Windows account credentials that are needed to create the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="e48c1-271">若要了解如何使用 RMO 來定義合併發行項，請參閱＜ [Define an Article](define-an-article.md)＞。</span><span class="sxs-lookup"><span data-stu-id="e48c1-271">To learn how to use RMO to define merge articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
## <a name="see-also"></a><span data-ttu-id="e48c1-272">另請參閱</span><span class="sxs-lookup"><span data-stu-id="e48c1-272">See Also</span></span>  
 <span data-ttu-id="e48c1-273">[以指令碼變數使用 sqlcmd](../../scripting/sqlcmd-use-with-scripting-variables.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-273">[Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md) </span></span>  
 <span data-ttu-id="e48c1-274">[發行資料和資料庫物件](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-274">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="e48c1-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="e48c1-276">[Define an Article](define-an-article.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-276">[Define an Article](define-an-article.md) </span></span>  
 <span data-ttu-id="e48c1-277">[檢視及修改發行集屬性](view-and-modify-publication-properties.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-277">[View and Modify Publication Properties](view-and-modify-publication-properties.md) </span></span>  
 <span data-ttu-id="e48c1-278">[[設定散發]](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-278">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="e48c1-279">[保護散發者](../security/secure-the-distributor.md) </span><span class="sxs-lookup"><span data-stu-id="e48c1-279">[Secure the Distributor](../security/secure-the-distributor.md) </span></span>  
 [<span data-ttu-id="e48c1-280">保護發行者</span><span class="sxs-lookup"><span data-stu-id="e48c1-280">Secure the Publisher</span></span>](../security/secure-the-publisher.md)  
  
  
