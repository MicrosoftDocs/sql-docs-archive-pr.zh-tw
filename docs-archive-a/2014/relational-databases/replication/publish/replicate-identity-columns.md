---
title: 複寫識別資料行 | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87592601"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="20ce5-102">複寫識別欄位</span><span class="sxs-lookup"><span data-stu-id="20ce5-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="20ce5-103">將 IDENTITY 屬性指派給資料行時，[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 會自動為含有識別欄位之資料表的新資料列產生序號。</span><span class="sxs-lookup"><span data-stu-id="20ce5-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="20ce5-104">如需詳細資訊，請參閱 [IDENTITY &#40;屬性&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="20ce5-105">由於識別欄位可能會做為主索引鍵的一部分，因此請務必避免在識別欄位中重複值。</span><span class="sxs-lookup"><span data-stu-id="20ce5-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="20ce5-106">若要在具有多個節點更新的複寫拓撲裡使用識別欄位，複寫拓撲中的每個節點必須使用不同的識別值範圍，以免出現重複。</span><span class="sxs-lookup"><span data-stu-id="20ce5-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="20ce5-107">例如，「發行者」可指派範圍 1-100、訂閱者 A 指派範圍 101-200，訂閱者 B 則指派範圍 201-300。</span><span class="sxs-lookup"><span data-stu-id="20ce5-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="20ce5-108">如果在「發行者」插入資料列，而且識別值是 65，該值就會複寫到每個「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="20ce5-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="20ce5-109">當複寫在每個「訂閱者」端插入資料時，不會遞增「訂閱者」資料表中的識別欄位值，而是插入常值 65。</span><span class="sxs-lookup"><span data-stu-id="20ce5-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="20ce5-110">只有使用者插入會導致識別欄位值遞增，複寫代理程式插入則不會。</span><span class="sxs-lookup"><span data-stu-id="20ce5-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="20ce5-111">複寫會處理所有發行集與訂閱類型的識別欄位，讓您能夠手動管理資料行，或者讓複寫自動管理這些資料行。</span><span class="sxs-lookup"><span data-stu-id="20ce5-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="20ce5-112">不支援在已發行的資料表上加入識別欄位，因為可能在資料行複寫至「訂閱者」時，導致無法聚合。</span><span class="sxs-lookup"><span data-stu-id="20ce5-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="20ce5-113">簽發者端識別欄位中的值，隨著受影響的資料表之資料列的實際儲存順序而不同。</span><span class="sxs-lookup"><span data-stu-id="20ce5-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="20ce5-114">資料列可能以不同方式儲存在訂閱者端；因此識別欄位的值可能與同資料列的不同。</span><span class="sxs-lookup"><span data-stu-id="20ce5-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="20ce5-115">指定識別範圍管理選項</span><span class="sxs-lookup"><span data-stu-id="20ce5-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="20ce5-116">複寫提供三個識別範圍管理選項：</span><span class="sxs-lookup"><span data-stu-id="20ce5-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="20ce5-117">自動。</span><span class="sxs-lookup"><span data-stu-id="20ce5-117">Automatic.</span></span> <span data-ttu-id="20ce5-118">用於「訂閱者」端更新的合併式複寫與異動複寫。</span><span class="sxs-lookup"><span data-stu-id="20ce5-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="20ce5-119">指定「發行者」與「訂閱者」的大小範圍，複寫會自動管理新範圍的指派。</span><span class="sxs-lookup"><span data-stu-id="20ce5-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="20ce5-120">複寫還會為「訂閱者」端的識別欄位設定 NOT FOR REPLICATION 選項，以便只有使用者插入會導致值在「訂閱者」端遞增。</span><span class="sxs-lookup"><span data-stu-id="20ce5-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="20ce5-121">「訂閱者」必須與「發行者」同步，方可接收新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="20ce5-122">由於「訂閱者」的識別範圍是自動指派的，因此如果反覆要求新範圍，任何「訂閱者」都可能用盡整個識別範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="20ce5-123">手動。</span><span class="sxs-lookup"><span data-stu-id="20ce5-123">Manual.</span></span> <span data-ttu-id="20ce5-124">用於「訂閱者」端沒有更新的快照式與異動複寫、點對點異動複寫，或者是應用程式必須程式化控制識別範圍的情況。</span><span class="sxs-lookup"><span data-stu-id="20ce5-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="20ce5-125">如果指定手動管理，必須確定範圍指派到了「發行者」與每個「訂閱者」，並在使用初始範圍時指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="20ce5-126">複寫會為「訂閱者」端的識別欄位設定 NOT FOR REPLICATION 選項。</span><span class="sxs-lookup"><span data-stu-id="20ce5-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="20ce5-127">無。</span><span class="sxs-lookup"><span data-stu-id="20ce5-127">None.</span></span> <span data-ttu-id="20ce5-128">此選項僅建議用於與舊版 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的回溯相容性，並且僅在交易式發行集的預存程序介面可用。</span><span class="sxs-lookup"><span data-stu-id="20ce5-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="20ce5-129">若要指定識別範圍管理選項，請參閱[管理識別資料行](manage-identity-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="20ce5-130">指派識別範圍</span><span class="sxs-lookup"><span data-stu-id="20ce5-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="20ce5-131">合併式複寫與異動複寫使用不同的方法指派範圍；這些方法在本節中均有描述。</span><span class="sxs-lookup"><span data-stu-id="20ce5-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="20ce5-132">複寫識別欄位時要考慮兩種範圍：指派至「發行者」與「訂閱者」的範圍，以及資料行中資料類型的範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="20ce5-133">下表顯示識別欄位中通常使用之資料類型可用的範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="20ce5-134">範圍用於拓撲中的所有節點。</span><span class="sxs-lookup"><span data-stu-id="20ce5-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="20ce5-135">例如，如果您使用 `smallint` 從1開始，增量為1，則最大的插入數為32767，代表發行者和所有訂閱者。</span><span class="sxs-lookup"><span data-stu-id="20ce5-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="20ce5-136">插入的實際數目取決於使用的值中是否有間距，以及是否使用臨界值。</span><span class="sxs-lookup"><span data-stu-id="20ce5-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="20ce5-137">如需臨界值的詳細資訊，請參閱下列的「合併式複寫」和「具有佇列更新訂閱的異動複寫」各節。</span><span class="sxs-lookup"><span data-stu-id="20ce5-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="20ce5-138">如果「發行者」在插入之後用盡了其識別範圍，則在 **db_owner** 固定資料庫角色的成員執行插入時，可自動指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="20ce5-139">如果執行插入的使用者並非該角色，則「記錄讀取器代理程式」、「合併代理程式」或屬於 **db_owner** 角色成員的使用者必須執行 [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="20ce5-140">對於異動複寫，「記錄讀取器代理程式」必須執行才能自動配置新範圍 (預設要求該代理程式連續執行)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="20ce5-141">在大型批次插入期間，複寫觸發程序只會引發一次，而不會針對插入的每個資料列引發。</span><span class="sxs-lookup"><span data-stu-id="20ce5-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="20ce5-142">如果在大型插入 (例如 `INSERT INTO` 陳述式) 期間用盡了識別範圍，這可能會導致 Insert 陳述式失敗。</span><span class="sxs-lookup"><span data-stu-id="20ce5-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="20ce5-143">資料類型</span><span class="sxs-lookup"><span data-stu-id="20ce5-143">Data type</span></span>|<span data-ttu-id="20ce5-144">範圍</span><span class="sxs-lookup"><span data-stu-id="20ce5-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="20ce5-145">不支援自動管理</span><span class="sxs-lookup"><span data-stu-id="20ce5-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="20ce5-146">-2^15 (-32,768) 到 2^15-1 (32,767)</span><span class="sxs-lookup"><span data-stu-id="20ce5-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="20ce5-147">-2^31 (-2,147,483,648) 到 2^31-1 (2,147,483,647)</span><span class="sxs-lookup"><span data-stu-id="20ce5-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="20ce5-148">-2^63 (-9,223,372,036,854,775,808) 到 2^63-1 (9,223,372,036,854,775,807)</span><span class="sxs-lookup"><span data-stu-id="20ce5-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="20ce5-149">`decimal` 和 `numeric`</span><span class="sxs-lookup"><span data-stu-id="20ce5-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="20ce5-150">-10^38+1 到 10^38-1</span><span class="sxs-lookup"><span data-stu-id="20ce5-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="20ce5-151">若要建立可用於多個資料表中或可在不參考任何資料表的情況下從應用程式進行呼叫的自動遞增數字，請參閱 [序號](../../sequence-numbers/sequence-numbers.md)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="20ce5-152">合併式複寫</span><span class="sxs-lookup"><span data-stu-id="20ce5-152">Merge Replication</span></span>  
 <span data-ttu-id="20ce5-153">識別範圍由「發行者」管理，並由「合併代理程式」傳播至「訂閱者」(在重新發行階層中，範圍由根「發行者」與重新發行者管理)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="20ce5-154">識別值從「發行者」端的集區指派。</span><span class="sxs-lookup"><span data-stu-id="20ce5-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="20ce5-155">您在 [新增發行集精靈] 中或使用 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) 將具有識別欄位的發行項新增至發行集時，指定下列的值：</span><span class="sxs-lookup"><span data-stu-id="20ce5-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="20ce5-156">\*\* \@ Identity_range\*\*參數，控制最初配置給「發行者」的識別範圍大小，以及具有用戶端訂閱的「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="20ce5-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="20ce5-157">對於執行舊版的「訂閱者」 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，這個參數 (，而不是\*\* \@ pub_identity_range\*\*參數) 也會控制重新發行訂閱者端的識別範圍大小。</span><span class="sxs-lookup"><span data-stu-id="20ce5-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="20ce5-158">\*\* \@ Pub_identity_range\*\*參數，可控制已配置給訂閱者的重新發行的識別範圍大小， (重新發行資料) 所需的重新發佈。</span><span class="sxs-lookup"><span data-stu-id="20ce5-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="20ce5-159">所有具有主訂閱的「訂閱者」都會收到重新發行的範圍，即使它們實際並未重新發行資料。</span><span class="sxs-lookup"><span data-stu-id="20ce5-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="20ce5-160">\*\* \@ 臨界值\*\*參數，用來判斷訂用帳戶或舊版的訂閱何時需要新的識別範圍 [!INCLUDE[ssEW](../../../includes/ssew-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="20ce5-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="20ce5-161">例如，您可以指定10000做為\*\* \@ identity_range\*\* ，而500000用於\*\* \@ pub_identity_range\*\*。</span><span class="sxs-lookup"><span data-stu-id="20ce5-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="20ce5-162">執行 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本的發行者和所有訂閱者 (包括具有主訂閱的訂閱者) 都會被指派 10000 的主要範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="20ce5-163">具有伺服器訂閱的訂閱者也會被指派500000的主要範圍，這可供與重新發行訂閱者同步處理的訂閱者使用 (您也必須在重新發佈的訂閱者) 上，為發行集中的發行項指定\*\* \@ identity_range**、 \*\* \@ pub_identity_range**和\*\* \@ 臨界值\*\*。</span><span class="sxs-lookup"><span data-stu-id="20ce5-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="20ce5-164">執行 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本的每一個訂閱者還會收到次要識別範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="20ce5-165">次要範圍的大小等於主要範圍；當主要範圍用盡時，就會使用次要範圍，並且「合併代理程式」會為「訂閱者」指派新的範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="20ce5-166">新範圍隨即成為次要範圍，且當「訂閱者」使用識別值時處理會繼續。</span><span class="sxs-lookup"><span data-stu-id="20ce5-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="20ce5-167">具有佇列更新訂閱的異動複寫</span><span class="sxs-lookup"><span data-stu-id="20ce5-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="20ce5-168">識別範圍由「散發者」管理，並由「散發代理程式」傳播至「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="20ce5-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="20ce5-169">識別值從「散發者」端的集區指派。</span><span class="sxs-lookup"><span data-stu-id="20ce5-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="20ce5-170">集區大小基於資料類型的大小以及用於識別欄位的遞增值。</span><span class="sxs-lookup"><span data-stu-id="20ce5-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="20ce5-171">您在 [新增發行集精靈] 中或使用 [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) 將具有識別欄位的發行項新增至發行集時，指定下列的值：</span><span class="sxs-lookup"><span data-stu-id="20ce5-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="20ce5-172">\*\* \@ Identity_range\*\*參數，控制最初配置給所有訂閱者的識別範圍大小。</span><span class="sxs-lookup"><span data-stu-id="20ce5-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="20ce5-173">\*\* \@ Pub_identity_range\*\*參數，控制配置給發行者的識別範圍大小。</span><span class="sxs-lookup"><span data-stu-id="20ce5-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="20ce5-174">\*\* \@ 臨界值\*\*參數，用於判斷訂閱何時需要新的識別範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="20ce5-175">例如，您可以為\*\* \@ pub_identity_range**指定10000，1000用於** \@ Identity_range\*\* (會假設訂閱者) 的更新較少，而80百分比表示\*\* \@ 閾值\*\*。</span><span class="sxs-lookup"><span data-stu-id="20ce5-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="20ce5-176">在「訂閱者」端執行 800 次插入 (1000 的 80%) 之後，將為「訂閱者」指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="20ce5-177">在「發行者」端執行 8000 次插入之後，將為「發行者」指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="20ce5-178">指派新範圍時，資料表裡的識別範圍值中會有一個間隔。</span><span class="sxs-lookup"><span data-stu-id="20ce5-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="20ce5-179">指定的臨界值越高間距就越小，但系統的容錯功能也就越弱：如果「散發代理程式」因某種原因無法執行，「訂閱者」可能更容易用盡識別。</span><span class="sxs-lookup"><span data-stu-id="20ce5-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="20ce5-180">為手動識別範圍管理指派範圍</span><span class="sxs-lookup"><span data-stu-id="20ce5-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="20ce5-181">如果指定手動識別範圍管理，則必須確定「發行者」與每個「訂閱者」都使用不同的識別範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="20ce5-182">例如，考慮識別欄位定義為 `IDENTITY(1,1)`之「發行者」端的資料表：識別欄位從 1 開始，每插一個資料列即遞增 1。</span><span class="sxs-lookup"><span data-stu-id="20ce5-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="20ce5-183">如果「發行者」端的資料表有 5,000 個資料列，而您希望在應用程式使用期間資料表有所成長，「發行者」可以使用範圍 1-10,000。</span><span class="sxs-lookup"><span data-stu-id="20ce5-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="20ce5-184">假設有兩個「訂閱者」，「訂閱者 A」可以使用 10,001-20,000，「訂閱者 B」可以使用 20,001-30,000。</span><span class="sxs-lookup"><span data-stu-id="20ce5-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="20ce5-185">在「訂閱者」透過快照集或其他方式初始化之後，執行 DBCC CHECKIDENT 以為「訂閱者」指派識別範圍的起點。</span><span class="sxs-lookup"><span data-stu-id="20ce5-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="20ce5-186">例如，在「訂閱者 A」端，應執行 `DBCC CHECKIDENT('<TableName>','reseed',10001)`。</span><span class="sxs-lookup"><span data-stu-id="20ce5-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="20ce5-187">在「訂閱者 B」端，應執行 `CHECKIDENT('<TableName>','reseed',20001)`。</span><span class="sxs-lookup"><span data-stu-id="20ce5-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="20ce5-188">若要指派新範圍至「發行者」或「訂閱者」，請執行 DBCC CHECKIDENT 並指定新值以重設資料表的種子資料。</span><span class="sxs-lookup"><span data-stu-id="20ce5-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="20ce5-189">您應該採用某種方式來確定必須在何時指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="20ce5-190">例如，您的應用程式可能有一個機制，可以偵測節點將用盡其範圍的時間，並使用 DBCC CHECKIDENT 指派新範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="20ce5-191">您也可以新增檢查條件約束，以確保在可能超出識別值使用範圍的情況下無法再新增資料列。</span><span class="sxs-lookup"><span data-stu-id="20ce5-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="20ce5-192">在資料庫還原後處理識別範圍</span><span class="sxs-lookup"><span data-stu-id="20ce5-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="20ce5-193">如果使用自動識別範圍管理，則「訂閱者」從備份還原時，會自動要求新的識別範圍值。</span><span class="sxs-lookup"><span data-stu-id="20ce5-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="20ce5-194">如果「發行者」從備份還原，您必須確定為該「發行者」指派了適當的範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="20ce5-195">對於合併式複寫，請使用 [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql) 指派新的範圍。</span><span class="sxs-lookup"><span data-stu-id="20ce5-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="20ce5-196">對於異動複寫，先確定已使用的最大值，然後設定新範圍的起點。</span><span class="sxs-lookup"><span data-stu-id="20ce5-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="20ce5-197">在發行集資料庫還原後使用下列程序：</span><span class="sxs-lookup"><span data-stu-id="20ce5-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="20ce5-198">停止所有「訂閱者」上的所有活動。</span><span class="sxs-lookup"><span data-stu-id="20ce5-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="20ce5-199">對於每個包括識別欄位的已發行資料表：</span><span class="sxs-lookup"><span data-stu-id="20ce5-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="20ce5-200">在每個「訂閱者」端的訂閱資料庫中，執行 `IDENT_CURRENT('<TableName>')`。</span><span class="sxs-lookup"><span data-stu-id="20ce5-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="20ce5-201">記錄所有「訂閱者」中找到的最大值。</span><span class="sxs-lookup"><span data-stu-id="20ce5-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="20ce5-202">在「發行者」端的發行集資料庫中，執行 `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`)。</span><span class="sxs-lookup"><span data-stu-id="20ce5-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="20ce5-203">在「發行者」端的發行集資料庫中，執行 `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`。</span><span class="sxs-lookup"><span data-stu-id="20ce5-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="20ce5-204">如果識別欄位中的值設定為遞減而非遞增，請記錄找到的最小值，然後用該值重設種子資料。</span><span class="sxs-lookup"><span data-stu-id="20ce5-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="20ce5-205">另請參閱</span><span class="sxs-lookup"><span data-stu-id="20ce5-205">See Also</span></span>  
 <span data-ttu-id="20ce5-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="20ce5-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="20ce5-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="20ce5-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="20ce5-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="20ce5-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="20ce5-209">[IDENTITY &#40;屬性&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="20ce5-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="20ce5-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="20ce5-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
