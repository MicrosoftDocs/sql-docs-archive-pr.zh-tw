---
title: 不使用快照集初始化交易式訂閱 | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- transactional replication, initializing
- replication [SQL Server], initializing
- initializing subscriptions [SQL Server replication], without snapshots
ms.assetid: 75c8c1f8-60bc-44a8-944b-d18d1f6bda11
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 88e240b75cdbb239548cfcb8e5d8df5eb2af2973
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585823"
---
# <a name="initialize-a-transactional-subscription-without-a-snapshot"></a><span data-ttu-id="55927-102">不使用快照集初始化交易式訂閱</span><span class="sxs-lookup"><span data-stu-id="55927-102">Initialize a Transactional Subscription Without a Snapshot</span></span>
  <span data-ttu-id="55927-103">依預設，會使用快照集來初始化交易式發行集的訂閱，此快照集由「快照集代理程式」產生並由「散發者代理程式」套用。</span><span class="sxs-lookup"><span data-stu-id="55927-103">By default, a subscription to a transactional publication is initialized with a snapshot, which is generated by the Snapshot Agent and applied by the Distribution Agent.</span></span> <span data-ttu-id="55927-104">在某些狀況下，例如那些牽涉到大型初始資料集的狀況，最好使用其他方法初始化訂閱。</span><span class="sxs-lookup"><span data-stu-id="55927-104">In some scenarios, such as those involving large initial datasets, it is preferable to initialize a subscription using another method.</span></span> <span data-ttu-id="55927-105">其他初始化「訂閱者」的方法包括：</span><span class="sxs-lookup"><span data-stu-id="55927-105">Other methods of initializing a Subscriber include:</span></span>  
  
-   <span data-ttu-id="55927-106">指定一個備份。</span><span class="sxs-lookup"><span data-stu-id="55927-106">Specifying a backup.</span></span> <span data-ttu-id="55927-107">在「訂閱者」上還原備份，「散發代理程式」隨後會複製所有需要的複寫中繼資料與系統程序。</span><span class="sxs-lookup"><span data-stu-id="55927-107">Restore the backup on the Subscriber, and then the Distribution Agent copies any required replication metadata and system procedures.</span></span> <span data-ttu-id="55927-108">用備份進行初始化是將資料傳遞到「訂閱者」的最快方法且相當便利，因為如果最新的備份發生在為「使用備份進行初始化」啟用發行集之後，便可使用。</span><span class="sxs-lookup"><span data-stu-id="55927-108">Initializing with a backup is the fastest way to deliver data to the Subscriber and is convenient, because any recent backup can be used if it was taken after the publication was enabled for initialization with a backup.</span></span>  
  
-   <span data-ttu-id="55927-109">透過其他機制將初始資料集複製到「訂閱者」，例如附加資料庫。</span><span class="sxs-lookup"><span data-stu-id="55927-109">Copying an initial dataset to the Subscriber through another mechanism, such as attaching a database.</span></span> <span data-ttu-id="55927-110">您必須確定「訂閱者」端的資料和結構描述正確，然後「散發代理程式」會複製需要的所有中繼資料和系統程序。</span><span class="sxs-lookup"><span data-stu-id="55927-110">You must ensure the correct data and schema are at the Subscriber, and then the Distribution Agent copies any required metadata and system procedures.</span></span>  
  
## <a name="initializing-a-subscription-with-a-backup"></a><span data-ttu-id="55927-111">使用備份初始化訂閱</span><span class="sxs-lookup"><span data-stu-id="55927-111">Initializing a subscription with a backup</span></span>  
 <span data-ttu-id="55927-112">備份包含整個資料庫；因此當訂閱資料庫被初始化後，每個資料庫都包含發行集資料庫的完整副本：</span><span class="sxs-lookup"><span data-stu-id="55927-112">A backup contains an entire database; therefore each subscription database will contain a complete copy of the publication database when it is initialized:</span></span>  
  
-   <span data-ttu-id="55927-113">備份包含未指定為發行集之發行項的資料表。</span><span class="sxs-lookup"><span data-stu-id="55927-113">The backup includes tables not specified as articles for the publication.</span></span>  
  
-   <span data-ttu-id="55927-114">即使資料列或資料行篩選已在資料表中加以指定，此備份仍會包含所有資料。</span><span class="sxs-lookup"><span data-stu-id="55927-114">The backup includes all data, even if row or column filters are specified on a table.</span></span>  
  
 <span data-ttu-id="55927-115">在還原備份之後，管理員或應用程式有責任移除所有不想要的物件或資料。</span><span class="sxs-lookup"><span data-stu-id="55927-115">It is the responsibility of the administrator or application to remove any unwanted objects or data after the backup has been restored.</span></span> <span data-ttu-id="55927-116">在後續同步處理中，只有當資料變更套用至指定為發行項的資料表，且這些變更滿足您指定的所有篩選條件時，才會複寫資料變更。</span><span class="sxs-lookup"><span data-stu-id="55927-116">In subsequent synchronizations, data changes are only replicated if they apply to tables specified as articles, and the changes meet any filtering criteria you specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="55927-117">還原備份時，如果您想讓「訂閱者」自動進行同步處理，則必須確定備份來自「發行者」。</span><span class="sxs-lookup"><span data-stu-id="55927-117">When restoring a backup, you must ensure that the backup came from the Publisher if you want the Subscriber to automatically synchronize.</span></span> <span data-ttu-id="55927-118">備份中的記錄序號 (LSN) 值 (用於設定啟動同步處理的位置) 對「發行者」是特定的。</span><span class="sxs-lookup"><span data-stu-id="55927-118">The log sequence number (LSN) values in the backup (which are used to set the point at which to start synchronizing) are specific to the Publisher.</span></span>  
  
 <span data-ttu-id="55927-119">**若要使用備份初始化訂閱**</span><span class="sxs-lookup"><span data-stu-id="55927-119">**To initialize a subscription with a backup**</span></span>  
  
 <span data-ttu-id="55927-120">若要使用備份初始化訂閱，在建立發行集時必須先啟用此選項，然後在建立訂閱時指定一些選項的值。</span><span class="sxs-lookup"><span data-stu-id="55927-120">To initialize a subscription with a backup, you first must enable the option when you create a publication, and then specify values for a number of options when you create a subscription.</span></span> <span data-ttu-id="55927-121">發行集可以透過「新增發行集精靈」或以程式設計方式進行啟用。</span><span class="sxs-lookup"><span data-stu-id="55927-121">Publications can be enabled through the New Publication Wizard or programmatically.</span></span> <span data-ttu-id="55927-122">但是，訂閱選項所需的值只能以程式設計方式指定。</span><span class="sxs-lookup"><span data-stu-id="55927-122">However, the values required for the subscription options can only be specified programmatically.</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="55927-123">：[為交易式發行集啟用使用備份的初始化 &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="55927-123">: [Enable Initialization with a Backup for Transactional Publications &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span></span>  
  
-   <span data-ttu-id="55927-124">複寫 Transact-SQL 程式設計：[從備份初始化交易式訂閱 &#40;複寫 Transact-SQL 程式設計&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span><span class="sxs-lookup"><span data-stu-id="55927-124">Replication Transact-SQL programming: [Initialize a Transactional Subscription from a Backup &#40;Replication Transact-SQL Programming&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="55927-125">如果訂閱未使用快照集初始化，在發行者端執行 SQL Server 服務的帳戶必須具有散發者端快照集資料夾的寫入權限。</span><span class="sxs-lookup"><span data-stu-id="55927-125">If a subscription is initialized without using a snapshot, the account under which the SQL Server service runs at the Publisher must have write permissions on the snapshot folder at the Distributor.</span></span> <span data-ttu-id="55927-126">如需權限的資訊，請參閱＜ [Replication Agent Security Model](security/replication-agent-security-model.md)＞。</span><span class="sxs-lookup"><span data-stu-id="55927-126">For more information about permissions, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
### <a name="ensuring-the-suitability-of-a-backup"></a><span data-ttu-id="55927-127">確定備份的適合性</span><span class="sxs-lookup"><span data-stu-id="55927-127">Ensuring the suitability of a backup</span></span>  
 <span data-ttu-id="55927-128">如果備份後發生的所有交易均儲存在「散發者」端，則備份適用於初始化「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="55927-128">A backup is suitable for initializing a Subscriber if all transactions that occur after the backup was taken are stored at the Distributor.</span></span> <span data-ttu-id="55927-129">如果備份不適合，則複寫會顯示一條錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="55927-129">Replication will display an error message if the backup is not suitable.</span></span>  
  
 <span data-ttu-id="55927-130">若要幫助確定備份適合使用，請遵循下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="55927-130">To help ensure that a backup is suitable for use, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="55927-131">使用可用的最新備份，如果最新備份早於最長散發保留期限，則在嘗試使用備份來初始化訂閱前建立一個新備份。</span><span class="sxs-lookup"><span data-stu-id="55927-131">Use the latest backup available, and if the latest backup is older than the maximum distribution retention period, create a new backup before attempting to initialize a subscription with a backup.</span></span> <span data-ttu-id="55927-132">如需保留期限的詳細資訊，請參閱＜ [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md)＞。</span><span class="sxs-lookup"><span data-stu-id="55927-132">For more information about retention period, see [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="55927-133">依預設，散發清除作業會從散發資料庫中清除 72 小時前的交易。</span><span class="sxs-lookup"><span data-stu-id="55927-133">By default, the distribution cleanup job clears transactions older than 72 hours from the distribution database.</span></span> <span data-ttu-id="55927-134">清除是根據為發行集設定的保留期限來進行的。</span><span class="sxs-lookup"><span data-stu-id="55927-134">Cleanup is based on the retention period set for the publication.</span></span> <span data-ttu-id="55927-135">與較舊的備份進行同步處理時，請考慮在您要還原備份之前暫時停用作業，並在訂閱成功建立後要重新啟用它。</span><span class="sxs-lookup"><span data-stu-id="55927-135">When synchronizing with older backups, consider temporarily disabling the job before the backup you would like to restore and re-enabling it after the subscription is successfully created.</span></span> <span data-ttu-id="55927-136">這可防止交易從可能需要從備份成功進行同步處理的散發資料庫中移除。</span><span class="sxs-lookup"><span data-stu-id="55927-136">This prevents removal of transactions from the distribution database that might be needed to synchronize successfully from the backup.</span></span> <span data-ttu-id="55927-137">如需執行清除作業的資訊，請參閱[執行複寫維護作業 &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="55927-137">For information about running cleanup jobs, see [Run Replication Maintenance Jobs &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md).</span></span>  
  
 <span data-ttu-id="55927-138">在某些情況下，您必須在設定使用備份進行了初始化的訂閱後，在還原的「訂閱者」資料庫中手動執行自訂。</span><span class="sxs-lookup"><span data-stu-id="55927-138">In some cases you must manually perform customizations in the restored Subscriber database after setting up subscriptions that are initialized with a backup.</span></span> <span data-ttu-id="55927-139">一般而言，如果定義「發行集」的方式為「訂閱者」資料庫內容應不同於「發行者」資料庫內容，則要求在還原的「訂閱者」資料庫端進行手動修改。</span><span class="sxs-lookup"><span data-stu-id="55927-139">In general, manual modifications at the restored Subscriber database are required if the Publication is defined in such a way that the Subscriber database content is expected to be different from the Publisher database content.</span></span>  
  
-   <span data-ttu-id="55927-140">如果將還原資料庫中的索引檢視做為記錄式索引檢視發行項來發行，則必須將它們轉換成資料表。</span><span class="sxs-lookup"><span data-stu-id="55927-140">Indexed-views at the restored database have to be converted to tables if they are published as log-based indexed-view-to-table articles</span></span>  
  
-   <span data-ttu-id="55927-141">還原資料庫中的訂閱時間戳記資料行必須轉換為 **binary(8)** 資料行：將包含時間戳記資料行之資料表的內容複製到含相符結構描述的新資料表 (除非含有的是 **binary(8)** 資料行而非時間戳記資料行)，拖拽原始資料表，並將新資料表重新命名為原始資料表的名稱。</span><span class="sxs-lookup"><span data-stu-id="55927-141">Subscribed timestamp columns at the restored database must be converted to **binary(8)** columns: copy the content of the tables containing timestamp columns to new tables with matching schemas except having **binary(8)** columns in place of the timestamp columns, drop the original tables, and rename the new tables with the same names as the original tables.</span></span>  
  
## <a name="initializing-a-subscription-with-an-alternative-method"></a><span data-ttu-id="55927-142">使用替代方法初始化訂閱</span><span class="sxs-lookup"><span data-stu-id="55927-142">Initializing a subscription with an alternative method</span></span>  
 <span data-ttu-id="55927-143">使用可讓您將發行集資料庫結構描述與資料複製到「訂閱者」的任何方法，均有可能初始化訂閱，例如 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="55927-143">It is possible to initialize a subscription using any method that allows you to copy the publication database schema and data to the Subscriber, such as [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].</span></span> <span data-ttu-id="55927-144">當您使用替代方法來初始化「訂閱者」時，複寫支援物件會複製到「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="55927-144">When you use an alternative method to initialize the Subscriber, replication support objects are copied to the Subscriber.</span></span>  
  
 <span data-ttu-id="55927-145">與使用備份進行初始化不同，您或您的應用程式必須確定資料與結構描述在您新增訂閱時已正確進行了同步處理。</span><span class="sxs-lookup"><span data-stu-id="55927-145">Unlike initializing with a backup, you or your application must ensure the data and schema are properly synchronized at the time you add the subscription.</span></span> <span data-ttu-id="55927-146">例如，若在複製資料和結構描述到訂閱者的時間，與加入訂閱的時間之間，發行者端有活動，此活動所導致的變更可能不會複寫到訂閱者。</span><span class="sxs-lookup"><span data-stu-id="55927-146">If, for example, there is activity on the Publisher between the time data and schema are copied to the Subscriber and the time at which the subscription is added, changes resulting from this activity might not be replicated to the Subscriber.</span></span>  
  
 <span data-ttu-id="55927-147">若要使用替代方法初始化訂閱，請參閱＜ [Initialize a Subscription Manually](initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="55927-147">To initialize a subscription with an alternative method, see [Initialize a Subscription Manually](initialize-a-subscription-manually.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="55927-148">另請參閱</span><span class="sxs-lookup"><span data-stu-id="55927-148">See Also</span></span>  
 [<span data-ttu-id="55927-149">初始化訂閱</span><span class="sxs-lookup"><span data-stu-id="55927-149">Initialize a Subscription</span></span>](initialize-a-subscription.md)  
  
  
