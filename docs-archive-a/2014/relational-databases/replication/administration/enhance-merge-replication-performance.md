---
title: 增強合併式複寫效能 | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- designing databases [SQL Server], replication performance
- Merge Agent, performance
- snapshots [SQL Server replication], performance considerations
- merge replication performance [SQL Server replication]
- subscriptions [SQL Server replication], performance considerations
- performance [SQL Server replication], merge replication
- agents [SQL Server replication], performance
ms.assetid: f929226f-b83d-4900-a07c-a62f64527c7f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 41dc258e9b45e9839ad142e73cb145999d02986c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709241"
---
# <a name="enhance-merge-replication-performance"></a><span data-ttu-id="57cda-102">增強合併式複寫效能</span><span class="sxs-lookup"><span data-stu-id="57cda-102">Enhance Merge Replication Performance</span></span>
  <span data-ttu-id="57cda-103">除了考慮＜ [增強一般複寫效能](enhance-general-replication-performance.md)＞中所述的一般效能提示之外，還要考慮合併式複寫特定的以下幾個其他方面。</span><span class="sxs-lookup"><span data-stu-id="57cda-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to merge replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="57cda-104">資料庫設計</span><span class="sxs-lookup"><span data-stu-id="57cda-104">Database Design</span></span>  
  
-   <span data-ttu-id="57cda-105">資料列篩選與聯結篩選中使用的索引資料行。</span><span class="sxs-lookup"><span data-stu-id="57cda-105">Index columns used in row filters and join filters.</span></span>  
  
     <span data-ttu-id="57cda-106">當您在已發行的發行項上使用資料列篩選時，請在篩選的 WHERE 子句中所使用的每個資料行上建立一個索引。</span><span class="sxs-lookup"><span data-stu-id="57cda-106">When you use a row filter on a published article, create an index on each of the columns that is used in the filter's WHERE clause.</span></span> <span data-ttu-id="57cda-107">如果沒有索引，[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 就必須讀取資料表中的每個資料列來判斷該資料列是否應包含在資料分割中。</span><span class="sxs-lookup"><span data-stu-id="57cda-107">Without an index, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has to read each row in the table to determine whether the row should be included in the partition.</span></span> <span data-ttu-id="57cda-108">有了索引之後， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 就可以很快地找出應該包含的資料列。</span><span class="sxs-lookup"><span data-stu-id="57cda-108">With an index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can quickly locate which rows should be included.</span></span> <span data-ttu-id="57cda-109">當複寫單從索引便可完全解析篩選的 WHERE 子句時，便能產生最快的處理速度。</span><span class="sxs-lookup"><span data-stu-id="57cda-109">The fastest processing takes place if replication can fully resolve the WHERE clause of the filter from the index alone.</span></span>  
  
     <span data-ttu-id="57cda-110">為聯結篩選所使用的全部資料行加上索引也非常重要。</span><span class="sxs-lookup"><span data-stu-id="57cda-110">Indexing all the columns used in join filters is also important.</span></span> <span data-ttu-id="57cda-111">每次執行「合併代理程式」時，系統都會搜尋基底資料表，以決定父資料表與相關資料表中哪些資料列應該包含於資料分割。</span><span class="sxs-lookup"><span data-stu-id="57cda-111">Each time the Merge Agent runs, it searches the base table to determine which rows in a parent table and which rows in related tables are included in a partition.</span></span> <span data-ttu-id="57cda-112">為聯結的資料行建立索引可避免 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 在「合併式代理程式」每次執行時都讀取資料表中的每個資料列。</span><span class="sxs-lookup"><span data-stu-id="57cda-112">Creating an index on the joined columns avoids having [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] read each row in the table every time the Merge Agent runs.</span></span>  
  
     <span data-ttu-id="57cda-113">如需篩選的詳細資訊，請參閱[篩選合併式複寫之發行的資料](../merge/filter-published-data-for-merge-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-113">For more information on filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="57cda-114">考慮包括大型物件 (LOB) 資料類型的過度正規化資料表。</span><span class="sxs-lookup"><span data-stu-id="57cda-114">Consider overnormalizing tables that include Large Object (LOB) data types.</span></span>  
  
     <span data-ttu-id="57cda-115">發生同步處理時，「合併代理程式」可能需要從「發行者」或「訂閱者」讀取及傳送整個資料列。</span><span class="sxs-lookup"><span data-stu-id="57cda-115">When synchronization occurs, the Merge Agent might need to read and transfer the entire data row from a Publisher or Subscriber.</span></span> <span data-ttu-id="57cda-116">如果資料列包含使用 LOB 的資料行，則上述處理可能需要額外的記憶體配置，且即使這些資料行並未更新仍會對效能造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="57cda-116">If the row contains columns that use LOBs, this process can require additional memory allocation and negatively impact performance even though these columns may not have been updated.</span></span> <span data-ttu-id="57cda-117">為了降低這一效能影響的可能性，請考慮將 LOB 資料行置於另一個資料表，對資料列資料的其餘部分使用一對一關聯性。</span><span class="sxs-lookup"><span data-stu-id="57cda-117">To reduce the likelihood that this performance impact occurs, consider putting LOB columns in a separate table using a one-to-one relationship to the rest of the row data.</span></span> <span data-ttu-id="57cda-118">資料類型 `text`、`ntext` 和 `image` 已被取代。</span><span class="sxs-lookup"><span data-stu-id="57cda-118">The data types `text`, `ntext`, and `image` are deprecated.</span></span> <span data-ttu-id="57cda-119">若您納入 LOB，建議您分別依序使用資料類型 `varchar(max)`、`nvarchar(max)`、`varbinary(max)`。</span><span class="sxs-lookup"><span data-stu-id="57cda-119">If you do include LOBs, we recommend that you use the data types `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, respectively.</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="57cda-120">發行集設計</span><span class="sxs-lookup"><span data-stu-id="57cda-120">Publication Design</span></span>  
  
-   <span data-ttu-id="57cda-121">使用 90RTM 的發行集相容性層級 ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本)。</span><span class="sxs-lookup"><span data-stu-id="57cda-121">Use a publication compatibility level of 90RTM ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version).</span></span>  
  
     <span data-ttu-id="57cda-122">除非一個或多個「訂閱者」使用不同版本的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]，否則請指定該發行集必須僅支援 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="57cda-122">Unless one or more Subscribers use a different version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], specify that the publication must support only [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span> <span data-ttu-id="57cda-123">這可讓發行集利用新功能與效能最佳化。</span><span class="sxs-lookup"><span data-stu-id="57cda-123">This allows the publication to take advantage of new features and performance optimizations.</span></span>  
  
-   <span data-ttu-id="57cda-124">使用適當的發行集保留設定。</span><span class="sxs-lookup"><span data-stu-id="57cda-124">Use appropriate publication retention settings.</span></span>  
  
     <span data-ttu-id="57cda-125">發行集保留期限，即訂閱必須進行同步處理之前的最長時間，它決定追蹤中繼資料的儲存時間。</span><span class="sxs-lookup"><span data-stu-id="57cda-125">The publication retention period, which is the maximum amount of time before a subscription must be synchronized, determines how long tracking metadata is stored.</span></span> <span data-ttu-id="57cda-126">值較大可能會影響儲存與處理效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-126">A high value can affect storage and processing performance.</span></span> <span data-ttu-id="57cda-127">如需設定發行集保留期限的詳細資訊，請參閱＜ [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md)＞。</span><span class="sxs-lookup"><span data-stu-id="57cda-127">For more information about setting the publication retention period, see [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="57cda-128">使用只在發行者端變更之資料表的僅限下載發行項。</span><span class="sxs-lookup"><span data-stu-id="57cda-128">Use download-only articles on those tables that are only changed at the Publisher.</span></span> <span data-ttu-id="57cda-129">如需詳細資訊，請參閱[使用僅限下載的發行項最佳化合併式複寫效能](../merge/optimize-merge-replication-performance-with-download-only-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-129">For more information, see [Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span></span>  
  
### <a name="filter-design-and-use"></a><span data-ttu-id="57cda-130">篩選設計與使用</span><span class="sxs-lookup"><span data-stu-id="57cda-130">Filter Design and Use</span></span>  
  
-   <span data-ttu-id="57cda-131">限制資料列篩選子句的複雜性。</span><span class="sxs-lookup"><span data-stu-id="57cda-131">Limit the complexity of row filter clauses.</span></span>  
  
     <span data-ttu-id="57cda-132">限制篩選條件的複雜度可在「合併代理程式」評估資料列變更以便傳送至「訂閱者」時協助改善效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-132">Limiting the complexity of the filtering criteria helps improve performance when the Merge Agent is evaluating row changes to send to Subscribers.</span></span> <span data-ttu-id="57cda-133">請避免在合併資料列篩選子句內使用子選取。</span><span class="sxs-lookup"><span data-stu-id="57cda-133">Avoid using sub-selects within merge row filter clauses.</span></span> <span data-ttu-id="57cda-134">反之請考慮使用聯結篩選，當您要依據某個資料表中的資料列篩選子句來分割另一個資料表中的資料時，使用聯結篩選通常更有效率。</span><span class="sxs-lookup"><span data-stu-id="57cda-134">Instead, consider using join filters, which are generally more efficient when used to partition data in one table based on the row filter clause in another table.</span></span> <span data-ttu-id="57cda-135">如需篩選的詳細資訊，請參閱[篩選合併式複寫之發行的資料](../merge/filter-published-data-for-merge-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-135">For more information about filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="57cda-136">使用有參數化篩選的預先計算的資料分割 (預設為使用這項功能)。</span><span class="sxs-lookup"><span data-stu-id="57cda-136">Use precomputed partitions with parameterized filters (this feature is used by default).</span></span> <span data-ttu-id="57cda-137">如需詳細資訊，請參閱[使用預先計算的資料分割最佳化參數化篩選效能](../merge/parameterized-filters-optimize-for-precomputed-partitions.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-137">For more information, see [Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>  
  
     <span data-ttu-id="57cda-138">預先計算的資料分割會對篩選行為造成許多限制。</span><span class="sxs-lookup"><span data-stu-id="57cda-138">Precomputed partitions impose a number of limits on filtering behavior.</span></span> <span data-ttu-id="57cda-139">如果您的應用程式無法遵守這些限制，請將 **keep_partition_changes** 選項設定為 **True**，以改善效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-139">If your application cannot adhere to these limitations, set the **keep_partition_changes** option to **True**, which provides a performance benefit.</span></span> <span data-ttu-id="57cda-140">如需詳細資訊，請參閱＜ [參數化資料列篩選器](../merge/parameterized-filters-parameterized-row-filters.md)＞。</span><span class="sxs-lookup"><span data-stu-id="57cda-140">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="57cda-141">如果資料已篩選，但是未在使用者之間共用，則使用非重疊資料分割。</span><span class="sxs-lookup"><span data-stu-id="57cda-141">Use nonoverlapping partitions if data is filtered but not shared among users.</span></span>  
  
     <span data-ttu-id="57cda-142">複寫可以最佳化未在資料分割或訂閱間共用之資料的效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-142">Replication can optimize performance for data that is not shared between partitions or subscriptions.</span></span> <span data-ttu-id="57cda-143">如需詳細資訊，請參閱＜ [參數化資料列篩選器](../merge/parameterized-filters-parameterized-row-filters.md)＞。</span><span class="sxs-lookup"><span data-stu-id="57cda-143">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="57cda-144">不要建立複雜的聯結篩選階層。</span><span class="sxs-lookup"><span data-stu-id="57cda-144">Do not create complex join filter hierarchies.</span></span>  
  
     <span data-ttu-id="57cda-145">在合併處理期間聯結篩選五個 (含) 以上資料表可能對效能有很大影響。</span><span class="sxs-lookup"><span data-stu-id="57cda-145">Join filters with five or more tables can significantly impact performance during merge processing.</span></span> <span data-ttu-id="57cda-146">建議要產生包含五個 (含) 以上資料表的聯結篩選時，考慮使用其他解決方案：</span><span class="sxs-lookup"><span data-stu-id="57cda-146">We recommend that if you are generating join filters of five or more tables that you consider other solutions:</span></span>  
  
    -   <span data-ttu-id="57cda-147">不要篩選主要為下列類型的資料表：查閱資料表、小型資料表以及內容不會變更的資料表。</span><span class="sxs-lookup"><span data-stu-id="57cda-147">Avoid filtering tables that are primarily lookup tables, smaller tables, and tables that are not subject to change.</span></span> <span data-ttu-id="57cda-148">讓這些資料表整體成為發行集的一部分。</span><span class="sxs-lookup"><span data-stu-id="57cda-148">Make those tables part of the publication in their entirety.</span></span> <span data-ttu-id="57cda-149">建議僅在必須分割給「訂閱者」的資料表之間使用聯結篩選。</span><span class="sxs-lookup"><span data-stu-id="57cda-149">We recommend that you use join filters only between tables that must be partitioned among Subscribers.</span></span> <span data-ttu-id="57cda-150">如需相關資訊，請參閱 [Join Filters](../merge/join-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-150">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
    -   <span data-ttu-id="57cda-151">如果聯結中有大量資料表，請考慮去除資料庫正規化的設計或使用對應資料表。</span><span class="sxs-lookup"><span data-stu-id="57cda-151">Consider denormalizing the database design or using a mapping table if there are a large number of tables in a join.</span></span> <span data-ttu-id="57cda-152">例如，如果業務員僅需其客戶的資料，但需要六個聯結以將客戶與業務員關聯，請考慮在客戶資料表中新增一個資料行以識別該業務員。</span><span class="sxs-lookup"><span data-stu-id="57cda-152">For example, if a sales person needs only the data for her customers, but it requires six joins to associate a customer with a sales person, consider adding a column to the customer table that identifies the sales person.</span></span> <span data-ttu-id="57cda-153">業務員資料有所重複，但複寫資料分割的效能益處可能要超過去除資料表正規化的成本。</span><span class="sxs-lookup"><span data-stu-id="57cda-153">The sales person data is redundant, but the costs of denormalizing the tables somewhat might be outweighed by the performance benefits for replication partitioning.</span></span>  
  
    -   <span data-ttu-id="57cda-154">當批次包含大量資料變更時，若要提升預先計算的資料分割效能，請小心設計您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="57cda-154">To improve the performance of precomputed partitions when batches contain lots of data changes, design your application with care.</span></span> <span data-ttu-id="57cda-155">務必確定先變更聯結篩選中父資料表的資料，然後再進行子資料表中對應的變更。</span><span class="sxs-lookup"><span data-stu-id="57cda-155">Make sure that changes to data in the parent table in a join filter are made before corresponding changes in the child tables.</span></span>  
  
-   <span data-ttu-id="57cda-156">如果邏輯允許，則將 **join_unique_key** 選項設定為 **1** 。</span><span class="sxs-lookup"><span data-stu-id="57cda-156">Set the **join_unique_key** option to **1** if logic allows.</span></span>  
  
     <span data-ttu-id="57cda-157">將此參數設定為 **1** 指出聯結篩選中子資料表與父資料表之間是一對一或一對多關聯性。</span><span class="sxs-lookup"><span data-stu-id="57cda-157">Setting this parameter to **1** indicates that the relationship between the child and parent tables in a join filter is one to one or one to many.</span></span> <span data-ttu-id="57cda-158">僅在對子資料表中的聯結資料行有保證唯一性的條件約束時，將此參數設定為 **1** 。</span><span class="sxs-lookup"><span data-stu-id="57cda-158">Only set this parameter to **1** if you have a constraint on the joining column in the child table that guarantees uniqueness.</span></span> <span data-ttu-id="57cda-159">如果該參數沒有正確設定為 **1** ，則可能發生資料非聚合。</span><span class="sxs-lookup"><span data-stu-id="57cda-159">If the parameter is set to **1** incorrectly, non-convergence of data can occur.</span></span> <span data-ttu-id="57cda-160">如需相關資訊，請參閱 [Join Filters](../merge/join-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-160">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
-   <span data-ttu-id="57cda-161">使用預先計算的資料分割時，應避免執行有大量變更的批次。</span><span class="sxs-lookup"><span data-stu-id="57cda-161">Avoid executing batches with lots of changes when you use precomputed partitions.</span></span>  
  
     <span data-ttu-id="57cda-162">在執行包含大量資料變更的批次之後執行合併代理程式時，代理程式會嘗試將此大型批次分割成幾個較小的批次。</span><span class="sxs-lookup"><span data-stu-id="57cda-162">When the Merge Agent is run after you run a batch that contains lots of data changes, the agent tries to divide the large batch into smaller batches.</span></span> <span data-ttu-id="57cda-163">這時候，其他合併代理程式處理序可能會遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="57cda-163">During this time, other Merge Agent processes may be blocked.</span></span> <span data-ttu-id="57cda-164">請考慮減少批次中的變更次數，並在批次之間執行合併代理程式。</span><span class="sxs-lookup"><span data-stu-id="57cda-164">Consider reducing the number of changes in a batch and run the Merge Agent between batches.</span></span> <span data-ttu-id="57cda-165">如果無法這麼做，請增加複寫的 **generation_leveling_threshold** 值。</span><span class="sxs-lookup"><span data-stu-id="57cda-165">If this cannot be done, increase the value of **generation_leveling_threshold** for the publication.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="57cda-166">訂閱考量因素</span><span class="sxs-lookup"><span data-stu-id="57cda-166">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="57cda-167">交錯訂閱同步處理排程。</span><span class="sxs-lookup"><span data-stu-id="57cda-167">Stagger subscription synchronization schedules.</span></span>  
  
     <span data-ttu-id="57cda-168">如果有大量「訂閱者」與某「發行者」同步，請考慮交錯配置排程以使「合併代理程式」在不同時間執行。</span><span class="sxs-lookup"><span data-stu-id="57cda-168">If a large number of Subscribers synchronize with a Publisher, consider staggering the schedules so that Merge Agents run at different times.</span></span> <span data-ttu-id="57cda-169">如需詳細資訊，請參閱 [Specify Synchronization Schedules](../specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-169">For more information, see [Specify Synchronization Schedules](../specify-synchronization-schedules.md).</span></span>  
  
## <a name="merge-agent-parameters"></a><span data-ttu-id="57cda-170">合併代理程式參數</span><span class="sxs-lookup"><span data-stu-id="57cda-170">Merge Agent Parameters</span></span>  
 <span data-ttu-id="57cda-171">如需有關合併代理程式及其參數的詳細資訊，請參閱＜ [Replication Merge Agent](../agents/replication-merge-agent.md)＞。</span><span class="sxs-lookup"><span data-stu-id="57cda-171">For information about the Merge Agent and its parameters, see [Replication Merge Agent](../agents/replication-merge-agent.md).</span></span>  
  
-   <span data-ttu-id="57cda-172">將提取訂閱的所有「訂閱者」升級到 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本。</span><span class="sxs-lookup"><span data-stu-id="57cda-172">Upgrade all Subscribers for pull subscriptions to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span>  
  
     <span data-ttu-id="57cda-173">將「訂閱者」升級到 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新本會升級該「訂閱者」端之訂閱所使用的「合併代理程式」。</span><span class="sxs-lookup"><span data-stu-id="57cda-173">Upgrading the Subscriber to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version upgrades the Merge Agent used by the subscriptions at that Subscriber.</span></span> <span data-ttu-id="57cda-174">若要利用各項新功能與效能最佳化，則需要使用 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 或更新版本的「合併代理程式」。</span><span class="sxs-lookup"><span data-stu-id="57cda-174">To take advantage of many of the new features and performance optimizations, the Merge Agent from [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version is required.</span></span>  
  
-   <span data-ttu-id="57cda-175">如果訂閱透過快速連線進行同步處理，且變更從「發行者」和「訂閱者」端送出，請使用「合併代理程式」的 **-ParallelUploadDownload** 參數。</span><span class="sxs-lookup"><span data-stu-id="57cda-175">If a subscription is synchronized over a fast connection and changes are sent from the Publisher and Subscriber, use the **-ParallelUploadDownload** parameter for the Merge Agent.</span></span>  
  
     [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="57cda-176">引進新的「合併代理程式」參數：**-ParallelUploadDownload**。</span><span class="sxs-lookup"><span data-stu-id="57cda-176">introduced a new Merge Agent parameter: **-ParallelUploadDownload**.</span></span> <span data-ttu-id="57cda-177">設定此參數可讓「合併代理程式」平行處理上傳至「發行者」以及下載至「訂閱者」的變更。</span><span class="sxs-lookup"><span data-stu-id="57cda-177">Setting this parameter allows the Merge Agent to process in parallel the changes uploaded to the Publisher and those downloaded to the Subscriber.</span></span> <span data-ttu-id="57cda-178">這對於高網路頻寬的高容量環境非常有用。</span><span class="sxs-lookup"><span data-stu-id="57cda-178">This is useful in high volume environments with high network bandwidth.</span></span> <span data-ttu-id="57cda-179">可於代理程式設定檔和命令列中指定代理程式參數。</span><span class="sxs-lookup"><span data-stu-id="57cda-179">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="57cda-180">如需詳細資訊，請參閱</span><span class="sxs-lookup"><span data-stu-id="57cda-180">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="57cda-181">處理複寫代理程式設定檔</span><span class="sxs-lookup"><span data-stu-id="57cda-181">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
    -   [<span data-ttu-id="57cda-182">檢視並修改複寫代理程式命令提示字元參數 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="57cda-182">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="57cda-183">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="57cda-183">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
-   <span data-ttu-id="57cda-184">考慮增加 **-MakeGenerationInterval** 參數的值，特別是在同步處理從訂閱者上傳的數目大於下載到訂閱者的數目時。</span><span class="sxs-lookup"><span data-stu-id="57cda-184">Consider increasing the value of the **-MakeGenerationInterval** parameter, especially if synchronization involves more uploads from Subscribers than downloads to Subscribers.</span></span>  
  
-   <span data-ttu-id="57cda-185">當您同步處理具有大量資料的資料列 (例如，具有 LOB 資料行的資料列) 時，Web 同步處理會要求額外的記憶體配置，而這樣會降低效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-185">When you synchronize data rows with a large amount of data, such as rows with LOB columns, Web synchronization can require additional memory allocation and hurt performance.</span></span> <span data-ttu-id="57cda-186">當「合併代理程式」產生 XML 訊息，而此訊息包含了過多具有大量資料的資料列時，便會發生這個情況。</span><span class="sxs-lookup"><span data-stu-id="57cda-186">This occurs when the Merge Agent generates an XML message that contains too many data rows with large amounts of data.</span></span> <span data-ttu-id="57cda-187">如果「合併代理程式」在 Web 同步處理期間耗用太多的資源，請使用以下其中一個方法來減少在單一訊息中所傳送的資料列數目：</span><span class="sxs-lookup"><span data-stu-id="57cda-187">If the Merge Agent is consuming too many resources during Web synchronization, reduce the number of rows sent in a single message in one of the following ways:</span></span>  
  
    -   <span data-ttu-id="57cda-188">對「合併代理程式」使用慢速連結代理程式設定檔。</span><span class="sxs-lookup"><span data-stu-id="57cda-188">Use the slow link agent profile for the Merge Agent.</span></span> <span data-ttu-id="57cda-189">如需相關資訊，請參閱 [Replication Agent Profiles](../agents/replication-agent-profiles.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-189">For more information, see [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span></span>  
  
    -   <span data-ttu-id="57cda-190">將「合併代理程式」的 **-DownloadGenerationsPerBatch** 和 **-UploadGenerationsPerBatch** 參數減少到 10 個 (含) 以下。</span><span class="sxs-lookup"><span data-stu-id="57cda-190">Decrease the **-DownloadGenerationsPerBatch** and **-UploadGenerationsPerBatch** parameters for the Merge Agent to a value of 10 or less.</span></span> <span data-ttu-id="57cda-191">這兩個參數的預設值為 50。</span><span class="sxs-lookup"><span data-stu-id="57cda-191">The default value of these parameters is 50.</span></span>  
  
## <a name="snapshot-considerations"></a><span data-ttu-id="57cda-192">快照集考量</span><span class="sxs-lookup"><span data-stu-id="57cda-192">Snapshot Considerations</span></span>  
  
-   <span data-ttu-id="57cda-193">在產生初始快照集之前，於大型資料表上建立 ROWGUIDCOL 資料行。</span><span class="sxs-lookup"><span data-stu-id="57cda-193">Create a ROWGUIDCOL column on large tables prior to generating the initial snapshot.</span></span>  
  
     <span data-ttu-id="57cda-194">合併式複寫要求每個發行的資料表都要有一個 ROWGUIDCOL 資料行。</span><span class="sxs-lookup"><span data-stu-id="57cda-194">Merge replication requires that each published table have a ROWGUIDCOL column.</span></span> <span data-ttu-id="57cda-195">若在「快照集代理程式」建立最初的快照集檔案之前表格中還沒有 ROWGUIDCOL 資料行的存在，則代理程式就必須先新增並填入 ROWGUIDCOL 資料行。</span><span class="sxs-lookup"><span data-stu-id="57cda-195">If a ROWGUIDCOL column does not exist in the table before the Snapshot Agent creates the initial snapshot files, the agent must first add and populate the ROWGUIDCOL column.</span></span> <span data-ttu-id="57cda-196">若要在合併式複寫期間產生快照集時獲得效能優勢，請在發行之前於每個資料表上建立 ROWGUIDCOL 資料行。</span><span class="sxs-lookup"><span data-stu-id="57cda-196">To gain a performance advantage when generating snapshots during merge replication, create the ROWGUIDCOL column on each table before publishing.</span></span> <span data-ttu-id="57cda-197">資料行可以是任意名稱 (**rowguid** 預設由「快照集代理程式」使用)，但必須包含下列資料類型特性：</span><span class="sxs-lookup"><span data-stu-id="57cda-197">The column can have any name (**rowguid** is used by the Snapshot Agent by default), but must have the following data type characteristics:</span></span>  
  
    -   <span data-ttu-id="57cda-198">資料類型 UNIQUEIDENTIFIER。</span><span class="sxs-lookup"><span data-stu-id="57cda-198">A data type of UNIQUEIDENTIFIER.</span></span>  
  
    -   <span data-ttu-id="57cda-199">預設值 NEWSEQUENTIALID() 或 NEWID()。</span><span class="sxs-lookup"><span data-stu-id="57cda-199">A default of NEWSEQUENTIALID() or NEWID().</span></span> <span data-ttu-id="57cda-200">建議使用 NEWSEQUENTIALID()，因為它可以在進行變更及追蹤變更時提供更高的效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-200">NEWSEQUENTIALID() is recommended because it can provide increased performance when making and tracking changes.</span></span>  
  
    -   <span data-ttu-id="57cda-201">ROWGUIDCOL 屬性集。</span><span class="sxs-lookup"><span data-stu-id="57cda-201">The ROWGUIDCOL property set.</span></span>  
  
    -   <span data-ttu-id="57cda-202">資料行上的唯一索引。</span><span class="sxs-lookup"><span data-stu-id="57cda-202">A unique index on the column.</span></span>  
  
-   <span data-ttu-id="57cda-203">預先產生快照集及/或允許訂閱者在第一次同步處理時，要求快照集的產生與套用。</span><span class="sxs-lookup"><span data-stu-id="57cda-203">Pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
     <span data-ttu-id="57cda-204">使用上述一或兩個選項為使用參數化篩選的發行集提供快照集。</span><span class="sxs-lookup"><span data-stu-id="57cda-204">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="57cda-205">如果不指定任何選項，訂閱會使用一系列 SELECT 與 INSERT 陳述式進行初始化，而非使用 **bcp** 公用程式；此處理要慢很多。</span><span class="sxs-lookup"><span data-stu-id="57cda-205">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="57cda-206">如需詳細資訊，請參閱 [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-206">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
## <a name="maintenance-and-monitoring-considerations"></a><span data-ttu-id="57cda-207">維護與監視考量</span><span class="sxs-lookup"><span data-stu-id="57cda-207">Maintenance and Monitoring Considerations</span></span>  
  
-   <span data-ttu-id="57cda-208">偶爾重新索引合併式複寫系統資料表。</span><span class="sxs-lookup"><span data-stu-id="57cda-208">Occasionally re-index merge replication system tables.</span></span>  
  
     <span data-ttu-id="57cda-209">做為合併式複寫維護的一部份，請不時檢查與合併式複寫相關聯的系統資料表成長： **MSmerge_contents**、 **MSmerge_genhistory**、 **MSmerge_tombstone**、 **MSmerge_current_partition_mappings**和 **MSmerge_past_partition_mappings**。</span><span class="sxs-lookup"><span data-stu-id="57cda-209">As part of maintenance for merge replication, occasionally check the growth of the system tables associated with merge replication: **MSmerge_contents**, **MSmerge_genhistory**, and **MSmerge_tombstone**, **MSmerge_current_partition_mappings**, and **MSmerge_past_partition_mappings**.</span></span> <span data-ttu-id="57cda-210">定期重新整理資料表的索引。</span><span class="sxs-lookup"><span data-stu-id="57cda-210">Periodically re-index these tables.</span></span> <span data-ttu-id="57cda-211">如需詳細資訊，請參閱 [重新組織與重建索引](../../indexes/reorganize-and-rebuild-indexes.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-211">For more information, see [Reorganize and Rebuild Indexes](../../indexes/reorganize-and-rebuild-indexes.md).</span></span>  
  
-   <span data-ttu-id="57cda-212">使用複寫監視器內的 **[同步處理記錄]** 索引標籤監視同步處理效能。</span><span class="sxs-lookup"><span data-stu-id="57cda-212">Monitor synchronization performance using the **Synchronization History** tab in Replication Monitor.</span></span>  
  
     <span data-ttu-id="57cda-213">對於合併式複寫，「複寫監視器」會在 **[同步處理記錄]** 索引標籤中顯示同步處理期間處理之每個發行項的詳細統計資料，包括在每個處理階段 (上傳變更、下載變更等等) 內花費的時間。</span><span class="sxs-lookup"><span data-stu-id="57cda-213">For merge replication, Replication Monitor displays detailed statistics in the **Synchronization History** tab for each article processed during synchronization, including the amount of time spent in each processing phase (uploading changes, downloading changes, and so on).</span></span> <span data-ttu-id="57cda-214">這樣有助於找出導致過慢的特定資料表，同時也是解決合併訂閱效能問題的最佳地點。</span><span class="sxs-lookup"><span data-stu-id="57cda-214">It can help pinpoint specific tables that are causing slow downs and is the best place to troubleshoot performance issues with merge subscriptions.</span></span> <span data-ttu-id="57cda-215">如需有關檢視詳細統計資料的詳細資訊，請參閱[使用複寫監視器來檢視資訊及執行工作](../monitor/view-information-and-perform-tasks-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="57cda-215">For more information on viewing detailed statistics, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
  
