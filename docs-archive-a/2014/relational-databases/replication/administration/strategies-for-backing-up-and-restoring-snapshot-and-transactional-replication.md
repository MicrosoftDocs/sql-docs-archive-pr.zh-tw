---
title: 備份與還原快照式和異動複寫的策略 | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- backups [SQL Server replication], snapshot replication
- restoring [SQL Server replication], transactional replication
- snapshot replication [SQL Server], backup and restore
- restoring [SQL Server replication], snapshot replication
- recovery [SQL Server replication], transactional replication
- transactional replication, backup and restore
- recovery [SQL Server replication], snapshot replication
- sync with backup [SQL Server replication]
- backups [SQL Server replication], transactional replication
ms.assetid: a8afcdbc-55db-4916-a219-19454f561f9e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26f6cf1a61e4df9db79bc5fd90429f86d70a99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87607382"
---
# <a name="strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication"></a><span data-ttu-id="f7ac1-102">備份與還原快照式和異動複寫的策略</span><span class="sxs-lookup"><span data-stu-id="f7ac1-102">Strategies for Backing Up and Restoring Snapshot and Transactional Replication</span></span>
  <span data-ttu-id="f7ac1-103">當為快照式及異動複寫設計備份與還原策略時，需要考慮三個方面：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-103">When you design a backup and restore strategy for snapshot and transactional replication, there are three areas to consider:</span></span>  
  
-   <span data-ttu-id="f7ac1-104">要備份的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-104">Which databases to back up.</span></span>  
  
-   <span data-ttu-id="f7ac1-105">異動複寫的備份設定。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-105">Backup settings for transactional replication.</span></span>  
  
-   <span data-ttu-id="f7ac1-106">還原資料庫的必要步驟。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-106">The steps that are required to restore a database.</span></span> <span data-ttu-id="f7ac1-107">這些步驟是根據複寫類型和所選擇的選項而不同。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-107">These depend on the type of replication and options chosen.</span></span>  
  
 <span data-ttu-id="f7ac1-108">本主題在接下來的三節中對這些方面一一進行說明。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-108">This topic covers each of these areas in the next three sections.</span></span> <span data-ttu-id="f7ac1-109">如需 Oracle 發行之備份及還原的詳細資訊，請參閱 [Oracle 發行者的備份與還原](../non-sql/backup-and-restore-for-oracle-publishers.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-109">For information about backup and restore for Oracle publishing, see [Backup and Restore for Oracle Publishers](../non-sql/backup-and-restore-for-oracle-publishers.md).</span></span>  
  
## <a name="backing-up-databases"></a><span data-ttu-id="f7ac1-110">備份資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-110">Backing up Databases</span></span>  
 <span data-ttu-id="f7ac1-111">對於快照式及異動複寫，您應定期備份下列資料庫：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-111">For snapshot and transactional replication, you should regularly back up the following databases:</span></span>  
  
-   <span data-ttu-id="f7ac1-112">在「發行者」端的發行集資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-112">The publication database at the Publisher.</span></span>  
  
-   <span data-ttu-id="f7ac1-113">在「散發者」端的散發資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-113">The distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="f7ac1-114">在每個「訂閱者」端的訂閱資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-114">The subscription database at each Subscriber.</span></span>  
  
-   <span data-ttu-id="f7ac1-115">發行者、散發者及所有訂閱者端的 **master** 與 **msdb** 系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-115">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="f7ac1-116">這些資料庫應與其他每個及相關的複寫資料庫同時備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-116">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="f7ac1-117">例如，在您備份發行集資料庫的同時，在「發行者」端備份 **master** 與 **msdb** 資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-117">For example, back up the **master** and **msdb** databases at the Publisher at the same time that you back up the publication database.</span></span> <span data-ttu-id="f7ac1-118">如果還原發行集資料庫，請確定 **master** 和 **msdb** 資料庫在複寫組態和設定上與發行集資料庫一致。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-118">If the publication database is restored, make sure that the **master** and **msdb** databases are consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
 <span data-ttu-id="f7ac1-119">如果您執行一般記錄備份，就必須在記錄備份中擷取任何複寫相關的變更。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-119">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="f7ac1-120">如果不執行記錄備份，則每當與複寫相關的設定發生變更時，便應該執行備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-120">If you do not perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="f7ac1-121">如需相關資訊，請參閱 [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-121">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
## <a name="backup-settings-for-transactional-replication"></a><span data-ttu-id="f7ac1-122">異動複寫的備份設定</span><span class="sxs-lookup"><span data-stu-id="f7ac1-122">Backup Settings for Transactional Replication</span></span>  
 <span data-ttu-id="f7ac1-123">異動複寫包含使用 **sync with backup** 選項 (可以在散發資料庫和發行集資料庫上設定)：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-123">Transactional replication includes using the **sync with backup** option, which can be set on the distribution database and the publication database:</span></span>  
  
-   <span data-ttu-id="f7ac1-124">建議在所有情況下，於散發資料庫上設定此選項。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-124">We recommend that you always set this option on the distribution database.</span></span>  
  
     <span data-ttu-id="f7ac1-125">在散發資料庫上設定此選項，可確保發行集資料庫記錄檔中的交易在散發資料庫中備份之前，不會被截斷。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-125">Setting this option on the distribution database ensures that transactions in the log of the publication database will not be truncated until they have been backed up at the distribution database.</span></span> <span data-ttu-id="f7ac1-126">散發資料庫可以還原到上次備份時的狀況，任何遺漏的交易都會從發行集資料庫傳遞到散發資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-126">The distribution database can be restored to the last backup, and any missing transactions are delivered from the publication database to the distribution database.</span></span> <span data-ttu-id="f7ac1-127">複寫會繼續，不受影響。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-127">Replication continues unaffected.</span></span>  
  
     <span data-ttu-id="f7ac1-128">在散發資料庫上設定此選項不會影響複寫延遲。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-128">Setting this option on the distribution database does not affect replication latency.</span></span> <span data-ttu-id="f7ac1-129">不過，此選項會延遲截斷發行集資料庫上的記錄的時間，使其在散發資料庫中相對應的交易備份之前，不會被截斷</span><span class="sxs-lookup"><span data-stu-id="f7ac1-129">However, the option will delay the truncation of the log on the publication database until the corresponding transactions in the distribution database have been backed up.</span></span> <span data-ttu-id="f7ac1-130">(這可能會造成發行集資料庫中存有較大的交易記錄)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-130">(This can create a larger transaction log in the publication database.)</span></span>  
  
-   <span data-ttu-id="f7ac1-131">如果您的應用程式允許額外的延遲，則建議在發行集資料庫上設定此選項。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-131">We recommend that you set this option on the publication database if your application can tolerate additional latency.</span></span>  
  
     <span data-ttu-id="f7ac1-132">在發行集資料庫上設定此選項，可確保交易在發行集資料庫中備份之前，不會傳遞到散發資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="f7ac1-133">最近一次的發行集資料庫備份這時可以在「發行者」端還原，同時不會出現這種情況：散發資料庫擁有的交易，在還原的發行集資料庫中不存在。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-133">The last publication database backup can then be restored at the Publisher without any chance of the distribution database having transactions that the restored publication database does not have.</span></span>  
  
     <span data-ttu-id="f7ac1-134">延遲和輸送量會受到影響，因為交易在「發行者」端備份之前，不能傳遞到散發資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-134">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher.</span></span> <span data-ttu-id="f7ac1-135">例如，如果交易記錄檔每五分鐘備份一次，則「發行者」端正在認可的交易與正在傳遞到散發資料庫 (繼而傳遞到「訂閱者」端) 的交易之間會存在額外的五分鐘延遲。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-135">For example, if the transaction log is backed up every five minutes, there is an additional five minutes of latency between when a transaction is committed at the Publisher and when the transaction is delivered to the distribution database, and subsequently the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f7ac1-136">**sync with backup** 選項確保了發行集資料庫與散發資料庫之間的一致性，但該選項不能保證資料不會遺失。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-136">The **sync with backup** option ensures consistency between the publication database and the distribution database, but the option does not guarantee against data loss.</span></span> <span data-ttu-id="f7ac1-137">例如，如果交易記錄檔遺失，則自最後一次交易記錄檔備份以後才認可的交易，在發行集資料庫或散發資料庫中都不可用。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-137">For example, if the transaction log is lost, transactions that have been committed since the last transaction log backup will not be available in the publication database or the distribution database.</span></span> <span data-ttu-id="f7ac1-138">這是與非複寫資料庫相同的行為。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-138">This is the same behavior as a nonreplicated database.</span></span>  
  
 <span data-ttu-id="f7ac1-139">**若要設定 sync with backup 選項**</span><span class="sxs-lookup"><span data-stu-id="f7ac1-139">**To set the sync with backup option**</span></span>  
  
-   <span data-ttu-id="f7ac1-140">複寫 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 程式設計：[為異動複寫啟用協調備份 &#40;複寫 Transact-SQL 程式設計&#41;](enable-coordinated-backups-for-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-140">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: [Enable Coordinated Backups for Transactional Replication &#40;Replication Transact-SQL Programming&#41;](enable-coordinated-backups-for-transactional-replication.md)</span></span>  
  
## <a name="restoring-databases-involved-in-replication"></a><span data-ttu-id="f7ac1-141">還原複寫中牽涉到的資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-141">Restoring Databases Involved in Replication</span></span>  
 <span data-ttu-id="f7ac1-142">如果最近的備份可用並遵循適當的步驟，則可以還原複寫拓撲中的所有資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-142">You can restore all databases in a replication topology if recent backups are available and the appropriate steps are followed.</span></span> <span data-ttu-id="f7ac1-143">發行集資料庫的還原步驟取決於所使用的複寫類型和選項，但是所有其他資料庫的還原步驟與複寫類型和選項無關。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-143">The restore steps for the publication database depend on the type of replication and options that are used; however, the restore steps for all other databases are independent of the type and options.</span></span>  
  
 <span data-ttu-id="f7ac1-144">複寫支援將複寫資料庫還原到與原先建立備份的同一個伺服器與資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-144">Replication supports restoring replicated databases to the same server and database from which the backup was created.</span></span> <span data-ttu-id="f7ac1-145">如果您將複寫資料庫的備份還原到另一個伺服器或資料庫，將無法保留複寫設定。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-145">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="f7ac1-146">在此情況下，您必須在還原備份之後，重新建立所有發行集和訂閱。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-146">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span>  
  
### <a name="publisher"></a><span data-ttu-id="f7ac1-147">發行者</span><span class="sxs-lookup"><span data-stu-id="f7ac1-147">Publisher</span></span>  
 <span data-ttu-id="f7ac1-148">對以下類型的複寫提供有還原步驟：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-148">There are restore steps provided for the following types of replication:</span></span>  
  
-   <span data-ttu-id="f7ac1-149">快照式複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-149">Snapshot replication</span></span>  
  
-   <span data-ttu-id="f7ac1-150">唯讀異動複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-150">Read-only transactional replication</span></span>  
  
-   <span data-ttu-id="f7ac1-151">具有可更新訂閱的異動複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-151">Transactional replication with updating subscriptions</span></span>  
  
-   <span data-ttu-id="f7ac1-152">點對點異動複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-152">Peer-to-peer transactional replication</span></span>  
  
 <span data-ttu-id="f7ac1-153">**msdb** 和 **master** 資料庫的還原 (也涵蓋在本節中) 對所有四種類型都相同。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-153">The restore of the **msdb** and **master** databases, which are also covered in this section, is the same for all four types.</span></span>  
  
#### <a name="publication-database-snapshot-replication"></a><span data-ttu-id="f7ac1-154">發行集資料庫：快照式複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-154">Publication Database: Snapshot Replication</span></span>  
  
1.  <span data-ttu-id="f7ac1-155">還原最新的發行集資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-155">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="f7ac1-156">移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-156">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="f7ac1-157">發行集資料庫備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-157">Does the publication database backup contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-158">若為是，則還原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-158">If yes, the restore is completed.</span></span> <span data-ttu-id="f7ac1-159">若為否，請移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-159">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-160">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-160">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-161">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-161">Restore is completed.</span></span>  
  
     <span data-ttu-id="f7ac1-162">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-162">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
#### <a name="publication-database-read-only-transactional-replication"></a><span data-ttu-id="f7ac1-163">發行集資料庫：唯讀異動複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-163">Publication Database: Read-Only Transactional Replication</span></span>  
  
1.  <span data-ttu-id="f7ac1-164">還原最新的發行集資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-164">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="f7ac1-165">移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-165">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="f7ac1-166">是否在失敗前對發行集資料庫啟用了 **sync with backup** 設定？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-166">Was the **sync with backup** setting enabled on the publication database before the failure?</span></span> <span data-ttu-id="f7ac1-167">若為是，請移至步驟 3；若為否，請移至步驟 5。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-167">If yes, go to step 3; if no, go to step 5.</span></span>  
  
     <span data-ttu-id="f7ac1-168">如果設定已啟用， `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` 查詢會傳回 '1'。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-168">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="f7ac1-169">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-169">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-170">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-170">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-171">若為是，則還原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-171">If yes, the restore is completed.</span></span> <span data-ttu-id="f7ac1-172">若為否，請移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-172">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="f7ac1-173">已還原發行集資料庫中的組態資訊並非最新；</span><span class="sxs-lookup"><span data-stu-id="f7ac1-173">The configuration information in the restored publication database is not up-to-date.</span></span> <span data-ttu-id="f7ac1-174">因此，您必須確定「訂閱者」擁有散發資料庫中的所有未處理命令，然後再卸除及重新建立複寫組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-174">Therefore, you must make sure that the Subscribers have all outstanding commands in the distribution database, and then drop and re-create the replication configuration.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-175">執行散發代理程式，直到所有訂閱者與散發資料庫中的未處理命令均已同步處理。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-175">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="f7ac1-176">確認所有的命令都已傳遞給訂閱者，方法是使用「複寫監視器」中的 **[未散發的命令]** 索引標籤，或是在散發資料庫中查詢 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 檢視。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-176">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="f7ac1-177">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-177">Go to step b.</span></span>  
  
         <span data-ttu-id="f7ac1-178">如需如何執行散發代理程式的詳細資訊，請參閱[啟動及停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 與[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-178">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="f7ac1-179">如需如何驗證命令的詳細資訊，請參閱在[散發資料庫中查看複寫的命令和其他資訊 &#40;複寫 transact-sql 程式設計&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md)和[使用複寫監視器來查看資訊及執行](../monitor/view-information-and-perform-tasks-replication-monitor.md)工作。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-179">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="f7ac1-180">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-180">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-181">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-181">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-182">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-182">The restore is completed.</span></span>  
  
         <span data-ttu-id="f7ac1-183">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-183">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="f7ac1-184">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-184">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
5.  <span data-ttu-id="f7ac1-185">未在發行集資料庫上設定 **sync with backup** 選項；</span><span class="sxs-lookup"><span data-stu-id="f7ac1-185">The **sync with backup** option was not set on the publication database.</span></span> <span data-ttu-id="f7ac1-186">因此，沒有包含在還原備份中的交易可能尚未傳遞到散發者和訂閱者。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-186">Therefore, transactions that were not included in the restored backup might have been delivered to the Distributor and Subscribers.</span></span> <span data-ttu-id="f7ac1-187">您必須確定「訂閱者」已經擁有散發資料庫中的所有未處理命令，然後再手動將任何未包含在所還原備份中的交易，套用到發行集資料庫：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-187">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f7ac1-188">執行此程序可能會造成已發行資料表的還原時間點，比備份中所還原的其他未發行資料表還要新。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-188">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-189">執行散發代理程式，直到所有訂閱者與散發資料庫中的未處理命令均已同步處理。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-189">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="f7ac1-190">確認所有的命令都已傳遞給訂閱者，方法是使用「複寫監視器」中的 **[未散發的命令]** 索引標籤，或是在散發資料庫中查詢 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 檢視。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-190">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="f7ac1-191">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-191">Go to step b.</span></span>  
  
         <span data-ttu-id="f7ac1-192">如需如何執行散發代理程式的詳細資訊，請參閱[啟動及停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 與[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-192">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="f7ac1-193">如需如何驗證命令的詳細資訊，請參閱在[散發資料庫中查看複寫的命令和其他資訊 &#40;複寫 transact-sql 程式設計&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md)和[使用複寫監視器來查看資訊及執行](../monitor/view-information-and-perform-tasks-replication-monitor.md)工作。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-193">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="f7ac1-194">使用 [tablediff 公用程式](../../../tools/tablediff-utility.md) 或其他工具來手動同步化發行者與訂閱者。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-194">Use the [tablediff utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="f7ac1-195">如此可讓您從訂閱資料庫中，復原沒有包含在發行集資料庫備份中的資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-195">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="f7ac1-196">移至步驟 c。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-196">Go to step c.</span></span>  
  
         <span data-ttu-id="f7ac1-197">如需 **tablediff** 公用程式的詳細資訊，請參閱[比較複寫資料表的差異 &#40;複寫程式設計&#41;](compare-replicated-tables-for-differences-replication-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-197">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="f7ac1-198">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-198">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-199">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-199">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-200">若為是，請執行 [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) 預存程序，以重新同步處理「發行者」中繼資料資料與「散發者」中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-200">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="f7ac1-201">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-201">The restore is completed.</span></span> <span data-ttu-id="f7ac1-202">若為否，請移至步驟 d。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-202">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="f7ac1-203">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-203">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-204">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-204">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-205">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-205">The restore is completed.</span></span>  
  
         <span data-ttu-id="f7ac1-206">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-206">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="f7ac1-207">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-207">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-transactional-replication-with-updating-subscriptions"></a><span data-ttu-id="f7ac1-208">發行集資料庫：具有可更新訂閱的異動複寫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-208">Publication Database: Transactional Replication with Updating Subscriptions</span></span>  
  
1.  <span data-ttu-id="f7ac1-209">還原最新的發行集資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-209">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="f7ac1-210">移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-210">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="f7ac1-211">執行散發代理程式，直到所有訂閱者與散發資料庫中的未處理命令均已同步處理。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-211">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="f7ac1-212">確認所有的命令都已傳遞給「訂閱者」，方法是使用「複寫監視器」中的 **[未散發的命令]** 索引標籤，或是在散發資料庫中查詢 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 檢視。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-212">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor, or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="f7ac1-213">移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-213">Go to step 3.</span></span>  
  
     <span data-ttu-id="f7ac1-214">如需如何執行散發代理程式的詳細資訊，請參閱[啟動及停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 與[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-214">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
     <span data-ttu-id="f7ac1-215">如需如何驗證命令的詳細資訊，請參閱在[散發資料庫中查看複寫的命令和其他資訊 &#40;複寫 transact-sql 程式設計&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md)和[使用複寫監視器來查看資訊及執行](../monitor/view-information-and-perform-tasks-replication-monitor.md)工作。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-215">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
3.  <span data-ttu-id="f7ac1-216">如要使用佇列更新訂閱，請連接到各訂閱者，並從訂閱資料庫的 [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) 資料表中刪除所有資料列。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-216">If you are using queued updating subscriptions, connect to each Subscriber and delete all rows from the [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) table in the subscription database.</span></span> <span data-ttu-id="f7ac1-217">移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-217">Go to step 4.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f7ac1-218">如果您正使用佇列更新訂閱以及包含識別欄位的任何資料表，則必須確保在還原後指派正確的識別範圍。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-218">If you are using queued updating subscriptions and any tables contain identity columns, you must make sure that the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="f7ac1-219">如需詳細資訊，請參閱[複寫識別資料欄](../publish/replicate-identity-columns.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-219">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
4.  <span data-ttu-id="f7ac1-220">您必須確定「訂閱者」已經擁有散發資料庫中的所有未處理命令，然後再手動將任何未包含在所還原備份中的交易，套用到發行集資料庫：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-220">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f7ac1-221">執行此程序可能會造成已發行資料表的還原時間點，比備份中所還原的其他未發行資料表還要新。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-221">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-222">執行散發代理程式，直到所有訂閱者與散發資料庫中的未處理命令均已同步處理。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-222">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="f7ac1-223">透過使用「複寫監視器」，或透過查詢散發資料庫中的 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 檢視，確認所有命令是否已傳遞到「訂閱者」。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-223">Verify that all commands are delivered to Subscribers by using Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="f7ac1-224">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-224">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="f7ac1-225">使用 [tablediff Utility](../../../tools/tablediff-utility.md) 或其他工具來手動同步化發行者與訂閱者。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-225">Use the [tablediff Utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="f7ac1-226">如此可讓您從訂閱資料庫中，復原沒有包含在發行集資料庫備份中的資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-226">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="f7ac1-227">移至步驟 c。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-227">Go to step c.</span></span>  
  
         <span data-ttu-id="f7ac1-228">如需 **tablediff** 公用程式的詳細資訊，請參閱[比較複寫資料表的差異 &#40;複寫程式設計&#41;](compare-replicated-tables-for-differences-replication-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-228">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="f7ac1-229">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-229">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-230">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-230">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-231">若為是，請執行 [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) 預存程序，以重新同步處理「發行者」中繼資料資料與「散發者」中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-231">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="f7ac1-232">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-232">The restore is completed.</span></span> <span data-ttu-id="f7ac1-233">若為否，請移至步驟 d。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-233">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="f7ac1-234">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-234">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-235">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-235">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-236">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-236">The restore is completed.</span></span>  
  
         <span data-ttu-id="f7ac1-237">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-237">For more information about how to remove replication, see and [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="f7ac1-238">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-238">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-peer-to-peer-transactional-replication"></a><span data-ttu-id="f7ac1-239">發行集資料庫：@loopback_detection</span><span class="sxs-lookup"><span data-stu-id="f7ac1-239">Publication Database: Peer-to-Peer Transactional Replication</span></span>  
 <span data-ttu-id="f7ac1-240">在下列步驟中，發行集資料庫 **A**、 **B**和 **C** 在點對點異動複寫拓撲中。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-240">In the following steps, publication databases **A**, **B**, and **C** are in a peer-to-peer transactional replication topology.</span></span> <span data-ttu-id="f7ac1-241">資料庫 **A** 和 **C** 在線上並正常運作；資料庫 **B** 則是要還原的資料庫。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-241">Databases **A** and **C** are online and functioning properly; database **B** is the database to be restored.</span></span> <span data-ttu-id="f7ac1-242">此處所述的程序 (尤其是步驟 7、10 和 11)，與在點對點拓撲中加入節點的程序非常類似。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-242">The process described here, especially steps 7, 10, and 11, is very similar to the process required to add a node to a peer-to-peer topology.</span></span> <span data-ttu-id="f7ac1-243">執行這些步驟最直接的方法是使用「設定點對點拓撲精靈」，但是您也可以使用預存程序。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-243">The most straightforward way to perform these steps is to use the Configure Peer-to-Peer Topology Wizard, but you can also use stored procedures.</span></span>  
  
1.  <span data-ttu-id="f7ac1-244">執行散發代理程式，以便同步處理資料庫 **A** 和 **C** 中的訂閱。移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-244">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **C**. Go to step 2.</span></span>  
  
     <span data-ttu-id="f7ac1-245">如需如何執行散發代理程式的詳細資訊，請參閱[啟動及停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 與[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-245">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
2.  <span data-ttu-id="f7ac1-246">如果 **B** 使用的散發資料庫仍然可用，則執行散發代理程式，以便同步處理資料庫 **B** 和 **A** 之間，以及資料庫 B 和 **C** 之間的訂閱。移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-246">If the distribution database that **B** uses is still available, run Distribution Agents to synchronize subscriptions between databases **B** and **A** and databases and B and **C**. Go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-247">透過在 **B** 的散發資料庫執行 [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql)，從 **B** 使用的散發資料庫中移除中繼資料。移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-247">Remove metadata from the distribution database that **B** uses by executing [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) at the distribution database for **B**. Go to step 4.</span></span>  
  
4.  <span data-ttu-id="f7ac1-248">在資料庫 **A** 和 **C** 中卸除資料庫 **B** 之發行集的訂閱。移至步驟 5。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-248">At databases **A** and **C**, drop the subscriptions to the publication at database **B**. Go to step 5.</span></span>  
  
     <span data-ttu-id="f7ac1-249">如需有關如何卸除訂閱的詳細資訊，請參閱＜ [Subscribe to Publications](../subscribe-to-publications.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-249">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
5.  <span data-ttu-id="f7ac1-250">執行資料庫 **A** 的記錄備份或完整備份。移至步驟 6。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-250">Perform a log backup or full backup of database **A**. Go to step 6.</span></span>  
  
6.  <span data-ttu-id="f7ac1-251">於資料庫 **B** 中還原資料庫 **A** 的備份。資料庫 **B** 現在擁有來自資料庫 **A** 的資料，但是沒有複寫組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-251">Restore the backup of database **A** at database **B**. Database **B** now has the data from database **A**, but not the replication configuration.</span></span> <span data-ttu-id="f7ac1-252">當您將備份還原到另一部伺服器時，複寫就會被移除，因此複寫已從資料庫 **B** 中移除。移至步驟 7。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-252">When you restore a backup to another server, replication is removed; therefore, replication has been removed from database **B**. Go to step 7.</span></span>  
  
7.  <span data-ttu-id="f7ac1-253">在資料庫 **B** 中重新建立發行集，然後在 **A** 和資料庫 **B** 之間重新建立訂閱。(有關資料庫 **C** 的訂閱將在後續階段中處理)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-253">Re-create the publication at database **B**, and then re-create subscriptions between databases **A** and **B**. (Subscriptions that involve database **C** are handled at a later stage.).</span></span>  
  
    1.  <span data-ttu-id="f7ac1-254">在資料庫 **B** 上重新建立發行集。移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-254">Re-create the publication at database **B**. Go to step b.</span></span>  
  
    2.  <span data-ttu-id="f7ac1-255">在資料庫**A**的發行集上，重新建立資料庫**B**的訂閱，指定應使用備份來初始化訂閱， (sp_addsubscription) 的參數之**initialize with backup**的值 **@sync_type** 。 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-255">Re-create the subscription at database **B** to the publication at database **A**, specifying that the subscription should be initialized with a backup (a value of **initialize with backup** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="f7ac1-256">移至步驟 c。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-256">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="f7ac1-257">重新建立資料庫**B**的發行集之資料庫**A**的訂閱，指定「訂閱者」已具有資料 (只有 sp_addsubscription) 參數的**replication 支援**值 **@sync_type** [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) 。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-257">Re-create the subscription at database **A** to the publication at database **B**, specifying that the Subscriber already has the data (a value of **replication support only** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="f7ac1-258">移至步驟 8。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-258">Go to step 8.</span></span>  
  
8.  <span data-ttu-id="f7ac1-259">執行散發代理程式，以便同步處理資料庫 **A** 和 **B** 中的訂閱。如果已發行資料表中有任何識別資料行，則移至步驟 9。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-259">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **B**. If there are any identity columns in published tables, go to step 9.</span></span> <span data-ttu-id="f7ac1-260">若為否，請移至步驟 10。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-260">If not, go to step 10.</span></span>  
  
9. <span data-ttu-id="f7ac1-261">還原之後，您針對資料庫 **A** 中的每一個資料表指派的識別範圍也會在資料庫 **B** 中使用。請確保還原的資料庫 **B** 已接收到來自失敗資料庫 **B** 中已傳播至資料庫 **A** 和資料庫 **C** 的所有變更；然後為每個資料表的識別範圍重設種子資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-261">After the restore, the identity range that you assigned for each table in database **A** would also be used in database **B**. Make sure that the restored database **B** has received all changes from the failed database **B** that were propagated to database **A** and database **C**; and then reseed the identity range for each table.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-262">在資料庫**B**上執行[sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) ，並取出 output 參數 **@request_id** 。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-262">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="f7ac1-263">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-263">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="f7ac1-264">依預設，「散發代理程式」設定為連續執行；因此 Token 應該會自動傳送到所有的節點。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-264">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="f7ac1-265">如果散發代理程式並非以連續模式執行，請執行代理程式。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-265">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="f7ac1-266">如需詳細資訊，請參閱[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)或[啟動和停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-266">For more information, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md) or [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span> <span data-ttu-id="f7ac1-267">移至步驟 c。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-267">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="f7ac1-268">執行[sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql)，提供 **@request_id** 在步驟 b 中取得的值。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-268">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="f7ac1-269">請稍候，直到所有節點都指示已經收到對等要求為止。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-269">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="f7ac1-270">移至步驟 d。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-270">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="f7ac1-271">使用 [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) 重設資料庫 **B** 上每個資料表的種子資料，以確保使用適當的範圍。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-271">Use [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) to reseed each table in database **B** to make sure that an appropriate range is used.</span></span> <span data-ttu-id="f7ac1-272">移至步驟 10。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-272">Go to step 10.</span></span>  
  
     <span data-ttu-id="f7ac1-273">如需如何管理識別範圍的詳細資訊，請參閱[複寫識別欄位](../publish/replicate-identity-columns.md)中的＜為手動識別範圍管理指派範圍＞一節。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-273">For more information about how to manage identity ranges, see the "Assigning ranges for manual identity range management" section of [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
10. <span data-ttu-id="f7ac1-274">此時，資料庫 **B** 和資料庫 **C** 並沒有直接連接，但它們將會透過資料庫 **A** 接收變更。如果拓撲包含任何正在執行 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 的節點，請移至步驟 11；否則請移至步驟 12。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-274">At this point, database **B** and database **C** are not directly connected, but they will receive changes through database **A**. If the topology contains any nodes that are running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], go to step 11; otherwise, go to step 12.</span></span>  
  
11. <span data-ttu-id="f7ac1-275">停止系統，然後重新建立資料庫 **B** 和 **C** 之間的訂閱。停止系統包括停止所有節點上已發行資料表的活動，並確定每個節點都已收到來自其他所有節點的所有變更。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-275">Quiesce the system, and then re-create the subscription between databases **B** and **C**. Quiescing a system involves stopping activity on published tables at all nodes and making sure of that each node has received all changes from all other nodes.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-276">停止點對點拓撲中已發行資料表上的所有活動。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-276">Stop all activity on published tables in the peer-to-peer topology.</span></span> <span data-ttu-id="f7ac1-277">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-277">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="f7ac1-278">在資料庫**B**上執行[sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) ，並取出 output 參數 **@request_id** 。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-278">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="f7ac1-279">移至步驟 c。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-279">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="f7ac1-280">依預設，「散發代理程式」設定為連續執行；因此 Token 應該會自動傳送到所有的節點。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-280">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="f7ac1-281">如果散發代理程式並非以連續模式執行，請執行代理程式。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-281">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="f7ac1-282">移至步驟 d。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-282">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="f7ac1-283">執行[sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql)，提供 **@request_id** 在步驟 b 中取得的值。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-283">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="f7ac1-284">請稍候，直到所有節點都指示已經收到對等要求為止。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-284">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="f7ac1-285">移至步驟 e。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-285">Go to step e.</span></span>  
  
    5.  <span data-ttu-id="f7ac1-286">重新建立資料庫 **C** 的發行集之資料庫 **B**的訂閱，指定「訂閱者」已具有資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-286">Re-create the subscription at database **B** to the publication at database **C**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-287">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-287">Go to step b.</span></span>  
  
    6.  <span data-ttu-id="f7ac1-288">重新建立資料庫 **B** 的發行集之資料庫 **C**的訂閱，指定「訂閱者」已具有資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-288">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-289">移至步驟 13。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-289">Go to step 13.</span></span>  
  
12. <span data-ttu-id="f7ac1-290">重新建立資料庫 **B** 和 **C**之間的訂閱：</span><span class="sxs-lookup"><span data-stu-id="f7ac1-290">Re-create the subscription between databases **B** and **C**:</span></span>  
  
    1.  <span data-ttu-id="f7ac1-291">在資料庫 **B**中查詢 [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) 資料表，以擷取資料庫 **B** 已從資料庫 **C**所接收之最新交易的記錄序號。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-291">At database **B**, query the [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) table to retrieve the log sequence number (LSN) of the most recent transaction that database **B** has received from database **C**.</span></span>  
  
    2.  <span data-ttu-id="f7ac1-292">在資料庫**C**的發行集上重新建立資料庫**B**的訂閱，指定應根據 lsn 初始化訂閱 (sp_addsubscription) 的參數的**initialize from lsn**值 **@sync_type** [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) 。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-292">Re-create the subscription at database **B** to the publication at database **C**, specifying that the subscription should be initialized based on LSN (a value of **initialize from lsn** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="f7ac1-293">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-293">Go to step b.</span></span>  
  
    3.  <span data-ttu-id="f7ac1-294">重新建立資料庫 **B** 的發行集之資料庫 **C**的訂閱，指定「訂閱者」已具有資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-294">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-295">移至步驟 13。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-295">Go to step 13.</span></span>  
  
13. <span data-ttu-id="f7ac1-296">執行散發代理程式，以便同步處理資料庫 **B** 和 **C** 中的訂閱。還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-296">Run the Distribution Agents to synchronize the subscriptions at databases **B** and **C**. The restore is completed.</span></span>  
  
#### <a name="msdb-database-publisher"></a><span data-ttu-id="f7ac1-297">msdb 資料庫 (發行者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-297">msdb Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="f7ac1-298">還原 **msdb** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-298">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-299">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-299">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-300">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-300">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-301">若為是，則復原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-301">If yes, recovery is completed.</span></span> <span data-ttu-id="f7ac1-302">若為否，請移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-302">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-303">從您的複寫指令碼重新建立訂閱清除作業。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-303">Re-create the subscription cleanup job from your replication scripts.</span></span> <span data-ttu-id="f7ac1-304">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-304">Recovery is completed.</span></span>  
  
#### <a name="master-database-publisher"></a><span data-ttu-id="f7ac1-305">Master 資料庫 (發行者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-305">master Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="f7ac1-306">還原 **master** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-306">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-307">確定資料庫和發行集資料庫內的複寫組態與設定一致。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-307">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-distributor"></a><span data-ttu-id="f7ac1-308">散發者端的資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-308">Databases at the Distributor</span></span>  
  
#### <a name="distribution-database"></a><span data-ttu-id="f7ac1-309">散發資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-309">Distribution Database</span></span>  
  
1.  <span data-ttu-id="f7ac1-310">還原散發資料庫的最新一次備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-310">Restore the latest backup of the distribution database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-311">是否在失敗前對散發資料庫啟用了 **sync with backup** 設定？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-311">Was the **sync with backup** setting enabled on the distribution database before the failure?</span></span> <span data-ttu-id="f7ac1-312">若為是，請移至步驟 3；若為否，請移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-312">If yes, go to step 3; if no, go to step 4.</span></span>  
  
     <span data-ttu-id="f7ac1-313">如果設定已啟用， `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` 查詢會傳回 '1'。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-313">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="f7ac1-314">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-314">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-315">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-315">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-316">若為是，則復原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-316">If yes, recovery is completed.</span></span> <span data-ttu-id="f7ac1-317">若為否，請移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-317">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="f7ac1-318">已還原散發資料庫中的組態資訊不是最新的，或者未在散發資料庫上設定 **sync with backup** 選項</span><span class="sxs-lookup"><span data-stu-id="f7ac1-318">Either the configuration information in the restored distribution database is not up-to-date, or the **sync with backup** option was not set on the distribution database.</span></span> <span data-ttu-id="f7ac1-319">(在還原之後，散發資料庫可能會遺失在「發行者」端認可，但尚未傳遞到「訂閱者」的交易)。卸除並重新建立複寫，然後執行驗證。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-319">(After the restore, the distribution database might be missing transactions that were committed at the Publisher but have not yet been delivered to Subscribers.) Drop and re-create replication, and then run validation.</span></span>  
  
    1.  <span data-ttu-id="f7ac1-320">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-320">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-321">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-321">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-322">移至步驟 b。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-322">Go to step b.</span></span>  
  
         <span data-ttu-id="f7ac1-323">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-323">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="f7ac1-324">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-324">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
    2.  <span data-ttu-id="f7ac1-325">標示所有發行集以供驗證。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-325">Mark all publications for validation.</span></span> <span data-ttu-id="f7ac1-326">將未通過驗證的任何訂閱重新初始化。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-326">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="f7ac1-327">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-327">Recovery is completed.</span></span>  
  
         <span data-ttu-id="f7ac1-328">如需驗證的相關資訊，請參閱 [Validate Replicated Data](../validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-328">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="f7ac1-329">如需詳細資訊，請參閱[重新初始化訂閱](../reinitialize-subscriptions.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-329">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="msdb-database-distributor"></a><span data-ttu-id="f7ac1-330">msdb 資料庫 (散發者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-330">msdb Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="f7ac1-331">還原 **msdb** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-331">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-332">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-332">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-333">該備份是否包含所有發行集和訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-333">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="f7ac1-334">若為是，則復原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-334">If yes, recovery is completed.</span></span> <span data-ttu-id="f7ac1-335">若為否，請移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-335">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-336">從「發行者」、「散發者」及「訂閱者」端移除複寫組態，然後重新建立組態。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-336">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="f7ac1-337">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-337">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-338">移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-338">Go to step 4.</span></span>  
  
     <span data-ttu-id="f7ac1-339">如需如何移除複寫的詳細資訊，請參閱 [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-339">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
     <span data-ttu-id="f7ac1-340">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-340">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
4.  <span data-ttu-id="f7ac1-341">標示所有發行集以供驗證。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-341">Mark all publications for validation.</span></span> <span data-ttu-id="f7ac1-342">將未通過驗證的任何訂閱重新初始化。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-342">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="f7ac1-343">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-343">Recovery is completed.</span></span>  
  
     <span data-ttu-id="f7ac1-344">如需驗證的相關資訊，請參閱 [Validate Replicated Data](../validate-data-at-the-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-344">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="f7ac1-345">如需詳細資訊，請參閱[重新初始化訂閱](../reinitialize-subscriptions.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-345">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="master-database-distributor"></a><span data-ttu-id="f7ac1-346">Master 資料庫 (散發者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-346">master Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="f7ac1-347">還原 **master** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-347">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-348">確定資料庫和發行集資料庫內的複寫組態與設定一致。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-348">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-subscriber"></a><span data-ttu-id="f7ac1-349">訂閱者端的資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-349">Databases at the Subscriber</span></span>  
  
#### <a name="subscription-database"></a><span data-ttu-id="f7ac1-350">訂閱資料庫</span><span class="sxs-lookup"><span data-stu-id="f7ac1-350">Subscription Database</span></span>  
  
1.  <span data-ttu-id="f7ac1-351">最新的訂閱資料庫備份是否比散發資料庫上的最低散發保留設定還新？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-351">Is the latest subscription database backup more recent than the minimum distribution retention setting on the distribution database?</span></span> <span data-ttu-id="f7ac1-352">(這點將決定「散發者」是否仍具有更新「訂閱者」的所有必要命令)。如果是，則移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-352">(This determines whether the Distributor still has all the commands that are required to bring the Subscriber up-to-date.) If yes, go to step 2.</span></span> <span data-ttu-id="f7ac1-353">如果否，請重新初始化該項訂閱。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-353">If no, reinitialize the subscription.</span></span> <span data-ttu-id="f7ac1-354">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-354">Recovery is completed.</span></span>  
  
     <span data-ttu-id="f7ac1-355">若要決定最大散發保留設定，則執行 [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) 並從 **max_distretention** 資料行中擷取值 (此值以小時表示)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-355">To determine the maximum distribution retention setting, execute [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) and retrieve the value from the **max_distretention** column (this value is in hours).</span></span>  
  
     <span data-ttu-id="f7ac1-356">如需有關如何重新初始化訂閱的詳細資訊，請參閱＜ [Reinitialize a Subscription](../reinitialize-a-subscription.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-356">For more information about how to reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
2.  <span data-ttu-id="f7ac1-357">還原最新一次訂閱資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-357">Restore the latest subscription database backup.</span></span> <span data-ttu-id="f7ac1-358">移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-358">Go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-359">如果訂閱資料庫僅包含發送訂閱，請移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-359">If the subscription database contains only push subscriptions, go to step 4.</span></span> <span data-ttu-id="f7ac1-360">如果訂閱資料庫包含任何提取訂閱，請詢問下列問題：訂閱資訊是最新的嗎？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-360">If the subscription database contains any pull subscriptions, ask the following questions: Is the subscription information current?</span></span> <span data-ttu-id="f7ac1-361">資料庫包含所有在失敗時所設定的資料表和選項嗎？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-361">Does the database include all tables and options that were set at the time of failure.</span></span> <span data-ttu-id="f7ac1-362">如果是，則移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-362">If yes, go to step 4.</span></span> <span data-ttu-id="f7ac1-363">如果否，請重新初始化該項訂閱。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-363">If no, reinitialize the subscription.</span></span> <span data-ttu-id="f7ac1-364">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-364">Recovery is completed.</span></span>  
  
4.  <span data-ttu-id="f7ac1-365">若要同步處理「訂閱者」，請執行「散發代理程式」。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-365">To synchronize the Subscriber, run the Distribution Agent.</span></span> <span data-ttu-id="f7ac1-366">復原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-366">Recovery is completed.</span></span>  
  
     <span data-ttu-id="f7ac1-367">如需如何執行散發代理程式的詳細資訊，請參閱[啟動及停止複寫代理程式 &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 與[複寫代理程式可執行檔概念](../concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-367">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
#### <a name="msdb-database-subscriber"></a><span data-ttu-id="f7ac1-368">msdb 資料庫 (訂閱者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-368">msdb Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="f7ac1-369">還原 **msdb** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-369">Restore the latest backup of the **msdb** database.</span></span> <span data-ttu-id="f7ac1-370">此「訂閱者」端是否使用提取訂閱？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-370">Are pull subscriptions used at this Subscriber?</span></span> <span data-ttu-id="f7ac1-371">如果不是，則還原已完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-371">If no, the restore is completed.</span></span> <span data-ttu-id="f7ac1-372">如果是，則移至步驟 2。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-372">If yes, go to step 2.</span></span>  
  
2.  <span data-ttu-id="f7ac1-373">還原的備份是否完整且為最新狀態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-373">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="f7ac1-374">該備份是否包含所有提取訂閱的最新組態？</span><span class="sxs-lookup"><span data-stu-id="f7ac1-374">Does it contain the latest configuration for all pull subscriptions?</span></span> <span data-ttu-id="f7ac1-375">若為是，則復原已經完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-375">If yes, recovery is completed.</span></span> <span data-ttu-id="f7ac1-376">若為否，請移至步驟 3。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-376">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="f7ac1-377">卸除並重新建立提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-377">Drop and re-create the pull subscriptions.</span></span> <span data-ttu-id="f7ac1-378">重新建立訂閱時，請指定「訂閱者」已經擁有該資料。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-378">When you re-create the subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="f7ac1-379">還原即可完成。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-379">The restore is completed.</span></span>  
  
     <span data-ttu-id="f7ac1-380">如需有關如何卸除訂閱的詳細資訊，請參閱＜ [Subscribe to Publications](../subscribe-to-publications.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-380">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
     <span data-ttu-id="f7ac1-381">如需有關如何指定訂閱者已經擁有該資料的詳細資訊，請參閱＜ [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)＞。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-381">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="master-database-subscriber"></a><span data-ttu-id="f7ac1-382">Master 資料庫 (訂閱者)</span><span class="sxs-lookup"><span data-stu-id="f7ac1-382">master Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="f7ac1-383">還原 **master** 資料庫的最新備份。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-383">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="f7ac1-384">確定資料庫和發行集資料庫內的複寫組態與設定一致。</span><span class="sxs-lookup"><span data-stu-id="f7ac1-384">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f7ac1-385">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f7ac1-385">See Also</span></span>  
 <span data-ttu-id="f7ac1-386">[SQL Server 資料庫的備份與還原](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-386">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="f7ac1-387">[備份及還原複寫的資料庫](back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-387">[Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md) </span></span>  
 <span data-ttu-id="f7ac1-388">[[設定散發]](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-388">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="f7ac1-389">[發行資料和資料庫物件](../publish/publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-389">[Publish Data and Database Objects](../publish/publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="f7ac1-390">[Subscribe to Publications](../subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-390">[Subscribe to Publications](../subscribe-to-publications.md) </span></span>  
 <span data-ttu-id="f7ac1-391">[初始化訂閱](../initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="f7ac1-391">[Initialize a Subscription](../initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="f7ac1-392">同步處理資料</span><span class="sxs-lookup"><span data-stu-id="f7ac1-392">Synchronize Data</span></span>](../synchronize-data.md)  
  
  
