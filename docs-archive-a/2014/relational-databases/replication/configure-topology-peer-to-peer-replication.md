---
title: 設定拓撲 (點對點複寫) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- sql12.rep.p2pwizard.peers.f1
ms.assetid: 5377c59f-2e25-4852-a306-c87ae3dca9fd
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2dfc09f5ae7f488afd46f29c301d11b7687e0a4b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585325"
---
# <a name="configure-topology-peer-to-peer-replication"></a><span data-ttu-id="0dec3-102">設定拓撲 (點對點複寫)</span><span class="sxs-lookup"><span data-stu-id="0dec3-102">Configure Topology (Peer-to-Peer Replication)</span></span>
  <span data-ttu-id="0dec3-103">您可以使用 **[設定拓撲]** 頁面來執行一些常見的組態設定工作，例如加入新的節點、刪除節點，以及在現有節點之間加入新連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-103">Use the **Configure topology** page to perform common configuration tasks, such as adding new nodes, deleting nodes, and adding new connections between existing nodes.</span></span> <span data-ttu-id="0dec3-104">您在此精靈之 **[發行集]** 頁面上選取的節點會顯示在設計介面上。</span><span class="sxs-lookup"><span data-stu-id="0dec3-104">The node you selected on the **Publication** page of this wizard is displayed on the design surface.</span></span> <span data-ttu-id="0dec3-105">若要指定組態選項，請以滑鼠右鍵按一下節點、連接或設計介面。</span><span class="sxs-lookup"><span data-stu-id="0dec3-105">To specify configuration options, right-click a node, a connection, or the design surface.</span></span>

> [!NOTE]
>  <span data-ttu-id="0dec3-106">「設定點對點拓撲精靈」會在關閉精靈時要求拓撲資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-106">The Configure Peer to Peer Topology Wizard requests topology information when the wizard is closed.</span></span> <span data-ttu-id="0dec3-107">如果您在所有節點回應資訊要求之前關閉並重新開啟此精靈，精靈可能會顯示部分網路。</span><span class="sxs-lookup"><span data-stu-id="0dec3-107">If the wizard is closed and reopened before all nodes respond to the request for information, the wizard might show a partial network.</span></span>

## <a name="options"></a><span data-ttu-id="0dec3-108">選項。</span><span class="sxs-lookup"><span data-stu-id="0dec3-108">Options</span></span>
 <span data-ttu-id="0dec3-109">**[設定拓撲]** 頁面包含當您以滑鼠右鍵按一下元素時可用的介面元素和選項。</span><span class="sxs-lookup"><span data-stu-id="0dec3-109">The **Configure topology** page contains interface elements and options that are available when you right-click an element.</span></span> <span data-ttu-id="0dec3-110">下表描述的是每個介面元素。</span><span class="sxs-lookup"><span data-stu-id="0dec3-110">The following table describes each interface element.</span></span>

|<span data-ttu-id="0dec3-111">介面元素</span><span class="sxs-lookup"><span data-stu-id="0dec3-111">Interface Element</span></span>|<span data-ttu-id="0dec3-112">描述</span><span class="sxs-lookup"><span data-stu-id="0dec3-112">Description</span></span>|
|-----------------------|-----------------|
|<span data-ttu-id="0dec3-113">設計介面</span><span class="sxs-lookup"><span data-stu-id="0dec3-113">Design surface</span></span>|<span data-ttu-id="0dec3-114">顯示其他介面元素。</span><span class="sxs-lookup"><span data-stu-id="0dec3-114">Displays other interface elements.</span></span> <span data-ttu-id="0dec3-115">若要加入元素，請以滑鼠右鍵按一下設計介面。</span><span class="sxs-lookup"><span data-stu-id="0dec3-115">To add elements, right-click the design surface.</span></span>|
|<span data-ttu-id="0dec3-116">![拓撲中的第一個節點](media/p2pwizard-firstnode.gif "拓撲中的第一個節點")</span><span class="sxs-lookup"><span data-stu-id="0dec3-116">![The first node in a topology](media/p2pwizard-firstnode.gif "The first node in a topology")</span></span>|<span data-ttu-id="0dec3-117">拓撲中的原始節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-117">The original node in the topology.</span></span> <span data-ttu-id="0dec3-118">系統會使用原始節點的發行集資料庫副本來初始化新的節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-118">New nodes are initialized by using a copy of the publication database from the original node.</span></span>|
|<span data-ttu-id="0dec3-119">![我們有完整資訊](media/p2pwizard-complete.gif "我們擁有其完整資訊的節點")或更新版本的節點，複寫具有完整的資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-119">![A node for which we have complete information](media/p2pwizard-complete.gif "A node for which we have complete information") or a later version, for which replication has complete information.</span></span> <span data-ttu-id="0dec3-120">若要指定組態選項，請以滑鼠右鍵按一下節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-120">To specify configuration options, right-click the node.</span></span>|
|<span data-ttu-id="0dec3-121">![我們沒有其完整資訊的節點](media/p2pwizard-incomplete.gif "我們沒有其完整資訊的節點")</span><span class="sxs-lookup"><span data-stu-id="0dec3-121">![A node for which we have incomplete information](media/p2pwizard-incomplete.gif "A node for which we have incomplete information")</span></span>|<span data-ttu-id="0dec3-122">複寫具有不完整資訊的節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-122">A node for which replication has incomplete information.</span></span> <span data-ttu-id="0dec3-123">若要指定組態選項，請以滑鼠右鍵按一下節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-123">To specify configuration options, right-click the node.</span></span> <span data-ttu-id="0dec3-124">由於下列其中一項原因，所以複寫具有不完整的資訊：</span><span class="sxs-lookup"><span data-stu-id="0dec3-124">Replication has incomplete information because of one of the following reasons:</span></span><br /><br /> <span data-ttu-id="0dec3-125">節點正在執行 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 執行個體 (無法儲存精靈所需的所有中繼資料)。</span><span class="sxs-lookup"><span data-stu-id="0dec3-125">The node is running an instance of [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], which does not store all the metadata required by the wizard.</span></span><br /><br /> <span data-ttu-id="0dec3-126">節點正在執行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 更新版本，但是複寫無法從節點中擷取訂閱資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-126">The node is running a later version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], but replication cannot retrieve subscription information from the node.</span></span> <span data-ttu-id="0dec3-127">若要疑難排解這個情況：</span><span class="sxs-lookup"><span data-stu-id="0dec3-127">To troubleshoot this situation:</span></span><br /><span data-ttu-id="0dec3-128">-請確定節點上的資料庫在線上，而且您可以使用與連接到該節點的散發代理程式相同的認證來連接它。</span><span class="sxs-lookup"><span data-stu-id="0dec3-128">-Make sure that the database at the node is online and that you can connect to it by using the same credentials as the Distribution Agents that connect to the node.</span></span><br /><span data-ttu-id="0dec3-129">-確定連接到節點的記錄讀取器代理程式和所有散發代理程式都在執行中。</span><span class="sxs-lookup"><span data-stu-id="0dec3-129">-Make sure that the Log Reader Agent and all Distribution Agents that connect to the node are running.</span></span><br /><span data-ttu-id="0dec3-130">-請確定 [重新整理超時] 已設定為 [夠高]，以收集所有拓撲資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-130">-Make sure that the refresh timeout is set high enough to gather all topology information.</span></span> <span data-ttu-id="0dec3-131">若要設定逾時，請以滑鼠右鍵按一下設計介面，然後按一下 **[設定重新整理逾時]**。</span><span class="sxs-lookup"><span data-stu-id="0dec3-131">To set the time-out, right-click the design surface, and click **Set Refresh Timeout**.</span></span>|
|<span data-ttu-id="0dec3-132">含有箭頭的灰線</span><span class="sxs-lookup"><span data-stu-id="0dec3-132">Gray line with arrows</span></span>|<span data-ttu-id="0dec3-133">兩個節點之間的連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-133">The connection between two nodes.</span></span> <span data-ttu-id="0dec3-134">若要加入連接，請以滑鼠右鍵按一下您想要連接的其中一個節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-134">To add a connection, right-click one of the nodes that you want to connect.</span></span> <span data-ttu-id="0dec3-135">若要移除連接，請以滑鼠右鍵按一下該連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-135">To remove a connection, right-click the connection.</span></span><br /><br /> <span data-ttu-id="0dec3-136">如果此線條只有單一箭頭，就表示複寫具有其中一個節點的不完整資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-136">If the line has a single arrow, replication has incomplete information for one of the nodes.</span></span>|

### <a name="options-for-the-design-surface"></a><span data-ttu-id="0dec3-137">設計介面的選項</span><span class="sxs-lookup"><span data-stu-id="0dec3-137">Options for the Design Surface</span></span>
 <span data-ttu-id="0dec3-138">**重繪圖形**在設計介面上重新繪製物件，而不重新整理拓撲。</span><span class="sxs-lookup"><span data-stu-id="0dec3-138">**Redraw Graph** Redraw the objects on the design surface without refreshing the topology.</span></span> <span data-ttu-id="0dec3-139">重繪可能會提供較佳的拓撲檢視。</span><span class="sxs-lookup"><span data-stu-id="0dec3-139">Redrawing might provide a better view of the topology.</span></span>

 <span data-ttu-id="0dec3-140">重新整理**拓撲**查詢拓撲中的每個節點，並顯示每個節點的更新資訊。</span><span class="sxs-lookup"><span data-stu-id="0dec3-140">**Refresh Topology** Query each node in the topology, and display updated information about each node.</span></span> <span data-ttu-id="0dec3-141">如果節點很多，這個處理序可能需要幾分鐘。</span><span class="sxs-lookup"><span data-stu-id="0dec3-141">With many nodes, this process can take several minutes.</span></span>

 <span data-ttu-id="0dec3-142">如果精靈要求拓撲資訊，然後您在所有節點回應要求之前關閉精靈並重新開啟，這個頁面可能會無法顯示拓撲中的所有節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-142">If the wizard requests topology information, and then you close and reopen the wizard before all nodes respond to the request, this page might not display all nodes in the topology.</span></span>

 <span data-ttu-id="0dec3-143">**加入新的對等節點**將的實例加入 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 至點對點拓撲。</span><span class="sxs-lookup"><span data-stu-id="0dec3-143">**Add a New Peer Node** Add an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the peer-to-peer topology.</span></span> <span data-ttu-id="0dec3-144">如果您加入執行個體當做節點，系統會在精靈完成之後，於該執行個體上建立發行集。</span><span class="sxs-lookup"><span data-stu-id="0dec3-144">Adding an instance as a node creates a publication at that instance after the wizard completes.</span></span> <span data-ttu-id="0dec3-145">在您加入節點之後，請以滑鼠右鍵按一下它，以便在新節點與現有節點之間加入連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-145">After you add the node, right-click it to add a connection between the new node and an existing node.</span></span>

 <span data-ttu-id="0dec3-146">若要參與點對點拓撲，這個執行個體必須符合下列需求：</span><span class="sxs-lookup"><span data-stu-id="0dec3-146">To participate in a peer-to-peer topology, the instance must meet the following requirements:</span></span>

-   <span data-ttu-id="0dec3-147">它必須已經設定為散發者或與遠端散發者產生關聯。</span><span class="sxs-lookup"><span data-stu-id="0dec3-147">It must already be configured as a Distributor or be associated with a remote Distributor.</span></span>

-   <span data-ttu-id="0dec3-148">它必須包含涉及複寫之資料庫的副本。</span><span class="sxs-lookup"><span data-stu-id="0dec3-148">It must contain a copy of the database involved in replication.</span></span> <span data-ttu-id="0dec3-149">這個副本通常是原始發行集資料庫的還原備份。</span><span class="sxs-lookup"><span data-stu-id="0dec3-149">This copy is typically a restored backup of the original publication database.</span></span>

 <span data-ttu-id="0dec3-150">**選取節點 (s) 以查看**選取要在設計介面上查看的節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-150">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="0dec3-151">如果拓撲具有大量節點，這個選項就很有用。</span><span class="sxs-lookup"><span data-stu-id="0dec3-151">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="0dec3-152">請注意，您只能在設計介面上顯示的節點之間加入連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-152">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

 <span data-ttu-id="0dec3-153">**設定**重新整理超時指定在作業超時之前，重新整理程式可以執行的時間長度。</span><span class="sxs-lookup"><span data-stu-id="0dec3-153">**Set Refresh Timeout** Specify how long the refresh process can run before the operation times out.</span></span>

### <a name="options-for-each-node"></a><span data-ttu-id="0dec3-154">每個節點的選項</span><span class="sxs-lookup"><span data-stu-id="0dec3-154">Options for Each Node</span></span>
 <span data-ttu-id="0dec3-155">**加入新的對等連接**在兩個節點之間新增連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-155">**Add a New Peer Connection** Add a connection between two nodes.</span></span> <span data-ttu-id="0dec3-156">例如，如果您在節點 A 與節點 B 之間加入連接，複寫就會加入兩個訂閱：第一個訂閱可讓節點 A 收到位於節點 B 之發行集的變更，而第二個訂閱可讓節點 B 收到位於節點 A 之發行集的變更。</span><span class="sxs-lookup"><span data-stu-id="0dec3-156">For example, if you add a connection between Node A and Node B, replication adds two subscriptions: The first enables Node A to receive changes from the publication at Node B, and the second enables Node B to receive changes from the publication at Node A.</span></span>

 <span data-ttu-id="0dec3-157">**刪除對等節點**從拓撲中移除節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-157">**Delete Peer Node** Removes a node from the topology.</span></span> <span data-ttu-id="0dec3-158">例如，如果您移除節點 C，就會一併移除位於該節點的發行集。</span><span class="sxs-lookup"><span data-stu-id="0dec3-158">For example, if you remove Node C, the publication at that node is removed.</span></span> <span data-ttu-id="0dec3-159">此外，系統也會移除節點 A 與節點 C 之間的訂閱，以及節點 B 與節點 C 之間的訂閱。</span><span class="sxs-lookup"><span data-stu-id="0dec3-159">Subscriptions between Node A and Node C, and Node B and Node C are also removed.</span></span> <span data-ttu-id="0dec3-160">但是，系統不會刪除位於節點 C 的資料庫，而且不會停用發行和散發功能。</span><span class="sxs-lookup"><span data-stu-id="0dec3-160">The database at Node C is not deleted, and publishing and distribution are not disabled.</span></span>

> [!NOTE]
>  <span data-ttu-id="0dec3-161">當您設定點對點複寫時，會為每個節點指定一個識別碼。</span><span class="sxs-lookup"><span data-stu-id="0dec3-161">When you configure peer-to-peer replication, you specify an ID for each node.</span></span> <span data-ttu-id="0dec3-162">此識別碼在拓撲的所有節點中必須是唯一的，並會儲存在 [MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) 系統資料表的 originator_id 資料行中。</span><span class="sxs-lookup"><span data-stu-id="0dec3-162">This ID, which must be unique across all nodes in the topology, is stored in the originator_id column in the [MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) system table.</span></span> <span data-ttu-id="0dec3-163">如果從拓撲中移除某個節點，其識別碼仍然會保留在記錄資料表中。</span><span class="sxs-lookup"><span data-stu-id="0dec3-163">If a node is removed from the topology, the ID is still retained in the history table.</span></span> <span data-ttu-id="0dec3-164">如果已移除的節點中有仍然在拓撲中進行複寫的變更，保留識別碼可防止發生假衝突。</span><span class="sxs-lookup"><span data-stu-id="0dec3-164">The ID is retained to prevent false conflicts from occurring if there are changes from the removed node that are still being replicated across the topology.</span></span> <span data-ttu-id="0dec3-165">如果您要針對新節點重複使用識別碼，必須先從所有節點的 MSpeer_originatorid_history 資料表中手動刪除該識別碼。</span><span class="sxs-lookup"><span data-stu-id="0dec3-165">If you want to reuse the ID for a new node, you must first manually delete the ID from the MSpeer_originatorid_history table at all nodes.</span></span> <span data-ttu-id="0dec3-166">在您刪除節點的識別碼前，執行 [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) 以確認已複寫源自該節點的所有變更。</span><span class="sxs-lookup"><span data-stu-id="0dec3-166">Before you delete an ID for a node, execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) to verify that all changes that originated from that node have been replicated.</span></span>

 <span data-ttu-id="0dec3-167">**連接到所有顯示的節點**在選取的節點與其他所有節點之間新增連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-167">**Connect to ALL Displayed Nodes** Adds connections between the selected node and all other nodes.</span></span> <span data-ttu-id="0dec3-168">例如，如果您在三節點拓撲中，針對節點 C 選取此選項，複寫就會加入四個訂閱：其中兩個訂閱可讓節點 A 和節點 B 收到位於節點 C 之發行集的變更，而另外兩個訂閱可讓節點 C 收到位於節點 A 和節點 B 之發行集的變更。</span><span class="sxs-lookup"><span data-stu-id="0dec3-168">For example, if you selected this option for Node C in a three node topology, replication adds four subscriptions: two that enable Node A and Node B to receive changes from the publication at Node C, and two that enable Node C to receive changes from the publications at Node A and Node B.</span></span>

 <span data-ttu-id="0dec3-169">**選取節點 (s) 以查看**選取要在設計介面上查看的節點。</span><span class="sxs-lookup"><span data-stu-id="0dec3-169">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="0dec3-170">如果拓撲具有大量節點，這個選項就很有用。</span><span class="sxs-lookup"><span data-stu-id="0dec3-170">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="0dec3-171">請注意，您只能在設計介面上顯示的節點之間加入連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-171">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

### <a name="options-for-the-connection-arrows"></a><span data-ttu-id="0dec3-172">連接箭頭的選項</span><span class="sxs-lookup"><span data-stu-id="0dec3-172">Options for the Connection Arrows</span></span>
 <span data-ttu-id="0dec3-173">**移除對等連接**移除兩個節點之間的連接。</span><span class="sxs-lookup"><span data-stu-id="0dec3-173">**Remove Peer Connection** Remove a connection between two nodes.</span></span> <span data-ttu-id="0dec3-174">例如，如果您移除節點 A 與節點 B 之間的連接，複寫就會卸除兩個訂閱：可讓節點 A 收到位於節點 B 之發行集的變更的訂閱，以及可讓節點 B 收到位於節點 A 之發行集的變更的訂閱。</span><span class="sxs-lookup"><span data-stu-id="0dec3-174">For example, if you remove a connection between Node A and Node B, replication drops two subscriptions: the one that enables Node A to receive changes from the publication at Node B, and the one that enables Node B to receive changes from the publication at Node A.</span></span>

## <a name="see-also"></a><span data-ttu-id="0dec3-175">另請參閱</span><span class="sxs-lookup"><span data-stu-id="0dec3-175">See Also</span></span>
 <span data-ttu-id="0dec3-176">[設定發佈和散發](configure-publishing-and-distribution.md)[管理點對點拓朴 &#40;複寫 transact-sql 程式設計&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [點對點異動複寫](transactional/peer-to-peer-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="0dec3-176">[Configure Publishing and Distribution](configure-publishing-and-distribution.md) [Administer a Peer-to-Peer Topology &#40;Replication Transact-SQL Programming&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [Peer-to-Peer Transactional Replication](transactional/peer-to-peer-transactional-replication.md)</span></span>


