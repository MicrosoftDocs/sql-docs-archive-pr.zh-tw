---
title: 建立和套用初始快照集 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], creating
- snapshot replication [SQL Server], initial snapshots
ms.assetid: 742727a1-5189-44ec-b3ae-6fd7aa1f5347
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: b7ac008fe139adf55376bb50fbf60dddcd6b9ae5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585887"
---
# <a name="create-and-apply-the-initial-snapshot"></a><span data-ttu-id="27c21-102">建立和套用初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-102">Create and Apply the Initial Snapshot</span></span>
  <span data-ttu-id="27c21-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO)，在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中建立及套用初始快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-103">This topic describes how to create and apply the initial snapshot in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="27c21-104">使用參數化篩選的合併式發行集需要一個兩段式快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-104">Merge publications that use parameterized filters require a two-part snapshot.</span></span> <span data-ttu-id="27c21-105">如需詳細資訊，請參閱 [使用參數化篩選建立合併式發行集的快照集](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-105">For more information, see [Create a Snapshot for a Merge Publication with Parameterized Filters](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="27c21-106">**本主題內容**</span><span class="sxs-lookup"><span data-stu-id="27c21-106">**In This Topic**</span></span>  
  
-   <span data-ttu-id="27c21-107">**若要建立和套用初始快照集，請使用：**</span><span class="sxs-lookup"><span data-stu-id="27c21-107">**To create and apply the initial snapshot, using:**</span></span>  
  
     [<span data-ttu-id="27c21-108">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="27c21-108">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="27c21-109">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="27c21-109">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="27c21-110">Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="27c21-110">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="27c21-111">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="27c21-111">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="27c21-112">依預設，如果 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 正在執行中，則在使用「新增發行集精靈」建立發行集之後，快照集代理程式便會立即產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-112">By default, if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent is running, a snapshot is generated by the Snapshot Agent immediately after a publication is created with the New Publication Wizard.</span></span> <span data-ttu-id="27c21-113">隨後，「散發代理程式」(針對快照式複寫和異動複寫) 或「合併代理程式」(針對合併訂閱) 預設會為所有訂閱套用該快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-113">By default, it is then applied by the Distribution Agent (for snapshot and transactional replication) or Merge Agent (for merge subscriptions) for all subscriptions.</span></span> <span data-ttu-id="27c21-114">也可以使用 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 和複寫監視器來產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-114">A snapshot can also be generated using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] and Replication Monitor.</span></span> <span data-ttu-id="27c21-115">如需啟動複寫監視器的詳細資訊，請參閱[啟動複寫監視器](monitor/start-the-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-115">For information about starting Replication Monitor, see [Start the Replication Monitor](monitor/start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-create-a-snapshot-in-management-studio"></a><span data-ttu-id="27c21-116">若要在 Management Studio 中建立快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-116">To create a snapshot in Management Studio</span></span>  
  
1.  <span data-ttu-id="27c21-117">連接到 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]中的發行者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="27c21-117">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="27c21-118">展開 **[複寫]** 資料夾，然後展開 **[本機發行集]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="27c21-118">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="27c21-119">以滑鼠右鍵按一下您要為其建立快照集的發行集，然後按一下 **[檢視快照集代理程式的狀態]** 。</span><span class="sxs-lookup"><span data-stu-id="27c21-119">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="27c21-120">在 [檢視快照集代理程式的狀態 - \<Publication>] 對話方塊中，按一下 [啟動]。</span><span class="sxs-lookup"><span data-stu-id="27c21-120">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
 <span data-ttu-id="27c21-121">快照集代理程式產生完快照集後，就會顯示一個訊息，例如「[100%] 已產生 17 個發行項的快照集」。</span><span class="sxs-lookup"><span data-stu-id="27c21-121">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-create-a-snapshot-in-replication-monitor"></a><span data-ttu-id="27c21-122">若要在複寫監視器中建立快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-122">To create a snapshot in Replication Monitor</span></span>  
  
1.  <span data-ttu-id="27c21-123">在複寫監視器的左窗格中展開發行者群組，然後展開發行者。</span><span class="sxs-lookup"><span data-stu-id="27c21-123">In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.</span></span>  
  
2.  <span data-ttu-id="27c21-124">以滑鼠右鍵按一下要產生快照集的發行集，然後按一下 **[產生快照集]** 。</span><span class="sxs-lookup"><span data-stu-id="27c21-124">Right-click the publication for which you want to generate a snapshot, and then click **Generate Snapshot**.</span></span>  
  
3.  <span data-ttu-id="27c21-125">若要檢視快照集代理程式的狀態，請按一下 **[代理程式]** 索引標籤。如需詳細資訊，請以滑鼠右鍵按一下方格中的「快照集代理程式」，然後按一下 **[檢視詳細資料]** 。</span><span class="sxs-lookup"><span data-stu-id="27c21-125">To view the status of the Snapshot Agent, click the **Agents** tab. For more detailed information, right-click the Snapshot Agent in the grid, and then click **View Details**.</span></span>  
  
#### <a name="to-apply-a-snapshot"></a><span data-ttu-id="27c21-126">若要套用快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-126">To apply a snapshot</span></span>  
  
1.  <span data-ttu-id="27c21-127">產生快照集後，將透過「散發代理程式」或「合併代理程式」對訂閱進行同步處理來套用該快照集：</span><span class="sxs-lookup"><span data-stu-id="27c21-127">After the snapshot is generated, it is applied by synchronizing the subscription with the Distribution Agent or the Merge Agent:</span></span>  
  
    -   <span data-ttu-id="27c21-128">如果將代理程式設定為連續執行 (異動複寫的預設值)，快照集會在產生後自動套用。</span><span class="sxs-lookup"><span data-stu-id="27c21-128">If the agent is set to run continuously (the default for transactional replication), the snapshot is automatically applied after it is generated.</span></span>  
  
    -   <span data-ttu-id="27c21-129">如果將代理程式設定為按排程執行，則快照集將在該代理程式排程的下次執行時套用。</span><span class="sxs-lookup"><span data-stu-id="27c21-129">If the agent is set to run on a schedule, the snapshot is applied the next time the agent is scheduled to run.</span></span>  
  
    -   <span data-ttu-id="27c21-130">如果將代理程式設定為視需要執行，則快照集將您在下次執行該代理程式時套用。</span><span class="sxs-lookup"><span data-stu-id="27c21-130">If the agent is set to run on demand, it is applied the next time you run the agent.</span></span>  
  
     <span data-ttu-id="27c21-131">如需有關同步處理訂閱的資訊，請參閱＜ [Synchronize a Push Subscription](synchronize-a-push-subscription.md) ＞和＜ [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)資料夾中可用。</span><span class="sxs-lookup"><span data-stu-id="27c21-131">For more information about synchronizing subscriptions, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="27c21-132">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="27c21-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="27c21-133">可以透過程式設計方式建立初始快照集，其方式是建立及執行快照集代理程式作業，或是從批次檔執行快照集代理程式的可執行檔。</span><span class="sxs-lookup"><span data-stu-id="27c21-133">Initial snapshots can be programmatically created either by creating and running a Snapshot Agent job or by running the Snapshot Agent executable file from a batch file.</span></span> <span data-ttu-id="27c21-134">在產生初始快照集之後，此快照集會在第一次同步處理訂閱時，傳送及套用到訂閱者。</span><span class="sxs-lookup"><span data-stu-id="27c21-134">After an initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="27c21-135">如果您從命令提示字元或批次檔執行快照集代理程式，每當現有的快照集無效時，您將需要重新執行此代理程式。</span><span class="sxs-lookup"><span data-stu-id="27c21-135">If you run the Snapshot Agent from a command prompt or a batch file, you will need to rerun the agent whenever the existing snapshot becomes invalid.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="27c21-136">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="27c21-136">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="27c21-137">如果您必須將認證儲存在指令碼檔案中，則必須維護這個檔案的安全性，使他人無法在未獲授權的情況下擅自存取。</span><span class="sxs-lookup"><span data-stu-id="27c21-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-and-run-a-snapshot-agent-job-to-generate-the-initial-snapshot"></a><span data-ttu-id="27c21-138">建立及執行快照集代理程式作業以產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-138">To create and run a Snapshot Agent job to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="27c21-139">建立快照式、交易式或合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="27c21-139">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="27c21-140">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-140">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="27c21-141">執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="27c21-141">Execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="27c21-142">指定 **@publication** 和下列參數：</span><span class="sxs-lookup"><span data-stu-id="27c21-142">Specify **@publication** and the following parameters:</span></span>  
  
    -   <span data-ttu-id="27c21-143">**@job_login，它會指定**散發者上的快照集代理程式執行時所用的 Windows 驗證認證。</span><span class="sxs-lookup"><span data-stu-id="27c21-143">**The @job_login, which specifies** the Windows Authentication credentials under which the Snapshot Agent runs at the Distributor.</span></span>  
  
    -   <span data-ttu-id="27c21-144">**@job_password**，它是提供之 Windows 認證的密碼。</span><span class="sxs-lookup"><span data-stu-id="27c21-144">**The @job_password**, which is the password for the supplied Windows credentials.</span></span>  
  
    -   <span data-ttu-id="27c21-145">(選擇性) 如果代理程式在連接到發行者時將使用「SQL Server 驗證」，會將 **@publisher_security_mode** 設定為 **@publisher_security_mode** 的值。</span><span class="sxs-lookup"><span data-stu-id="27c21-145">(Optional) A value of **0** for **@publisher_security_mode** if the agent will use SQL Server Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="27c21-146">在此情況下，您也必須指定和的 SQL Server Authentication 登入資訊 **@publisher_login** **@publisher_password** 。</span><span class="sxs-lookup"><span data-stu-id="27c21-146">In this case, you must also specify the SQL Server Authentication login information for **@publisher_login** and **@publisher_password**.</span></span>  
  
    -   <span data-ttu-id="27c21-147">(選擇性) 快照集代理程式作業的同步排程。</span><span class="sxs-lookup"><span data-stu-id="27c21-147">(Optional) A synchronization schedule for the Snapshot Agent job.</span></span> <span data-ttu-id="27c21-148">如需詳細資訊，請參閱 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-148">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="27c21-149">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="27c21-149">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="27c21-150">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="27c21-150">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="27c21-151">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-151">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="27c21-152">將發行項加入至發行集。</span><span class="sxs-lookup"><span data-stu-id="27c21-152">Add articles to the publication.</span></span> <span data-ttu-id="27c21-153">如需詳細資訊，請參閱 [定義發行項](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-153">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
4.  <span data-ttu-id="27c21-154">在發行集資料庫的發行者端，執行 [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql)，並指定步驟 1 中的 **@publication** 值。</span><span class="sxs-lookup"><span data-stu-id="27c21-154">At the Publisher on the publication database, execute [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql), specifying the value of **@publication** from step 1.</span></span>  
  
#### <a name="to-run-the-snapshot-agent-to-generate-the-initial-snapshot"></a><span data-ttu-id="27c21-155">執行快照集代理程式來產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-155">To run the Snapshot Agent to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="27c21-156">建立快照式、交易式或合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="27c21-156">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="27c21-157">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-157">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="27c21-158">將發行項加入至發行集。</span><span class="sxs-lookup"><span data-stu-id="27c21-158">Add articles to the publication.</span></span> <span data-ttu-id="27c21-159">如需詳細資訊，請參閱 [定義發行項](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-159">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="27c21-160">從命令提示字元或批次檔中，執行 [snapshot.exe](agents/replication-snapshot-agent.md) 來啟動 **複寫合併代理程式**，並指定下列命令列引數：</span><span class="sxs-lookup"><span data-stu-id="27c21-160">From the command prompt or in a batch file, start the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) by running **snapshot.exe**, specifying the following command-line arguments:</span></span>  
  
    -   <span data-ttu-id="27c21-161">**-Publication**</span><span class="sxs-lookup"><span data-stu-id="27c21-161">**-Publication**</span></span>  
  
    -   <span data-ttu-id="27c21-162">**-Publisher**</span><span class="sxs-lookup"><span data-stu-id="27c21-162">**-Publisher**</span></span>  
  
    -   <span data-ttu-id="27c21-163">**-Distributor**</span><span class="sxs-lookup"><span data-stu-id="27c21-163">**-Distributor**</span></span>  
  
    -   <span data-ttu-id="27c21-164">**-PublisherDB**</span><span class="sxs-lookup"><span data-stu-id="27c21-164">**-PublisherDB**</span></span>  
  
    -   <span data-ttu-id="27c21-165">**-ReplicationType**</span><span class="sxs-lookup"><span data-stu-id="27c21-165">**-ReplicationType**</span></span>  
  
     <span data-ttu-id="27c21-166">無果您正在使用「SQL Server 驗證」，您也必須指定下列引數：</span><span class="sxs-lookup"><span data-stu-id="27c21-166">If you are using SQL Server Authentication, you must also specify the following arguments:</span></span>  
  
    -   <span data-ttu-id="27c21-167">**-DistributorLogin**</span><span class="sxs-lookup"><span data-stu-id="27c21-167">**-DistributorLogin**</span></span>  
  
    -   <span data-ttu-id="27c21-168">**-DistributorPassword**</span><span class="sxs-lookup"><span data-stu-id="27c21-168">**-DistributorPassword**</span></span>  
  
    -   <span data-ttu-id="27c21-169">**-DistributorSecurityMode** =  **\@publisher_security_mode**</span><span class="sxs-lookup"><span data-stu-id="27c21-169">**-DistributorSecurityMode** = **0**</span></span>  
  
    -   <span data-ttu-id="27c21-170">**-PublisherLogin**</span><span class="sxs-lookup"><span data-stu-id="27c21-170">**-PublisherLogin**</span></span>  
  
    -   <span data-ttu-id="27c21-171">**-PublisherPassword**</span><span class="sxs-lookup"><span data-stu-id="27c21-171">**-PublisherPassword**</span></span>  
  
    -   <span data-ttu-id="27c21-172">**-PublisherSecurityMode** =  **\@publisher_security_mode**</span><span class="sxs-lookup"><span data-stu-id="27c21-172">**-PublisherSecurityMode** = **0**</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="27c21-173">範例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="27c21-173">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="27c21-174">此範例會示範如何建立交易式發行集，並針對新的發行集加入快照集代理程式作業 (使用 **sqlcmd** 指令碼變數)。</span><span class="sxs-lookup"><span data-stu-id="27c21-174">This example shows how to create a transactional publication and add a Snapshot Agent job for the new publication (using **sqlcmd** scripting variables).</span></span> <span data-ttu-id="27c21-175">此範例也會啟動此作業。</span><span class="sxs-lookup"><span data-stu-id="27c21-175">The example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_trangenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpubinitialsnapshot.sql#sp_trangenerate_snapshot)]  
  
 <span data-ttu-id="27c21-176">此範例會建立合併式發行集，並針對此發行集加入快照集代理程式作業 (使用 **sqlcmd** 變數)。</span><span class="sxs-lookup"><span data-stu-id="27c21-176">This example creates a merge publication and adds a Snapshot Agent job (using **sqlcmd** variables) for the publication.</span></span> <span data-ttu-id="27c21-177">此範例也會啟動此作業。</span><span class="sxs-lookup"><span data-stu-id="27c21-177">This example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_mergegenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubinitialsnapshot.sql#sp_mergegenerate_snapshot)]  
  
 <span data-ttu-id="27c21-178">下列命令列引數會啟動快照集代理程式，以針對合併式發行集產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-178">The following command-line arguments start the Snapshot Agent to generate the snapshot for a merge publication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="27c21-179">加入了分行符號，以提升可讀性。</span><span class="sxs-lookup"><span data-stu-id="27c21-179">Line breaks were added to improve readability.</span></span> <span data-ttu-id="27c21-180">在批次檔中，必須在單一行中撰寫命令。</span><span class="sxs-lookup"><span data-stu-id="27c21-180">In a batch file, commands must be made in a single line.</span></span>  
  
 [!code-sql[HowTo#startmergesnapshot_10](../../snippets/tsql/SQL15/replication/howto/tsql/createmergesnapshot_10.bat)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="27c21-181">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="27c21-181">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="27c21-182">快照集代理程式會在發行集建立之後產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-182">The Snapshot Agent generates snapshots after a publication is created.</span></span> <span data-ttu-id="27c21-183">您可以使用 Replication Management Objects (RMO) 和對複寫代理程式功能的直接 Managed 程式碼存取，以程式設計的方式產生這些快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-183">You can generate these snapshots programmatically by using Replication Management Objects (RMO) and direct managed code access to replication agent functionalities.</span></span> <span data-ttu-id="27c21-184">您使用的物件取決於複寫的類型而定。</span><span class="sxs-lookup"><span data-stu-id="27c21-184">The objects you use depend on the type of replication.</span></span> <span data-ttu-id="27c21-185">您可以使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 物件同步啟動快照集代理程式，或是使用代理程式作業以非同步方式啟動它。</span><span class="sxs-lookup"><span data-stu-id="27c21-185">The Snapshot Agent can be started synchronously using the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> object or asynchronously using the agent job.</span></span> <span data-ttu-id="27c21-186">在產生初始快照集之後，此快照集會在第一次同步處理訂閱時，傳送及套用到訂閱者。</span><span class="sxs-lookup"><span data-stu-id="27c21-186">After the initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="27c21-187">每當現有的快照集不再包含有效且最新的資料時，您就需要重新執行此代理程式。</span><span class="sxs-lookup"><span data-stu-id="27c21-187">You will need to rerun the agent whenever the existing snapshot no longer contains valid, up-to-date data.</span></span> <span data-ttu-id="27c21-188">如需詳細資訊，請參閱[維護發行集](publish/maintain-publications.md)。</span><span class="sxs-lookup"><span data-stu-id="27c21-188">For more information, see [Maintain Publications](publish/maintain-publications.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="27c21-189">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="27c21-189">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="27c21-190">如果您必須儲存認證，請使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) 密碼編譯服務 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="27c21-190">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="27c21-191">啟動快照集代理程式作業 (非同步) 來針對快照式或交易式發行集產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-191">To generate the initial snapshot for a snapshot or transactional publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="27c21-192">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="27c21-192">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="27c21-193">建立 <xref:Microsoft.SqlServer.Replication.TransPublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="27c21-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span> <span data-ttu-id="27c21-194">設定發行集的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 屬性，並將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為在步驟 1 中建立的連接。</span><span class="sxs-lookup"><span data-stu-id="27c21-194">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="27c21-195">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法以載入物件的剩餘屬性。</span><span class="sxs-lookup"><span data-stu-id="27c21-195">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="27c21-196">如果此方法傳回 `false`，則表示步驟 2 中的發行集屬性定義不正確，或者該發行集不存在。</span><span class="sxs-lookup"><span data-stu-id="27c21-196">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="27c21-197">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值是 `false`，請呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 來針對這個發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="27c21-197">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="27c21-198">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 方法來啟動代理程式作業，以針對這個發行集產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-198">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="27c21-199">(選擇性) 當 <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> 的值是 `true` 時，表示快照集可供訂閱者使用。</span><span class="sxs-lookup"><span data-stu-id="27c21-199">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="27c21-200">執行快照集代理程式 (同步) 來針對快照式或交易式發行集產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-200">To generate the initial snapshot for a snapshot or transactional publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="27c21-201">建立 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 類別的執行個體，並設定下列必要的屬性：</span><span class="sxs-lookup"><span data-stu-id="27c21-201">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="27c21-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 發行者的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="27c21-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 發行集資料庫的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="27c21-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 發行集的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="27c21-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 散發者的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="27c21-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 表示連接到發行者時會使用 Windows 驗證的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值或是 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 的值； <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> 的值表示連接到發行者時會使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="27c21-207">建議使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-207">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="27c21-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 表示連接到散發者時會使用 Windows 驗證的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值或是 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 的值； <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> 的值表示連接到散發者時會使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="27c21-209">建議使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-209">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="27c21-210">針對 <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> 設定 <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> 或 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>的值。</span><span class="sxs-lookup"><span data-stu-id="27c21-210">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="27c21-211">呼叫 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="27c21-211">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="27c21-212">啟動快照集代理程式作業 (非同步) 來針對合併式發行集產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-212">To generate the initial snapshot for a merge publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="27c21-213">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="27c21-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="27c21-214">建立 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="27c21-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class.</span></span> <span data-ttu-id="27c21-215">設定發行集的 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 屬性，並將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為在步驟 1 中建立的連接。</span><span class="sxs-lookup"><span data-stu-id="27c21-215">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="27c21-216">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法以載入物件的剩餘屬性。</span><span class="sxs-lookup"><span data-stu-id="27c21-216">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="27c21-217">如果此方法傳回 `false`，則表示步驟 2 中的發行集屬性定義不正確，或者該發行集不存在。</span><span class="sxs-lookup"><span data-stu-id="27c21-217">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="27c21-218">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值是 `false`，請呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 來針對這個發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="27c21-218">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="27c21-219">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 方法來啟動代理程式作業，以針對這個發行集產生快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-219">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="27c21-220">(選擇性) 當 <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 的值是 `true` 時，表示快照集可供訂閱者使用。</span><span class="sxs-lookup"><span data-stu-id="27c21-220">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="27c21-221">執行快照集代理程式 (同步) 來針對合併式發行集產生初始快照集</span><span class="sxs-lookup"><span data-stu-id="27c21-221">To generate the initial snapshot for a merge publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="27c21-222">建立 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 類別的執行個體，並設定下列必要的屬性：</span><span class="sxs-lookup"><span data-stu-id="27c21-222">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="27c21-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 發行者的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="27c21-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 發行集資料庫的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="27c21-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 發行集的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="27c21-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 散發者的名稱</span><span class="sxs-lookup"><span data-stu-id="27c21-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="27c21-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 表示連接到發行者時會使用 Windows 驗證的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值或是 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 的值； <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> 的值表示連接到發行者時會使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="27c21-228">建議使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-228">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="27c21-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 表示連接到散發者時會使用 Windows 驗證的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值或是 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 的值； <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> 和 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> 的值表示連接到散發者時會使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="27c21-230">建議使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="27c21-230">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="27c21-231">為 <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> 設定 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>的值。</span><span class="sxs-lookup"><span data-stu-id="27c21-231">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="27c21-232">呼叫 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="27c21-232">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="27c21-233">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="27c21-233">Examples (RMO)</span></span>  
 <span data-ttu-id="27c21-234">這個範例會同步執行快照集代理程式，以針對交易式發行集產生初始快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-234">This example synchronously runs the Snapshot Agent to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot)]  
  
 <span data-ttu-id="27c21-235">這個範例會以非同步方式啟動代理程式作業，以針對交易式發行集產生初始快照集。</span><span class="sxs-lookup"><span data-stu-id="27c21-235">This example asynchronously starts the agent job to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot_WithJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot_withjob)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot_WithJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot_withjob)]  
  
## <a name="see-also"></a><span data-ttu-id="27c21-236">另請參閱</span><span class="sxs-lookup"><span data-stu-id="27c21-236">See Also</span></span>  
 <span data-ttu-id="27c21-237">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-237">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="27c21-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span></span>  
 <span data-ttu-id="27c21-239">[Create a Push Subscription](create-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-239">[Create a Push Subscription](create-a-push-subscription.md) </span></span>  
 <span data-ttu-id="27c21-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span></span>  
 <span data-ttu-id="27c21-241">[建立並套用快照集](create-and-apply-the-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-241">[Create and Apply the Snapshot](create-and-apply-the-snapshot.md) </span></span>  
 <span data-ttu-id="27c21-242">[使用快照集初始化訂閱](initialize-a-subscription-with-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-242">[Initialize a Subscription with a Snapshot](initialize-a-subscription-with-a-snapshot.md) </span></span>  
 <span data-ttu-id="27c21-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="27c21-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="27c21-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="27c21-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 [<span data-ttu-id="27c21-246">以指令碼變數使用 sqlcmd</span><span class="sxs-lookup"><span data-stu-id="27c21-246">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
