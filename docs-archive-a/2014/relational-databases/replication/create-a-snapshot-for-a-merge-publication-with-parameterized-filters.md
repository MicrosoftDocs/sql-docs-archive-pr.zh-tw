---
title: 使用參數化篩選建立合併式發行集的快照集 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87697978"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="92dd1-102">使用參數化篩選建立合併式發行集的快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="92dd1-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO)，在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中使用參數化篩選建立合併式發行集的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="92dd1-104">開始之前</span><span class="sxs-lookup"><span data-stu-id="92dd1-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="92dd1-105">建議</span><span class="sxs-lookup"><span data-stu-id="92dd1-105">Recommendations</span></span>  
  
-   <span data-ttu-id="92dd1-106">在使用參數化篩選產生合併式發行集的快照集時，您必須先產生一個標準 (結構描述) 快照集，其中包含所有發行的資料以及訂閱的訂閱者中繼資料。</span><span class="sxs-lookup"><span data-stu-id="92dd1-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="92dd1-107">如需詳細資訊，請參閱 [建立和套用初始快照集](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="92dd1-108">在您建立結構描述快照集之後，您可以產生包含發行資料之訂閱者特有資料分割的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="92dd1-109">如果發行集內的一或多個發行項的篩選產生對每個訂閱而言是唯一的非重疊資料分割，則只要合併代理程式一執行，就會清除中繼資料。</span><span class="sxs-lookup"><span data-stu-id="92dd1-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="92dd1-110">這表示分割快照集會更快過期。</span><span class="sxs-lookup"><span data-stu-id="92dd1-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="92dd1-111">使用這個選項時，您應該考慮允許訂閱者初始化快照集的產生與傳遞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="92dd1-112">如需篩選選項的詳細資訊，請參閱[含參數化篩選之合併式發行集的快照集](snapshots-for-merge-publications-with-parameterized-filters.md)的＜設定資料分割選項＞一節。</span><span class="sxs-lookup"><span data-stu-id="92dd1-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="92dd1-113">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="92dd1-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="92dd1-114">您可在 [發行集屬性 - \<Publication>] 對話方塊的 [資料分割區] 頁面上，產生分割區的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="92dd1-115">如需有關存取這個對話方塊的詳細資訊，請參閱＜ [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="92dd1-116">您可以讓訂閱者初始化快照集產生和傳遞，並且/或者產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="92dd1-117">產生一個或多個資料分割的快照集之前，必須：</span><span class="sxs-lookup"><span data-stu-id="92dd1-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="92dd1-118">使用「新增發行集精靈」建立合併發行集，並在精靈的 **[加入篩選]** 頁面上，指定一個或多個參數化資料列篩選器。</span><span class="sxs-lookup"><span data-stu-id="92dd1-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="92dd1-119">如需詳細資訊，請參閱 [針對合併發行項定義及修改參數化資料列篩選](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="92dd1-120">產生發行集的結構描述快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="92dd1-121">依預設，當您完成「新增發行集精靈」時，便會產生結構描述快照集；您也可以從 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]產生結構描述快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="92dd1-122">若要產生結構描述快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="92dd1-123">連接到 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]中的發行者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="92dd1-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="92dd1-124">展開 **[複寫]** 資料夾，然後展開 **[發行集]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="92dd1-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="92dd1-125">以滑鼠右鍵按一下您要為其建立快照集的發行集，然後按一下 **[檢視快照集代理程式的狀態]** 。</span><span class="sxs-lookup"><span data-stu-id="92dd1-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="92dd1-126">在 [檢視快照集代理程式的狀態 - \<Publication>] 對話方塊中，按一下 [啟動]。</span><span class="sxs-lookup"><span data-stu-id="92dd1-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="92dd1-127">快照集代理程式產生完快照集後，就會顯示一個訊息，例如「[100%] 已產生 17 個發行項的快照集」。</span><span class="sxs-lookup"><span data-stu-id="92dd1-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="92dd1-128">若要允許訂閱者初始化快照集的產生與傳遞</span><span class="sxs-lookup"><span data-stu-id="92dd1-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="92dd1-129">在 [發行集屬性 - \<Publication>] 對話方塊的 [資料分割區] 頁面上，選取 [新的訂閱者嘗試進行同步處理時，自動定義分割區並依需要產生快照集]。</span><span class="sxs-lookup"><span data-stu-id="92dd1-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="92dd1-130">若要產生和重新整理快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="92dd1-131">在 [發行集屬性 - \<Publication>] 對話方塊的 [資料分割區] 頁面上，按一下 [新增]。</span><span class="sxs-lookup"><span data-stu-id="92dd1-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="92dd1-132">輸入與您要建立快照集的資料分割關聯之 **HOST_NAME()** 和 (或) **SUSER_SNAME()** 的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="92dd1-133">選擇性地指定重新整理快照集的排程：</span><span class="sxs-lookup"><span data-stu-id="92dd1-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="92dd1-134">選取 **[排程這個資料分割的快照集代理程式在下列時間執行]**</span><span class="sxs-lookup"><span data-stu-id="92dd1-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="92dd1-135">接受重新重理快照集的預設排程，或按一下 **[變更]** 以指定其他排程。</span><span class="sxs-lookup"><span data-stu-id="92dd1-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="92dd1-136">按一下 [確定] 回到 [發行集屬性 - \<Publication>] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="92dd1-137">在屬性方格中選取資料分割，然後按一下 **[立即產生選取的快照集]** 。</span><span class="sxs-lookup"><span data-stu-id="92dd1-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="92dd1-138">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="92dd1-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="92dd1-139">您可以使用預存程序和快照集代理程式進行以下作業：</span><span class="sxs-lookup"><span data-stu-id="92dd1-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="92dd1-140">允許訂閱者在首次執行同步處理時，要求快照集產生和應用程式。</span><span class="sxs-lookup"><span data-stu-id="92dd1-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="92dd1-141">為每個資料分割預先產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="92dd1-142">以手動方式為每一個訂閱者產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="92dd1-143">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="92dd1-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="92dd1-144">如果您必須將認證儲存在指令碼檔案中，則必須維護這個檔案的安全性，使他人無法在未獲授權的情況下擅自存取。</span><span class="sxs-lookup"><span data-stu-id="92dd1-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="92dd1-145">建立可讓訂閱者初始化快照集產生和傳遞的發行集</span><span class="sxs-lookup"><span data-stu-id="92dd1-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="92dd1-146">在發行集資料庫的發行者端，執行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="92dd1-147">指定下列參數：</span><span class="sxs-lookup"><span data-stu-id="92dd1-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="92dd1-148">為 **\@publication** 設定為發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="92dd1-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="92dd1-149">Allow_subscriber_initiated_snapshot 的值 `true` ， \*\* \@ \*\*可讓訂閱者起始快照集進程。</span><span class="sxs-lookup"><span data-stu-id="92dd1-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="92dd1-150">(選擇性) 為 **\@max_concurrent_dynamic_snapshots** 設定為可以並行執行的動態快照集處理序數目。</span><span class="sxs-lookup"><span data-stu-id="92dd1-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="92dd1-151">如果正在執行最大的處理序數目，而且訂閱者嘗試產生快照集，則會將此處理序置於佇列中。</span><span class="sxs-lookup"><span data-stu-id="92dd1-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="92dd1-152">根據預設，並行處理序的數目沒有任何限制。</span><span class="sxs-lookup"><span data-stu-id="92dd1-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="92dd1-153">在發行者端，執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="92dd1-154">指定用於\*\* \@ 發行**的步驟1中所使用的發行集名稱，以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 連接到發行者時，複寫[快照集代理程式](agents/replication-snapshot-agent.md)驗證的 Windows 認證，您也必須為** \@ publisher_security_mode**指定**0**的值，以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] \*\* \@ publisher_login**和\*\* \@ publisher_password\*\*的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="92dd1-155">這麼做會為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="92dd1-156">如需有關產生初始快照集以及為快照集代理程式定義自訂排程的詳細資訊，請參閱＜ [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="92dd1-157">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="92dd1-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="92dd1-158">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="92dd1-159">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="92dd1-160">若要將發行項新增至發行集中，請執行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="92dd1-161">必須針對發行集中的每一個發行項執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="92dd1-162">在使用參數化篩選時，您必須使用 **\@subset_filterclause** 參數來指定一或多個發行項的參數化資料列篩選器。</span><span class="sxs-lookup"><span data-stu-id="92dd1-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="92dd1-163">如需詳細資訊，請參閱 [針對合併發行項定義及修改參數化資料列篩選](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="92dd1-164">如果將根據參數化資料列篩選器來篩選其他發行項，請執行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 來定義兩個發行項之間的聯結或邏輯記錄關聯性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="92dd1-165">必須針對每一個定義的關聯性執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="92dd1-166">如需詳細資訊，請參閱 [定義和修改合併發行項之間的聯結篩選](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="92dd1-167">當合併代理程式要求此快照集初始化訂閱者時，會自動產生要求之訂閱資料分割的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="92dd1-168">建立發行集及預先產生或自動重新整理快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="92dd1-169">若要建立發行集，請執行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="92dd1-170">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="92dd1-171">在發行者端，執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="92dd1-172">為 **\@publication** 指定步驟 1 中所使用的發行集名稱，並為 **\@job_login** 和 **\@password** 指定執行快照集代理程式時所使用的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="92dd1-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="92dd1-173">如果代理程式會在與發行者連接時使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證，您也必須為 **\@publisher_security_mode** 指定 **0** 值，並為 **\@publisher_login** 和 **\@publisher_password** 指定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="92dd1-174">這麼做會為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="92dd1-175">如需有關產生初始快照集以及為快照集代理程式定義自訂排程的詳細資訊，請參閱＜ [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="92dd1-176">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="92dd1-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="92dd1-177">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="92dd1-178">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="92dd1-179">若要將發行項新增至發行集中，請執行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="92dd1-180">必須針對發行集中的每一個發行項執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="92dd1-181">在使用參數化篩選時，您必須使用 **\@subset_filterclause** 參數來指定一個發行項的參數化資料列篩選器。</span><span class="sxs-lookup"><span data-stu-id="92dd1-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="92dd1-182">如需詳細資訊，請參閱 [針對合併發行項定義及修改參數化資料列篩選](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="92dd1-183">如果將根據參數化資料列篩選器來篩選其他發行項，請執行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 來定義兩個發行項之間的聯結或邏輯記錄關聯性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="92dd1-184">必須針對每一個定義的關聯性執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="92dd1-185">如需詳細資訊，請參閱 [定義和修改合併發行項之間的聯結篩選](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="92dd1-186">在發行集資料庫的發行者端，執行 [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)，並指定步驟 1 中的 **\@publication** 值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="92dd1-187">請注意結果集中 **snapshot_jobid** 的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="92dd1-188">將步驟 5 取得之 **snapshot_jobid** 的值轉換成 **uniqueidentifier**。</span><span class="sxs-lookup"><span data-stu-id="92dd1-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="92dd1-189">在 **msdb** 資料庫的發行者端，執行 [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql)，並為 **\@job_id** 指定步驟 6 中所取得的轉換值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="92dd1-190">在發行集資料庫的發行者端，執行 [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="92dd1-191">為 **\@publication** 指定步驟 1 中的發行集名稱，並為 **\@suser_sname** (如果 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 用於篩選子句) 或是為 **\@host_name** (如果 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 用於篩選子句) 指定用於定義資料分割的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="92dd1-192">在發行集資料庫的發行者端，執行 [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="92dd1-193">為 **\@publication** 指定步驟 1 中的發行集名稱、步驟 8 中的 **\@suser_sname** 或 **\@host_name** 的值，以及此作業的排程。</span><span class="sxs-lookup"><span data-stu-id="92dd1-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="92dd1-194">這樣會建立針對指定的資料分割產生參數化快照集的作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="92dd1-195">如需詳細資訊，請參閱 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="92dd1-196">這個作業會使用與步驟 2 中定義的初始快照集作業相同的 Windows 帳戶來執行。</span><span class="sxs-lookup"><span data-stu-id="92dd1-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="92dd1-197">若要移除參數化快照集作業及其相關的資料分割，請執行 [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="92dd1-198">在發行集資料庫的發行者上，執行 [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql)，指定步驟 1 中 **\@publication** 的值以及步驟 8 中 **\@suser_sname** 或 **\@host_name** 的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="92dd1-199">請注意結果集中 **dynamic_snapshot_jobid** 的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="92dd1-200">在 **msdb** 資料庫的散發者端，執行 [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql)，並為 **\@job_id** 指定步驟 9 中所取得的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="92dd1-201">這樣會啟動資料分割的參數化快照集作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="92dd1-202">針對每一個訂閱重複步驟 8-11 來產生分割快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="92dd1-203">針對每一個資料分割建立發行集及手動建立快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="92dd1-204">若要建立發行集，請執行 [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="92dd1-205">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="92dd1-206">在發行者端，執行 [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="92dd1-207">為 **\@publication** 指定步驟 1 中所使用的發行集名稱，並為 **\@job_login** 和 **\@password** 指定執行快照集代理程式時所使用的 Windows 認證。</span><span class="sxs-lookup"><span data-stu-id="92dd1-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="92dd1-208">如果代理程式會在與發行者連接時使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證，您也必須為 **\@publisher_security_mode** 指定 **0** 值，並為 **\@publisher_login** 和 **\@publisher_password** 指定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的登入資訊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="92dd1-209">這麼做會為發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="92dd1-210">如需有關產生初始快照集以及為快照集代理程式定義自訂排程的詳細資訊，請參閱＜ [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="92dd1-211">當利用遠端散發者來設定發行者時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="92dd1-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="92dd1-212">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="92dd1-213">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="92dd1-214">若要將發行項新增至發行集中，請執行 [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="92dd1-215">必須針對發行集中的每一個發行項執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="92dd1-216">在使用參數化篩選時，您必須使用 **\@subset_filterclause** 參數，至少為一個發行項指定參數化資料列篩選器。</span><span class="sxs-lookup"><span data-stu-id="92dd1-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="92dd1-217">如需詳細資訊，請參閱 [針對合併發行項定義及修改參數化資料列篩選](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="92dd1-218">如果將根據參數化資料列篩選器來篩選其他發行項，請執行 [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) 來定義兩個發行項之間的聯結或邏輯記錄關聯性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="92dd1-219">必須針對每一個定義的關聯性執行一次此預存程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="92dd1-220">如需詳細資訊，請參閱 [定義和修改合併發行項之間的聯結篩選](publish/define-and-modify-a-join-filter-between-merge-articles.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="92dd1-221">從命令提示字元啟動快照集作業或是執行複寫快照集代理程式，以產生標準快照集結構描述和其他檔案。</span><span class="sxs-lookup"><span data-stu-id="92dd1-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="92dd1-222">如需詳細資訊，請參閱 [建立和套用初始快照集](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="92dd1-223">再次從命令提示字元執行複寫快照集代理程式，以產生大量複製 (.bcp) 檔案，為 **-DynamicSnapshotLocation** 指定分割快照集的位置，以及指定可定義此資料分割的下列其中一個或兩個屬性：</span><span class="sxs-lookup"><span data-stu-id="92dd1-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="92dd1-224">**-DynamicFilterHostName** - 使用 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 時的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="92dd1-225">**-DynamicFilterLogin** - 使用 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 時的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="92dd1-226">針對每一個訂閱重複步驟 6 來產生分割快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="92dd1-227">針對每一個訂閱執行合併代理程式，以便在訂閱者上套用初始分割快照集，並指定下列屬性：</span><span class="sxs-lookup"><span data-stu-id="92dd1-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="92dd1-228">**-Hostname** - 如果正在覆寫 HOST_NAME 的實際值，則表示用於定義資料分割的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="92dd1-229">**-DynamicSnapshotLocation** - 此資料分割的動態快照集位置。</span><span class="sxs-lookup"><span data-stu-id="92dd1-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="92dd1-230">如需複寫代理程式之程式設計的詳細資訊，請參閱[複寫代理程式可執行檔概念](concepts/replication-agent-executables-concepts.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="92dd1-231">範例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="92dd1-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="92dd1-232">這個範例會使用參數化篩選來建立合併式發行集，其中的訂閱者會起始快照集的產生程序。</span><span class="sxs-lookup"><span data-stu-id="92dd1-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="92dd1-233">**\@job_login** 和 **\@job_password** 的值會使用指令碼變數來傳遞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="92dd1-234">這個範例會使用參數化篩選建立發行集，其中的每一個訂閱者會藉由執行 [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) 來定義其資料分割，並藉由執行 [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) 來建立篩選的快照集作業，傳遞資料分割資訊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="92dd1-235">**\@job_login** 和 **\@job_password** 的值會使用指令碼變數來傳遞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="92dd1-236">這個範例會使用參數化篩選建立發行集，其中的每一個訂閱者必須藉由提供資料分割資訊，以建立其資料分割和篩選的快照集作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="92dd1-237">訂閱者在手動執行複寫代理程式時，會使用命令列參數提供資料分割資訊。</span><span class="sxs-lookup"><span data-stu-id="92dd1-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="92dd1-238">此範例假設也已經建立發行集的訂閱。</span><span class="sxs-lookup"><span data-stu-id="92dd1-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="92dd1-239">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="92dd1-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="92dd1-240">您可以透過以下方式，以程式設計的方式使用 Replication Management Objects (RMO) 來產生分割快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="92dd1-241">允許訂閱者在首次執行同步處理時，要求快照集產生和應用程式。</span><span class="sxs-lookup"><span data-stu-id="92dd1-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="92dd1-242">為每個資料分割預先產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="92dd1-243">執行「快照集代理程式」為每個訂閱者手動產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="92dd1-244">當篩選發行項產生了對每個訂閱而言是唯一的非重疊資料分割時 (在建立合併發行項時，針對 <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> 指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> 的值)，則只要合併代理程式一執行，就會清除中繼資料。</span><span class="sxs-lookup"><span data-stu-id="92dd1-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="92dd1-245">這表示分割快照集會更快過期。</span><span class="sxs-lookup"><span data-stu-id="92dd1-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="92dd1-246">當使用這個選項時，您應該考慮允許訂閱者要求產生快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="92dd1-247">如需詳細資訊，請參閱＜ [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md)＞主題中的「使用適當的篩選選項」一節。</span><span class="sxs-lookup"><span data-stu-id="92dd1-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="92dd1-248">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="92dd1-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="92dd1-249">如果您必須儲存認證，請使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) 密碼編譯服務 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="92dd1-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="92dd1-250">建立可讓訂閱者初始化快照集產生和傳遞的發行集</span><span class="sxs-lookup"><span data-stu-id="92dd1-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="92dd1-251">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="92dd1-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="92dd1-252">為發行集資料庫建立 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> 類別的執行個體、將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 執行個體，並呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="92dd1-253">如果 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 傳回 `false`，請確認此資料庫確實存在。</span><span class="sxs-lookup"><span data-stu-id="92dd1-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="92dd1-254">如果 <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> 屬性為 `false`，請將它設定為 `true` 然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="92dd1-255">建立 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體，並為此物件設定下列屬性：</span><span class="sxs-lookup"><span data-stu-id="92dd1-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="92dd1-256">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設定為步驟 1 中的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-257">將 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>設為發行的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="92dd1-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-258">將 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>設定為發行集名稱。</span><span class="sxs-lookup"><span data-stu-id="92dd1-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-259">將 <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>設定為動態快照集作業的最大數目。</span><span class="sxs-lookup"><span data-stu-id="92dd1-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="92dd1-260">由於訂閱者起始的快照集要求可在任何時間發生，所以當多個訂閱者同時要求其分割快照集時，這個屬性會限制可以同時執行的快照集代理程式作業數目。</span><span class="sxs-lookup"><span data-stu-id="92dd1-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="92dd1-261">當正在執行最大的作業數目時，其他分割快照集要求會排入佇列中，直到其中一個執行中的作業完成為止。</span><span class="sxs-lookup"><span data-stu-id="92dd1-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="92dd1-262">使用位元邏輯 OR (Visual C# 中為 `|` 且 Visual Basic 中為 `Or`) 運算子，將 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> 值加入 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-263"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> 欄位，可提供執行快照集代理程式作業所使用之 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶的認證。</span><span class="sxs-lookup"><span data-stu-id="92dd1-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="92dd1-264">當發行集是由 `sysadmin` 固定伺服器角色的成員所建立時，建議您設定 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="92dd1-265">如需詳細資訊，請參閱 [複寫代理程式安全性模型](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="92dd1-266">呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法來建立發行集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="92dd1-267">當利用遠端散發者來設定發行者時，提供給所有屬性的值 (包括 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>) 都會以純文字的方式傳給散發者。</span><span class="sxs-lookup"><span data-stu-id="92dd1-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="92dd1-268">您應該先加密「發行者」及其遠端「散發者」之間的連線，然後再呼叫 <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="92dd1-269">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="92dd1-270">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 屬性將發行項加入發行集中。</span><span class="sxs-lookup"><span data-stu-id="92dd1-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="92dd1-271">至少針對定義參數化篩選的一個發行項指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="92dd1-272">(選擇性) 建立可在發行項之間定義聯結篩選的 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="92dd1-273">如需詳細資訊，請參閱 [定義發行項](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="92dd1-274">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值是 `false`，請呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 來針對這個發行集建立初始快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="92dd1-275">呼叫步驟 4 中建立之 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 物件的 <xref:Microsoft.SqlServer.Replication.MergePublication> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="92dd1-276">這樣會啟動可產生初始快照集的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="92dd1-277">如需有關產生初始快照集以及為快照集代理程式定義自訂排程的詳細資訊，請參閱＜ [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="92dd1-278">(選擇性) 檢查是否有為 <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 屬性設定 `true` 的值，以判斷初始快照集何時可準備好供人使用。</span><span class="sxs-lookup"><span data-stu-id="92dd1-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="92dd1-279">當訂閱者的合併代理程式第一次連接時，會自動產生分割快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="92dd1-280">建立發行集及預先產生或自動重新整理快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="92dd1-281">使用 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體來定義合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="92dd1-282">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="92dd1-283">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 屬性將發行項加入發行集中。</span><span class="sxs-lookup"><span data-stu-id="92dd1-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="92dd1-284">至少針對定義參數化篩選的一個發行項指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 屬性，並建立可在兩個發行項之間定義聯結篩選的任何 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="92dd1-285">如需詳細資訊，請參閱 [定義發行項](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="92dd1-286">如果 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> 的值是 `false`，請呼叫 <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> 來針對這個發行集建立快照集代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="92dd1-287">呼叫步驟 1 中建立之 <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> 物件的 <xref:Microsoft.SqlServer.Replication.MergePublication> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="92dd1-288">這個方法會啟動可產生初始快照集的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="92dd1-289">如需有關產生初始快照集以及為快照集代理程式定義自訂排程的詳細資訊，請參閱＜ [建立和套用初始快照集](create-and-apply-the-initial-snapshot.md)＞。</span><span class="sxs-lookup"><span data-stu-id="92dd1-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="92dd1-290">檢查是否有為 <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> 屬性設定 `true` 的值，以判斷初始快照集何時可準備好供人使用。</span><span class="sxs-lookup"><span data-stu-id="92dd1-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="92dd1-291">建立 <xref:Microsoft.SqlServer.Replication.MergePartition> 類別的執行個體，並使用以下其中一個或兩個屬性來為訂閱者設定參數化篩選準則：</span><span class="sxs-lookup"><span data-stu-id="92dd1-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="92dd1-292">如果訂閱者的資料分割是由 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 的結果所定義，請使用 <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-293">如果訂閱者的資料分割是由 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 的結果或這個函式的多載所定義，請使用 <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="92dd1-294">建立 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 類別的執行個體，並設定與步驟 6 中相同的屬性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="92dd1-295">使用 <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> 類別來定義排程，以針對訂閱者資料分割產生篩選的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="92dd1-296">使用步驟 1 中的 <xref:Microsoft.SqlServer.Replication.MergePublication> 執行個體，呼叫 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="92dd1-297">傳遞步驟 6 的 <xref:Microsoft.SqlServer.Replication.MergePartition> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="92dd1-298">使用步驟 1 中的 <xref:Microsoft.SqlServer.Replication.MergePublication> 執行個體，呼叫 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="92dd1-299">傳遞步驟 7 中的 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 物件及步驟 8 中的 <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="92dd1-300">呼叫 <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>並在 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> 物件中找出傳回的陣列中新加入的分割快照集作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="92dd1-301">取得此作業的 <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="92dd1-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="92dd1-302">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與散發者的連接。</span><span class="sxs-lookup"><span data-stu-id="92dd1-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="92dd1-303">建立 SQL Server 管理物件 (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> 類別的執行個體，傳遞步驟 13 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="92dd1-304">建立 <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> 類別的執行個體，傳遞步驟 14 中 <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> 的 <xref:Microsoft.SqlServer.Management.Smo.Server> 屬性及步驟 12 中的作業名稱。</span><span class="sxs-lookup"><span data-stu-id="92dd1-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="92dd1-305">呼叫 <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> 方法來啟動分割快照集作業。</span><span class="sxs-lookup"><span data-stu-id="92dd1-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="92dd1-306">對每一個訂閱者重複步驟 6-16。</span><span class="sxs-lookup"><span data-stu-id="92dd1-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="92dd1-307">針對每一個資料分割建立發行集及手動建立快照集</span><span class="sxs-lookup"><span data-stu-id="92dd1-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="92dd1-308">使用 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體來定義合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="92dd1-309">如需詳細資訊，請參閱[建立發行集](publish/create-a-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="92dd1-310">使用 <xref:Microsoft.SqlServer.Replication.MergeArticle> 屬性將發行項加入發行集中。至少針對定義參數化篩選的一個發行項指定 <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> 屬性，並建立可在兩個發行項之間定義聯結篩選的任何 <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> 物件。</span><span class="sxs-lookup"><span data-stu-id="92dd1-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="92dd1-311">如需詳細資訊，請參閱 [定義發行項](publish/define-an-article.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="92dd1-312">產生初始快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-312">Generate the initial snapshot.</span></span> <span data-ttu-id="92dd1-313">如需詳細資訊，請參閱 [建立和套用初始快照集](create-and-apply-the-initial-snapshot.md)。</span><span class="sxs-lookup"><span data-stu-id="92dd1-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="92dd1-314">建立 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> 類別的執行個體，並設定下列必要的屬性：</span><span class="sxs-lookup"><span data-stu-id="92dd1-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="92dd1-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - 發行者的名稱</span><span class="sxs-lookup"><span data-stu-id="92dd1-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="92dd1-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - 發行集資料庫的名稱</span><span class="sxs-lookup"><span data-stu-id="92dd1-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="92dd1-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - 發行集的名稱</span><span class="sxs-lookup"><span data-stu-id="92dd1-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="92dd1-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - 散發者的名稱</span><span class="sxs-lookup"><span data-stu-id="92dd1-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="92dd1-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 代表使用「Windows 整合式驗證」的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值，或使用「SQL Server 驗證」的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="92dd1-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 代表使用「Windows 整合式驗證」的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> 值，或使用「SQL Server 驗證」的 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> 值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="92dd1-321">為 <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> 設定 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>的值。</span><span class="sxs-lookup"><span data-stu-id="92dd1-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="92dd1-322">設定以下其中一個或多個屬性來定義資料分割參數：</span><span class="sxs-lookup"><span data-stu-id="92dd1-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="92dd1-323">如果訂閱者的資料分割是由 [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) 的結果所定義，請使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="92dd1-324">如果訂閱者的資料分割是由 [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) 的結果或這個函式的多載所定義，請使用 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>。</span><span class="sxs-lookup"><span data-stu-id="92dd1-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="92dd1-325">呼叫 <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="92dd1-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="92dd1-326">對每一個訂閱者重複步驟 4-7。</span><span class="sxs-lookup"><span data-stu-id="92dd1-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="92dd1-327">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="92dd1-327">Examples (RMO)</span></span>  
 <span data-ttu-id="92dd1-328">此範例會建立允許訂閱者要求產生快照集的合併式發行集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="92dd1-329">這個範例會使用參數化資料列篩選器，針對合併式發行集手動建立訂閱者資料分割及篩選的快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="92dd1-330">這個範例會使用參數化資料列篩選器，針對合併式發行集的訂閱者啟動快照集代理程式來產生篩選的資料快照集。</span><span class="sxs-lookup"><span data-stu-id="92dd1-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="92dd1-331">另請參閱</span><span class="sxs-lookup"><span data-stu-id="92dd1-331">See Also</span></span>  
 <span data-ttu-id="92dd1-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="92dd1-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="92dd1-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="92dd1-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="92dd1-334">[具有參數化篩選之合併式發行集的快照集](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="92dd1-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="92dd1-335">複寫安全性最佳作法</span><span class="sxs-lookup"><span data-stu-id="92dd1-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
