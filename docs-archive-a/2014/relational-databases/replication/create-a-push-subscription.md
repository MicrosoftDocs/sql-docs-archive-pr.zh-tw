---
title: 建立發送訂閱 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- push subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], push subscriptions
- subscriptions [SQL Server replication], push
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: adfbbc61-58d1-4330-9ad6-b14ab1142e2b
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2195d96f4337cc60ba213deb5e3cc2831d27da76
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87607374"
---
# <a name="create-a-push-subscription"></a><span data-ttu-id="c0ebb-102">建立發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-102">Create a Push Subscription</span></span>
  <span data-ttu-id="c0ebb-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO) 來建立 [!INCLUDE[tsql](../../includes/tsql-md.md)]中的發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-103">This topic describes how to create a push subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="c0ebb-104">如需為非訂閱者建立發送訂閱的相關資訊 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，請參閱為[非 SQL Server 的訂閱者建立訂閱](create-a-subscription-for-a-non-sql-server-subscriber.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-104">For information about creating a push subscription for a non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Subscriber, see [Create a Subscription for a Non-SQL Server Subscriber](create-a-subscription-for-a-non-sql-server-subscriber.md).</span></span>  
  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="c0ebb-105">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c0ebb-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="c0ebb-106">使用「新增訂閱精靈」在「發行者」或「訂閱者」端建立發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-106">Create a push subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="c0ebb-107">依照精靈中各頁面進行：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="c0ebb-108">指定發行者和發行集。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="c0ebb-109">選取要執行複寫代理程式的位置。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-109">Select where replication agents will run.</span></span> <span data-ttu-id="c0ebb-110">對於發送訂閱，根據發行集的類型在 **[散發代理程式位置]** 頁面或 **[合併代理程式位置]** 頁面上選取 **[在散發者端執行所有代理程式 (發送訂閱)]** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-110">For a push subscription, select **Run all agents at the Distributor (push subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="c0ebb-111">指定訂閱者與訂閱資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="c0ebb-112">指定複寫代理程式要連接用的登入和密碼：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="c0ebb-113">針對快照集和交易式發行集的訂閱，請於 **[散發代理程式安全性]** 頁面指定認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="c0ebb-114">針對合併式發行集的訂閱，請於 **[合併代理程式安全性]** 頁面指定認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="c0ebb-115">如需有關各代理程式需要的權限資訊，請參閱＜ [複寫代理程式安全性模型](security/replication-agent-security-model.md)＞。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="c0ebb-116">指定同步處理排程，以及訂閱者要初始化的時間。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="c0ebb-117">指定合併式發行集的其他選項：訂閱類型以及參數化篩選的值。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-117">Specify additional options for merge publications: subscription type; and values for parameterized filtering.</span></span>  
  
-   <span data-ttu-id="c0ebb-118">為交易式發行集指定其他選項，以允許更新訂閱：訂閱者是否應立即在發行者端認可變更，或者應寫入佇列；認證用來連接訂閱者和發行者。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="c0ebb-119">選擇性的編寫訂閱指令碼。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-publisher"></a><span data-ttu-id="c0ebb-120">若要從發行者端建立發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-120">To create a push subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="c0ebb-121">連線到 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 的發行者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="c0ebb-122">展開 **[複寫]** 資料夾，然後展開 **[本機發行集]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="c0ebb-123">以滑鼠右鍵按一下您要建立一個或多個訂閱的發行集，然後按一下 **[新增訂閱]** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="c0ebb-124">在新增訂閱精靈中完成頁面。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-subscriber"></a><span data-ttu-id="c0ebb-125">若要從訂閱者建立發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-125">To create a push subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="c0ebb-126">連接到 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中的訂閱者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="c0ebb-127">展開 **[複寫]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="c0ebb-128">以滑鼠右鍵按一下 **[區域訂閱]** 資料夾，然後按一下 **[新增訂閱]** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="c0ebb-129">在 [新增訂閱] 精靈的 [發行集] 頁面上，從 [發行者] 下拉式清單中選取 [\<Find SQL Server Publisher>] 或 [\<Find Oracle Publisher>]。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="c0ebb-130">連接到 **[連接到伺服器]** 對話方塊中的發行者。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="c0ebb-131">選取 **[發行集]** 頁面上的發行集。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="c0ebb-132">在新增訂閱精靈中完成頁面。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="c0ebb-133">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c0ebb-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="c0ebb-134">您可以使用複寫預存程序以程式設計的方式建立發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-134">Push subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="c0ebb-135">使用哪些預存程序要依訂閱所屬的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c0ebb-136">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-136">When possible, prompt users to enter security credentials at run time.</span></span> <span data-ttu-id="c0ebb-137">如果您必須將認證儲存在指令碼檔案中，則必須維護這個檔案的安全性，使他人無法在未獲授權的情況下擅自存取。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="c0ebb-138">若要建立快照式或交易式發行集的發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-138">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="c0ebb-139">在發行集資料庫的「發行者」上，確認發行集確實是藉由執行 [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql)來支援發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-139">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="c0ebb-140">如果 **allow_push** 的值為 **1**，則發送訂閱受到支援。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-140">If the value of **allow_push** is **1**, push subscriptions are supported.</span></span>  
  
    -   <span data-ttu-id="c0ebb-141">如果**allow_push**的值為**0**，請執行[sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)，並針對指定**allow_push** **@property** `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-141">If the value of **allow_push** is **0**, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="c0ebb-142">在發行集資料庫的「發行者」上，執行 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-142">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="c0ebb-143">指定 **@publication** 、 **@subscriber** 和 **@destination_db** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-143">Specify **@publication**, **@subscriber** and **@destination_db**.</span></span> <span data-ttu-id="c0ebb-144">將 **@subscription_type** 指定為 **@subscription_type**＞。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-144">Specify a value of **push** for **@subscription_type**.</span></span> <span data-ttu-id="c0ebb-145">如需有關如何更新訂閱的詳細資訊，請參閱[建立交易式發行集的可更新訂閱](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="c0ebb-145">For information about how to update subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
3.  <span data-ttu-id="c0ebb-146">在發行集資料庫的「發行者」上，執行 [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-146">At the Publisher on the publication database, execute [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c0ebb-147">指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-147">Specify the following:</span></span>  
  
    -   <span data-ttu-id="c0ebb-148">**@subscriber**、 **@subscriber_db** 和 **@publication** 參數。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-148">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="c0ebb-149">在散發者端用 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 來執行和之散發代理程式的 Windows **@job_login** 認證 **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-149">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="c0ebb-150">使用「Windows 整合式驗證」建立的連接一律使用由和指定的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-150">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="c0ebb-151">散發代理程式一律使用「Windows 整合式驗證」建立與散發者的本機連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-151">The Distribution Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="c0ebb-152">依預設，代理程式會使用「Windows 整合式驗證」連接到訂閱者。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-152">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="c0ebb-153">(選擇性) **0** 指定為 **@subscriber_security_mode** ，以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@subscriber_login** ，並將 **@subscriber_password**＞。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-153">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="c0ebb-154">如果您在連接到「訂閱者」時需要使用「SQL Server 驗證」，請指定這些參數。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-154">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="c0ebb-155">此訂閱之散發代理程式作業的排程。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-155">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="c0ebb-156">如需詳細資訊，請參閱 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-156">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c0ebb-157">利用遠端「散發者」來建立「發行者」上的發送訂閱時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字格式傳給「散發者」。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-157">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="c0ebb-158">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="c0ebb-159">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="c0ebb-160">若要建立合併式發行集的發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-160">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="c0ebb-161">在發行集資料庫的「發行者」上，確認發行集確實是藉由執行 [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)來支援發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-161">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="c0ebb-162">如果 **allow_push** 的值為 **1**，則發行集支援發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-162">If the value of **allow_push** is **1**, the publication supports push subscriptions.</span></span>  
  
    -   <span data-ttu-id="c0ebb-163">如果**allow_push**的值不是**1**，請執行[sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)，並針對指定**allow_push** **@property** `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-163">If the value of **allow_push** is not **1**, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="c0ebb-164">在發行集資料庫的「發行者」上，執行 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)並指定下列參數：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-164">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="c0ebb-165">**@publication**.</span><span class="sxs-lookup"><span data-stu-id="c0ebb-165">**@publication**.</span></span> <span data-ttu-id="c0ebb-166">這是發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-166">This is the name of the publication.</span></span>  
  
    -   <span data-ttu-id="c0ebb-167">**@subscriber_type**.</span><span class="sxs-lookup"><span data-stu-id="c0ebb-167">**@subscriber_type**.</span></span> <span data-ttu-id="c0ebb-168">將客訂閱指定為 **local** ，並將主訂閱指定為 **global**。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-168">For a client subscription, specify **local** and for a server subscription, specify **global**.</span></span>  
  
    -   <span data-ttu-id="c0ebb-169">**@subscription_priority**.</span><span class="sxs-lookup"><span data-stu-id="c0ebb-169">**@subscription_priority**.</span></span> <span data-ttu-id="c0ebb-170">指定主訂閱的訂閱優先權 (從**0.00** 到 **99.99**)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-170">For a server subscription, specify a priority for the subscription (**0.00** to **99.99**).</span></span>  
  
         <span data-ttu-id="c0ebb-171">如需詳細資訊，請參閱 [進階合併式複寫衝突偵測與解決](merge/advanced-merge-replication-conflict-detection-and-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-171">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="c0ebb-172">在發行集資料庫的「發行者」上，執行 [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-172">At the Publisher on the publication database, execute [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="c0ebb-173">指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-173">Specify the following:</span></span>  
  
    -   <span data-ttu-id="c0ebb-174">**@subscriber**、 **@subscriber_db** 和 **@publication** 參數。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-174">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="c0ebb-175">在散發者端用來執行和之合併代理程式的 Windows **@job_login** 認證 **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-175">The Windows credentials under which the Merge Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="c0ebb-176">使用「Windows 整合式驗證」建立的連接一律使用由和指定的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-176">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="c0ebb-177">「合併代理程式」一律使用「Windows 整合式驗證」建立到「散發者」的本機連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-177">The Merge Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="c0ebb-178">依預設，代理程式會使用「Windows 整合式驗證」連接到訂閱者。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-178">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="c0ebb-179">(選擇性) **0** 指定為 **@subscriber_security_mode** ，以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@subscriber_login** ，並將 **@subscriber_password**＞。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-179">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="c0ebb-180">如果您在連接到「訂閱者」時需要使用「SQL Server 驗證」，請指定這些參數。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-180">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="c0ebb-181">(選擇性) **0** 指定為 **@publisher_security_mode** ，以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@publisher_login** ，並將 **@publisher_password**＞。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-181">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**.</span></span> <span data-ttu-id="c0ebb-182">如果您在連接到「發行者」時需要使用「SQL Server 驗證」，請指定這些值。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-182">Specify these values if you need to use SQL Server Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="c0ebb-183">此訂閱之「合併代理程式」作業的排程。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-183">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="c0ebb-184">如需詳細資訊，請參閱 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-184">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c0ebb-185">利用遠端「散發者」來建立「發行者」上的發送訂閱時，提供給所有參數的值 (包括 *job_login* 和 *job_password*) 都會以純文字格式傳給「散發者」。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-185">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="c0ebb-186">您應該先加密「發行者」及其遠端「散發者」之間的連接，再執行這個預存程序。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-186">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="c0ebb-187">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-187">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="c0ebb-188">範例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="c0ebb-188">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="c0ebb-189">下列範例會建立交易式發行集的發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-189">The following example creates a push subscription to a transactional publication.</span></span> <span data-ttu-id="c0ebb-190">登入和密碼值是在執行階段使用 **sqlcmd** 指令碼變數所提供。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-190">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpushsubscription_agent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpushsub.sql#sp_addtranpushsubscription_agent)]  
  
 <span data-ttu-id="c0ebb-191">下列範例會建立合併式發行集的發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-191">The following example creates a push subscription to a merge publication.</span></span> <span data-ttu-id="c0ebb-192">登入和密碼值是在執行階段使用 **sqlcmd** 指令碼變數所提供。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-192">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepushsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepushsub.sql#sp_addmergepushsubscriptionagent)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="c0ebb-193">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="c0ebb-193">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="c0ebb-194">您可以使用 Replication Management Objects (RMO) 以程式設計的方式建立發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-194">You can create push subscriptions programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="c0ebb-195">用於建立發送訂閱的 RMO 類別依該訂閱所屬的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-195">The RMO classes you use to create a push subscription depend on the type of publication to which the subscription is created.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c0ebb-196">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-196">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="c0ebb-197">如果您必須儲存認證，請使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) 密碼編譯服務 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-197">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="c0ebb-198">若要建立快照式或交易式發行集的發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-198">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="c0ebb-199">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-199">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="c0ebb-200">使用步驟 1 中的發行者連接建立 <xref:Microsoft.SqlServer.Replication.TransPublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="c0ebb-201">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-201">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="c0ebb-202">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-202">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="c0ebb-203">如果此方法傳回 `false`，則表示步驟 2 中指定的屬性不正確，或伺服器上不存在該發行集。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-203">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="c0ebb-204">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 屬性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之間執行位元運算邏輯 AND (Visual C# 中的 `&` 和 Visual Basic 中的 `And`)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-204">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="c0ebb-205">如果結果為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，則將 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 設為 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之間位元運算邏輯 OR (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`) 的結果。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-205">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="c0ebb-206">然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以啟用發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-206">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="c0ebb-207">如果訂閱資料庫不存在，可使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 類別建立它。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-207">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="c0ebb-208">如需詳細資訊，請參閱[建立、改變和移除資料庫](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-208">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="c0ebb-209">建立 <xref:Microsoft.SqlServer.Replication.TransSubscription> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-209">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransSubscription> class.</span></span>  
  
7.  <span data-ttu-id="c0ebb-210">設定下列訂閱屬性：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-210">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="c0ebb-211">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設為到步驟 1 中建立之「發行者」的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-211">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-212">將 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>設為訂閱資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-212">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-213">將 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>設為「訂閱者」的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-213">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-214">將 <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>設為發行集資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-214">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-215">將 <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>設為發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-215">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-216"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (或 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) 欄位，為「散發代理程式」在「散發者」上執行時所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶提供認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-216">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Distributor.</span></span> <span data-ttu-id="c0ebb-217">此帳戶用於建立到「散發者」的本機連接，以及使用「Windows 驗證」建立遠端連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-217">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="c0ebb-218">當訂閱是由 `sysadmin` 固定伺服器角色的成員建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>，但還是建議您對其進行設定。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-218">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="c0ebb-219">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-219">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="c0ebb-220">如需詳細資訊，請參閱 [複寫代理程式安全性模型](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-220">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="c0ebb-221">(選擇性) <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> 的 `true` 值 (預設值)，以建立用於同步處理訂閱的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-221">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="c0ebb-222">如果指定 `false`，則只能以程式設計的方式同步處理訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-222">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="c0ebb-223">(選擇性) 在使用「SQL Server 驗證」連接到「訂閱者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-223">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
8.  <span data-ttu-id="c0ebb-224">呼叫 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-224">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c0ebb-225">利用遠端「散發者」來建立「發行者」上的發送訂閱時，提供給所有屬性的值 (包括 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) 都會以純文字的方式傳給「散發者」。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-225">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="c0ebb-226">您應該先加密「發行者」及其遠端「散發者」之間的連線，然後再呼叫 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-226">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="c0ebb-227">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-227">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="c0ebb-228">若要建立合併式發行集的發送訂閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-228">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="c0ebb-229">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-229">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="c0ebb-230">使用步驟 1 中的發行者連接建立 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-230">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="c0ebb-231">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-231">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="c0ebb-232">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-232">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="c0ebb-233">如果此方法傳回 `false`，則表示步驟 2 中指定的屬性不正確，或伺服器上不存在該發行集。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-233">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="c0ebb-234">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 屬性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之間執行位元運算邏輯 AND (Visual C# 中的 `&` 和 Visual Basic 中的 `And`)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-234">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="c0ebb-235">如果結果為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，則將 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 設為 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> 之間位元運算邏輯 OR (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`) 的結果。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-235">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="c0ebb-236">然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以啟用發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-236">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="c0ebb-237">如果訂閱資料庫不存在，可使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 類別建立它。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-237">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="c0ebb-238">如需詳細資訊，請參閱[建立、改變和移除資料庫](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-238">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="c0ebb-239">建立 <xref:Microsoft.SqlServer.Replication.MergeSubscription> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-239">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeSubscription> class.</span></span>  
  
7.  <span data-ttu-id="c0ebb-240">設定下列訂閱屬性：</span><span class="sxs-lookup"><span data-stu-id="c0ebb-240">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="c0ebb-241">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設為到步驟 1 中建立之「發行者」的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-241">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-242">將 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>設為訂閱資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-242">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-243">將 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>設為「訂閱者」的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-243">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-244">將 <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>設為發行集資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-244">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-245">將 <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>設為發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-245">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="c0ebb-246"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (或 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) 欄位，為「合併代理程式」在「散發者」上執行時所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶提供認證。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-246">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Distributor.</span></span> <span data-ttu-id="c0ebb-247">此帳戶用於建立到「散發者」的本機連接，以及使用「Windows 驗證」建立遠端連接。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-247">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="c0ebb-248">當訂閱是由 `sysadmin` 固定伺服器角色的成員建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>，但還是建議您對其進行設定。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-248">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="c0ebb-249">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-249">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="c0ebb-250">如需詳細資訊，請參閱 [複寫代理程式安全性模型](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-250">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="c0ebb-251">(選擇性) <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> 的 `true` 值 (預設值)，以建立用於同步處理訂閱的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-251">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="c0ebb-252">如果指定 `false`，則只能以程式設計的方式同步處理訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-252">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="c0ebb-253">(選擇性) 在使用「SQL Server 驗證」連接到「訂閱者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-253">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="c0ebb-254">(選擇性) 在使用「SQL Server 驗證」連接到「發行者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-254">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="c0ebb-255">呼叫 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-255">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c0ebb-256">利用遠端「散發者」來建立「發行者」上的發送訂閱時，提供給所有屬性的值 (包括 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) 都會以純文字的方式傳給「散發者」。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-256">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="c0ebb-257">您應該先加密「發行者」及其遠端「散發者」之間的連線，然後再呼叫 <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-257">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="c0ebb-258">如需詳細資訊，請參閱[啟用 Database Engine 的加密連接 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-258">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="c0ebb-259">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="c0ebb-259">Examples (RMO)</span></span>  
 <span data-ttu-id="c0ebb-260">此範例會建立交易式發行集的新發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-260">This example creates a new push subscription to a transactional publication.</span></span> <span data-ttu-id="c0ebb-261">用於執行「散發代理程式」作業的 Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-261">The Windows account credentials you use to run the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpushsub)]  
  
 <span data-ttu-id="c0ebb-262">此範例會建立合併式發行集的新發送訂閱。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-262">This example creates a new push subscription to a merge publication.</span></span> <span data-ttu-id="c0ebb-263">用於執行「合併代理程式」作業的 Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="c0ebb-263">The Windows account credentials you use to run the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepushsub)]  
  
## <a name="see-also"></a><span data-ttu-id="c0ebb-264">另請參閱</span><span class="sxs-lookup"><span data-stu-id="c0ebb-264">See Also</span></span>  
 <span data-ttu-id="c0ebb-265">[檢視及修改發送訂閱屬性](view-and-modify-push-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-265">[View and Modify Push Subscription Properties](view-and-modify-push-subscription-properties.md) </span></span>  
 <span data-ttu-id="c0ebb-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="c0ebb-267">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-267">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="c0ebb-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="c0ebb-269">[同步處理發送訂閱](synchronize-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-269">[Synchronize a Push Subscription](synchronize-a-push-subscription.md) </span></span>  
 <span data-ttu-id="c0ebb-270">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="c0ebb-270">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="c0ebb-271">以指令碼變數使用 sqlcmd</span><span class="sxs-lookup"><span data-stu-id="c0ebb-271">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
