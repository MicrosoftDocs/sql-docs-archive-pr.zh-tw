---
title: 使用複寫代理程式事件的警示 | Microsoft 文件
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- viewing alerts
- Queue Reader Agent, alerts
- alerts [SQL Server replication]
- predefined replication alerts [SQL Server replication]
- Log Reader Agent, alerts
- Distribution Agent, alerts
- Merge Agent, alerts
- agents [SQL Server replication], alerts
- displaying alerts
- Snapshot Agent, alerts
ms.assetid: 8c42e523-7020-471d-8977-a0bd044b9471
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 9d3e30c0a8768a872dc86745ef986faec509c3c6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585892"
---
# <a name="use-alerts-for-replication-agent-events"></a><span data-ttu-id="87abd-102">使用複寫代理程式事件的警示</span><span class="sxs-lookup"><span data-stu-id="87abd-102">Use Alerts for Replication Agent Events</span></span>
  [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] <span data-ttu-id="87abd-103">和 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent 提供使用警示來監視事件 (如複寫代理程式事件) 的方法。</span><span class="sxs-lookup"><span data-stu-id="87abd-103">and [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent provide a way to monitor events, such as replication agent events, using alerts.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="87abd-104">Agent 會監視 Windows 應用程式記錄檔中與警示相關的事件。</span><span class="sxs-lookup"><span data-stu-id="87abd-104">Agent monitors the Windows application log for events that are associated with alerts.</span></span> <span data-ttu-id="87abd-105">如果發生這類事件， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent 會藉由執行已經定義的工作，及 (或) 向指定操作員傳送電子郵件或呼叫器訊息，進行自動回應。</span><span class="sxs-lookup"><span data-stu-id="87abd-105">If such an event occurs, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent responds automatically, by executing a task that you have defined and/or sending e-mail or a pager message to a specified operator.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="87abd-106">包含一組預先定義的複寫代理程式警示，您可以設定這類警示來執行工作和 (或) 通知操作員。</span><span class="sxs-lookup"><span data-stu-id="87abd-106">includes a set of predefined alerts for replication agents that you can configure to execute a task and/or notify an operator.</span></span> <span data-ttu-id="87abd-107">如需定義要執行之工作的詳細資訊，請參閱本主題的「自動化回應警示」一節。</span><span class="sxs-lookup"><span data-stu-id="87abd-107">For more information about defining a task to execute, see the section "Automating a Response to an Alert" in this topic.</span></span>  
  
 <span data-ttu-id="87abd-108">當電腦設定為「散發者」時，會安裝下列警示：</span><span class="sxs-lookup"><span data-stu-id="87abd-108">The following alerts are installed when a computer is configured as a Distributor:</span></span>  
  
|<span data-ttu-id="87abd-109">訊息 ID</span><span class="sxs-lookup"><span data-stu-id="87abd-109">Message ID</span></span>|<span data-ttu-id="87abd-110">預先定義的警示</span><span class="sxs-lookup"><span data-stu-id="87abd-110">Predefined alert</span></span>|<span data-ttu-id="87abd-111">觸發警示的條件</span><span class="sxs-lookup"><span data-stu-id="87abd-111">Condition causing the alert to fire</span></span>|<span data-ttu-id="87abd-112">在 msdb..sysreplicationalerts 中輸入額外的資訊</span><span class="sxs-lookup"><span data-stu-id="87abd-112">Enters additional information in msdb..sysreplicationalerts</span></span>|  
|----------------|----------------------|-----------------------------------------|-----------------------------------------------------------------|  
|<span data-ttu-id="87abd-113">14150</span><span class="sxs-lookup"><span data-stu-id="87abd-113">14150</span></span>|<span data-ttu-id="87abd-114">**複寫: 代理程式成功**</span><span class="sxs-lookup"><span data-stu-id="87abd-114">**Replication: agent success**</span></span>|<span data-ttu-id="87abd-115">代理程式成功關閉。</span><span class="sxs-lookup"><span data-stu-id="87abd-115">Agent shuts down successfully.</span></span>|<span data-ttu-id="87abd-116">是</span><span class="sxs-lookup"><span data-stu-id="87abd-116">Yes</span></span>|  
|<span data-ttu-id="87abd-117">14151</span><span class="sxs-lookup"><span data-stu-id="87abd-117">14151</span></span>|<span data-ttu-id="87abd-118">**複寫: 代理程式失敗**</span><span class="sxs-lookup"><span data-stu-id="87abd-118">**Replication: agent failure**</span></span>|<span data-ttu-id="87abd-119">代理程式關閉時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="87abd-119">Agent shuts down with an error.</span></span>|<span data-ttu-id="87abd-120">是</span><span class="sxs-lookup"><span data-stu-id="87abd-120">Yes</span></span>|  
|<span data-ttu-id="87abd-121">14152</span><span class="sxs-lookup"><span data-stu-id="87abd-121">14152</span></span>|<span data-ttu-id="87abd-122">**複寫: 代理程式重試**</span><span class="sxs-lookup"><span data-stu-id="87abd-122">**Replication: agent retry**</span></span>|<span data-ttu-id="87abd-123">代理程式於重試動作不成功之後關閉 (代理程式遇到錯誤，例如伺服器無法使用、鎖死、連線失敗、或逾時失敗)。</span><span class="sxs-lookup"><span data-stu-id="87abd-123">Agent shuts down after unsuccessfully retrying an operation (agent encounters an error such as server not available, deadlock, connection failure, or time-out failure).</span></span>|<span data-ttu-id="87abd-124">是</span><span class="sxs-lookup"><span data-stu-id="87abd-124">Yes</span></span>|  
|<span data-ttu-id="87abd-125">14157</span><span class="sxs-lookup"><span data-stu-id="87abd-125">14157</span></span>|<span data-ttu-id="87abd-126">**複寫: 已卸除逾期的訂閱**</span><span class="sxs-lookup"><span data-stu-id="87abd-126">**Replication: expired subscription dropped**</span></span>|<span data-ttu-id="87abd-127">已卸除逾期的訂閱。</span><span class="sxs-lookup"><span data-stu-id="87abd-127">Expired subscription was dropped.</span></span>|<span data-ttu-id="87abd-128">否</span><span class="sxs-lookup"><span data-stu-id="87abd-128">No</span></span>|  
|<span data-ttu-id="87abd-129">20572</span><span class="sxs-lookup"><span data-stu-id="87abd-129">20572</span></span>|<span data-ttu-id="87abd-130">**複寫: 驗證失敗後重新初始化訂閱**</span><span class="sxs-lookup"><span data-stu-id="87abd-130">**Replication: Subscription reinitialized after validation failure**</span></span>|<span data-ttu-id="87abd-131">回應作業「重新初始化資料驗證失敗的訂閱」成功重新初始化訂閱。</span><span class="sxs-lookup"><span data-stu-id="87abd-131">Response job 'Reinitialize subscriptions on data validation failure' reinitializes a subscription successfully.</span></span>|<span data-ttu-id="87abd-132">否</span><span class="sxs-lookup"><span data-stu-id="87abd-132">No</span></span>|  
|<span data-ttu-id="87abd-133">20574</span><span class="sxs-lookup"><span data-stu-id="87abd-133">20574</span></span>|<span data-ttu-id="87abd-134">**複寫: 訂閱者資料驗證失敗**</span><span class="sxs-lookup"><span data-stu-id="87abd-134">**Replication: Subscriber has failed data validation**</span></span>|<span data-ttu-id="87abd-135">散發或合併代理程式的資料驗證失敗。</span><span class="sxs-lookup"><span data-stu-id="87abd-135">Distribution or Merge Agent fails data validation.</span></span>|<span data-ttu-id="87abd-136">是</span><span class="sxs-lookup"><span data-stu-id="87abd-136">Yes</span></span>|  
|<span data-ttu-id="87abd-137">20575</span><span class="sxs-lookup"><span data-stu-id="87abd-137">20575</span></span>|<span data-ttu-id="87abd-138">**複寫: 訂閱者已經通過資料驗證**</span><span class="sxs-lookup"><span data-stu-id="87abd-138">**Replication: Subscriber has passed data validation**</span></span>|<span data-ttu-id="87abd-139">散發或合併代理程式通過資料驗證。</span><span class="sxs-lookup"><span data-stu-id="87abd-139">Distribution or Merge Agent passes data validation.</span></span>|<span data-ttu-id="87abd-140">是</span><span class="sxs-lookup"><span data-stu-id="87abd-140">Yes</span></span>|  
|<span data-ttu-id="87abd-141">20578</span><span class="sxs-lookup"><span data-stu-id="87abd-141">20578</span></span>|<span data-ttu-id="87abd-142">**複寫: 代理程式自訂關閉**</span><span class="sxs-lookup"><span data-stu-id="87abd-142">**Replication: agent custom shutdown**</span></span>|||  
|<span data-ttu-id="87abd-143">22815</span><span class="sxs-lookup"><span data-stu-id="87abd-143">22815</span></span>|<span data-ttu-id="87abd-144">**點對點衝突偵測警示**</span><span class="sxs-lookup"><span data-stu-id="87abd-144">**Peer-to-peer conflict detection alert**</span></span>|<span data-ttu-id="87abd-145">散發代理程式在嘗試將變更套用到對等節點上時偵測到衝突。</span><span class="sxs-lookup"><span data-stu-id="87abd-145">Distribution Agent detected a conflict when it tries to apply a change at a peer-to-peer node.</span></span>|<span data-ttu-id="87abd-146">是</span><span class="sxs-lookup"><span data-stu-id="87abd-146">Yes</span></span>|  
  
 <span data-ttu-id="87abd-147">除了這些警示外，複寫監視器還提供與狀態和效能相關的警告與警示集合。</span><span class="sxs-lookup"><span data-stu-id="87abd-147">In addition to these alerts, Replication Monitor provides a set of warnings and alerts related to status and performance.</span></span> <span data-ttu-id="87abd-148">如需詳細資訊，請參閱在複寫監視器警示基礎結構[中設定臨界值和警告](../monitor/set-thresholds-and-warnings-in-replication-monitor.md)。</span><span class="sxs-lookup"><span data-stu-id="87abd-148">For more information, see [Set Thresholds and Warnings in Replication Monitor](../monitor/set-thresholds-and-warnings-in-replication-monitor.md) alerts infrastructure.</span></span> <span data-ttu-id="87abd-149">如需詳細資訊，請參閱[建立使用者定義的事件](../../../ssms/agent/create-a-user-defined-event.md)。</span><span class="sxs-lookup"><span data-stu-id="87abd-149">For more information, see [Create a User-Defined Event](../../../ssms/agent/create-a-user-defined-event.md).</span></span>  
  
 <span data-ttu-id="87abd-150">**若要設定預先定義的複寫警示**</span><span class="sxs-lookup"><span data-stu-id="87abd-150">**To configure predefined replication alerts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="87abd-151">：[設定預先定義的複寫警示 &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="87abd-151">: [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span></span>  
  
## <a name="viewing-the-application-log-directly"></a><span data-ttu-id="87abd-152">直接檢視應用程式記錄檔</span><span class="sxs-lookup"><span data-stu-id="87abd-152">Viewing the Application Log Directly</span></span>  
 <span data-ttu-id="87abd-153">若要檢視 Windows 應用程式記錄檔，請使用 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 事件檢視器。</span><span class="sxs-lookup"><span data-stu-id="87abd-153">To view the Windows application log, use the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Event Viewer.</span></span> <span data-ttu-id="87abd-154">應用程式記錄檔包含 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 錯誤訊息，以及電腦上其他許多活動的訊息。</span><span class="sxs-lookup"><span data-stu-id="87abd-154">The application log contains [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error messages as well as messages for many other activities on the computer.</span></span> <span data-ttu-id="87abd-155">與 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 錯誤記錄檔不同，每次啟動 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 時不會建立新的應用程式記錄檔 (每個 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 工作階段都會將新的事件寫入現有的應用程式記錄檔)，但您可以指定記錄事件的保留期限。</span><span class="sxs-lookup"><span data-stu-id="87abd-155">Unlike the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error log, a new application log is not created each time you start [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] session writes new events to an existing application log); however, you can specify how long logged events will be retained.</span></span> <span data-ttu-id="87abd-156">檢視 Windows 應用程式記錄檔時，您可以篩選特定事件的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="87abd-156">When you view the Windows application log, you can filter the log for specific events.</span></span> <span data-ttu-id="87abd-157">如需詳細資訊，請參閱 Windows 文件集。</span><span class="sxs-lookup"><span data-stu-id="87abd-157">For more information, see the Windows documentation.</span></span>  
  
## <a name="automating-a-response-to-an-alert"></a><span data-ttu-id="87abd-158">自動化回應警示</span><span class="sxs-lookup"><span data-stu-id="87abd-158">Automating a Response to an Alert</span></span>  
 <span data-ttu-id="87abd-159">複寫為資料驗證失敗的訂閱提供回應作業，還提供架構，可建立對警示的其他自動回應。</span><span class="sxs-lookup"><span data-stu-id="87abd-159">Replication provides a response job for subscriptions that fail data validation, and also provides a framework for creating additional automated responses to alerts.</span></span> <span data-ttu-id="87abd-160">回應作業命名為 **[重新初始化資料驗證失敗的訂閱]** ，並儲存在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 之 **Agent 的** [作業] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]資料夾中。</span><span class="sxs-lookup"><span data-stu-id="87abd-160">The response job is titled **Reinitialize subscriptions on data validation failure** and is stored in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent **Jobs** folder in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="87abd-161">如需啟用此回應作業的詳細資訊，請參閱[設定預先定義的複寫警示 &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="87abd-161">For information about enabling this response job, see [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md).</span></span> <span data-ttu-id="87abd-162">如果交易式發行集中的發行項驗證失敗，回應作業只會重新初始化失敗的發行項。</span><span class="sxs-lookup"><span data-stu-id="87abd-162">If articles in a transactional publication fail validation, the response job reinitializes only those articles that failed.</span></span> <span data-ttu-id="87abd-163">如果合併式發行集中的發行項驗證失敗，回應作業將重新初始化發行集中的所有發行項。</span><span class="sxs-lookup"><span data-stu-id="87abd-163">If articles in a merge publication fail validation, the response job reinitializes all articles in the publication.</span></span>  
  
### <a name="framework-for-automating-responses"></a><span data-ttu-id="87abd-164">自動回應的架構</span><span class="sxs-lookup"><span data-stu-id="87abd-164">Framework for Automating Responses</span></span>  
 <span data-ttu-id="87abd-165">通常在觸發警示時，協助您了解造成警示原因和採取適當動作的唯一資訊，都包含在警示訊息中。</span><span class="sxs-lookup"><span data-stu-id="87abd-165">Usually, when an alert occurs, the only information you have to help you understand what caused the alert and the appropriate action to take is contained in the alert message itself.</span></span> <span data-ttu-id="87abd-166">剖析此資訊可能較費時，並且很容易出錯。</span><span class="sxs-lookup"><span data-stu-id="87abd-166">Parsing this information can be error-prone and time-consuming.</span></span> <span data-ttu-id="87abd-167">複寫透過提供 **sysreplicationalerts** 系統資料表中警示的其他資訊，簡化了自動回應；提供的資訊已剖析成易於自訂程式使用的形式。</span><span class="sxs-lookup"><span data-stu-id="87abd-167">Replication makes automating responses easier by providing additional information about the alert in the **sysreplicationalerts** system table; the information provided is already parsed in a form easily used by customized programs.</span></span>  
  
 <span data-ttu-id="87abd-168">例如，如果「訂閱者 A」 **Sales.SalesOrderHeader** 資料表中的資料驗證失敗， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 便會觸發 20574 訊息，通知您發生失敗。</span><span class="sxs-lookup"><span data-stu-id="87abd-168">For example, if the data in the **Sales.SalesOrderHeader** table at Subscriber A fails validation, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can trigger message 20574, notifying you of that failure.</span></span> <span data-ttu-id="87abd-169">您收到的訊息將會是：「訂閱者 'A' 訂閱的發行項 'SalesOrderHeader' (在發行集 'MyPublication' 中) 未通過資料驗證」。</span><span class="sxs-lookup"><span data-stu-id="87abd-169">The message you receive will be: "Subscriber 'A', subscription to article 'SalesOrderHeader' in publication 'MyPublication' failed data validation."</span></span>  
  
 <span data-ttu-id="87abd-170">如果您根據此訊息建立回應，必須手動從訊息中剖析「訂閱者」名稱、發行項名稱、發行集名稱及錯誤。</span><span class="sxs-lookup"><span data-stu-id="87abd-170">If you create a response based on the message, you must manually parse the Subscriber name, article name, publication name, and error from the message.</span></span> <span data-ttu-id="87abd-171">但由於「散發代理程式」和「合併代理程式」會將相同資訊寫入 **sysreplicationalerts** (包括代理程式類型、警示時間、發行集資料庫、「訂閱者」資料庫以及發行集類型等詳細資料)，回應作業可從資料表中直接查詢相關資訊。</span><span class="sxs-lookup"><span data-stu-id="87abd-171">However, because the Distribution Agent and Merge Agent write that same information to **sysreplicationalerts** (along with details such as the type of agent, time of the alert, publication database, Subscriber database, and type of publication) the response job can directly query the relevant information from the table.</span></span> <span data-ttu-id="87abd-172">儘管實際資料列無法與警示的特定執行個體相關聯，但資料表含 **status** 資料行，該資料可用於追蹤已服務的項目。</span><span class="sxs-lookup"><span data-stu-id="87abd-172">Although the exact row cannot be associated with a specific instance of the alert, the table has a **status** column, which can be used to keep track of serviced entries.</span></span> <span data-ttu-id="87abd-173">在記錄保留期限內將保留此資料表中的項目。</span><span class="sxs-lookup"><span data-stu-id="87abd-173">The entries in this table are maintained for the history retention period.</span></span>  
  
 <span data-ttu-id="87abd-174">例如，若要在服務警示訊息 20574 的 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 中建立回應作業，可能會使用下列邏輯：</span><span class="sxs-lookup"><span data-stu-id="87abd-174">For example, if you were to create a response job in [!INCLUDE[tsql](../../../includes/tsql-md.md)] that services alert message 20574, you might use the following logic:</span></span>  
  
```  
declare @publisher sysname, @publisher_db sysname, @publication sysname, @publication_type int, @article sysname, @subscriber sysname, @subscriber_db sysname, @alert_id int  
declare hc cursor local for select publisher, publisher_db, publication, publication_type, article, subscriber,   
  subscriber_db, alert_id from   
  msdb..sysreplicationalerts where  
  alert_error_code = 20574 and status = 0  
  for read only  
open hc  
fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
while (@@fetch_status <> -1)  
begin  
/* Do custom work  */  
/* Update status to 1, which means the alert has been serviced. This prevents subsequent runs of this job from doing this again */  
update msdb..sysreplicationalerts set status = 1 where alert_id = @alert_id  
 fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
end  
close hc  
deallocate hc  
```  
  
## <a name="see-also"></a><span data-ttu-id="87abd-175">另請參閱</span><span class="sxs-lookup"><span data-stu-id="87abd-175">See Also</span></span>  
 <span data-ttu-id="87abd-176">[複寫代理程式管理](replication-agent-administration.md) </span><span class="sxs-lookup"><span data-stu-id="87abd-176">[Replication Agent Administration](replication-agent-administration.md) </span></span>  
 <span data-ttu-id="87abd-177">[Best Practices for Replication Administration](../administration/best-practices-for-replication-administration.md) </span><span class="sxs-lookup"><span data-stu-id="87abd-177">[Best Practices for Replication Administration](../administration/best-practices-for-replication-administration.md) </span></span>  
 [<span data-ttu-id="87abd-178">監視 &#40;複寫&#41;</span><span class="sxs-lookup"><span data-stu-id="87abd-178">Monitoring &#40;Replication&#41;</span></span>](../monitoring-replication.md)  
  
  
