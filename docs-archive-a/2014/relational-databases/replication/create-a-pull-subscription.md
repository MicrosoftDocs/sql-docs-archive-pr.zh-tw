---
title: 建立提取訂閱 | Microsoft Docs
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- pull subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], pull subscriptions
- subscriptions [SQL Server replication], pull
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: 41d1886d-59c9-41fc-9bd6-a59b40e0af6e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 12ef7d658496c0fb7281827259e8e46f0c5fac64
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87607375"
---
# <a name="create-a-pull-subscription"></a><span data-ttu-id="d9fbc-102">建立提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-102">Create a Pull Subscription</span></span>
  <span data-ttu-id="d9fbc-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO)，在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中建立提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-103">This topic describes how create a pull subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="d9fbc-104">為 P2P 複寫設定提取訂閱可透過指令碼來進行，但無法透過精靈進行。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-104">Setting up a pull subscription for P2P replication is possible by script, but is not available through the wizard.</span></span>  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d9fbc-105">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d9fbc-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d9fbc-106">使用「新增訂閱精靈」在「發行者」或「訂閱者」端建立提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-106">Create a pull subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="d9fbc-107">依照精靈中各頁面進行：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="d9fbc-108">指定發行者和發行集。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="d9fbc-109">選取要執行複寫代理程式的位置。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-109">Select where replication agents will run.</span></span> <span data-ttu-id="d9fbc-110">對於提取訂閱，根據發行集類型在 **[散發代理程式位置]** 頁面或 **[合併代理程式位置]** 頁面上選取 **[在訂閱者端執行每一個代理程式 (提取訂閱)]** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-110">For a pull subscription, select **Run each agent at its Subscriber (pull subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="d9fbc-111">指定訂閱者與訂閱資料庫。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="d9fbc-112">指定複寫代理程式要連接用的登入和密碼：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="d9fbc-113">針對快照集和交易式發行集的訂閱，請於 **[散發代理程式安全性]** 頁面指定認證。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="d9fbc-114">針對合併式發行集的訂閱，請於 **[合併代理程式安全性]** 頁面指定認證。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="d9fbc-115">如需有關各代理程式需要的權限資訊，請參閱＜ [複寫代理程式安全性模型](security/replication-agent-security-model.md)＞。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="d9fbc-116">指定同步處理排程，以及訂閱者要初始化的時間。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="d9fbc-117">指定合併式發行集的其他選項：訂閱類型；參數化篩選的值；以及如果針對 Web 同步處理啟用該發行集時，透過 HTTPS 同步處理的資訊。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-117">Specify additional options for merge publications: subscription type; values for parameterized filtering; and information for synchronization through HTTPS if the publication is enabled for Web synchronization.</span></span>  
  
-   <span data-ttu-id="d9fbc-118">為交易式發行集指定其他選項，以允許更新訂閱：訂閱者是否應立即在發行者端認可變更，或者應寫入佇列；認證用來連接訂閱者和發行者。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="d9fbc-119">選擇性的編寫訂閱指令碼。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-publisher"></a><span data-ttu-id="d9fbc-120">若要從發行者建立提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-120">To create a pull subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="d9fbc-121">連線到 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 的發行者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="d9fbc-122">展開 **[複寫]** 資料夾，然後展開 **[本機發行集]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="d9fbc-123">以滑鼠右鍵按一下您要建立一個或多個訂閱的發行集，然後按一下 **[新增訂閱]** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="d9fbc-124">在新增訂閱精靈中完成頁面。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-subscriber"></a><span data-ttu-id="d9fbc-125">若要從訂閱者建立提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-125">To create a pull subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="d9fbc-126">連接到 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]中的訂閱者，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="d9fbc-127">展開 **[複寫]** 資料夾。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="d9fbc-128">以滑鼠右鍵按一下 **[區域訂閱]** 資料夾，然後按一下 **[新增訂閱]** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="d9fbc-129">在 [新增訂閱] 精靈的 [發行集] 頁面上，從 [發行者] 下拉式清單中選取 [\<Find SQL Server Publisher>] 或 [\<Find Oracle Publisher>]。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="d9fbc-130">連接到 **[連接到伺服器]** 對話方塊中的發行者。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="d9fbc-131">選取 **[發行集]** 頁面上的發行集。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="d9fbc-132">在新增訂閱精靈中完成頁面。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d9fbc-133">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d9fbc-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="d9fbc-134">您可以使用複寫預存程序以程式設計的方式建立提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-134">Pull subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="d9fbc-135">使用哪些預存程序要依訂閱所屬的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d9fbc-136">若要建立快照式或交易式發行集的提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-136">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d9fbc-137">在發行者端，執行 [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql) 來確認發行集可支援提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-137">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="d9fbc-138">如果結果集中 **allow_pull** 的值為 **1**，則發行集支援提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-138">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="d9fbc-139">如果**allow_pull**的值為**0**，請執行[sp_changepublication &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)，並針對指定**allow_pull** **@property** `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-139">If the value of **allow_pull** is **0**, execute [sp_changepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="d9fbc-140">在訂閱者端，執行 [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-140">At the Subscriber, execute [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="d9fbc-141">指定 **@publisher** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-141">Specify **@publisher** and **@publication**.</span></span> <span data-ttu-id="d9fbc-142">如需有關更新訂閱的詳細資訊，請參閱＜ [建立交易式發行集的可更新訂閱](publish/create-an-updatable-subscription-to-a-transactional-publication.md)＞。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-142">For information about updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
3.  <span data-ttu-id="d9fbc-143">在訂閱者端，執行 [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-143">At the Subscriber, execute [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="d9fbc-144">指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-144">Specify the following:</span></span>  
  
    -   <span data-ttu-id="d9fbc-145">**@publisher**、 **@publisher_db** 和 **@publication** 參數。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-145">The **@publisher**, **@publisher_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="d9fbc-146">在「 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 訂閱者」端用來執行和之散發代理程式的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-146">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d9fbc-147">使用「Windows 整合式驗證」建立的連接一律使用由和指定的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-147">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="d9fbc-148">散發代理程式一律使用「Windows 整合式驗證」建立與訂閱者的本機連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-148">The Distribution Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="d9fbc-149">依預設，代理程式會使用「Windows 整合式驗證」連接到「散發者」。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-149">By default, the agent will connect to the Distributor using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="d9fbc-150">(選擇性) **0** 指定為 **@distributor_security_mode** ，以及 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@distributor_login** ，並將 **@distributor_password**登入資訊 (如果您在連接到散發者時需要使用「 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證」)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-150">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="d9fbc-151">此訂閱之散發代理程式作業的排程。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-151">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="d9fbc-152">如需詳細資訊，請參閱 [Specify Synchronization Schedules](specify-synchronization-schedules.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-152">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
4.  <span data-ttu-id="d9fbc-153">在發行者端，執行 [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) 來註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-153">At the Publisher, execute [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="d9fbc-154">指定 **@publication** 、 **@subscriber** 和 **@destination_db** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-154">Specify **@publication**, **@subscriber**, and **@destination_db**.</span></span> <span data-ttu-id="d9fbc-155">為 **@subscription_type** 指定為 **@subscription_type**＞。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-155">Specify a value of **pull** for **@subscription_type**.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="d9fbc-156">若要建立合併式發行集的提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-156">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="d9fbc-157">在發行者端，執行 [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) 來確認發行集可支援提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-157">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="d9fbc-158">如果結果集中 **allow_pull** 的值為 **1**，則發行集支援提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-158">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="d9fbc-159">如果**allow_pull**的值為**0**，請執行[sp_changemergepublication &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)，並針對指定**allow_pull** **@property** `true` **@value** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-159">If the value of **allow_pull** is **0**, execute [sp_changemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="d9fbc-160">在訂閱者端，執行 [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-160">At the Subscriber, execute [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="d9fbc-161">指定 **@publisher** 、 **@publisher_db** 、 **@publication** 和下列參數：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-161">Specify **@publisher**, **@publisher_db**, **@publication**, and the following parameters:</span></span>  
  
    -   <span data-ttu-id="d9fbc-162">**@subscriber_type**-針對 [用戶端訂閱] 指定 [**本機**]，針對 [伺服器訂閱] 指定 [**全域**]。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-162">**@subscriber_type** - specify **local** for a client subscription and **global** for a server subscription.</span></span>  
  
    -   <span data-ttu-id="d9fbc-163">**@subscription_priority**-指定訂用帳戶的優先順序 (**0.00**到**99.99**) 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-163">**@subscription_priority** - Specify a priority for the subscription (**0.00** to **99.99**).</span></span> <span data-ttu-id="d9fbc-164">只需要對主訂閱執行此動作。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-164">This is only required for a server subscription.</span></span>  
  
         <span data-ttu-id="d9fbc-165">如需詳細資訊，請參閱 [進階合併式複寫衝突偵測與解決](merge/advanced-merge-replication-conflict-detection-and-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-165">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="d9fbc-166">在訂閱者端，執行 [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-166">At the Subscriber, execute [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="d9fbc-167">指定下列參數：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-167">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="d9fbc-168">**@publisher**、 **@publisher_db** 和 **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-168">**@publisher**, **@publisher_db**, and **@publication**.</span></span>  
  
    -   <span data-ttu-id="d9fbc-169">在「訂閱者」端用來執行和之合併代理程式的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-169">The Windows credentials under which the Merge Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d9fbc-170">使用「Windows 整合式驗證」建立的連接一律使用由和指定的 Windows 認證 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-170">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="d9fbc-171">「合併代理程式」一律使用「Windows 整合式驗證」建立到「訂閱者」的本機連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-171">The Merge Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="d9fbc-172">依預設，代理程式會使用「Windows 整合式驗證」連接到「發行者」。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-172">By default, the agent will connect to the Distributor and Publisher using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="d9fbc-173">(選擇性) **0** 指定為 **@distributor_security_mode** ，以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@distributor_login** ，並將 **@distributor_password**登入資訊 (如果您在連接到散發者時需要使用「 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證」)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-173">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="d9fbc-174">(選擇性) **0** 指定為 **@publisher_security_mode** ，以及 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 和 **@publisher_login** ，並將 **@publisher_password**登入資訊 (如果您在連接到散發者時需要使用「 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 驗證」)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-174">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="d9fbc-175">此訂閱之「合併代理程式」作業的排程。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-175">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="d9fbc-176">如需詳細資訊，請參閱 [建立交易式發行集的可更新訂閱](publish/create-an-updatable-subscription-to-a-transactional-publication.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-176">For more information, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
4.  <span data-ttu-id="d9fbc-177">在發行者端，執行 [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-177">At the Publisher, execute [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="d9fbc-178">指定 **@publication** 、 **@subscriber** 、 **@subscriber_db** 和的**pull**值 **@subscription_type** 。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-178">Specify **@publication**, **@subscriber**, **@subscriber_db**, and a value of **pull** for **@subscription_type**.</span></span> <span data-ttu-id="d9fbc-179">如此會註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-179">This registers the pull subscription.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d9fbc-180">範例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d9fbc-180">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="d9fbc-181">下列範例會建立交易式發行集的提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-181">The following example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="d9fbc-182">第一批次在「訂閱者」上執行，而第二批次在「發行者」上執行。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-182">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="d9fbc-183">登入和密碼值是在執行階段使用 sqlcmd 指令碼變數提供的。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-183">Login and password values are supplied at runtime using sqlcmd scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addtranpullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscription)]  
  
 <span data-ttu-id="d9fbc-184">下列範例會建立合併式發行集的提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-184">The following example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="d9fbc-185">第一批次在「訂閱者」上執行，而第二批次在「發行者」上執行。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-185">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="d9fbc-186">登入和密碼值是在執行階段使用 **sqlcmd** 指令碼變數所提供。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-186">Login and password values are supplied at runtime using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addmergepullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscription)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="d9fbc-187">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="d9fbc-187">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="d9fbc-188">用於建立提取訂閱的 RMO 類別依該訂閱所屬的發行集類型而定。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-188">The RMO classes used to create a pull subscription depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d9fbc-189">若要建立快照式或交易式發行集的提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-189">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d9fbc-190">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與訂閱者和發行者的連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-190">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> Class.</span></span>  
  
2.  <span data-ttu-id="d9fbc-191">使用步驟 1 中的發行者連接建立 <xref:Microsoft.SqlServer.Replication.TransPublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="d9fbc-192">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-192">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="d9fbc-193">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-193">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="d9fbc-194">如果這個方法傳回 `false`，則表示步驟 2 中指定的屬性不正確，或伺服器上沒有該發行集存在。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-194">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="d9fbc-195">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 屬性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之間執行位元運算邏輯 AND (Visual C# 中的 `&` 和 Visual Basic 中的 `And`)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-195">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="d9fbc-196">如果結果為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，則將 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 設為 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之間位元運算邏輯 OR (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`) 的結果。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-196">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="d9fbc-197">然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以啟用提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-197">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="d9fbc-198">如果訂閱資料庫不存在，可使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 類別建立它。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-198">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="d9fbc-199">如需詳細資訊，請參閱[建立、改變和移除資料庫](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-199">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="d9fbc-200">建立 <xref:Microsoft.SqlServer.Replication.TransPullSubscription> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="d9fbc-201">設定下列訂閱屬性：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-201">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="d9fbc-202">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設為到步驟 1 中建立之「訂閱者」的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-202">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-203">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>設為訂閱資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-203">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-204">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>設為「發行者」的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-204">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-205">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>設為發行集資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-205">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-206">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>設為發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-206">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-207"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>) 欄位，為「散發代理程式」在「訂閱者」上執行時所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶提供認證。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-207">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Subscriber.</span></span> <span data-ttu-id="d9fbc-208">此帳戶用於建立到「訂閱者」的本機連接，以及使用「Windows 驗證」建立遠端連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-208">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d9fbc-209">當訂閱是由 `sysadmin` 固定伺服器角色的成員建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>，但還是建議您對其進行設定。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-209">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="d9fbc-210">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-210">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="d9fbc-211">如需詳細資訊，請參閱 [複寫代理程式安全性模型](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-211">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="d9fbc-212">(選擇性) <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> 的 `true` 值，以建立用於同步處理訂閱的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-212">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="d9fbc-213">如果指定 `false` (預設值)，則只能以程式設計的方式同步處理訂閱，而且您在從 <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> 屬性存取此物件時必須指定其他屬性 <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-213">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="d9fbc-214">如需相關資訊，請參閱 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-214">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d9fbc-215">並非所有 [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本都可使用 SQL Server Agent。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-215">SQL Server Agent is not available in every edition of [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d9fbc-216">如需版本支援的功能清單 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ，請參閱[SQL Server 2014 版本支援的功能](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-216">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span> <span data-ttu-id="d9fbc-217">當您為 Express 訂閱者指定值 `true` 時，不會建立代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-217">When you specify a value of `true` for Express Subscribers, the agent job is not created.</span></span> <span data-ttu-id="d9fbc-218">不過，在「訂閱者」上會儲存重要的訂閱相關中繼資料。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-218">However, important subscription-related metadata is stored at the Subscriber.</span></span>  
  
    -   <span data-ttu-id="d9fbc-219">(選擇性) 在使用「SQL Server 驗證」連接到「散發者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-219">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
8.  <span data-ttu-id="d9fbc-220">呼叫 <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-220">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="d9fbc-221">使用步驟 2 中 <xref:Microsoft.SqlServer.Replication.TransPublication> 類別的執行個體，呼叫 <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> 方法，以使用「發行者」註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-221">Using the instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="d9fbc-222">如果此註冊已存在，則會發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-222">If this registration already exists, an exception occurs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="d9fbc-223">若要建立合併式發行集的提取訂閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-223">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="d9fbc-224">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立到「訂閱者」和「發行者」的連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-224">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="d9fbc-225">使用步驟 1 中的發行者連接建立 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-225">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="d9fbc-226">指定 <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>和 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-226">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="d9fbc-227">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-227">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="d9fbc-228">如果這個方法傳回 `false`，則表示步驟 2 中指定的屬性不正確，或伺服器上沒有該發行集存在。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-228">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="d9fbc-229">在 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 屬性和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之間執行位元運算邏輯 AND (Visual C# 中的 `&` 和 Visual Basic 中的 `And`)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-229">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="d9fbc-230">如果結果為 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>，則將 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 設為 <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> 和 <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> 之間位元運算邏輯 OR (Visual C# 中的 `|` 和 Visual Basic 中的 `Or`) 的結果。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-230">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="d9fbc-231">然後呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> 以啟用提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-231">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="d9fbc-232">如果訂閱資料庫不存在，可使用 <xref:Microsoft.SqlServer.Management.Smo.Database> 類別建立它。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-232">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="d9fbc-233">如需詳細資訊，請參閱[建立、改變和移除資料庫](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-233">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="d9fbc-234">建立 <xref:Microsoft.SqlServer.Replication.MergePullSubscription> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-234">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="d9fbc-235">設定下列訂閱屬性：</span><span class="sxs-lookup"><span data-stu-id="d9fbc-235">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="d9fbc-236">將 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 設為到步驟 1 中建立之「訂閱者」的 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-236">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-237">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>設為訂閱資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-237">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-238">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>設為「發行者」的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-238">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-239">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>設為發行集資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-239">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-240">將 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>設為發行集的名稱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-240">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="d9fbc-241"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> 的 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> 和 <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>) 欄位，為「合併代理程式」在「訂閱者」上執行時所使用的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶提供認證。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-241">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Subscriber.</span></span> <span data-ttu-id="d9fbc-242">此帳戶用於建立到「訂閱者」的本機連接，以及使用「Windows 驗證」建立遠端連接。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-242">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d9fbc-243">當訂閱是由 `sysadmin` 固定伺服器角色的成員建立時，不需要設定 <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>，但還是建議您對其進行設定。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-243">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="d9fbc-244">在這種情況下，代理程式會模擬「SQL Server Agent」帳戶。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-244">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="d9fbc-245">如需詳細資訊，請參閱 [複寫代理程式安全性模型](security/replication-agent-security-model.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-245">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="d9fbc-246">(選擇性) <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> 的 `true` 值，以建立用於同步處理訂閱的代理程式作業。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-246">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="d9fbc-247">如果指定 `false` (預設值)，則只能以程式設計的方式同步處理訂閱，而且您在從 <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> 屬性存取此物件時必須指定其他屬性 <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A>。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-247">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="d9fbc-248">如需相關資訊，請參閱 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-248">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
    -   <span data-ttu-id="d9fbc-249">(選擇性) 在使用「SQL Server 驗證」連接到「散發者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-249">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
    -   <span data-ttu-id="d9fbc-250">(選擇性) 在使用「SQL Server 驗證」連接到「發行者」時，設定 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> 的 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> 和 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (或 <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> ) 欄位。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-250">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="d9fbc-251">呼叫 <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-251">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="d9fbc-252">使用步驟 2 中 <xref:Microsoft.SqlServer.Replication.MergePublication> 類別的執行個體，呼叫 <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> 方法，以使用「發行者」註冊提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-252">Using the instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="d9fbc-253">如果此註冊已存在，則會發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-253">If this registration already exists, an exception occurs.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="d9fbc-254">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="d9fbc-254">Example (RMO)</span></span>  
 <span data-ttu-id="d9fbc-255">此範例會建立交易式發行集的提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-255">This example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="d9fbc-256">用於建立「散發代理程式」作業的 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-256">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account credentials used to create the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpullsub)]  
  
 <span data-ttu-id="d9fbc-257">此範例會建立合併式發行集的提取訂閱。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-257">This example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="d9fbc-258">用於建立「合併代理程式」作業的 Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-258">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub)]  
  
 <span data-ttu-id="d9fbc-259">此範例會建立合併式發行集的提取訂閱，而不會在 [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql)中建立相關聯的代理程式作業和訂閱中繼資料。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-259">This example creates a pull subscription to a merge publication without creating an associated agent job and subscription metadata in [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql).</span></span> <span data-ttu-id="d9fbc-260">用於建立「合併代理程式」作業的 Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-260">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_NoJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_nojob)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_NoJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_nojob)]  
  
 <span data-ttu-id="d9fbc-261">此範例會建立合併式發行集的提取訂閱，使用 Web 同步處理可以從網際網路對其進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-261">This example creates a pull subscription to a merge publication that can be synchronized over the Internet using Web synchronization.</span></span> <span data-ttu-id="d9fbc-262">用於建立「合併代理程式」作業的 Windows 帳戶認證是在執行階段傳遞的。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-262">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span> <span data-ttu-id="d9fbc-263">如需詳細資訊，請參閱 [Configure Web Synchronization](configure-web-synchronization.md)。</span><span class="sxs-lookup"><span data-stu-id="d9fbc-263">For more information, see [Configure Web Synchronization](configure-web-synchronization.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_WebSync](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_websync)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_WebSync](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_websync)]  
  
## <a name="see-also"></a><span data-ttu-id="d9fbc-264">另請參閱</span><span class="sxs-lookup"><span data-stu-id="d9fbc-264">See Also</span></span>  
 <span data-ttu-id="d9fbc-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="d9fbc-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="d9fbc-266">[檢視及修改提取訂閱屬性](view-and-modify-pull-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="d9fbc-266">[View and Modify Pull Subscription Properties](view-and-modify-pull-subscription-properties.md) </span></span>  
 <span data-ttu-id="d9fbc-267">[Configure Web Synchronization](configure-web-synchronization.md) </span><span class="sxs-lookup"><span data-stu-id="d9fbc-267">[Configure Web Synchronization](configure-web-synchronization.md) </span></span>  
 <span data-ttu-id="d9fbc-268">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="d9fbc-268">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="d9fbc-269">複寫安全性最佳作法</span><span class="sxs-lookup"><span data-stu-id="d9fbc-269">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
