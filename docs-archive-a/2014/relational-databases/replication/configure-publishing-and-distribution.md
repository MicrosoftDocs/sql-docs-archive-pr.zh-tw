---
title: 設定發行和散發 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], distribution
- distribution configuration [SQL Server replication]
- publishing [SQL Server replication], configuring
ms.assetid: 3cfc8966-833e-42fa-80cb-09175d1feed7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: afd1544b5412c6ce2d83a9a1e9a50ddf662b3056
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87585333"
---
# <a name="configure-publishing-and-distribution"></a><span data-ttu-id="bbb15-102">設定發行和散發</span><span class="sxs-lookup"><span data-stu-id="bbb15-102">Configure Publishing and Distribution</span></span>
  <span data-ttu-id="bbb15-103">本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]或 Replication Management Objects (RMO)，在 [!INCLUDE[tsql](../../includes/tsql-md.md)]中設定發行和散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-103">This topic describes how to configure publishing and distribution in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="bbb15-104">開始之前</span><span class="sxs-lookup"><span data-stu-id="bbb15-104">Before You Begin</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="bbb15-105">Security</span><span class="sxs-lookup"><span data-stu-id="bbb15-105">Security</span></span>  
 <span data-ttu-id="bbb15-106">如需詳細資訊，請參閱[安全複寫部署](security/view-and-modify-replication-security-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-106">For more information, see [Secure Replication Deployment](security/view-and-modify-replication-security-settings.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="bbb15-107">使用 SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="bbb15-107">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="bbb15-108">使用「新增發行集精靈」或「設定散發精靈」來設定散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-108">Configure distribution using the New Publication Wizard or the Configure Distribution Wizard.</span></span> <span data-ttu-id="bbb15-109">設定散發者之後，請檢視並修改 [散發者屬性 - \<Distributor>] 對話方塊中的屬性。</span><span class="sxs-lookup"><span data-stu-id="bbb15-109">After the Distributor is configured, view and modify properties in the **Distributor Properties - \<Distributor>** dialog box.</span></span> <span data-ttu-id="bbb15-110">如果您想設定「散發者」以便 **db_owner** 固定資料庫角色的成員可以建立發行集，或者因為您想設定非「發行者」的遠端「散發者」，則請使用「設定散發精靈」。</span><span class="sxs-lookup"><span data-stu-id="bbb15-110">Use the Configure Distribution Wizard if you want to configure a Distributor so that members of the **db_owner** fixed database roles can create publications, or because you want to configure a remote Distributor that is not a Publisher.</span></span>  
  
#### <a name="to-configure-distribution"></a><span data-ttu-id="bbb15-111">若要設定散發</span><span class="sxs-lookup"><span data-stu-id="bbb15-111">To configure distribution</span></span>  
  
1.  <span data-ttu-id="bbb15-112">在 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中，連線到將成為「散發者」的伺服器 (在許多情況下，「發行者」與「散發者」是同一部伺服器)，然後展開伺服器節點。</span><span class="sxs-lookup"><span data-stu-id="bbb15-112">In [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], connect to the server that will be the Distributor (in many cases, the Publisher and Distributor are the same server), and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="bbb15-113">在以滑鼠右鍵按一下 **[複寫]** 資料夾，然後按一下 **[設定散發]** 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-113">Right-click the **Replication** folder, and then click **Configure Distribution**.</span></span>  
  
3.  <span data-ttu-id="bbb15-114">遵循「設定散發精靈」的指示執行下列項目：</span><span class="sxs-lookup"><span data-stu-id="bbb15-114">Follow the Configure Distribution Wizard to:</span></span>  
  
    -   <span data-ttu-id="bbb15-115">選取「散發者」。</span><span class="sxs-lookup"><span data-stu-id="bbb15-115">Select a Distributor.</span></span> <span data-ttu-id="bbb15-116">若要使用本機散發者，選取 **' \<ServerName> ' 將扮演自己的散發者;SQL Server 將建立散發資料庫和記錄**檔。</span><span class="sxs-lookup"><span data-stu-id="bbb15-116">To use a local Distributor, select **'\<ServerName>' will act as its own Distributor; SQL Server will create a distribution database and log**.</span></span> <span data-ttu-id="bbb15-117">若要使用遠端散發者，請選取 **[使用下列伺服器做為散發者]** ，然後選取伺服器。</span><span class="sxs-lookup"><span data-stu-id="bbb15-117">To use a remote Distributor, select **Use the following server as the Distributor**, and then select a server.</span></span> <span data-ttu-id="bbb15-118">伺服器必須已設定為散發者，且必須先啟用發行者才能使用散發者。</span><span class="sxs-lookup"><span data-stu-id="bbb15-118">The server must already be configured as a Distributor, and the Publisher must be enabled to use the Distributor.</span></span> <span data-ttu-id="bbb15-119">如需詳細資訊，請參閱[在散發者端啟用遠端發行者 &#40;SQL Server Management Studio&#41;](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-119">For more information, see [Enable a Remote Publisher at a Distributor &#40;SQL Server Management Studio&#41;](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md).</span></span>  
  
         <span data-ttu-id="bbb15-120">如果您選取遠端「散發者」，則必須在 **[管理密碼]** 頁面上輸入密碼才能從「發行者」連接到「散發者」。</span><span class="sxs-lookup"><span data-stu-id="bbb15-120">If you select a remote Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="bbb15-121">此密碼必須符合發行者於遠端散發者啟用時所指定的密碼。</span><span class="sxs-lookup"><span data-stu-id="bbb15-121">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
    -   <span data-ttu-id="bbb15-122">指定根快照集資料夾 (針對本機「散發者」)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-122">Specify a root snapshot folder (for a local Distributor).</span></span> <span data-ttu-id="bbb15-123">快照集資料夾只是指定為共用的目錄；讀取並寫入此資料夾的代理程式必須具有足夠的權限才能對其進行存取。</span><span class="sxs-lookup"><span data-stu-id="bbb15-123">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="bbb15-124">使用此「散發者」的每個「發行者」在根資料夾下建立資料夾，每個發行集在要儲存快照集檔案的「發行者」資料夾下建立資料夾。</span><span class="sxs-lookup"><span data-stu-id="bbb15-124">Each Publisher that uses this Distributor creates a folder under the root folder, and each publication creates folders under the Publisher folder in which to store snapshot files.</span></span> <span data-ttu-id="bbb15-125">如需適當設定資料夾安全性的詳細資訊，請參閱[保護快照集資料夾](security/secure-the-snapshot-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-125">For more information on securing the folder appropriately, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
    -   <span data-ttu-id="bbb15-126">指定散發資料庫 (針對本機「散發者」)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-126">Specify the distribution database (for a local Distributor).</span></span> <span data-ttu-id="bbb15-127">散發資料庫為異動複寫中所有類型的複寫與交易，儲存中繼資料和歷程資料。</span><span class="sxs-lookup"><span data-stu-id="bbb15-127">The distribution database stores metadata and history data for all types of replication and transactions for transactional replication.</span></span>  
  
    -   <span data-ttu-id="bbb15-128">選擇性地啟用其他「發行者」來使用「散發者」。</span><span class="sxs-lookup"><span data-stu-id="bbb15-128">Optionally enable other Publishers to use the Distributor.</span></span> <span data-ttu-id="bbb15-129">如果啟用其他「發行者」來使用「散發者」，則必須在 **[散發者密碼]** 頁面上輸入密碼才能從這些「發行者」連接到「散發者」。</span><span class="sxs-lookup"><span data-stu-id="bbb15-129">If other Publishers are enabled to use the Distributor, you must enter a password on the **Distributor Password** page for connections made from these Publishers to the Distributor.</span></span>  
  
    -   <span data-ttu-id="bbb15-130">選擇性地編寫組態設定的指令碼。</span><span class="sxs-lookup"><span data-stu-id="bbb15-130">Optionally script configuration settings.</span></span> <span data-ttu-id="bbb15-131">如需詳細資訊，請參閱 [Scripting Replication](scripting-replication.md)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-131">For more information, see [Scripting Replication](scripting-replication.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="bbb15-132">使用 Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="bbb15-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="bbb15-133">您可以使用複寫預存程序來以程式設計的方式設定複寫發行和散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-133">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
#### <a name="to-configure-publishing-using-a-local-distributor"></a><span data-ttu-id="bbb15-134">使用本機散發者設定發行</span><span class="sxs-lookup"><span data-stu-id="bbb15-134">To configure publishing using a local distributor</span></span>  
  
1.  <span data-ttu-id="bbb15-135">請執行 [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) 來判斷伺服器是否已經設定為散發者。</span><span class="sxs-lookup"><span data-stu-id="bbb15-135">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="bbb15-136">如果結果集中 **installed** 的值是 **0**，請在 master 資料庫的散發者上執行 [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-136">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span>  
  
    -   <span data-ttu-id="bbb15-137">如果結果集中 **distribution db installed** 的值是 **0**，請在 master 資料庫的散發者上執行 [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-137">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="bbb15-138">指定\*\* \@ 資料庫\*\*的散發資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-138">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="bbb15-139">（選擇性）您可以指定\*\* \@ max_distretention**的交易保留期限上限，以及** \@ history_retention\*\*的記錄保留期限。</span><span class="sxs-lookup"><span data-stu-id="bbb15-139">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="bbb15-140">如果正在建立新的資料庫，請指定所要的資料庫屬性參數。</span><span class="sxs-lookup"><span data-stu-id="bbb15-140">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="bbb15-141">在散發者（也就是發行者）上，執行[sp_adddistpublisher &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql)，指定將用來做為\*\* \@ working_directory\*\*之預設快照集資料夾的 UNC 共用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-141">At the Distributor, which is also the Publisher, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span>  
  
3.  <span data-ttu-id="bbb15-142">在發行者上，執行 [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-142">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="bbb15-143">指定要為\*\* \@ dbname**發行的資料庫、 \*\* \@ optname**的複寫類型，以及 value 的值 `true` \*\* \@ \*\*。</span><span class="sxs-lookup"><span data-stu-id="bbb15-143">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of `true` for **\@value**.</span></span>  
  
#### <a name="to-configure-publishing-using-a-remote-distributor"></a><span data-ttu-id="bbb15-144">使用遠端散發者設定發行</span><span class="sxs-lookup"><span data-stu-id="bbb15-144">To configure publishing using a remote distributor</span></span>  
  
1.  <span data-ttu-id="bbb15-145">請執行 [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) 來判斷伺服器是否已經設定為散發者。</span><span class="sxs-lookup"><span data-stu-id="bbb15-145">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="bbb15-146">如果結果集中 **installed** 的值是 **0**，請在 master 資料庫的散發者上執行 [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-146">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="bbb15-147">指定\*\* \@ 密碼\*\*的強式密碼。</span><span class="sxs-lookup"><span data-stu-id="bbb15-147">Specify a strong password for **\@password**.</span></span> <span data-ttu-id="bbb15-148">**distributor_admin** 帳戶的這個密碼將會由發行者連接到散發者時使用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-148">This password for the **distributor_admin** account will be used by the Publisher when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="bbb15-149">如果結果集中 **distribution db installed** 的值是 **0**，請在 master 資料庫的散發者上執行 [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-149">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="bbb15-150">指定\*\* \@ 資料庫\*\*的散發資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-150">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="bbb15-151">（選擇性）您可以指定\*\* \@ max_distretention**的交易保留期限上限，以及** \@ history_retention\*\*的記錄保留期限。</span><span class="sxs-lookup"><span data-stu-id="bbb15-151">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="bbb15-152">如果正在建立新的資料庫，請指定所要的資料庫屬性參數。</span><span class="sxs-lookup"><span data-stu-id="bbb15-152">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="bbb15-153">在散發者上，執行[sp_adddistpublisher &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql)，並指定將作為\*\* \@ working_directory\*\*預設快照集資料夾使用的 UNC 共用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-153">At the Distributor, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span> <span data-ttu-id="bbb15-154">如果散發 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 者會在連接到發行者時使用驗證，您也必須為\*\* \@ security_mode**指定**0**的值，並為 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] \*\* \@ 登**入和\*\* \@ 密碼\*\*指定登入資訊。</span><span class="sxs-lookup"><span data-stu-id="bbb15-154">If the Distributor will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@login** and **\@password**.</span></span>  
  
3.  <span data-ttu-id="bbb15-155">在 master 資料庫的發行者上，執行 [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-155">At the Publisher on the master database, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql).</span></span> <span data-ttu-id="bbb15-156">針對 [ \*\* \@ 密碼\*\*]，指定步驟1中所使用的增強式密碼。</span><span class="sxs-lookup"><span data-stu-id="bbb15-156">Specify the strong password used in step 1 for **\@password**.</span></span> <span data-ttu-id="bbb15-157">這個密碼將會由發行者連接到散發者時使用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-157">This password will be used by the Publisher when connecting to the Distributor.</span></span>  
  
4.  <span data-ttu-id="bbb15-158">在發行者上，執行 [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-158">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="bbb15-159">指定要為\*\* \@ dbname**發行的資料庫、 \*\* \@ optname**的複寫類型，以及\*\* \@ 值\*\*為 true 的值。</span><span class="sxs-lookup"><span data-stu-id="bbb15-159">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of true for **\@value**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="bbb15-160">範例 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="bbb15-160">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="bbb15-161">下列範例會示範如何以程式設計方式設定發行和散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-161">The following example demonstrates how to configure publishing and distribution programmatically.</span></span> <span data-ttu-id="bbb15-162">在此範例中，會使用指令碼變數來提供設定為發行者和本機散發者的伺服器名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-162">In this example, the name of the server that is being configured as a publisher and a local distributor is supplied using scripting variables.</span></span> <span data-ttu-id="bbb15-163">您可以使用複寫預存程序來以程式設計的方式設定複寫發行和散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-163">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
 [!code-sql[HowTo#AddDistPub](../../snippets/tsql/SQL15/replication/howto/tsql/adddistpub.sql#adddistpub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="bbb15-164">使用 Replication Management Objects (RMO)</span><span class="sxs-lookup"><span data-stu-id="bbb15-164">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-on-a-single-server"></a><span data-ttu-id="bbb15-165">在單一伺服器上設定發行和散發</span><span class="sxs-lookup"><span data-stu-id="bbb15-165">To configure publishing and distribution on a single server</span></span>  
  
1.  <span data-ttu-id="bbb15-166">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與伺服器的連接。</span><span class="sxs-lookup"><span data-stu-id="bbb15-166">Create a connection to the server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="bbb15-167">建立 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-167">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="bbb15-168">傳遞步驟 1 的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-168">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="bbb15-169">建立 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-169">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="bbb15-170">將 <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> 屬性設定為資料庫名稱，並將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-170">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="bbb15-171">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法來安裝散發者。</span><span class="sxs-lookup"><span data-stu-id="bbb15-171">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="bbb15-172">傳遞步驟 3 的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 物件。</span><span class="sxs-lookup"><span data-stu-id="bbb15-172">Pass the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span>  
  
6.  <span data-ttu-id="bbb15-173">建立 <xref:Microsoft.SqlServer.Replication.DistributionPublisher> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-173">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="bbb15-174">設定 <xref:Microsoft.SqlServer.Replication.DistributionPublisher>的以下屬性：</span><span class="sxs-lookup"><span data-stu-id="bbb15-174">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="bbb15-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - 發行者的名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the Publisher.</span></span>  
  
    -   <span data-ttu-id="bbb15-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - 步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="bbb15-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - 步驟 5 中建立的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="bbb15-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - 用於存取快照集檔案的共用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="bbb15-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - 當連接到發行者時，所使用的安全性模式。</span><span class="sxs-lookup"><span data-stu-id="bbb15-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="bbb15-180">建議使用<xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-180"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="bbb15-181">呼叫 <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="bbb15-181">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-using-a-remote-distributor"></a><span data-ttu-id="bbb15-182">使用遠端散發者設定發行和散發</span><span class="sxs-lookup"><span data-stu-id="bbb15-182">To configure publishing and distribution using a remote Distributor</span></span>  
  
1.  <span data-ttu-id="bbb15-183">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與遠端散發者伺服器的連接。</span><span class="sxs-lookup"><span data-stu-id="bbb15-183">Create a connection to the remote Distributor server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="bbb15-184">建立 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-184">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="bbb15-185">傳遞步驟 1 的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-185">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="bbb15-186">建立 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-186">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="bbb15-187">將 <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> 屬性設定為資料庫名稱，並將 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> 屬性設定為步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-187">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="bbb15-188">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法來安裝散發者。</span><span class="sxs-lookup"><span data-stu-id="bbb15-188">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="bbb15-189">指定安全密碼 (連接到遠端散發者時由發行者使用) 及步驟 3 中的 <xref:Microsoft.SqlServer.Replication.DistributionDatabase> 物件。</span><span class="sxs-lookup"><span data-stu-id="bbb15-189">Specify a secure password (used by the Publisher when connecting to the remote Distributor) and the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span> <span data-ttu-id="bbb15-190">如需詳細資訊，請參閱[保護散發者](security/secure-the-distributor.md)。</span><span class="sxs-lookup"><span data-stu-id="bbb15-190">For more information, see [Secure the Distributor](security/secure-the-distributor.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bbb15-191">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="bbb15-191">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="bbb15-192">如果您必須儲存認證，請使用 [Windows .NET Framework 提供的](https://go.microsoft.com/fwlink/?LinkId=34733) 密碼編譯服務 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-192">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
6.  <span data-ttu-id="bbb15-193">建立 <xref:Microsoft.SqlServer.Replication.DistributionPublisher> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="bbb15-194">設定 <xref:Microsoft.SqlServer.Replication.DistributionPublisher>的以下屬性：</span><span class="sxs-lookup"><span data-stu-id="bbb15-194">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="bbb15-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - 本機發行者伺服器的名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the local Publisher server.</span></span>  
  
    -   <span data-ttu-id="bbb15-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - 步驟 1 中的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="bbb15-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - 步驟 5 中建立的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="bbb15-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="bbb15-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - 用於存取快照集檔案的共用。</span><span class="sxs-lookup"><span data-stu-id="bbb15-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="bbb15-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - 當連接到發行者時，所使用的安全性模式。</span><span class="sxs-lookup"><span data-stu-id="bbb15-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="bbb15-200">建議使用<xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-200"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="bbb15-201">呼叫 <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="bbb15-201">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="bbb15-202">使用 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 類別建立與本機發行者伺服器的連接。</span><span class="sxs-lookup"><span data-stu-id="bbb15-202">Create a connection to the local Publisher server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
10. <span data-ttu-id="bbb15-203">建立 <xref:Microsoft.SqlServer.Replication.ReplicationServer> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bbb15-203">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="bbb15-204">傳遞步驟 9 的 <xref:Microsoft.SqlServer.Management.Common.ServerConnection> 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-204">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 9.</span></span>  
  
11. <span data-ttu-id="bbb15-205">呼叫 <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="bbb15-205">Call the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="bbb15-206">傳遞遠端散發者的名稱以及步驟 5 中指定之遠端散發者的密碼。</span><span class="sxs-lookup"><span data-stu-id="bbb15-206">Pass the name of the remote Distributor and the password for the remote Distributor specified in step 5.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bbb15-207">可能的話，會在執行階段提示使用者輸入安全性認證。</span><span class="sxs-lookup"><span data-stu-id="bbb15-207">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="bbb15-208">如果您必須儲存認證，請使用 Windows .NET Framework 提供的 [密碼編譯服務](https://go.microsoft.com/fwlink/?LinkId=34733) 。</span><span class="sxs-lookup"><span data-stu-id="bbb15-208">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the Windows .NET Framework.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="bbb15-209">範例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="bbb15-209">Example (RMO)</span></span>  
 <span data-ttu-id="bbb15-210">您可以使用 Replication Management Objects (RMO) 以程式設計的方式設定複寫發行和散發。</span><span class="sxs-lookup"><span data-stu-id="bbb15-210">You can programmatically configure replication publishing and distribution by using Replication Management Objects (RMO).</span></span>  
  
 [!code-csharp[HowTo#rmo_AddDistPub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_adddistpub)]  
  
 [!code-vb[HowTo#rmo_vb_AddDistPub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_adddistpub)]  
  
## <a name="see-also"></a><span data-ttu-id="bbb15-211">另請參閱</span><span class="sxs-lookup"><span data-stu-id="bbb15-211">See Also</span></span>  
 <span data-ttu-id="bbb15-212">[檢視及修改散發者和發行者屬性](view-and-modify-distributor-and-publisher-properties.md) </span><span class="sxs-lookup"><span data-stu-id="bbb15-212">[View and Modify Distributor and Publisher Properties](view-and-modify-distributor-and-publisher-properties.md) </span></span>  
 <span data-ttu-id="bbb15-213">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="bbb15-213">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="bbb15-214">[[設定散發]](configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="bbb15-214">[Configure Distribution](configure-distribution.md) </span></span>  
 <span data-ttu-id="bbb15-215">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="bbb15-215">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 [<span data-ttu-id="bbb15-216">設定 AlwaysOn 可用性群組 &#40;SQL Server 的複寫&#41;</span><span class="sxs-lookup"><span data-stu-id="bbb15-216">Configure Replication for AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md) 
  
  
