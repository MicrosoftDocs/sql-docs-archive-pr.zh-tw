---
title: 差異備份 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- differential backups
- differential backups, about
ms.assetid: 123bb7af-1367-4bde-bfcb-76d36799b905
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 5c057e0d41cb46adef0ec1e01c3406190db900e4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87599525"
---
# <a name="differential-backups-sql-server"></a><span data-ttu-id="f6cdc-102">差異備份 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f6cdc-102">Differential Backups (SQL Server)</span></span>
  <span data-ttu-id="f6cdc-103">此備份和還原主題與所有的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 資料庫相關。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-103">This backup and restore topic is relevant for all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases.</span></span>  
  
 <span data-ttu-id="f6cdc-104">差異備份是以先前最近的完整資料備份為基礎。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-104">A differential backup is based on the most recent, previous full data backup.</span></span> <span data-ttu-id="f6cdc-105">差異備份只擷取自那次完整備份以後變更過的資料。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-105">A differential backup captures only the data that has changed since that full backup.</span></span> <span data-ttu-id="f6cdc-106">差異備份據以為基礎的完整備份就稱為差異的 *「基底」* (Base)。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-106">The full backup upon which a differential backup is based is known as the *base* of the differential.</span></span> <span data-ttu-id="f6cdc-107">完整備份 (不包括僅限複製備份) 可做為一系列差異備份的基底，包括資料庫備份、部分備份及檔案備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-107">Full backups, except for copy-only backups, can serve as the base for a series of differential backups, including database backups, partial backups, and file backups.</span></span> <span data-ttu-id="f6cdc-108">檔案差異備份的基底備份可以包含在完整備份、檔案備份或部分備份之中。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-108">The base backup for a file differential backup can be contained within a full backup, a file backup, or a partial backup.</span></span>  
  
  
##  <a name="benefits"></a><a name="Benefits"></a> <span data-ttu-id="f6cdc-109">優點</span><span class="sxs-lookup"><span data-stu-id="f6cdc-109">Benefits</span></span>  
  
-   <span data-ttu-id="f6cdc-110">相較於建立完整備份，建立差異備份可以非常快速。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-110">Creating a differential backups can be very fast compared to creating a full backup.</span></span> <span data-ttu-id="f6cdc-111">差異備份只會記錄自差異備份據以為基礎的完整備份以後變更過的資料。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-111">A differential backup records only the data that has changed since the full backup upon the differential backup is based.</span></span> <span data-ttu-id="f6cdc-112">這有利於經常備份資料，以降低資料遺失的風險。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-112">This facilitates taking frequent data backups, which decrease the risk of data loss.</span></span> <span data-ttu-id="f6cdc-113">但是，在還原差異備份之前，必須先還原其基底。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-113">However, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="f6cdc-114">因此，從差異備份中還原較之從完整備份中還原，由於需要兩個備份檔案，因此勢必要採取更多的步驟和時間。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-114">Therefore restoring from a differential backup will necessarily take more steps and time than restoring from a full backup because two backup files are required.</span></span>  
  
-   <span data-ttu-id="f6cdc-115">如果資料庫某個子集的修改比資料庫的其餘部分更加頻繁，差異資料庫備份就特別有用。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-115">Differential database backups are especially useful if a subset of a database is modified more frequently than the rest of the database.</span></span> <span data-ttu-id="f6cdc-116">在這些情形下，差異資料庫備份可以讓您經常備份，而避免完整資料庫備份的負擔。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-116">In these cases, differential database backups enable you back up frequently without the overhead of full database backups.</span></span>  
  
-   <span data-ttu-id="f6cdc-117">在完整復原模式下，使用差異備份可減少您必須還原的記錄備份數目。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-117">Under the full recovery model, using differential backups can reduce the number of log backups that you have to restore.</span></span>  
  
##  <a name="overview-of-differential-backups"></a><a name="Overview"></a> <span data-ttu-id="f6cdc-118">差異備份概觀</span><span class="sxs-lookup"><span data-stu-id="f6cdc-118">Overview of Differential Backups</span></span>  
 <span data-ttu-id="f6cdc-119">差異備份擷取從建立差異基底到建立差異備份已變更之任何 *「範圍」* (Extent) (八個實體連續頁面的集合) 的狀態。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-119">A differential backup captures the state of any *extents* (collections of eight physically contiguous pages) that have changed between when the differential base was created and the when differential backup is created.</span></span> <span data-ttu-id="f6cdc-120">這表示給定差異備份的大小取決於基底之後變更過的資料量。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-120">This means that the size of a given differential backup depends on the amount of data that has changed since the base.</span></span> <span data-ttu-id="f6cdc-121">一般而言，基底愈舊，新的差異備份就會愈大。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-121">Generally, the older a base is, the larger a new differential backup will be.</span></span> <span data-ttu-id="f6cdc-122">在一系列的差異備份中，經常更新的範圍很可能包含每個差異備份中的不同資料。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-122">In a series of differential backups, a frequently updated extent is likely to contain different data in each differential backup.</span></span>  
  
 <span data-ttu-id="f6cdc-123">下圖說明差異備份的運作方式。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-123">The following illustration shows how a differential backup works.</span></span> <span data-ttu-id="f6cdc-124">圖中顯示 24 個資料範圍，其中 6 個已經變更。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-124">The figure shows 24 data extents, 6 of which have changed.</span></span> <span data-ttu-id="f6cdc-125">差異備份只包含這 6 個資料範圍。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-125">The differential backup contains only these 6 data extents.</span></span> <span data-ttu-id="f6cdc-126">差異備份作業必須藉助點陣圖頁面 (此頁面包含每個範圍的一個位元)。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-126">The differential backup operation relies on a bitmap page that contains a bit for every extent.</span></span> <span data-ttu-id="f6cdc-127">對於基底之後已更新的每個範圍，點陣圖中的位元將設為 1。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-127">For each extent updated since the base, the bit is set to 1 in the bitmap.</span></span>  
  
 <span data-ttu-id="f6cdc-128">![差異點陣圖識別變更的範圍](../../database-engine/media/bnr-how-diff-backups-work.gif "差異點陣圖識別變更的範圍")</span><span class="sxs-lookup"><span data-stu-id="f6cdc-128">![Differential bitmap identifies changed extents](../../database-engine/media/bnr-how-diff-backups-work.gif "Differential bitmap identifies changed extents")</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f6cdc-129">僅限複製備份不會更新差異點陣圖。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-129">The differential bitmap is not updated by a copy-only backup.</span></span> <span data-ttu-id="f6cdc-130">因此，只複製備份不影響後續的差異備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-130">Therefore, a copy-only backup does not affect subsequent differential backups.</span></span>  
  
 <span data-ttu-id="f6cdc-131">在基底之後不久建立的差異備份，其大小通常比差異基底小得多，</span><span class="sxs-lookup"><span data-stu-id="f6cdc-131">A differential backup that is taken fairly soon after its base is usually significantly smaller than the differential base.</span></span> <span data-ttu-id="f6cdc-132">因此可以節省儲存空間和備份時間。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-132">This saves storage space and backup time.</span></span> <span data-ttu-id="f6cdc-133">不過，資料庫隨著時間不斷變更後，資料庫和特定差異基底之間的差異也會跟著增加。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-133">However, as a database changes over time, the difference between the database and a specific differential base increases.</span></span> <span data-ttu-id="f6cdc-134">差異備份及其基底之間相隔的時間愈長，差異備份的規模可能愈大。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-134">The longer the time between a differential backup and its base, the larger the differential backup is likely to be.</span></span> <span data-ttu-id="f6cdc-135">這表示差異備份的大小到最後會與差異基底的大小十分接近。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-135">This means that the differential backups can eventually approach the differential base in size.</span></span> <span data-ttu-id="f6cdc-136">大型的差異備份將喪失備份速度較快與規模較小的優勢。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-136">A large differential backup loses the advantages of a faster and smaller backup.</span></span>  
  
 <span data-ttu-id="f6cdc-137">隨著差異備份大小增加，還原差異備份會大幅增加還原資料庫所需的時間。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-137">As the differential backups increase in size, restoring a differential backup can significantly increase the time that is required to restore a database.</span></span> <span data-ttu-id="f6cdc-138">因此，建議您定期進行新的完整備份，為資料建立新的差異基底。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-138">Therefore, we recommend that you take a new full backup at set intervals to establish a new differential base for the data.</span></span> <span data-ttu-id="f6cdc-139">例如，您可能每週進行整個資料庫的完整備份 (亦即，完整資料庫備份)，然後在該週定期進行一連串的差異資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-139">For example, you might take a weekly full backup of the whole database (that is, a full database backup) followed by a regular series of differential database backups during the week.</span></span>  
  
 <span data-ttu-id="f6cdc-140">還原時，您必須在還原差異備份之前先還原其基底。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-140">At restore time, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="f6cdc-141">接著，只還原最新的差異備份，以便將資料庫向前復原到建立該差異備份的時間點。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-141">Then, restore only the most recent differential backup to bring the database forward to the time when that differential backup was created.</span></span> <span data-ttu-id="f6cdc-142">通常，您會在還原最新的完整備份之後，接著還原以該完整備份為基礎的最新差異備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-142">Typically, you would restore the most recent full backup followed by the most recent differential backup that is based on that full backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="f6cdc-143">使用記憶體最佳化資料表的資料庫差異備份</span><span class="sxs-lookup"><span data-stu-id="f6cdc-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="f6cdc-144">如需差異備份和具有記憶體最佳化資料表之資料庫的資訊，請參閱 [備份含有記憶體最佳化資料表的資料庫](../in-memory-oltp/memory-optimized-tables.md)。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-144">For information about differential backups and databases with memory-optimized tables, see [Backing Up a Database with Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
##  <a name="differential-backups-of-read-only-databases"></a><a name="ReadOnlyDbs"></a> <span data-ttu-id="f6cdc-145">唯讀資料庫的差異備份</span><span class="sxs-lookup"><span data-stu-id="f6cdc-145">Differential Backups of Read-Only Databases</span></span>  
 <span data-ttu-id="f6cdc-146">若為唯讀資料庫，單獨使用的完整備份會比搭配差異備份一起使用更容易管理。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-146">For read-only databases, full backups used alone are easier to manage than when they are used with differential backups.</span></span> <span data-ttu-id="f6cdc-147">當資料庫是唯讀時，備份和其他作業無法改變檔案所包含的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-147">When a database is read-only, backup and other operations cannot change the metadata that is contained in the file.</span></span> <span data-ttu-id="f6cdc-148">因此，差異備份所需的中繼資料，例如差異備份開始的記錄序號 (差異基底 LSN)，會儲存在 **master** 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-148">Therefore, metadata that is required by a differential backup, such as the log sequence number at which the differential backup begins (the differential base LSN) is stored in the **master** database.</span></span> <span data-ttu-id="f6cdc-149">如果差異基底是在資料庫為唯讀時建立，則差異點陣圖顯示的變更會比基底備份之後實際發生的變更還要多。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-149">If the differential base is taken when the database is read-only, the differential bitmap indicates more changes than have actually occurred since the base backup.</span></span> <span data-ttu-id="f6cdc-150">備份會讀取這些額外資料，但是不會將它寫入備份，因為 **backupset** 系統資料表中儲存的 [differential_base_lsn](/sql/relational-databases/system-tables/backupset-transact-sql) 是用來判斷在基底之後是否實際變更過資料。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-150">The extra data is read by backup, but is not written to the backup, because the **differential_base_lsn** stored in the [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) system table is used to determine whether the data has actually changed since the base.</span></span>  
  
 <span data-ttu-id="f6cdc-151">重建，還原或卸離後再重新附加唯讀資料庫時，會遺失差異基底資訊。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-151">When a read-only database is rebuilt, restored, or detached and attached, the differential-base information is lost.</span></span> <span data-ttu-id="f6cdc-152">發生這種情形的原因是， **master** 資料庫與使用者資料庫並未同步。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-152">This occurs because the **master** database is not synchronized with the user database.</span></span> <span data-ttu-id="f6cdc-153">[!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] 無法偵測或防止此問題。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-153">The [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot detect or prevent this problem.</span></span> <span data-ttu-id="f6cdc-154">以後的任何差異備份將不會以最近的完整備份為基底，因此可能會產生出人意料的結果。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-154">Any later differential backups are not based on the most recent full backup and could provide unexpected results.</span></span> <span data-ttu-id="f6cdc-155">若要建立新的差異基底，我們建議您建立完整資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-155">To establish a new differential base, we recommend that you create a full database backup.</span></span>  
  
### <a name="best-practices-for-using-differential-backups-with-a-read-only-database"></a><span data-ttu-id="f6cdc-156">對唯讀資料庫使用差異備份的最佳作法</span><span class="sxs-lookup"><span data-stu-id="f6cdc-156">Best Practices for Using Differential Backups with a Read-Only Database</span></span>  
 <span data-ttu-id="f6cdc-157">在建立唯讀資料庫的完整資料庫備份之後，如果您打算建立後續的差異備份，請備份 **master** 資料庫。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-157">After you create a full database backup of a read-only database, if you intend to create a subsequent differential backup, back up the **master** database.</span></span>  
  
 <span data-ttu-id="f6cdc-158">如果 **master** 資料庫遺失，在還原使用者資料庫的任何差異備份之前，請先將此資料庫還原。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-158">If the **master** database is lost, restore it before you restore any differential backup of a user database.</span></span>  
  
 <span data-ttu-id="f6cdc-159">如果您先卸離再附加您打算於稍後使用差異備份的唯讀資料庫，請盡可能進行唯讀資料庫和 **master** 資料庫的完整資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="f6cdc-159">If you detach and attach a read-only database for which you plan to later use differential backups, as soon as it is practical, take a full database backup of both the read-only database and of the **master** database.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="f6cdc-160">相關工作</span><span class="sxs-lookup"><span data-stu-id="f6cdc-160">Related Tasks</span></span>  
  
-   [<span data-ttu-id="f6cdc-161">建立差異資料庫備份 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f6cdc-161">Create a Differential Database Backup &#40;SQL Server&#41;</span></span>](create-a-differential-database-backup-sql-server.md)  
  
-   [<span data-ttu-id="f6cdc-162">還原差異資料庫備份 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f6cdc-162">Restore a Differential Database Backup &#40;SQL Server&#41;</span></span>](restore-a-differential-database-backup-sql-server.md)  
  
  
## <a name="see-also"></a><span data-ttu-id="f6cdc-163">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f6cdc-163">See Also</span></span>  
 <span data-ttu-id="f6cdc-164">[備份概觀 &#40;SQL Server&#41;](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="f6cdc-164">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="f6cdc-165">[完整資料庫備份 &#40;SQL Server&#41;](full-database-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="f6cdc-165">[Full Database Backups &#40;SQL Server&#41;](full-database-backups-sql-server.md) </span></span>  
 <span data-ttu-id="f6cdc-166">[完整資料庫還原 &#40;完整復原模式&#41;](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="f6cdc-166">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="f6cdc-167">[完整資料庫還原 &#40;簡單復原模式&#41;](complete-database-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="f6cdc-167">[Complete Database Restores &#40;Simple Recovery Model&#41;](complete-database-restores-simple-recovery-model.md) </span></span>  
 [<span data-ttu-id="f6cdc-168">交易記錄備份 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f6cdc-168">Transaction Log Backups &#40;SQL Server&#41;</span></span>](transaction-log-backups-sql-server.md)  
  
  
