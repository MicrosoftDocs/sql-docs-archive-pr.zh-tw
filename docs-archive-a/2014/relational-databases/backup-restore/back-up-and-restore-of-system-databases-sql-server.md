---
title: 系統資料庫的備份與還原 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- system databases [SQL Server], backing up and restoring
- restoring system databases [SQL Server]
- backing up [SQL Server], system databases
- database backups [SQL Server], system databases
- servers [SQL Server], backup
ms.assetid: aef0c4fa-ba67-413d-9359-1a67682fdaab
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 51ccf1aeadcf4ab9a662cdd629a812d3ee4b82aa
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87606937"
---
# <a name="back-up-and-restore-of-system-databases-sql-server"></a><span data-ttu-id="325c8-102">系統資料庫的備份與還原 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="325c8-102">Back Up and Restore of System Databases (SQL Server)</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="325c8-103">會維護一組系統層級資料庫，即「系統資料庫」  ，這對伺服器執行個體的運作而言是不可或缺的。</span><span class="sxs-lookup"><span data-stu-id="325c8-103">maintains a set of system-level databases, s*ystem databases*, which are essential for the operation of a server instance.</span></span> <span data-ttu-id="325c8-104">在每次重大更新之後，有幾個系統資料庫必須加以備份。</span><span class="sxs-lookup"><span data-stu-id="325c8-104">Several of the system databases must be backed up after every significant update.</span></span> <span data-ttu-id="325c8-105">您一定要備份的系統資料庫包括 **msdb**、 **master**和 **model**。</span><span class="sxs-lookup"><span data-stu-id="325c8-105">The system databases that you must always back up include **msdb**, **master**, and **model**.</span></span> <span data-ttu-id="325c8-106">如果有任何資料庫在伺服器執行個體上使用複寫，您還必須備份 **distribution** 系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-106">If any database uses replication on the server instance, there is a **distribution** system database that you must also back up.</span></span> <span data-ttu-id="325c8-107">這些系統資料庫的備份可讓您在發生系統失敗 (如硬碟故障) 時還原和復原 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系統。</span><span class="sxs-lookup"><span data-stu-id="325c8-107">Backups of these system databases let you restore and recover the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] system in the event of system failure, such as the loss of a hard disk.</span></span>  
  
 <span data-ttu-id="325c8-108">下表摘要列出所有系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-108">The following table summarizes all of the system databases.</span></span>  
  
|<span data-ttu-id="325c8-109">系統資料庫</span><span class="sxs-lookup"><span data-stu-id="325c8-109">System database</span></span>|<span data-ttu-id="325c8-110">描述</span><span class="sxs-lookup"><span data-stu-id="325c8-110">Description</span></span>|<span data-ttu-id="325c8-111">需要備份嗎？</span><span class="sxs-lookup"><span data-stu-id="325c8-111">Are backups required?</span></span>|<span data-ttu-id="325c8-112">復原模式</span><span class="sxs-lookup"><span data-stu-id="325c8-112">Recovery model</span></span>|<span data-ttu-id="325c8-113">註解</span><span class="sxs-lookup"><span data-stu-id="325c8-113">Comments</span></span>|  
|---------------------|-----------------|---------------------------|--------------------|--------------|  
|[<span data-ttu-id="325c8-114">master</span><span class="sxs-lookup"><span data-stu-id="325c8-114">master</span></span>](../databases/master-database.md)|<span data-ttu-id="325c8-115">記錄 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系統之所有系統層級資訊的資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-115">The database that records all of the system level information for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] system.</span></span>|<span data-ttu-id="325c8-116">是</span><span class="sxs-lookup"><span data-stu-id="325c8-116">Yes</span></span>|<span data-ttu-id="325c8-117">Simple</span><span class="sxs-lookup"><span data-stu-id="325c8-117">Simple</span></span>|<span data-ttu-id="325c8-118">請視需要經常備份 **master** ，充分地保護資料以滿足您業務的需求。</span><span class="sxs-lookup"><span data-stu-id="325c8-118">Back up **master** as often as necessary to protect the data sufficiently for your business needs.</span></span> <span data-ttu-id="325c8-119">建議安排定期備份，您可在進行大規模更新之後，以額外的備份來補充。</span><span class="sxs-lookup"><span data-stu-id="325c8-119">We recommend a regular backup schedule, which you can supplement with an additional backup after a substantial update.</span></span>|  
|[<span data-ttu-id="325c8-120">model</span><span class="sxs-lookup"><span data-stu-id="325c8-120">model</span></span>](../databases/model-database.md)|<span data-ttu-id="325c8-121">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體上建立之所有資料庫的範本。</span><span class="sxs-lookup"><span data-stu-id="325c8-121">The template for all databases that are created on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|<span data-ttu-id="325c8-122">是</span><span class="sxs-lookup"><span data-stu-id="325c8-122">Yes</span></span>|<span data-ttu-id="325c8-123">使用者可設定<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="325c8-123">User configurable<sup>1</sup></span></span>|<span data-ttu-id="325c8-124">只在有業務上有需要時才備份 **model** ；例如，在自訂資料庫選項之後立即備份。</span><span class="sxs-lookup"><span data-stu-id="325c8-124">Back up **model** only when necessary for your business needs; for example, immediately after customizing its database options.</span></span><br /><br /> <span data-ttu-id="325c8-125">**最佳做法：** 我們建議您在必要時僅建立 **model** 的完整資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="325c8-125">**Best practice:** We recommend that you create only full database backups of **model**, as required.</span></span> <span data-ttu-id="325c8-126">因為 **model** 很小，而且少有變更，所以不需要備份記錄。</span><span class="sxs-lookup"><span data-stu-id="325c8-126">Because **model** is small and rarely changes, backing up the log is unnecessary.</span></span>|  
|[<span data-ttu-id="325c8-127">msdb</span><span class="sxs-lookup"><span data-stu-id="325c8-127">msdb</span></span>](../databases/msdb-database.md)|<span data-ttu-id="325c8-128">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 用於排程警示和作業以及用於記錄操作員的資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-128">The database used by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent for scheduling alerts and jobs, and for recording operators.</span></span> <span data-ttu-id="325c8-129">**msdb** 也包含歷程記錄資料表，例如備份和還原歷程記錄資料表。</span><span class="sxs-lookup"><span data-stu-id="325c8-129">**msdb** also contains history tables such as the backup and restore history tables.</span></span>|<span data-ttu-id="325c8-130">是</span><span class="sxs-lookup"><span data-stu-id="325c8-130">Yes</span></span>|<span data-ttu-id="325c8-131">簡單 (預設值)</span><span class="sxs-lookup"><span data-stu-id="325c8-131">Simple (default)</span></span>|<span data-ttu-id="325c8-132">每當 **msdb** 更新時就加以備份。</span><span class="sxs-lookup"><span data-stu-id="325c8-132">Back up **msdb** whenever it is updated.</span></span>|  
|<span data-ttu-id="325c8-133">[Resource](../databases/resource-database.md) (RDB)</span><span class="sxs-lookup"><span data-stu-id="325c8-133">[Resource](../databases/resource-database.md) (RDB)</span></span>|<span data-ttu-id="325c8-134">唯讀資料庫，其中包含下者隨附之所有系統物件的複本： [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="325c8-134">A read-only database that contains copies of all system objects that ship with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span></span>|<span data-ttu-id="325c8-135">否</span><span class="sxs-lookup"><span data-stu-id="325c8-135">No</span></span>|-|<span data-ttu-id="325c8-136">**Resource** 資料庫位於 mssqlsystemresource.mdf 檔案中，這個檔案中只包含程式碼。</span><span class="sxs-lookup"><span data-stu-id="325c8-136">The **Resource** database resides in the mssqlsystemresource.mdf file, which contains only code.</span></span> <span data-ttu-id="325c8-137">因此， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 無法備份 **Resource** 資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-137">Therefore, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot back up the **Resource** database.</span></span><br /><br /> <span data-ttu-id="325c8-138">注意:您可以將 mssqlsystemresource.mdf 檔視為二進位 (.exe) 檔案而非資料庫檔案，藉以針對該檔案執行以檔案或磁碟為基礎的備份。</span><span class="sxs-lookup"><span data-stu-id="325c8-138">Note: You can perform a file-based or a disk-based backup on the mssqlsystemresource.mdf file by treating the file as if it were a binary (.exe) file, instead of a database file.</span></span> <span data-ttu-id="325c8-139">但是您無法在這些備份上使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 還原。</span><span class="sxs-lookup"><span data-stu-id="325c8-139">But you cannot use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] restore on the backups.</span></span> <span data-ttu-id="325c8-140">還原 mssqlsystemresource.mdf 的備份副本只能手動完成，而且您必須小心不要使用過期或可能不安全的 **Resource** 資料庫來覆寫目前的資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-140">Restoring a backup copy of mssqlsystemresource.mdf can only be done manually, and you must be careful not to overwrite the current **Resource** database with an out-of-date or potentially insecure version.</span></span>|  
|[<span data-ttu-id="325c8-141">tempdb</span><span class="sxs-lookup"><span data-stu-id="325c8-141">tempdb</span></span>](../databases/tempdb-database.md)|<span data-ttu-id="325c8-142">用以保存暫存或中繼結果集的工作空間。</span><span class="sxs-lookup"><span data-stu-id="325c8-142">A workspace for holding temporary or intermediate result sets.</span></span> <span data-ttu-id="325c8-143">每當 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體啟動時，就會重新建立此資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-143">This database is re-created every time an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is started.</span></span> <span data-ttu-id="325c8-144">當伺服器執行個體關閉時， **tempdb** 中的任何資料都會被永久刪除。</span><span class="sxs-lookup"><span data-stu-id="325c8-144">When the server instance is shut down, any data in **tempdb** is deleted permanently.</span></span>|<span data-ttu-id="325c8-145">否</span><span class="sxs-lookup"><span data-stu-id="325c8-145">No</span></span>|<span data-ttu-id="325c8-146">Simple</span><span class="sxs-lookup"><span data-stu-id="325c8-146">Simple</span></span>|<span data-ttu-id="325c8-147">您不能備份 **tempdb** 系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-147">You cannot back up the **tempdb** system database.</span></span>|  
|[<span data-ttu-id="325c8-148">設定散發</span><span class="sxs-lookup"><span data-stu-id="325c8-148">Configure Distribution</span></span>](../replication/configure-distribution.md)|<span data-ttu-id="325c8-149">唯有將伺服器設定為複寫散發者時才會存在的資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-149">A database that exists only if the server is configured as a replication Distributor.</span></span> <span data-ttu-id="325c8-150">這個資料庫會儲存各種複寫的中繼資料和記錄資料，以及異動複寫的交易。</span><span class="sxs-lookup"><span data-stu-id="325c8-150">This database stores metadata and history data for all types of replication, and transactions for transactional replication.</span></span>|<span data-ttu-id="325c8-151">是</span><span class="sxs-lookup"><span data-stu-id="325c8-151">Yes</span></span>|<span data-ttu-id="325c8-152">Simple</span><span class="sxs-lookup"><span data-stu-id="325c8-152">Simple</span></span>|<span data-ttu-id="325c8-153">如需有關何時備份 **distribution** 資料庫的詳細資訊，請參閱 [備份及還原複寫的資料庫](../replication/administration/back-up-and-restore-replicated-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="325c8-153">For information about when to back up the **distribution** database, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md).</span></span>|  
  
 <span data-ttu-id="325c8-154"><sup>1</sup>若要瞭解模型目前的復原模式，請參閱 &#40;SQL Server&#41;或[sys.databases &#40;transact-sql&#41;](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql)中，[查看或變更資料庫的復原模式](view-or-change-the-recovery-model-of-a-database-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="325c8-154"><sup>1</sup> To learn the current recovery model of the model, see [View or Change the Recovery Model of a Database &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md) or [sys.databases &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql).</span></span>  
  
## <a name="limitations-on-restoring-system-databases"></a><span data-ttu-id="325c8-155">還原系統資料庫的限制</span><span class="sxs-lookup"><span data-stu-id="325c8-155">Limitations on Restoring System Databases</span></span>  
  
-   <span data-ttu-id="325c8-156">您只能從伺服器執行個體目前執行之 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 版本所建立的備份還原系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-156">System databases can be restored only from backups that are created on the version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that the server instance is currently running.</span></span> <span data-ttu-id="325c8-157">例如，在執行 SP1 的伺服器實例上還原系統資料庫 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="325c8-157">For example, to restore a system database on a server instance that is running on [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] SP1.</span></span>  
  
-   <span data-ttu-id="325c8-158">若要還原任何資料庫， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的執行個體必須在執行中。</span><span class="sxs-lookup"><span data-stu-id="325c8-158">To restore any database, the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must be running.</span></span> <span data-ttu-id="325c8-159">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] master **資料庫必須是可存取的，而且至少部分可用，** 的執行個體才能夠啟動。</span><span class="sxs-lookup"><span data-stu-id="325c8-159">Startup of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires that the **master** database is accessible and at least partly usable.</span></span> <span data-ttu-id="325c8-160">如果 **master** 資料庫變得無法使用，您可以使用下列任一方法將資料庫回復到可用狀態：</span><span class="sxs-lookup"><span data-stu-id="325c8-160">If **master** becomes unusable, you can return the database to a usable state in either of the following ways:</span></span>  
  
    -   <span data-ttu-id="325c8-161">從現行資料庫備份來還原 **master** 。</span><span class="sxs-lookup"><span data-stu-id="325c8-161">Restore **master** from a current database backup.</span></span>  
  
         <span data-ttu-id="325c8-162">如果您可以啟動伺服器執行個體，應該就能夠從完整資料庫備份來還原 **master** 。</span><span class="sxs-lookup"><span data-stu-id="325c8-162">If you can start the server instance, you should be able to restore **master** from a full database backup.</span></span>  
  
    -   <span data-ttu-id="325c8-163">完全重建 **master** 。</span><span class="sxs-lookup"><span data-stu-id="325c8-163">Rebuild **master** completely.</span></span>  
  
         <span data-ttu-id="325c8-164">如果 **master** 嚴重損壞，使您無法啟動 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]，則必須重建 **master**。</span><span class="sxs-lookup"><span data-stu-id="325c8-164">If severe damage to **master** prevents you from starting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must rebuild **master**.</span></span> <span data-ttu-id="325c8-165">如需詳細資訊，請參閱 [重建系統資料庫](../databases/system-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="325c8-165">For more information, see [Rebuild System Databases](../databases/system-databases.md).</span></span>  
  
        > [!IMPORTANT]  
        >  <span data-ttu-id="325c8-166">重建 **master** 將會重建所有的系統資料庫。</span><span class="sxs-lookup"><span data-stu-id="325c8-166">Rebuilding **master** rebuilds all of the system databases.</span></span>  
  
-   <span data-ttu-id="325c8-167">在某些情況下，復原 model 資料庫若發生問題，可能就需要重建系統資料庫，或是置換 model 資料庫的 mdf 和 ldf 檔案。</span><span class="sxs-lookup"><span data-stu-id="325c8-167">Under some circumstances, problems recovering the model database may require rebuilding the system databases or replacing the mdf and ldf files for the model database.</span></span> <span data-ttu-id="325c8-168">如需詳細資訊，請參閱 [重建系統資料庫](../databases/system-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="325c8-168">For more information, see [Rebuild System Databases](../databases/system-databases.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="325c8-169">相關工作</span><span class="sxs-lookup"><span data-stu-id="325c8-169">Related Tasks</span></span>  
  
-   [<span data-ttu-id="325c8-170">建立完整資料庫備份 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="325c8-170">Create a Full Database Backup &#40;SQL Server&#41;</span></span>](create-a-full-database-backup-sql-server.md)  
  
-   [<span data-ttu-id="325c8-171">完整資料庫還原 &#40;簡單復原模式&#41;</span><span class="sxs-lookup"><span data-stu-id="325c8-171">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="325c8-172">還原 master 資料庫 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="325c8-172">Restore the master Database &#40;Transact-SQL&#41;</span></span>](restore-the-master-database-transact-sql.md)  
  
-   [<span data-ttu-id="325c8-173">檢視或變更資料庫的復原模式 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="325c8-173">View or Change the Recovery Model of a Database &#40;SQL Server&#41;</span></span>](view-or-change-the-recovery-model-of-a-database-sql-server.md)  
  
-   [<span data-ttu-id="325c8-174">移動系統資料庫</span><span class="sxs-lookup"><span data-stu-id="325c8-174">Move System Databases</span></span>](../databases/move-system-databases.md)  
  
## <a name="see-also"></a><span data-ttu-id="325c8-175">另請參閱</span><span class="sxs-lookup"><span data-stu-id="325c8-175">See Also</span></span>  
 <span data-ttu-id="325c8-176">[散發資料庫](../../relational-databases/replication/distribution-database.md) </span><span class="sxs-lookup"><span data-stu-id="325c8-176">[Distribution Database](../../relational-databases/replication/distribution-database.md) </span></span>  
 <span data-ttu-id="325c8-177">[master 資料庫](../databases/master-database.md) </span><span class="sxs-lookup"><span data-stu-id="325c8-177">[master Database](../databases/master-database.md) </span></span>  
 <span data-ttu-id="325c8-178">[msdb 資料庫](../databases/msdb-database.md) </span><span class="sxs-lookup"><span data-stu-id="325c8-178">[msdb Database](../databases/msdb-database.md) </span></span>  
 <span data-ttu-id="325c8-179">[Model 資料庫](../databases/model-database.md) </span><span class="sxs-lookup"><span data-stu-id="325c8-179">[model Database](../databases/model-database.md) </span></span>  
 <span data-ttu-id="325c8-180">[Resource 資料庫](../databases/resource-database.md) </span><span class="sxs-lookup"><span data-stu-id="325c8-180">[Resource Database](../databases/resource-database.md) </span></span>  
 [<span data-ttu-id="325c8-181">tempdb 資料庫</span><span class="sxs-lookup"><span data-stu-id="325c8-181">tempdb Database</span></span>](../databases/tempdb-database.md)  
  
  
