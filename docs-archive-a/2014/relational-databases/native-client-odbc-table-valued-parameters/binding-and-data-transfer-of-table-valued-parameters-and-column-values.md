---
title: 資料表值參數和資料行值的系結和資料傳輸 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters (ODBC), binding and data transfer
ms.assetid: 0a2ea462-d613-42b6-870f-c7fa086a6b42
author: rothja
ms.author: jroth
ms.openlocfilehash: 2e9e30e22a69b2d500990cc1481506b4edbda99b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87598862"
---
# <a name="binding-and-data-transfer-of-table-valued-parameters-and-column-values"></a><span data-ttu-id="3d0da-102">資料表值參數和資料行值的繫結與資料傳送</span><span class="sxs-lookup"><span data-stu-id="3d0da-102">Binding and Data Transfer of Table-Valued Parameters and Column Values</span></span>
  <span data-ttu-id="3d0da-103">資料表值參數與其他參數一樣，必須先繫結，然後才能傳遞至伺服器。</span><span class="sxs-lookup"><span data-stu-id="3d0da-103">Table-valued parameters, like other parameters, must be bound before they are passed to the server.</span></span> <span data-ttu-id="3d0da-104">應用程式系結資料表值參數的方式，與系結其他參數的方法相同：使用 SQLBindParameter 或對 SQLSetDescField 或 SQLSetDescRec 的對等呼叫。</span><span class="sxs-lookup"><span data-stu-id="3d0da-104">The application binds table-valued parameters the same way it binds other parameters: by using SQLBindParameter or equivalent calls to SQLSetDescField or SQLSetDescRec.</span></span> <span data-ttu-id="3d0da-105">資料表值參數的伺服器資料類型是 SQL_SS_TABLE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-105">The server data type for a table-valued parameter is SQL_SS_TABLE.</span></span> <span data-ttu-id="3d0da-106">C 類型可以指定為 SQL_C_DEFAULT 或 SQL_C_BINARY。</span><span class="sxs-lookup"><span data-stu-id="3d0da-106">The C type can be specified either as SQL_C_DEFAULT or SQL_C_BINARY.</span></span>  
  
 <span data-ttu-id="3d0da-107">在 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 或更新版本中，只支援輸入資料表值參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-107">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] or later, only input table-valued parameters are supported.</span></span> <span data-ttu-id="3d0da-108">因此，如果您嘗試將 SQL_DESC_PARAMETER_TYPE 設定為 SQL_PARAM_INPUT 以外的值，將會傳回含有 SQLSTATE = HY105 和「無效的參數類型」訊息的 SQL_ERROR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-108">Therefore, any attempt to set SQL_DESC_PARAMETER_TYPE to a value other than SQL_PARAM_INPUT will return SQL_ERROR with SQLSTATE = HY105 and the message "Invalid parameter type".</span></span>  
  
 <span data-ttu-id="3d0da-109">您可以使用屬性 SQL_CA_SS_COL_HAS_DEFAULT_VALUE，將預設值指派給整個資料表值參數資料行。</span><span class="sxs-lookup"><span data-stu-id="3d0da-109">Entire table-valued parameter columns can be assigned default values by using the attribute SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span></span> <span data-ttu-id="3d0da-110">不過，您無法使用 SQLBindParameter 的*StrLen_or_IndPtr*中的 SQL_DEFAULT_PARAM，將個別的資料表值參數資料行值指派給預設值。</span><span class="sxs-lookup"><span data-stu-id="3d0da-110">Individual table-valued parameter column values, however, cannot be assigned default values by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="3d0da-111">使用*StrLen_or_IndPtr* with SQLBindParameter 中的 SQL_DEFAULT_PARAM，就無法將資料表值參數設為預設值。</span><span class="sxs-lookup"><span data-stu-id="3d0da-111">Table-valued parameters as a whole cannot be set to a default value by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="3d0da-112">如果未遵循這些規則，SQLExecute 或 SQLExecDirect 會傳回 SQL_ERROR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-112">If these rules are not followed, SQLExecute or SQLExecDirect will return SQL_ERROR.</span></span> <span data-ttu-id="3d0da-113">將會產生含有 SQLSTATE = 07S01 和「參數的預設參數用法無效」訊息的診斷記錄 \<p> ，其中 \<p> 是查詢語句中 TVP 的序數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-113">A diagnostic record will be generated with SQLSTATE=07S01 and the message "Invalid use of default parameter for parameter \<p>", where \<p> is the ordinal of the TVP in the query statement.</span></span>  
  
 <span data-ttu-id="3d0da-114">繫結資料表值參數之後，應用程式必須接著繫結每個資料表值參數資料行。</span><span class="sxs-lookup"><span data-stu-id="3d0da-114">After binding the table-valued parameter, the application must then bind each table-valued parameter column.</span></span> <span data-ttu-id="3d0da-115">若要這樣做，應用程式會先呼叫 SQLSetStmtAttr，將 SQL_SOPT_SS_PARAM_FOCUS 設定為數據表值參數的序數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-115">To do this, the application first calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of a table-valued parameter.</span></span> <span data-ttu-id="3d0da-116">然後，應用程式會呼叫下列常式來系結資料表值參數的資料行： SQLBindParameter、SQLSetDescRec 和 SQLSetDescField。</span><span class="sxs-lookup"><span data-stu-id="3d0da-116">Then the application binds the columns of the table-valued parameter by calls to the following routines: SQLBindParameter, SQLSetDescRec, and SQLSetDescField.</span></span> <span data-ttu-id="3d0da-117">將 SQL_SOPT_SS_PARAM_FOCUS 設定為0，會還原一般作用中的 SQLBindParameter、SQLSetDescRec 和 SQLSetDescField，以便在一般的頂層參數上運作。</span><span class="sxs-lookup"><span data-stu-id="3d0da-117">Setting SQL_SOPT_SS_PARAM_FOCUS to 0 restores the usual effect of SQLBindParameter, SQLSetDescRec, and SQLSetDescField in operating on regular top-level parameters.</span></span>  
  
 <span data-ttu-id="3d0da-118">雖然不會針對資料表值參數本身傳送或接收任何實際資料，但是會針對每個構成的資料行傳送或接收資料。</span><span class="sxs-lookup"><span data-stu-id="3d0da-118">No actual data is sent or received for the table-valued parameter itself, but data is sent and received for each of its constituent columns.</span></span> <span data-ttu-id="3d0da-119">因為資料表值參數是虛擬資料行，所以 SQLBindParameter 的參數是用來參考與其他資料類型不同的屬性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d0da-119">Because the table-valued parameter is a pseudo column, the parameters for SQLBindParameter are used to refer to different attributes than other data types, as follows:</span></span>  
  
|<span data-ttu-id="3d0da-120">參數</span><span class="sxs-lookup"><span data-stu-id="3d0da-120">Parameter</span></span>|<span data-ttu-id="3d0da-121">非資料表值參數類型的相關屬性，包括資料行</span><span class="sxs-lookup"><span data-stu-id="3d0da-121">Related attribute for non-table-valued parameter types, including columns</span></span>|<span data-ttu-id="3d0da-122">資料表值參數的相關屬性</span><span class="sxs-lookup"><span data-stu-id="3d0da-122">Related attribute for table-valued parameters</span></span>|  
|---------------|--------------------------------------------------------------------------------|----------------------------------------------------|  
|<span data-ttu-id="3d0da-123">*InputOutputType*</span><span class="sxs-lookup"><span data-stu-id="3d0da-123">*InputOutputType*</span></span>|<span data-ttu-id="3d0da-124">IPD 中的 SQL_DESC_PARAMETER_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-124">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="3d0da-125">若為資料表值參數資料行，這必須與資料表值參數本身的設定相同。</span><span class="sxs-lookup"><span data-stu-id="3d0da-125">For table-valued parameter columns, this must be the same as the setting for the table-valued parameter itself.</span></span>|<span data-ttu-id="3d0da-126">IPD 中的 SQL_DESC_PARAMETER_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-126">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="3d0da-127">這必須是 SQL_PARAM_INPUT。</span><span class="sxs-lookup"><span data-stu-id="3d0da-127">This must be SQL_PARAM_INPUT.</span></span>|  
|<span data-ttu-id="3d0da-128">*ValueType*</span><span class="sxs-lookup"><span data-stu-id="3d0da-128">*ValueType*</span></span>|<span data-ttu-id="3d0da-129">APD 中的 SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span>|<span data-ttu-id="3d0da-130">APD 中的 SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span><br /><br /> <span data-ttu-id="3d0da-131">這必須是 SQL_C_DEFAULT 或 SQL_C_BINARY。</span><span class="sxs-lookup"><span data-stu-id="3d0da-131">This must be SQL_C_DEFAULT or SQL_C_BINARY.</span></span>|  
|<span data-ttu-id="3d0da-132">*ParameterType*</span><span class="sxs-lookup"><span data-stu-id="3d0da-132">*ParameterType*</span></span>|<span data-ttu-id="3d0da-133">IPD 中的 SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span>|<span data-ttu-id="3d0da-134">IPD 中的 SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="3d0da-135">這必須是 SQL_SS_TABLE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-135">This must be SQL_SS_TABLE.</span></span>|  
|<span data-ttu-id="3d0da-136">*ColumnSize*</span><span class="sxs-lookup"><span data-stu-id="3d0da-136">*ColumnSize*</span></span>|<span data-ttu-id="3d0da-137">IPD 中的 SQL_DESC_LENGTH 或 SQL_DESC_PRECISION。</span><span class="sxs-lookup"><span data-stu-id="3d0da-137">SQL_DESC_LENGTH or SQL_DESC_PRECISION in IPD.</span></span><br /><br /> <span data-ttu-id="3d0da-138">這取決於*ParameterType*的值。</span><span class="sxs-lookup"><span data-stu-id="3d0da-138">This depends on the value of *ParameterType*.</span></span>|<span data-ttu-id="3d0da-139">SQL_DESC_ARRAY_SIZE</span><span class="sxs-lookup"><span data-stu-id="3d0da-139">SQL_DESC_ARRAY_SIZE</span></span><br /><br /> <span data-ttu-id="3d0da-140">當參數焦點設定為資料表值參數時，也可以使用 SQL_ATTR_PARAM_SET_SIZE 來設定。</span><span class="sxs-lookup"><span data-stu-id="3d0da-140">Can also be set using SQL_ATTR_PARAM_SET_SIZE when the parameter focus is set to the table-valued parameter.</span></span><br /><br /> <span data-ttu-id="3d0da-141">如果是資料表值參數，這就是資料表值參數資料行緩衝區中的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="3d0da-141">For a table-valued parameter, this is the number of rows in the table-valued parameter column buffers.</span></span>|  
|<span data-ttu-id="3d0da-142">*DecimalDigits*</span><span class="sxs-lookup"><span data-stu-id="3d0da-142">*DecimalDigits*</span></span>|<span data-ttu-id="3d0da-143">IPD 中的 SQL_DESC_PRECISION 或 SQL_DESC_SCALE。</span><span class="sxs-lookup"><span data-stu-id="3d0da-143">SQL_DESC_PRECISION or SQL_DESC_SCALE in IPD.</span></span>|<span data-ttu-id="3d0da-144">未使用的。</span><span class="sxs-lookup"><span data-stu-id="3d0da-144">Unused.</span></span> <span data-ttu-id="3d0da-145">這必須是 0。</span><span class="sxs-lookup"><span data-stu-id="3d0da-145">This must be 0.</span></span><br /><br /> <span data-ttu-id="3d0da-146">如果此參數不是0，SQLBindParameter 會傳回 SQL_ERROR，而且會產生含有 SQLSTATE = HY104 和訊息「不正確有效位數或小數位數」的診斷記錄。</span><span class="sxs-lookup"><span data-stu-id="3d0da-146">If this parameter is not 0, SQLBindParameter will return SQL_ERROR, and a diagnostic record will be generated with SQLSTATE= HY104 and the message "Invalid precision or scale".</span></span>|  
|<span data-ttu-id="3d0da-147">*ParameterValuePtr*</span><span class="sxs-lookup"><span data-stu-id="3d0da-147">*ParameterValuePtr*</span></span>|<span data-ttu-id="3d0da-148">APD 中的 SQL_DESC_DATA_PTR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-148">SQL_DESC_DATA_PTR in APD.</span></span>|<span data-ttu-id="3d0da-149">SQL_CA_SS_TYPE_NAME。</span><span class="sxs-lookup"><span data-stu-id="3d0da-149">SQL_CA_SS_TYPE_NAME.</span></span><br /><br /> <span data-ttu-id="3d0da-150">這個參數對於預存程序呼叫而言是選擇性的，如果不需要的話可以指定 NULL。</span><span class="sxs-lookup"><span data-stu-id="3d0da-150">This is optional for stored procedure calls, and NULL can be specified if it is not required.</span></span> <span data-ttu-id="3d0da-151">您必須針對不是程序呼叫的 SQL 陳述式指定這個參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-151">It must be specified for SQL statements that are not procedure calls.</span></span><br /><br /> <span data-ttu-id="3d0da-152">這個參數也會當做一個唯一值，應用程式可以在使用變動資料列繫結時使用這個值來識別這個資料表值參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-152">This parameter also serves as a unique value that the application can use to identify this table-valued parameter when variable row binding is used.</span></span> <span data-ttu-id="3d0da-153">如需詳細資訊，請參閱本主題後面的「變動資料表值參數資料列繫結」一節。</span><span class="sxs-lookup"><span data-stu-id="3d0da-153">For more information, see the "Variable Table-Valued Parameter Row Binding" section, later in this topic.</span></span><br /><br /> <span data-ttu-id="3d0da-154">當資料表值參數類型名稱是在呼叫 SQLBindParameter 時指定時，必須將它指定為 Unicode 值，即使在以 ANSI 應用程式形式建立的應用程式中也是如此。</span><span class="sxs-lookup"><span data-stu-id="3d0da-154">When a table-valued parameter type name is specified on a call to SQLBindParameter, it must be specified as a Unicode value, even in applications that are built as ANSI applications.</span></span> <span data-ttu-id="3d0da-155">參數*StrLen_or_IndPtr*所使用的值應該是 SQL_NTS 或名稱的字串長度乘以 SIZEOF (WCHAR) 。</span><span class="sxs-lookup"><span data-stu-id="3d0da-155">The value used for the parameter *StrLen_or_IndPtr* should be either SQL_NTS or the string length of the name multiplied by sizeof(WCHAR).</span></span>|  
|<span data-ttu-id="3d0da-156">*BufferLength*</span><span class="sxs-lookup"><span data-stu-id="3d0da-156">*BufferLength*</span></span>|<span data-ttu-id="3d0da-157">APD 中的 SQL_DESC_OCTET_LENGTH。</span><span class="sxs-lookup"><span data-stu-id="3d0da-157">SQL_DESC_OCTET_LENGTH in APD.</span></span>|<span data-ttu-id="3d0da-158">資料表值參數類型名稱的長度 (以位元組為單位)。</span><span class="sxs-lookup"><span data-stu-id="3d0da-158">The length of the table-valued parameter type name in bytes.</span></span><br /><br /> <span data-ttu-id="3d0da-159">如果此類型名稱以 Null 結尾，這項設定可以是 SQL_NTS；如果不需要資料表值參數類型名稱則為 0。</span><span class="sxs-lookup"><span data-stu-id="3d0da-159">This can be SQL_NTS if the type name is null terminated, or 0 if the table-valued parameter type name is not required.</span></span>|  
|<span data-ttu-id="3d0da-160">*StrLen_or_IndPtr*</span><span class="sxs-lookup"><span data-stu-id="3d0da-160">*StrLen_or_IndPtr*</span></span>|<span data-ttu-id="3d0da-161">APD 中的 SQL_DESC_OCTET_LENGTH_PTR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-161">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span>|<span data-ttu-id="3d0da-162">APD 中的 SQL_DESC_OCTET_LENGTH_PTR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-162">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span><br /><br /> <span data-ttu-id="3d0da-163">若為資料表值參數，這就是資料列計數而非資料長度。</span><span class="sxs-lookup"><span data-stu-id="3d0da-163">For table-valued parameters, this is a row count rather than a data length.</span></span>|  
  
 <span data-ttu-id="3d0da-164">資料表值參數支援兩種資料傳送模式：固定資料列繫結和變動資料列繫結。</span><span class="sxs-lookup"><span data-stu-id="3d0da-164">Two data transfer modes are supported for table-valued parameters: fixed row binding and variable row binding.</span></span>  
  
## <a name="fixed-table-valued-parameter-row-binding"></a><span data-ttu-id="3d0da-165">固定資料表值參數資料列繫結</span><span class="sxs-lookup"><span data-stu-id="3d0da-165">Fixed Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="3d0da-166">對於固定資料列繫結而言，應用程式會針對所有可能的輸入資料行值配置夠大的緩衝區 (或緩衝區陣列)。</span><span class="sxs-lookup"><span data-stu-id="3d0da-166">For fixed row binding, an application allocates buffers (or buffer arrays) large enough for all possible input column values.</span></span> <span data-ttu-id="3d0da-167">此應用程式會進行下列作業：</span><span class="sxs-lookup"><span data-stu-id="3d0da-167">The application does the following:</span></span>  
  
1.  <span data-ttu-id="3d0da-168">使用 SQLBindParameter、SQLSetDescRec 或 SQLSetDescField 呼叫來系結所有參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-168">Binds all parameters by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    1.  <span data-ttu-id="3d0da-169">將 SQL_DESC_ARRAY_SIZE 設定為可針對每個資料表值參數傳送的最大資料列數目。</span><span class="sxs-lookup"><span data-stu-id="3d0da-169">Sets SQL_DESC_ARRAY_SIZE to the maximum number of rows that can be transferred for each table-valued parameter.</span></span> <span data-ttu-id="3d0da-170">這可以在 SQLBindParameter 呼叫中完成。</span><span class="sxs-lookup"><span data-stu-id="3d0da-170">This can be done in the SQLBindParameter call.</span></span>  
  
2.  <span data-ttu-id="3d0da-171">呼叫 SQLSetStmtAttr，將 SQL_SOPT_SS_PARAM_FOCUS 設定為每個資料表值參數的序數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-171">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of each table-valued parameter.</span></span>  
  
    1.  <span data-ttu-id="3d0da-172">針對每個資料表值參數，使用 SQLBindParameter、SQLSetDescRec 或 SQLSetDescField 呼叫來系結資料表值參數資料行。</span><span class="sxs-lookup"><span data-stu-id="3d0da-172">For each table-valued parameter, binds table-valued parameter columns by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    2.  <span data-ttu-id="3d0da-173">對於每個要有預設值的資料表值參數資料行，會呼叫 SQLSetDescField，將 SQL_CA_SS_COL_HAS_DEFAULT_VALUE 設定為1。</span><span class="sxs-lookup"><span data-stu-id="3d0da-173">For each table-valued parameter column that is to have default values, calls SQLSetDescField to set SQL_CA_SS_COL_HAS_DEFAULT_VALUE to 1.</span></span>  
  
3.  <span data-ttu-id="3d0da-174">呼叫 SQLSetStmtAttr，將 SQL_SOPT_SS_PARAM_FOCUS 設定為0。</span><span class="sxs-lookup"><span data-stu-id="3d0da-174">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to 0.</span></span> <span data-ttu-id="3d0da-175">這必須在呼叫 SQLExecute 或 SQLExecDirect 之前完成。</span><span class="sxs-lookup"><span data-stu-id="3d0da-175">This must be done before SQLExecute or SQLExecDirect is called.</span></span> <span data-ttu-id="3d0da-176">否則，系統將傳回 SQL_ERROR，並產生包含 SQLSTATE=HY024 和「屬性值 SQL_SOPT_SS_PARAM_FOCUS 無效 (在執行時間必須為零)」訊息的診斷記錄。</span><span class="sxs-lookup"><span data-stu-id="3d0da-176">Otherwise, SQL_ERROR is be returned and a diagnostic record is generated with SQLSTATE=HY024 and the message "Invalid attribute value, SQL_SOPT_SS_PARAM_FOCUS (must be zero at execution time)".</span></span>  
  
4.  <span data-ttu-id="3d0da-177">將*StrLen_or_IndPtr*或 SQL_DESC_OCTET_LENGTH_PTR 設定為不含資料列的資料表值參數 SQL_DEFAULT_PARAM，或如果資料表值參數有資料列，則會在下一次呼叫 SQLExecute 或 SQLExecDirect 時傳送的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="3d0da-177">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR to SQL_DEFAULT_PARAM for a table-valued parameter with no rows, or the number of rows to be transferred on the next call of SQLExecute or SQLExecDirect if the table-valued parameter has rows.</span></span> <span data-ttu-id="3d0da-178">*StrLen_or_IndPtr*或 SQL_DESC_OCTET_LENGTH_PTR 無法設定為數據表值參數的 SQL_Null_DATA， (因為資料表值參數組成資料行可為 null) 。</span><span class="sxs-lookup"><span data-stu-id="3d0da-178">*StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR cannot be set to SQL_NULL_DATA for a table-valued parameter as table-valued parameters are not nullable (though table-valued parameter constituent columns may be nullable).</span></span> <span data-ttu-id="3d0da-179">如果這個值設定為不正確值，SQLExecute 或 SQLExecDirect 會傳回 SQL_ERROR，而且會產生包含 SQLSTATE = HY090 和訊息「參數的字串或緩衝區長度無效」的診斷記錄 \<p> ，其中 p 是參數編號。</span><span class="sxs-lookup"><span data-stu-id="3d0da-179">If this is set to an invalid value, SQLExecute or SQLExecDirect returns SQL_ERROR, and a diagnostic record is generated with SQLSTATE=HY090 and the message "Invalid string or buffer length for parameter \<p>", where p is the parameter number.</span></span>  
  
5.  <span data-ttu-id="3d0da-180">呼叫 SQLExecute 或 SQLExecDirect。</span><span class="sxs-lookup"><span data-stu-id="3d0da-180">Calls SQLExecute or SQLExecDirect.</span></span>  
  
 <span data-ttu-id="3d0da-181">如果*StrLen_or_IndPtr*設定為 SQL_LEN_DATA_AT_EXEC (*長度*) 或 SQL_DATA_AT_EXEC 資料行，就可以將輸入資料表值參數資料行值傳入片段。</span><span class="sxs-lookup"><span data-stu-id="3d0da-181">Input table-valued parameter column values can be passed in pieces if *StrLen_or_IndPtr* is set to SQL_LEN_DATA_AT_EXEC(*length*) or SQL_DATA_AT_EXEC for the column.</span></span> <span data-ttu-id="3d0da-182">這與使用參數陣列時分段傳遞值一樣。</span><span class="sxs-lookup"><span data-stu-id="3d0da-182">This is similar to passing values in pieces when arrays of parameters are used.</span></span> <span data-ttu-id="3d0da-183">就像所有的資料執行中參數一樣，SQLParamData 並不會指出驅動程式要求資料之陣列的哪一列;應用程式必須負責這項工作。</span><span class="sxs-lookup"><span data-stu-id="3d0da-183">As with all data-at-execution parameters, SQLParamData does not indicate which row of the array the driver is requesting data for; the application must take care of this.</span></span> <span data-ttu-id="3d0da-184">應用程式無法針對驅動程式要求值的順序提出任何假設。</span><span class="sxs-lookup"><span data-stu-id="3d0da-184">The application cannot make any assumptions about the order in which the driver will request values.</span></span>  
  
## <a name="variable-table-valued-parameter-row-binding"></a><span data-ttu-id="3d0da-185">變動資料表值參數資料列繫結</span><span class="sxs-lookup"><span data-stu-id="3d0da-185">Variable Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="3d0da-186">對於變動資料列繫結而言，資料列會在執行階段按照批次傳送，而且應用程式會視需要將資料列傳遞至驅動程式。</span><span class="sxs-lookup"><span data-stu-id="3d0da-186">For variable row binding, rows are transferred in batches at execution time and the application passes rows to the driver on demand.</span></span> <span data-ttu-id="3d0da-187">這與個別參數值的資料執行中一樣。</span><span class="sxs-lookup"><span data-stu-id="3d0da-187">This is similar to data-at-execution for individual parameter values.</span></span> <span data-ttu-id="3d0da-188">應用程式會針對變動資料列繫結，執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="3d0da-188">For variable row binding, the application does the following:</span></span>  
  
1.  <span data-ttu-id="3d0da-189">依照上一節「固定資料表值參數資料列繫結」的步驟 1 到 3 所述，繫結參數和資料表值參數資料行。</span><span class="sxs-lookup"><span data-stu-id="3d0da-189">Binds parameters and table-valued parameter columns as described in steps 1 to 3 of the previous section, "Fixed Table-Valued Parameter Row Binding".</span></span>  
  
2.  <span data-ttu-id="3d0da-190">針對要在執行時間傳遞至 SQL_DATA_AT_EXEC 的任何資料表值參數，設定*StrLen_or_IndPtr*或 SQL_DESC_OCTET_LENGTH_PTR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-190">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR for any table-valued parameters that are to be passed at execution time to SQL_DATA_AT_EXEC.</span></span> <span data-ttu-id="3d0da-191">如果沒有設定任何項目，就會依照上一節所述的方式處理此參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-191">If neither is set, the parameter will be processed as described in the previous section.</span></span>  
  
3.  <span data-ttu-id="3d0da-192">呼叫 SQLExecute 或 SQLExecDirect。</span><span class="sxs-lookup"><span data-stu-id="3d0da-192">Calls SQLExecute or SQLExecDirect.</span></span> <span data-ttu-id="3d0da-193">如果有任何 SQL_PARAM_INPUT 或 SQL_PARAM_INPUT_OUTPUT 參數要當做資料執行中參數處理，這就會傳回 SQL_NEED_DATA。</span><span class="sxs-lookup"><span data-stu-id="3d0da-193">This will return SQL_NEED_DATA if there are any SQL_PARAM_INPUT or SQL_PARAM_INPUT_OUTPUT parameters to be handled as data-at-execution parameters.</span></span> <span data-ttu-id="3d0da-194">在此情況下，應用程式會進行下列作業：</span><span class="sxs-lookup"><span data-stu-id="3d0da-194">In this case, the application does the following:</span></span>  
  
    -   <span data-ttu-id="3d0da-195">呼叫 SQLParamData。</span><span class="sxs-lookup"><span data-stu-id="3d0da-195">Calls SQLParamData.</span></span> <span data-ttu-id="3d0da-196">這會傳回資料執行中參數的*ParameterValuePtr*值，以及 SQL_NEED_DATA 的傳回碼。</span><span class="sxs-lookup"><span data-stu-id="3d0da-196">This returns the *ParameterValuePtr* value for a data-at-execution parameter and a return code of SQL_NEED_DATA.</span></span> <span data-ttu-id="3d0da-197">當所有參數資料都已傳遞至驅動程式時，SQLParamData 會傳回 SQL_SUCCESS、SQL_SUCCESS_WITH_INFO 或 SQL_ERROR。</span><span class="sxs-lookup"><span data-stu-id="3d0da-197">When all parameter data has been passed to the driver, SQLParamData returns SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, or SQL_ERROR.</span></span> <span data-ttu-id="3d0da-198">對於資料執行中參數而言， *ParameterValuePtr*（與描述項欄位 SQL_DESC_DATA_PTR 相同）可視為權杖，以唯一識別需要值的參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-198">For data-at-execution parameters, *ParameterValuePtr*, which is the same as the descriptor field SQL_DESC_DATA_PTR, can be regarded as a token to uniquely identify a parameter for which a value is required.</span></span> <span data-ttu-id="3d0da-199">這個 "Token" 會在繫結階段從應用程式傳遞至驅動程式，然後在執行階段傳回應用程式。</span><span class="sxs-lookup"><span data-stu-id="3d0da-199">This "token" is passed from the application to the driver at bind time, then passed back to the application at execution time.</span></span>  
  
4.  <span data-ttu-id="3d0da-200">若要傳送 null 資料表值參數的資料表值參數資料列資料，如果資料表值參數沒有資料列，應用程式會呼叫 SQLPutData，並將*StrLen_or_Ind*設定為 SQL_DEFAULT_PARAM。</span><span class="sxs-lookup"><span data-stu-id="3d0da-200">To send table-valued parameter row data for null table-valued parameters, if the table-valued parameter has no rows, an application calls SQLPutData with *StrLen_or_Ind* set to SQL_DEFAULT_PARAM.</span></span>  
  
     <span data-ttu-id="3d0da-201">應用程式會針對非 NULL TVP：</span><span class="sxs-lookup"><span data-stu-id="3d0da-201">For non-NULL TVPs, an application:</span></span>  
  
    -   <span data-ttu-id="3d0da-202">將所有資料表值參數資料行的*Str_Len_or_Ind*設定為適當的值，並為不是資料執行中參數的資料表值參數資料行，填入資料緩衝區。</span><span class="sxs-lookup"><span data-stu-id="3d0da-202">Sets *Str_Len_or_Ind* for all the table-valued parameter columns to appropriate values, and populates data buffers for table-valued parameter columns that are not to be data-at-execution parameters.</span></span> <span data-ttu-id="3d0da-203">您可以利用一般參數分段傳遞至驅動程式的相同方式來運用資料表值參數資料行的資料執行中。</span><span class="sxs-lookup"><span data-stu-id="3d0da-203">You can use data-at-execution for table-valued parameter columns in a similar way to that in which ordinary parameters can be passed to the driver in pieces.</span></span>  
  
    -   <span data-ttu-id="3d0da-204">呼叫 SQLPutData， *Str_Len_or_Ind*設定為要傳送至伺服器的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="3d0da-204">Calls SQLPutData with *Str_Len_or_Ind* set to the number of rows to be sent to the server.</span></span> <span data-ttu-id="3d0da-205">超出 0 到 SQL_DESC_ARRAY_SIZE 或 SQL_DEFAULT_PARAM 之範圍以外的任何值都是錯誤，而且將傳回 SQLSTATE HY090 以及「無效的字串或緩衝區長度」訊息。</span><span class="sxs-lookup"><span data-stu-id="3d0da-205">Any value outside the range 0 to SQL_DESC_ARRAY_SIZE or SQL_DEFAULT_PARAM is an error, and will return SQLSTATE HY090, with the message "Invalid string or buffer length".</span></span> <span data-ttu-id="3d0da-206">0 表示已經傳送所有資料列，而且資料表值參數沒有其他資料 (如此清單中第二個項目符號項目所述)。</span><span class="sxs-lookup"><span data-stu-id="3d0da-206">0 indicates that all rows have been sent and there is no more data for a table-valued parameter (as noted in the second bullet item in this list).</span></span> <span data-ttu-id="3d0da-207">只有當驅動程式第一次要求資料表值參數的資料時，才能使用 SQL_DEFAULT_PARAM (如此清單中第一個項目符號項目所述)。</span><span class="sxs-lookup"><span data-stu-id="3d0da-207">SQL_DEFAULT_PARAM can only be used the first time the driver requests data for a table-valued parameter (as described in the first bullet item in this list).</span></span>  
  
5.  <span data-ttu-id="3d0da-208">當所有資料列都已傳送時，會針對*Str_Len_or_Ind*值為0的資料表值參數呼叫 SQLPutData，然後繼續進行上述步驟3a。</span><span class="sxs-lookup"><span data-stu-id="3d0da-208">When all rows have been sent, calls SQLPutData for the table-valued parameter with a *Str_Len_or_Ind* value of 0, then proceeds to step 3a above.</span></span>  
  
6.  <span data-ttu-id="3d0da-209">再次呼叫 SQLParamData。</span><span class="sxs-lookup"><span data-stu-id="3d0da-209">Calls SQLParamData again.</span></span> <span data-ttu-id="3d0da-210">如果資料表值參數資料行之間有任何資料執行中參數，將會以 SQLParamData 傳回的*ValuePtrPtr*值來識別這些參數。</span><span class="sxs-lookup"><span data-stu-id="3d0da-210">If there are any data-at-execution parameters among the table-valued parameter columns, these will be identified by the value *ValuePtrPtr* returned by SQLParamData.</span></span> <span data-ttu-id="3d0da-211">當所有資料行值都可供使用時，SQLParamData 會再次傳回資料表值參數的*ParameterValuePtr*值，應用程式會重新開始。</span><span class="sxs-lookup"><span data-stu-id="3d0da-211">When all column values are available, SQLParamData will again return the *ParameterValuePtr* value for the table-valued parameter, and the application begins again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3d0da-212">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3d0da-212">See Also</span></span>  
 [<span data-ttu-id="3d0da-213">ODBC&#41;&#40;的資料表值參數</span><span class="sxs-lookup"><span data-stu-id="3d0da-213">Table-Valued Parameters &#40;ODBC&#41;</span></span>](table-valued-parameters-odbc.md)  
  
  
