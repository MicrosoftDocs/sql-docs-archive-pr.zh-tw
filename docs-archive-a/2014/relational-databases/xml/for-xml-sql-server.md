---
title: FOR XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87710458"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="3c6fc-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3c6fc-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="3c6fc-103">SELECT 查詢會將結果以資料列集的形式傳回。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="3c6fc-104">在查詢中指定 FOR XML 子句，您就可選擇以 XML 格式擷取 SQL 查詢的正式結果。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="3c6fc-105">FOR XML 子句可以使用在最上層的查詢與子查詢中。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="3c6fc-106">最上層的 FOR XML 子句只能用在 SELECT 陳述式中。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="3c6fc-107">在子查詢中，FOR XML 可以在 INSERT、UPDATE 與 DELETE 陳述式中使用。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="3c6fc-108">它也可用在指派陳述式中。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="3c6fc-109">在 FOR XML 子句中，您可以指定下列其中一個模式：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="3c6fc-110">RAW</span><span class="sxs-lookup"><span data-stu-id="3c6fc-110">RAW</span></span>  
  
-   <span data-ttu-id="3c6fc-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="3c6fc-111">AUTO</span></span>  
  
-   <span data-ttu-id="3c6fc-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="3c6fc-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="3c6fc-113">PATH</span><span class="sxs-lookup"><span data-stu-id="3c6fc-113">PATH</span></span>  
  
 <span data-ttu-id="3c6fc-114">RAW 模式會對資料列集中 SELECT 陳述式傳回的每一個資料列，產生單一 \<row> 元素。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="3c6fc-115">您可以撰寫巢狀 FOR XML 查詢來產生 XML 階層。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="3c6fc-116">AUTO 模式會使用啟發學習法 (根據 SELECT 陳述式的指定方式)，在所產生的 XML 中產生巢狀結構。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="3c6fc-117">您對產生的 XML 之外觀只有最少的控制權。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="3c6fc-118">您可以撰寫巢狀的 FOR XML 查詢，以產生 AUTO 模式啟發學習法所產生之 XML 外觀以外的 XML 階層。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="3c6fc-119">EXPLICIT 模式可讓您對 XML 外觀有更多的控制權。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="3c6fc-120">您在決定 XML 的外觀時，可依照意願混合屬性和元素。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="3c6fc-121">因為查詢執行的關係，產生的結果資料列集需要有特定格式。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="3c6fc-122">這個資料列集格式之後會對應到 XML 外觀。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="3c6fc-123">EXPLICIT 模式的功能是可依照意願混合屬性和元素、建立包裝函數和巢狀的複雜屬性，以及建立以空格分隔的值 (例如，OrderID 屬性可能有順序識別碼值的清單) 和混合的內容。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="3c6fc-124">不過，撰寫 EXPLICIT 模式的查詢比較繁雜。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="3c6fc-125">您可以使用部份新的 FOR XML 功能，例如撰寫巢狀的 FOR XML RAW/AUTO/PATH 模式查詢和 TYPE 指示詞，而不要使用 EXPLICIT 模式來產生階層。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="3c6fc-126">巢狀的 FOR XML 查詢可以產生您使用 EXPLICIT 模式可產生的任何 XML。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="3c6fc-127">如需詳細資訊，請參閱 [使用巢狀 FOR XML 查詢](use-nested-for-xml-queries.md) 和 [在 FOR XML 查詢中的 TYPE 指示詞](type-directive-in-for-xml-queries.md)。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="3c6fc-128">若搭配使用 PATH 模式和巢狀的 FOR XML 查詢功能，則能夠以較簡易的方式提供 EXPLICIT 模式的彈性。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="3c6fc-129">只有在執行設定為這些模式的查詢時，這些模式才有效。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="3c6fc-130">它們並不會影響任何後續查詢的結果。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="3c6fc-131">對於任何搭配 FOR BROWSE 子句使用的選取項目而言，FOR XML 都是無效的。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="3c6fc-132">範例</span><span class="sxs-lookup"><span data-stu-id="3c6fc-132">Example</span></span>  
 <span data-ttu-id="3c6fc-133">下列 `SELECT` 陳述式可從 `Sales.Customer` 資料庫的 `Sales.SalesOrderHeader` 與 `AdventureWorks2012` 資料表擷取資訊。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="3c6fc-134">此查詢在 `AUTO` 子句中指定了 `FOR XML` 模式：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="3c6fc-135">FOR XML 子句和伺服器名稱</span><span class="sxs-lookup"><span data-stu-id="3c6fc-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="3c6fc-136">當包含 FOR XML 子句的 SELECT 陳述式在查詢中指定四部分的名稱時，若在本機電腦上執行查詢，則伺服器名稱並不會在產生的 XML 文件中傳回。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="3c6fc-137">但如果是在網路伺服器上執行查詢，則伺服器名稱會以四個部分的名稱形式傳回。</span><span class="sxs-lookup"><span data-stu-id="3c6fc-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="3c6fc-138">例如，請考量以下的查詢：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="3c6fc-139">若 `ServerName` 是本機伺服器，查詢將會傳回下列結果：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="3c6fc-140">若 `ServerName` 是網路伺服器，查詢將會傳回下列結果：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="3c6fc-141">您可以指定下列別名來避免這種模稜兩可的情況：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="3c6fc-142">此查詢傳回的內容如下：</span><span class="sxs-lookup"><span data-stu-id="3c6fc-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="3c6fc-143">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3c6fc-143">See Also</span></span>  
 <span data-ttu-id="3c6fc-144">[FOR XML 子句的基本語法](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="3c6fc-145">[使用 FOR XML 的 RAW 模式](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="3c6fc-146">[搭配 FOR XML 使用 AUTO 模式](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="3c6fc-147">[搭配 FOR XML 使用 EXPLICIT 模式](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="3c6fc-148">[搭配 FOR XML 使用 PATH 模式](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="3c6fc-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3c6fc-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="3c6fc-150">使用 WITH XMLNAMESPACES 將命名空間加入至查詢</span><span class="sxs-lookup"><span data-stu-id="3c6fc-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
