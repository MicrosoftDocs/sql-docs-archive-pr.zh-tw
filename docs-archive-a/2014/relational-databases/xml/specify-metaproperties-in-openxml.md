---
title: 在 OPENXML 中指定中繼屬性 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- overflow in XML document [SQL Server]
- metaproperties [XML in SQL Server]
- unconsumed data
- extracting information of XML nodes [SQL Server]
- OPENXML statement, metaproperties
ms.assetid: 29bfd1c6-3f9a-43c4-924a-53d438e442f4
author: rothja
ms.author: jroth
ms.openlocfilehash: c52d1162aa495deff8a0fde314fdcde0735d9c2f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87703974"
---
# <a name="specify-metaproperties-in-openxml"></a><span data-ttu-id="b88e7-102">在 OPENXML 中指定中繼屬性</span><span class="sxs-lookup"><span data-stu-id="b88e7-102">Specify Metaproperties in OPENXML</span></span>
  <span data-ttu-id="b88e7-103">XML 文件的中繼屬性 (Metaproperty) 之屬性 (Attribute)，是描述 XML 項目 (例如元素、屬性或任何其他 DOM 節點) 屬性 (Property) 的屬性 (Attribute)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-103">Metaproperty attributes in an XML document are attributes that describe the properties of an XML item, such as element, attribute, or any other DOM node.</span></span> <span data-ttu-id="b88e7-104">這些屬性實際上不存在於 XML 文件文字中。</span><span class="sxs-lookup"><span data-stu-id="b88e7-104">These attributes do not physically exist in the XML document text.</span></span> <span data-ttu-id="b88e7-105">不過，OPENXML 會提供這些中繼屬性給所有的 XML 項目。</span><span class="sxs-lookup"><span data-stu-id="b88e7-105">However, OPENXML provides these metaproperties for all the XML items.</span></span> <span data-ttu-id="b88e7-106">這些中繼屬性可讓您擷取 XML 節點的資訊，例如本機定位和命名空間資訊。</span><span class="sxs-lookup"><span data-stu-id="b88e7-106">These metaproperties allow you to extract information, such as local positioning and namespace information, of XML nodes.</span></span> <span data-ttu-id="b88e7-107">此資訊可提供您所呈現文字以外更詳細的資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-107">This information provides you with more details than are apparent in the textual representation.</span></span>  
  
 <span data-ttu-id="b88e7-108">您可以使用 *ColPattern* 參數，將這些中繼屬性對應至 OPENXML 陳述式的資料列集資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-108">You can map these metaproperties to the rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span> <span data-ttu-id="b88e7-109">這些資料行將會包括其所對應的中繼屬性值。</span><span class="sxs-lookup"><span data-stu-id="b88e7-109">The columns will contain the values of the metaproperties to which they are mapped.</span></span> <span data-ttu-id="b88e7-110">如需 OPENXML 語法的詳細資訊，請參閱 [OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-110">For more information about the syntax of OPENXML, see [OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql).</span></span>  
  
 <span data-ttu-id="b88e7-111">若要存取中繼屬性的屬性，需提供 SQL Server 特定的命名空間。</span><span class="sxs-lookup"><span data-stu-id="b88e7-111">To access the metaproperty attributes, a namespace that is specific to SQL Server is provided.</span></span> <span data-ttu-id="b88e7-112">這個命名空間 **urn:schemas-microsoft-com:xml-metaprop** 可讓使用者存取中繼屬性的屬性。</span><span class="sxs-lookup"><span data-stu-id="b88e7-112">This namespace, **urn:schemas-microsoft-com:xml-metaprop** allows the user to access the metaproperty attributes.</span></span> <span data-ttu-id="b88e7-113">若 OPENXML 查詢的結果是以邊緣資料表格式傳回，每一個中繼屬性的屬性在邊緣資料表中各有一個資料行 ( **xmltext** 中繼屬性除外)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-113">If the result of an OPENXML query is returned in an edge table format, the edge table contains one column for each metaproperty attribute, except the **xmltext** metaproperty.</span></span>  
  
 <span data-ttu-id="b88e7-114">有些中繼屬性的屬性是使用來進行處理。</span><span class="sxs-lookup"><span data-stu-id="b88e7-114">Some of the metaproperty attributes are used for processing purposes.</span></span> <span data-ttu-id="b88e7-115">例如， **xmltext** 中繼屬性的屬性是用來處理溢位。</span><span class="sxs-lookup"><span data-stu-id="b88e7-115">For example, the **xmltext** metaproperty attribute is used for overflow handling.</span></span> <span data-ttu-id="b88e7-116">溢位處理指的是文件中未消耗/未處理的資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-116">Overflow handling refers to the unconsumed, unprocessed data in the document.</span></span> <span data-ttu-id="b88e7-117">由 OPENXML 產生之資料列集的其中一個資料行可識別為溢位資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-117">One of the columns in the rowset that is generated by OPENXML can be identified as the overflow column.</span></span> <span data-ttu-id="b88e7-118">作法是使用 **ColPattern** 參數，將它對應到 *xmltext* 中繼屬性。</span><span class="sxs-lookup"><span data-stu-id="b88e7-118">You do this by mapping it to the **xmltext** metaproperty by using the *ColPattern* parameter.</span></span> <span data-ttu-id="b88e7-119">然後資料行就會接收溢位資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-119">The column then receives the overflow data.</span></span> <span data-ttu-id="b88e7-120">*flags* 參數會判斷資料行是否包含所有資料，或只包含未耗用的資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-120">The *flags* parameter determines whether the column contains everything or only the unconsumed data.</span></span>  
  
 <span data-ttu-id="b88e7-121">以下資料表將列出每個剖析 XML 元素具有的中繼屬性。</span><span class="sxs-lookup"><span data-stu-id="b88e7-121">The following table lists the metaproperty attributes that each parsed XML element possesses.</span></span> <span data-ttu-id="b88e7-122">這些中繼屬性的屬性可使用命名空間 **urn:schemas-microsoft-com:xml-metaprop**加以存取。</span><span class="sxs-lookup"><span data-stu-id="b88e7-122">These metaproperty attributes can be accessed by using the namespace **urn:schemas-microsoft-com:xml-metaprop**.</span></span> <span data-ttu-id="b88e7-123">由使用者利用這些中繼屬性直接在 XML 文件中設定的任何值，將予以忽略。</span><span class="sxs-lookup"><span data-stu-id="b88e7-123">Any value that the user sets directly in the XML document by using these metaproperties is ignored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b88e7-124">您無法在任何 XPath 瀏覽中參考這些中繼屬性。</span><span class="sxs-lookup"><span data-stu-id="b88e7-124">You cannot reference these metaproperties in any XPath navigation.</span></span>  
  
|<span data-ttu-id="b88e7-125">中繼屬性的屬性</span><span class="sxs-lookup"><span data-stu-id="b88e7-125">Metaproperty attribute</span></span>|<span data-ttu-id="b88e7-126">描述</span><span class="sxs-lookup"><span data-stu-id="b88e7-126">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="b88e7-127">**\@mp:id**</span><span class="sxs-lookup"><span data-stu-id="b88e7-127">**\@mp:id**</span></span>|<span data-ttu-id="b88e7-128">提供 DOM 節點的全文件識別碼 (由系統產生)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-128">Provides a system-generated, document-wide identifier of the DOM node.</span></span> <span data-ttu-id="b88e7-129">只要文件未經過重新分析，此識別碼就會參照相同的 XML 節點。</span><span class="sxs-lookup"><span data-stu-id="b88e7-129">As long as the document is not reparsed, this ID refers to the same XML node.</span></span><br /><br /> <span data-ttu-id="b88e7-130">XML 識別碼為 **0** ，表示元素為根元素。</span><span class="sxs-lookup"><span data-stu-id="b88e7-130">An XML ID of **0** indicates that the element is a root element.</span></span> <span data-ttu-id="b88e7-131">其父系 XML 識別碼為 NULL。</span><span class="sxs-lookup"><span data-stu-id="b88e7-131">Its parent XML ID is NULL.</span></span>|  
|<span data-ttu-id="b88e7-132">**\@mp:localname**</span><span class="sxs-lookup"><span data-stu-id="b88e7-132">**\@mp:localname**</span></span>|<span data-ttu-id="b88e7-133">儲存節點名稱的本機部份。</span><span class="sxs-lookup"><span data-stu-id="b88e7-133">Stores the local part of the name of the node.</span></span> <span data-ttu-id="b88e7-134">它會和前置詞及命名空間 URI 一起用來命名元素或屬性節點。</span><span class="sxs-lookup"><span data-stu-id="b88e7-134">It is used with a prefix and a namespace URI to name element or attribute nodes.</span></span>|  
|<span data-ttu-id="b88e7-135">**\@mp:namespaceuri**</span><span class="sxs-lookup"><span data-stu-id="b88e7-135">**\@mp:namespaceuri**</span></span>|<span data-ttu-id="b88e7-136">提供目前元素的命名空間 URI。</span><span class="sxs-lookup"><span data-stu-id="b88e7-136">Provides the namespace URI of the current element.</span></span> <span data-ttu-id="b88e7-137">若此屬性值為 NULL，則沒有命名空間</span><span class="sxs-lookup"><span data-stu-id="b88e7-137">If the value of this attribute is NULL, no namespace is present</span></span>|  
|<span data-ttu-id="b88e7-138">**\@mp:prefix**</span><span class="sxs-lookup"><span data-stu-id="b88e7-138">**\@mp:prefix**</span></span>|<span data-ttu-id="b88e7-139">儲存現行元素名稱的命名空間前置詞。</span><span class="sxs-lookup"><span data-stu-id="b88e7-139">Stores the namespace prefix of the current element name.</span></span><br /><br /> <span data-ttu-id="b88e7-140">若無前置詞 (NULL) 但提供了 URI，表示指定的命名空間是預設命名空間。</span><span class="sxs-lookup"><span data-stu-id="b88e7-140">If no prefix is present (NULL) and a URI is given, it indicates that the specified namespace is the default namespace.</span></span> <span data-ttu-id="b88e7-141">若未提供 URI，則不附加任何命名空間。</span><span class="sxs-lookup"><span data-stu-id="b88e7-141">If no URI is given, no namespace is attached.</span></span>|  
|<span data-ttu-id="b88e7-142">**\@mp:prev**</span><span class="sxs-lookup"><span data-stu-id="b88e7-142">**\@mp:prev**</span></span>|<span data-ttu-id="b88e7-143">儲存相對於節點的前一個同層級。</span><span class="sxs-lookup"><span data-stu-id="b88e7-143">Stores the previous sibling relative to a node.</span></span> <span data-ttu-id="b88e7-144">這提供了文件中元素排序的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="b88e7-144">This provides information about the ordering of elements in the document.</span></span><br /><br /> <span data-ttu-id="b88e7-145">**\@mp:prev** 含有具相同父元素的前一個同層級元素的 XML 識別碼。</span><span class="sxs-lookup"><span data-stu-id="b88e7-145">**\@mp:prev** contains the XML ID of the previous sibling that has the same parent element.</span></span> <span data-ttu-id="b88e7-146">若元素位在同層級元素清單的前端，則 **\@mp:prev** 為 NULL。</span><span class="sxs-lookup"><span data-stu-id="b88e7-146">If an element is at the front of the sibling list, **\@mp:prev** is NULL.</span></span>|  
|<span data-ttu-id="b88e7-147">**\@mp:xmltext**</span><span class="sxs-lookup"><span data-stu-id="b88e7-147">**\@mp:xmltext**</span></span>|<span data-ttu-id="b88e7-148">用來進行處理。</span><span class="sxs-lookup"><span data-stu-id="b88e7-148">Used for processing purposes.</span></span> <span data-ttu-id="b88e7-149">它是元素及其屬性 (還有子元素) 的文字序列化，會用在 OPENXML 的溢位處理。</span><span class="sxs-lookup"><span data-stu-id="b88e7-149">It is the textual serialization of the element and its attributes, and also the subelements, as used in the overflow handling of OPENXML.</span></span>|  
  
 <span data-ttu-id="b88e7-150">下表顯示所提供的其他父屬性，可讓您擷取關於階層的資訊。</span><span class="sxs-lookup"><span data-stu-id="b88e7-150">This table shows the additional parent properties that are provided and which allow you to retrieve information about the hierarchy.</span></span>  
  
|<span data-ttu-id="b88e7-151">父系中繼屬性的屬性</span><span class="sxs-lookup"><span data-stu-id="b88e7-151">Parent metaproperty attribute</span></span>|<span data-ttu-id="b88e7-152">描述</span><span class="sxs-lookup"><span data-stu-id="b88e7-152">Description</span></span>|  
|-----------------------------------|-----------------|  
|<span data-ttu-id="b88e7-153">**\@mp:parentid**</span><span class="sxs-lookup"><span data-stu-id="b88e7-153">**\@mp:parentid**</span></span>|<span data-ttu-id="b88e7-154">對應至 **../\@mp:id**</span><span class="sxs-lookup"><span data-stu-id="b88e7-154">Corresponds to **../\@mp:id**</span></span>|  
|<span data-ttu-id="b88e7-155">**\@mp:parentlocalname**</span><span class="sxs-lookup"><span data-stu-id="b88e7-155">**\@mp:parentlocalname**</span></span>|<span data-ttu-id="b88e7-156">對應至 **../\@mp:localname**</span><span class="sxs-lookup"><span data-stu-id="b88e7-156">Corresponds to **../\@mp:localname**</span></span>|  
|<span data-ttu-id="b88e7-157">**\@mp:parentnamespacerui**</span><span class="sxs-lookup"><span data-stu-id="b88e7-157">**\@mp:parentnamespacerui**</span></span>|<span data-ttu-id="b88e7-158">對應至 **../\@mp:namespaceuri**</span><span class="sxs-lookup"><span data-stu-id="b88e7-158">Corresponds to **../\@mp:namespaceuri**</span></span>|  
|<span data-ttu-id="b88e7-159">**\@mp:parentprefix**</span><span class="sxs-lookup"><span data-stu-id="b88e7-159">**\@mp:parentprefix**</span></span>|<span data-ttu-id="b88e7-160">對應至 **../\@mp:prefix**</span><span class="sxs-lookup"><span data-stu-id="b88e7-160">Corresponds to **../\@mp:prefix**</span></span>|  
  
## <a name="examples"></a><span data-ttu-id="b88e7-161">範例</span><span class="sxs-lookup"><span data-stu-id="b88e7-161">Examples</span></span>  
 <span data-ttu-id="b88e7-162">下列範例說明如何使用 OPENXML 來建立不同的資料列集檢視。</span><span class="sxs-lookup"><span data-stu-id="b88e7-162">The following examples illustrate how OPENXML is used to create different rowset views.</span></span>  
  
### <a name="a-mapping-the-openxml-rowset-columns-to-the-metaproperties"></a><span data-ttu-id="b88e7-163">A.</span><span class="sxs-lookup"><span data-stu-id="b88e7-163">A.</span></span> <span data-ttu-id="b88e7-164">將 OPENXML 資料列集資料行對應至中繼屬性</span><span class="sxs-lookup"><span data-stu-id="b88e7-164">Mapping the OPENXML rowset columns to the metaproperties</span></span>  
 <span data-ttu-id="b88e7-165">此範例使用 OPENXML 來建立範例 XML 文件的資料列集檢視。</span><span class="sxs-lookup"><span data-stu-id="b88e7-165">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="b88e7-166">並特別說明如何利用 *ColPattern* 參數，將各種中繼屬性的屬性，對應到 OPENXML 陳述式的資料列集資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-166">Specifically, it shows how the various metaproperty attributes can be mapped to rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span>  
  
 <span data-ttu-id="b88e7-167">OPENXML 陳述式說明下列各項：</span><span class="sxs-lookup"><span data-stu-id="b88e7-167">The OPENXML statement illustrates the following:</span></span>  
  
-   <span data-ttu-id="b88e7-168">**id** 資料行會對應到 **\@mp:id** 中繼屬性 (metaproperty) 屬性 (attribute)，表示該資料行包含元素的唯一 XML 識別碼 (由系統產生)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-168">The **id** column is mapped to the **\@mp:id** metaproperty attribute and indicates that the column contains the system-generated unique XML ID of the element.</span></span>  
  
-   <span data-ttu-id="b88e7-169">**parent** 資料行會對應到 **\@mp:parentid** ，表示該資料行包含元素父系的 XML 識別碼。</span><span class="sxs-lookup"><span data-stu-id="b88e7-169">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent of the element.</span></span>  
  
-   <span data-ttu-id="b88e7-170">**parentLocalName** 資料行會對應到 **\@mp:parentlocalname** ，表示該資料行包含父系的區域名稱。</span><span class="sxs-lookup"><span data-stu-id="b88e7-170">The **parentLocalName** column is mapped to **\@mp:parentlocalname** and indicates that the column contains the local name of the parent.</span></span>  
  
 <span data-ttu-id="b88e7-171">然後，SELECT 陳述式會傳回 OPENXML 所提供的資料列集：</span><span class="sxs-lookup"><span data-stu-id="b88e7-171">The SELECT statement then returns the rowset that is provided by OPENXML:</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- Sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (id int '@mp:id',   
            oid char(5),   
            date datetime,   
            amount real,   
            parentIDNo int '@mp:parentid',   
            parentLocalName varchar(40) '@mp:parentlocalname')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="b88e7-172">以下是結果：</span><span class="sxs-lookup"><span data-stu-id="b88e7-172">This is the result:</span></span>  
  
```  
id   oid         date                amount    parentIDNo  parentLocalName    
--- ------- ---------------------- ---------- ------------ ---------------  
6    O1    1996-01-20 00:00:00.000     3.5         2        Customer  
10   O2    1997-04-30 00:00:00.000     13.4        2        Customer  
19   O3    1999-07-14 00:00:00.000     100.0       15       Customer  
25   O4    1996-01-20 00:00:00.000     10000.0     15       Customer  
```  
  
### <a name="b-retrieving-the-whole-xml-document"></a><span data-ttu-id="b88e7-173">B.</span><span class="sxs-lookup"><span data-stu-id="b88e7-173">B.</span></span> <span data-ttu-id="b88e7-174">擷取整份 XML 文件</span><span class="sxs-lookup"><span data-stu-id="b88e7-174">Retrieving the whole XML document</span></span>  
 <span data-ttu-id="b88e7-175">在此範例中，會使用 OPENXML 建立範本 XML 文件的單一資料行資料列集檢視。</span><span class="sxs-lookup"><span data-stu-id="b88e7-175">In this example, OPENXML is used to create a one-column rowset view of the sample XML document.</span></span> <span data-ttu-id="b88e7-176">此資料行 **Col1**會對應到 **xmltext** 中繼屬性，而成為溢位資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-176">This column, **Col1**, is mapped to the **xmltext** metaproperty and becomes an overflow column.</span></span> <span data-ttu-id="b88e7-177">所以，此資料行將接收未耗用的資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-177">As a result, the column receives the unconsumed data.</span></span> <span data-ttu-id="b88e7-178">在此案例中，就是指整份文件。</span><span class="sxs-lookup"><span data-stu-id="b88e7-178">In this case, it is the whole document.</span></span>  
  
 <span data-ttu-id="b88e7-179">然後 SELECT 陳述式會傳回完整的資料列集。</span><span class="sxs-lookup"><span data-stu-id="b88e7-179">The SELECT statement then returns the complete rowset.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
SET @doc = N'<?xml version="1.0"?>  
<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very   
             satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue   
             white red">  
     <MyTag>Testing to see if all the subelements are returned</MyTag>  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/')  
   WITH (Col1 ntext '@mp:xmltext')  
```  
  
 <span data-ttu-id="b88e7-180">若要擷取整份文件，但不要 XML 宣告，則可將查詢指定為如下所示：</span><span class="sxs-lookup"><span data-stu-id="b88e7-180">To retrieve the whole document without the XML declaration, the query can be specified as shown in the following:</span></span>  
  
```  
SELECT *  
FROM OPENXML (@idoc, '/root')  
   WITH (Col1 ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="b88e7-181">查詢將傳回含有 root 名稱的根元素，以及根元素所包含的資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-181">The query returns the root element that has the name root and the data that is contained by the root element</span></span>  
  
### <a name="c-specifying-the-xmltext-metaproperty-to-retrieve-the-unconsumed-data-in-a-column"></a><span data-ttu-id="b88e7-182">C.</span><span class="sxs-lookup"><span data-stu-id="b88e7-182">C.</span></span> <span data-ttu-id="b88e7-183">指定 xmltext 中繼屬性來擷取資料行中未耗用的資料</span><span class="sxs-lookup"><span data-stu-id="b88e7-183">Specifying the xmltext metaproperty to retrieve the unconsumed data in a column</span></span>  
 <span data-ttu-id="b88e7-184">此範例使用 OPENXML 來建立範例 XML 文件的資料列集檢視。</span><span class="sxs-lookup"><span data-stu-id="b88e7-184">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="b88e7-185">範例中將說明如何將 **xmltext** 中繼屬性的屬性對應到 OPENXML 中的資料列集資料行，以擷取未消耗的 XML 資料。</span><span class="sxs-lookup"><span data-stu-id="b88e7-185">The example shows how to retrieve unconsumed XML data by mapping the **xmltext** metaproperty attribute to a rowset column in OPENXML.</span></span>  
  
 <span data-ttu-id="b88e7-186">**comment** 資料行藉由對應到 **\@mp:xmltext** 中繼屬性，而被識別為溢位資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-186">The **comment** column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span> <span data-ttu-id="b88e7-187">*flags* 參數是設為 **9** (XML_ATTRIBUTE 和 XML_NOCOPY)。</span><span class="sxs-lookup"><span data-stu-id="b88e7-187">The *flags* parameter is set to **9** (XML_ATTRIBUTE and XML_NOCOPY).</span></span> <span data-ttu-id="b88e7-188">這表示 **屬性中心** 對應，並表示只有未耗用的資料才要複製到溢位資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-188">This indicates **attribute-centric** mapping and indicates that only the unconsumed data should be copied to the overflow column.</span></span>  
  
 <span data-ttu-id="b88e7-189">然後 SELECT 陳述式將傳回由 OPENXML 所提供的資料列集。</span><span class="sxs-lookup"><span data-stu-id="b88e7-189">The SELECT statement then returns the rowset provided by OPENXML.</span></span>  
  
 <span data-ttu-id="b88e7-190">在此範例中， **\@mp:parentlocalname** 中繼屬性是針對 OPENXML 所產生資料列集的資料行 **ParentLocalName** 來設定的。</span><span class="sxs-lookup"><span data-stu-id="b88e7-190">In this example, the **\@mp:parentlocalname** metaproperty is set for a column, **ParentLocalName**, in the rowset generated by OPENXML.</span></span> <span data-ttu-id="b88e7-191">因此，此資料行含有父元素的本機名稱。</span><span class="sxs-lookup"><span data-stu-id="b88e7-191">As a result, this column contains the local name of the parent element.</span></span>  
  
 <span data-ttu-id="b88e7-192">資料列集內還指定了另外兩個資料行： **parent** 及 **comment**。</span><span class="sxs-lookup"><span data-stu-id="b88e7-192">Two additional columns are specified in the rowset, **parent** and **comment**.</span></span> <span data-ttu-id="b88e7-193">**parent** 資料行會對應到 **\@mp:parentid** ，表示該資料行包含元素之父元素的 XML 識別碼。</span><span class="sxs-lookup"><span data-stu-id="b88e7-193">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent element of the element.</span></span> <span data-ttu-id="b88e7-194">comment 資料行藉由對應到 **\@mp:xmltext** 中繼屬性，而被識別為溢位資料行。</span><span class="sxs-lookup"><span data-stu-id="b88e7-194">The comment column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>  
'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (oid char(5),   
            date datetime,  
            comment ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="b88e7-195">以下是結果。</span><span class="sxs-lookup"><span data-stu-id="b88e7-195">This is the result.</span></span> <span data-ttu-id="b88e7-196">由於已耗用 oid 資料行及 date 資料行，因此它們沒有出現在溢位資料行中。</span><span class="sxs-lookup"><span data-stu-id="b88e7-196">Because the oid columns and date columns are already consumed, they do not appear in the overflow column.</span></span>  
  
```  
oid   date                        comment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
----- --------------------------- ----------------------------------------  
O1    1996-01-20 00:00:00.000     <Order amount="3.5"/>  
O2    1997-04-30 00:00:00.000     <Order amount="13.4">Customer was very   
                                   satisfied</Order>  
O3    1999-07-14 00:00:00.000     <Order amount="100" note="Wrap it blue   
                                   white red"><Urgency>   
                                   Important</Urgency></Order>  
O4    1996-01-20 00:00:00.000     <Order amount="10000"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="b88e7-197">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b88e7-197">See Also</span></span>  
 <span data-ttu-id="b88e7-198">[OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="b88e7-198">[OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql) </span></span>  
 [<span data-ttu-id="b88e7-199">OPENXML &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b88e7-199">OPENXML &#40;SQL Server&#41;</span></span>](../xml/openxml-sql-server.md)  
  
  
