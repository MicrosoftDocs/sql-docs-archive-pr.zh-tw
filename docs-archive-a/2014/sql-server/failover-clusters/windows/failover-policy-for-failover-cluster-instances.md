---
title: 容錯移轉叢集執行個體的容錯移轉原則 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- flexible failover policy
ms.assetid: 39ceaac5-42fa-4b5d-bfb6-54403d7f0dc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8d441e5627280cb46168d9ff187d7f43da8b26a6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595566"
---
# <a name="failover-policy-for-failover-cluster-instances"></a><span data-ttu-id="b9532-102">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="b9532-102">Failover Policy for Failover Cluster Instances</span></span>
  <span data-ttu-id="b9532-103">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體 (FCI) 中，一個給定時間只能有一個節點可以擁有 Windows Server 容錯移轉叢集 (WSFC) 叢集資源群組。</span><span class="sxs-lookup"><span data-stu-id="b9532-103">In a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI), only one node can own the Windows Server Failover Cluster (WSFC) cluster resource group at a given time.</span></span> <span data-ttu-id="b9532-104">用戶端要求都是透過 FCI 中的此節點提供服務。</span><span class="sxs-lookup"><span data-stu-id="b9532-104">The client requests are served through this node in the FCI.</span></span> <span data-ttu-id="b9532-105">萬一發生失敗而且重新啟動不成功，群組擁有權會移至 FCI 中的另一個 WSFC 節點。</span><span class="sxs-lookup"><span data-stu-id="b9532-105">In the case of a failure and an unsuccessful restart, the group ownership is moved to another WSFC node in the FCI.</span></span> <span data-ttu-id="b9532-106">這項程序就稱為容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b9532-106">This process is called failover.</span></span> [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] <span data-ttu-id="b9532-107">提高失敗偵測的可靠性，並提供靈活的容錯移轉原則。</span><span class="sxs-lookup"><span data-stu-id="b9532-107">increases the reliability of failure detection and provides a flexible failover policy.</span></span>  
  
 <span data-ttu-id="b9532-108">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI 仰賴基礎 WSFC 服務進行容錯移轉偵測。</span><span class="sxs-lookup"><span data-stu-id="b9532-108">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI depends on the underlying WSFC service for failover detection.</span></span> <span data-ttu-id="b9532-109">因此，兩個機制決定 FCI 的容錯移轉行為：一是原生 WSFC 功能，二是 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 安裝程式所加入的功能。</span><span class="sxs-lookup"><span data-stu-id="b9532-109">Therefore, two mechanisms determine the failover behavior for FCI: the former is native WSFC functionality, and the latter is functionality added by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup.</span></span>  
  
-   <span data-ttu-id="b9532-110">WSFC 叢集維護仲裁設定，以確保自動容錯移轉中的唯一容錯移轉目標。</span><span class="sxs-lookup"><span data-stu-id="b9532-110">The WSFC cluster maintains the quorum configuration, which ensures a unique failover target in an automatic failover.</span></span> <span data-ttu-id="b9532-111">WSFC 服務決定叢集是否一直保持最佳的仲裁健全狀況，並且據以使資源群組上線和離線。</span><span class="sxs-lookup"><span data-stu-id="b9532-111">The WSFC service determines whether the cluster is in optimal quorum health at all times and brings the resource group online and offline accordingly.</span></span>  
  
-   <span data-ttu-id="b9532-112">使用中的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體會透過專用連接，定期向 WSFC 資源群組回報一組元件診斷。</span><span class="sxs-lookup"><span data-stu-id="b9532-112">The active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance periodically reports a set of component diagnostics to the WSFC resource group over a dedicated connection.</span></span> <span data-ttu-id="b9532-113">WSFC 資源群組維護容錯移轉原則，此原則會定義觸發重新啟動和容錯移轉的失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="b9532-113">The WSFC resource group maintains the failover policy, which defines the failure conditions that trigger restarts and failovers.</span></span>  
  
 <span data-ttu-id="b9532-114">此主題討論上面的第二個機制。</span><span class="sxs-lookup"><span data-stu-id="b9532-114">This topic discusses the second mechanism above.</span></span> <span data-ttu-id="b9532-115">如需 WSFC 仲裁組態和健全狀況偵測行為的詳細資訊，請參閱 [WSFC 仲裁模式和投票組態 &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="b9532-115">For more information on the WSFC behavior for quorum configuration and health detection, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b9532-116">AlwaysOn 可用性群組不允許 FCI 來回自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b9532-116">Automatic failovers to and from an FCI are not allowed in an AlwaysOn availability group.</span></span> <span data-ttu-id="b9532-117">不過，AlwaysOn 可用性群組允許 FCI 來回手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b9532-117">However, manual failovers to and from and FCI are allowed in an AlwaysOn availability group.</span></span>  
  
##  <a name="failover-policy-overview"></a><a name="Concepts"></a> <span data-ttu-id="b9532-118">容錯移轉原則概觀</span><span class="sxs-lookup"><span data-stu-id="b9532-118">Failover Policy Overview</span></span>  
 <span data-ttu-id="b9532-119">容錯移轉程序可以分為下列步驟：</span><span class="sxs-lookup"><span data-stu-id="b9532-119">The failover process can be broken down into the following steps:</span></span>  
  
1.  [<span data-ttu-id="b9532-120">監視健全狀態</span><span class="sxs-lookup"><span data-stu-id="b9532-120">Monitor the Health Status</span></span>](failover-policy-for-failover-cluster-instances.md#monitor)  
  
2.  [<span data-ttu-id="b9532-121">判斷失敗</span><span class="sxs-lookup"><span data-stu-id="b9532-121">Determining Failures</span></span>](failover-policy-for-failover-cluster-instances.md#determine)  
  
3.  [<span data-ttu-id="b9532-122">回應失敗</span><span class="sxs-lookup"><span data-stu-id="b9532-122">Responding to Failures</span></span>](failover-policy-for-failover-cluster-instances.md#respond)  
  
###  <a name="monitor-the-health-status"></a><a name="monitor"></a><span data-ttu-id="b9532-123">監視健全狀況狀態</span><span class="sxs-lookup"><span data-stu-id="b9532-123">Monitor the Health Status</span></span>  
 <span data-ttu-id="b9532-124">對 FCI 三種類型的健全狀態進行監視：</span><span class="sxs-lookup"><span data-stu-id="b9532-124">There are three types of health statuses that are monitored for the FCI:</span></span>  
  
-   [<span data-ttu-id="b9532-125">SQL Server 服務的狀態</span><span class="sxs-lookup"><span data-stu-id="b9532-125">State of the SQL Server service</span></span>](failover-policy-for-failover-cluster-instances.md#service)  
  
-   [<span data-ttu-id="b9532-126">SQL Server 執行個體的回應性</span><span class="sxs-lookup"><span data-stu-id="b9532-126">Responsiveness of the SQL Server instance</span></span>](failover-policy-for-failover-cluster-instances.md#instance)  
  
-   [<span data-ttu-id="b9532-127">SQL Server 元件診斷</span><span class="sxs-lookup"><span data-stu-id="b9532-127">SQL Server component diagnostics</span></span>](failover-policy-for-failover-cluster-instances.md#component)  
  
####  <a name="state-of-the-sql-server-service"></a><a name="service"></a><span data-ttu-id="b9532-128">SQL Server 服務的狀態</span><span class="sxs-lookup"><span data-stu-id="b9532-128">State of the SQL Server service</span></span>  
 <span data-ttu-id="b9532-129">WSFC 服務會監視使用中 FCI 節點上 SQL Server 服務的啟動狀態，以偵測 SQL Server 服務停止的情況。</span><span class="sxs-lookup"><span data-stu-id="b9532-129">The WSFC service monitors the start state of the SQL Server service on the active FCI node to detect when the SQL Server service is stopped.</span></span>  
  
####  <a name="responsiveness-of-the-sql-server-instance"></a><a name="instance"></a><span data-ttu-id="b9532-130">SQL Server 實例的回應性</span><span class="sxs-lookup"><span data-stu-id="b9532-130">Responsiveness of the SQL Server instance</span></span>  
 <span data-ttu-id="b9532-131">在 SQL Server 啟動期間，WSFC 服務會使用 SQL Server Database Engine 資源 DLL，以獨佔模式用於監視健全狀態的不同執行緒上建立新的連接。</span><span class="sxs-lookup"><span data-stu-id="b9532-131">During SQL Server startup, the WSFC service uses the SQL Server Database Engine resource DLL to create a new connection to on a separate thread that is used exclusively for monitoring the health status.</span></span> <span data-ttu-id="b9532-132">這可以確保 SQL 執行個體在負載下有必要資源可報告其健全狀態。</span><span class="sxs-lookup"><span data-stu-id="b9532-132">This ensures that there the SQL instance has the required resources to report its health status while under load.</span></span> <span data-ttu-id="b9532-133">SQL Server 會使用這個專用連線，以重複模式執行 [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) 系統預存程序，定期向資源 DLL 回報 SQL Server 元件的健全狀態。</span><span class="sxs-lookup"><span data-stu-id="b9532-133">Using this dedicated connection, SQL Server runs the [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) system stored procedure in repeat mode to periodically report the health status of the SQL Server components to the resource DLL.</span></span>  
  
 <span data-ttu-id="b9532-134">資源 DLL 使用健全狀況檢查逾時來判斷 SQL 執行個體的回應性。</span><span class="sxs-lookup"><span data-stu-id="b9532-134">The resource DLL determines the responsiveness of the SQL instance using a health check timeout.</span></span> <span data-ttu-id="b9532-135">HealthCheckTimeout 屬性會定義資源 DLL 應該等候 sp_server_diagnostics 預存程序的時間，以便在超過該時間後，向 WSFC 服務回報 SQL 執行個體沒有回應。</span><span class="sxs-lookup"><span data-stu-id="b9532-135">The HealthCheckTimeout property defines how long the resource DLL should wait for the sp_server_diagnostics stored procedure before it reports the SQL instance as unresponsive to the WSFC service.</span></span> <span data-ttu-id="b9532-136">此屬性可透過使用 T-SQL 和容錯移轉叢集管理員嵌入式管理單元進行設定。</span><span class="sxs-lookup"><span data-stu-id="b9532-136">This property is configurable using T-SQL as well as in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="b9532-137">如需詳細資訊，請參閱＜ [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md)＞。</span><span class="sxs-lookup"><span data-stu-id="b9532-137">For more information, see [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md).</span></span> <span data-ttu-id="b9532-138">下列項目會描述此屬性會如何影響逾時和重複間隔設定：</span><span class="sxs-lookup"><span data-stu-id="b9532-138">The following items describe how this property affects timeout and repeat interval settings:</span></span>  
  
-   <span data-ttu-id="b9532-139">資源 DLL 會呼叫 sp_server_diagnostics 預存程序，並將重複間隔設定為 HealthCheckTimeout 設定的三分之一。</span><span class="sxs-lookup"><span data-stu-id="b9532-139">The resource DLL calls the sp_server_diagnostics stored procedure and sets the repeat interval to one-third of the HealthCheckTimeout setting.</span></span>  
  
-   <span data-ttu-id="b9532-140">如果 sp_server_diagnostics 預存程序變慢，或未傳回資訊，資源 DLL 會等待 HealthCheckTimeout 所指定的間隔，才向 WSFC 服務回報 SQL 執行個體沒有回應。</span><span class="sxs-lookup"><span data-stu-id="b9532-140">If the sp_server_diagnostics stored procedure is slow or is not returning information, the resource DLL will wait for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
-   <span data-ttu-id="b9532-141">如果專用連接中斷，資源 DLL 會在 HealthCheckTimeout 所指定的間隔內重試連接到 SQL 執行個體，才向 WSFC 服務回報 SQL 執行個體沒有回應。</span><span class="sxs-lookup"><span data-stu-id="b9532-141">If the dedicated connection is lost, the resource DLL will retry the connection to the SQL instance for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
####  <a name="sql-server-component-diagnostics"></a><a name="component"></a><span data-ttu-id="b9532-142">SQL Server 元件診斷</span><span class="sxs-lookup"><span data-stu-id="b9532-142">SQL Server component diagnostics</span></span>  
 <span data-ttu-id="b9532-143">系統預存程序 sp_server_diagnostics 會定期收集 SQL 執行個體上的元件診斷。</span><span class="sxs-lookup"><span data-stu-id="b9532-143">The system stored procedure sp_server_diagnostics periodically collects component diagnostics on the SQL instance.</span></span> <span data-ttu-id="b9532-144">收集到的診斷資訊會在下列每一個元件中顯示為一個資料列，並傳遞給呼叫執行緒。</span><span class="sxs-lookup"><span data-stu-id="b9532-144">The diagnostic information that is collected is surfaced as a row for each of the following components and passed to the calling thread.</span></span>  
  
1.  <span data-ttu-id="b9532-145">系統</span><span class="sxs-lookup"><span data-stu-id="b9532-145">system</span></span>  
  
2.  <span data-ttu-id="b9532-146">resource</span><span class="sxs-lookup"><span data-stu-id="b9532-146">resource</span></span>  
  
3.  <span data-ttu-id="b9532-147">查詢處理序</span><span class="sxs-lookup"><span data-stu-id="b9532-147">query process</span></span>  
  
4.  <span data-ttu-id="b9532-148">io_subsystem</span><span class="sxs-lookup"><span data-stu-id="b9532-148">io_subsystem</span></span>  
  
5.  <span data-ttu-id="b9532-149">活動</span><span class="sxs-lookup"><span data-stu-id="b9532-149">events</span></span>  
  
 <span data-ttu-id="b9532-150">系統、資源和查詢處理序元件會用於失敗偵測。</span><span class="sxs-lookup"><span data-stu-id="b9532-150">The system, resource, and query process components are used for failure detection.</span></span> <span data-ttu-id="b9532-151">io_subsytem 和事件元件只會用於診斷用途。</span><span class="sxs-lookup"><span data-stu-id="b9532-151">The io_subsytem and events components are used for diagnostic purposes only.</span></span>  
  
 <span data-ttu-id="b9532-152">每個資訊的資料列集也會寫入至 SQL Server 叢集診斷記錄檔。</span><span class="sxs-lookup"><span data-stu-id="b9532-152">Each rowset of information is also written to the SQL Server cluster diagnostics log.</span></span> <span data-ttu-id="b9532-153">如需詳細資訊，請參閱 [檢視及閱讀容錯移轉叢集執行個體診斷記錄檔](view-and-read-failover-cluster-instance-diagnostics-log.md)。</span><span class="sxs-lookup"><span data-stu-id="b9532-153">For more information, see [View and Read Failover Cluster Instance Diagnostics Log](view-and-read-failover-cluster-instance-diagnostics-log.md).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="b9532-154">sp_server_diagnostic 預存程序可供 SQL Server AlwaysOn 技術使用，它也可供任何 SQL Server 執行個體用於偵測問題及疑難排解。</span><span class="sxs-lookup"><span data-stu-id="b9532-154">While the sp_server_diagnostic stored procedure is used by SQL Server AlwaysOn technology, it is available for use in any SQL Server instance to help detect and troubleshoot problems.</span></span>  
  
####  <a name="determining-failures"></a><a name="determine"></a> <span data-ttu-id="b9532-155">判斷失敗</span><span class="sxs-lookup"><span data-stu-id="b9532-155">Determining Failures</span></span>  
 <span data-ttu-id="b9532-156">SQL Server Database Engine 資源 DLL 會使用 FailureConditionLevel 屬性，判斷偵測到的健全狀態是否為失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="b9532-156">The SQL Server Database Engine resource DLL determines whether the detected health status is a condition for failure using the FailureConditionLevel property.</span></span> <span data-ttu-id="b9532-157">FailureConditionLevel 屬性定義了哪些偵測到的健全狀態導致重新啟動或容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b9532-157">The FailureConditionLevel property defines which detected health statuses cause restarts or failovers.</span></span> <span data-ttu-id="b9532-158">多個選項等級可供使用，包括沒有自動重新啟動或容錯移轉，以及導致自動重新啟動或容錯移轉的所有可能失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="b9532-158">Multiple levels of options are available, ranging from no automatic restart or failover to all possible failure conditions resulting in an automatic restart or failover.</span></span> <span data-ttu-id="b9532-159">如需有關如何設定這個屬性的詳細資訊，請參閱＜ [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md)＞。</span><span class="sxs-lookup"><span data-stu-id="b9532-159">For more information about how to configure this property, see [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md).</span></span>  
  
 <span data-ttu-id="b9532-160">失敗狀況會設定為遞增等級。</span><span class="sxs-lookup"><span data-stu-id="b9532-160">The failure conditions are set on an increasing scale.</span></span> <span data-ttu-id="b9532-161">對於等級 1-5，每個等級都包含來自上一個等級的所有狀況，並加上自身的狀況。</span><span class="sxs-lookup"><span data-stu-id="b9532-161">For levels 1-5, each level includes all the conditions from the previous levels in addition to its own conditions.</span></span> <span data-ttu-id="b9532-162">這表示，每個等級都具有更高的容錯移轉或重新啟動可能性。</span><span class="sxs-lookup"><span data-stu-id="b9532-162">This means that with each level, there is an increased probability of a failover or restart.</span></span> <span data-ttu-id="b9532-163">下表描述的是失敗狀況等級。</span><span class="sxs-lookup"><span data-stu-id="b9532-163">The failure condition levels are described in the following table.</span></span>  
  
 <span data-ttu-id="b9532-164">請檢閱 [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql)，此系統預存程序在失敗狀況層級扮演重要角色。</span><span class="sxs-lookup"><span data-stu-id="b9532-164">Review [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) as this system stored procedure plays in important role in the failure condition levels.</span></span>  
  
|<span data-ttu-id="b9532-165">層級</span><span class="sxs-lookup"><span data-stu-id="b9532-165">Level</span></span>|<span data-ttu-id="b9532-166">條件</span><span class="sxs-lookup"><span data-stu-id="b9532-166">Condition</span></span>|<span data-ttu-id="b9532-167">描述</span><span class="sxs-lookup"><span data-stu-id="b9532-167">Description</span></span>|  
|-----------|---------------|-----------------|  
|<span data-ttu-id="b9532-168">0</span><span class="sxs-lookup"><span data-stu-id="b9532-168">0</span></span>|<span data-ttu-id="b9532-169">沒有自動的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-169">No automatic failover or restart</span></span>|<span data-ttu-id="b9532-170">指出任何失敗狀況都不會自動觸發容錯移轉或重新啟動。</span><span class="sxs-lookup"><span data-stu-id="b9532-170">Indicates that no failover or restart will be triggered automatically on any failure conditions.</span></span> <span data-ttu-id="b9532-171">這個等級只會用於系統維護的用途。</span><span class="sxs-lookup"><span data-stu-id="b9532-171">This level is for system maintenance purposes only.</span></span>|  
|<span data-ttu-id="b9532-172">1</span><span class="sxs-lookup"><span data-stu-id="b9532-172">1</span></span>|<span data-ttu-id="b9532-173">伺服器關閉的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-173">Failover or restart on server down</span></span>|<span data-ttu-id="b9532-174">表示伺服器重新啟動或容錯移轉會在引發下列狀況時觸發：</span><span class="sxs-lookup"><span data-stu-id="b9532-174">Indicates that a server restart or failover will be triggered if the following condition is raised:</span></span><br /><br /> <span data-ttu-id="b9532-175">SQL Server 服務已關閉。</span><span class="sxs-lookup"><span data-stu-id="b9532-175">SQL Server service is down.</span></span>|  
|<span data-ttu-id="b9532-176">2</span><span class="sxs-lookup"><span data-stu-id="b9532-176">2</span></span>|<span data-ttu-id="b9532-177">伺服器無回應的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-177">Failover or restart on server unresponsive</span></span>|<span data-ttu-id="b9532-178">表示伺服器重新啟動或容錯移轉會在引發下列任何一個狀況時觸發：</span><span class="sxs-lookup"><span data-stu-id="b9532-178">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b9532-179">SQL Server 服務已關閉。</span><span class="sxs-lookup"><span data-stu-id="b9532-179">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b9532-180">SQL Server 執行個體沒有回應 (資源 DLL 無法在 HealthCheckTimeout 設定內接收來自 sp_server_diagnostics 的資料)。</span><span class="sxs-lookup"><span data-stu-id="b9532-180">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span>|  
|<span data-ttu-id="b9532-181">3\*</span><span class="sxs-lookup"><span data-stu-id="b9532-181">3\*</span></span>|<span data-ttu-id="b9532-182">發生重大伺服器錯誤的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-182">Failover or restart on critical server errors</span></span>|<span data-ttu-id="b9532-183">表示伺服器重新啟動或容錯移轉會在引發下列任何一個狀況時觸發：</span><span class="sxs-lookup"><span data-stu-id="b9532-183">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b9532-184">SQL Server 服務已關閉。</span><span class="sxs-lookup"><span data-stu-id="b9532-184">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b9532-185">SQL Server 執行個體沒有回應 (資源 DLL 無法在 HealthCheckTimeout 設定內接收來自 sp_server_diagnostics 的資料)。</span><span class="sxs-lookup"><span data-stu-id="b9532-185">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b9532-186">系統預存程序 sp_server_diagnostics 傳回「系統錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-186">System stored procedure sp_server_diagnostics returns 'system error'.</span></span>|  
|<span data-ttu-id="b9532-187">4</span><span class="sxs-lookup"><span data-stu-id="b9532-187">4</span></span>|<span data-ttu-id="b9532-188">發生一般伺服器錯誤的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-188">Failover or restart on moderate server errors</span></span>|<span data-ttu-id="b9532-189">表示伺服器重新啟動或容錯移轉會在引發下列任何一個狀況時觸發：</span><span class="sxs-lookup"><span data-stu-id="b9532-189">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b9532-190">SQL Server 服務已關閉。</span><span class="sxs-lookup"><span data-stu-id="b9532-190">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b9532-191">SQL Server 執行個體沒有回應 (資源 DLL 無法在 HealthCheckTimeout 設定內接收來自 sp_server_diagnostics 的資料)。</span><span class="sxs-lookup"><span data-stu-id="b9532-191">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b9532-192">系統預存程序 sp_server_diagnostics 傳回「系統錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-192">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="b9532-193">系統預存程序 sp_server_diagnostics 傳回「資源錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-193">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span>|  
|<span data-ttu-id="b9532-194">5</span><span class="sxs-lookup"><span data-stu-id="b9532-194">5</span></span>|<span data-ttu-id="b9532-195">任何合格失敗狀況的容錯移轉或重新啟動</span><span class="sxs-lookup"><span data-stu-id="b9532-195">Failover or restart on any qualified failure conditions</span></span>|<span data-ttu-id="b9532-196">表示伺服器重新啟動或容錯移轉會在引發下列任何一個狀況時觸發：</span><span class="sxs-lookup"><span data-stu-id="b9532-196">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b9532-197">SQL Server 服務已關閉。</span><span class="sxs-lookup"><span data-stu-id="b9532-197">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b9532-198">SQL Server 執行個體沒有回應 (資源 DLL 無法在 HealthCheckTimeout 設定內接收來自 sp_server_diagnostics 的資料)。</span><span class="sxs-lookup"><span data-stu-id="b9532-198">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b9532-199">系統預存程序 sp_server_diagnostics 傳回「系統錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-199">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="b9532-200">系統預存程序 sp_server_diagnostics 傳回「資源錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-200">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span><br /><br /> <span data-ttu-id="b9532-201">系統預存程序 sp_server_diagnostics 傳回「query_processing 錯誤」。</span><span class="sxs-lookup"><span data-stu-id="b9532-201">System stored procedure sp_server_diagnostics returns 'query_processing error'.</span></span>|  
  
 <span data-ttu-id="b9532-202">\*預設值</span><span class="sxs-lookup"><span data-stu-id="b9532-202">\*Default Value</span></span>  
  
####  <a name="responding-to-failures"></a><a name="respond"></a><span data-ttu-id="b9532-203">回應失敗</span><span class="sxs-lookup"><span data-stu-id="b9532-203">Responding to Failures</span></span>  
 <span data-ttu-id="b9532-204">在偵測到一個或多個失敗狀況後，WSFC 服務回應失敗的方式取決於 WSFC 仲裁狀態以及 FCI 資源群組的重新啟動和容錯移轉設定。</span><span class="sxs-lookup"><span data-stu-id="b9532-204">After one or more failure conditions are detected, how the WSFC service responds to the failures depends on the WSFC quorum state and the restart and failover settings of the FCI resource group.</span></span> <span data-ttu-id="b9532-205">如果 FCI 已經失去其 WSFC 仲裁，整個 FCI 就會離線，而且 FCI 已經失去其高可用性。</span><span class="sxs-lookup"><span data-stu-id="b9532-205">If the FCI has lost its WSFC quorum, then the entire FCI is brought offline and the FCI has lost its high availability.</span></span> <span data-ttu-id="b9532-206">如果 FCI 仍然保留其 WSFC 仲裁，WSFC 服務的回應方式可能會先嘗試重新啟動失敗的節點，如果重新啟動嘗試不成功則容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b9532-206">If the FCI still retains its WSFC quorum, then the WSFC service may respond by first attempting to restart the failed node and then failover if the restart attempts are unsuccessful.</span></span> <span data-ttu-id="b9532-207">重新啟動和容錯移轉設定是在容錯移轉叢集管理員嵌入式管理單元中進行設定。</span><span class="sxs-lookup"><span data-stu-id="b9532-207">The restart and failover settings are configured in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="b9532-208">如需這些設定的詳細資訊，請參閱[ \<Resource> 屬性：原則](https://technet.microsoft.com/library/cc725685.aspx)索引標籤。</span><span class="sxs-lookup"><span data-stu-id="b9532-208">For more information these settings, see [\<Resource> Properties: Policies Tab](https://technet.microsoft.com/library/cc725685.aspx).</span></span>  
  
 <span data-ttu-id="b9532-209">如需維護仲裁健全狀況的詳細資訊，請參閱 [WSFC 仲裁模式和投票組態 &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="b9532-209">For more information on maintaining quorum health, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b9532-210">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b9532-210">See Also</span></span>  
 [<span data-ttu-id="b9532-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b9532-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
