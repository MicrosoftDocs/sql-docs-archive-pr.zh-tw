---
title: AlwaysOn 容錯移轉叢集執行個體 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- high availability [SQL Server], failover clustering
- virtual servers [SQL Server], about virtual servers
- clusters [SQL Server]
- servers [SQL Server], failover clustering
- resource groups [SQL Server]
- availability [SQL Server]
- failover clustering [SQL Server]
- AlwaysOn [SQL Server], see failover clustering [SQL Server]
ms.assetid: 86a15b33-4d03-4549-8ea2-b45e4f1baad7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6adc173560fd83d00616eb00c63651ef667c2a00
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595577"
---
# <a name="always-on-failover-cluster-instances-sql-server"></a><span data-ttu-id="d5775-102">AlwaysOn 容錯移轉叢集執行個體 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d5775-102">Always On Failover Cluster Instances (SQL Server)</span></span>
  <span data-ttu-id="d5775-103">作為 Always On 供應專案的一部分 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，Always On 容錯移轉叢集實例會利用 Windows Server 容錯移轉叢集 (WSFC) 功能，透過伺服器實例層級的冗余來提供本機高可用性-*容錯移轉叢集實例* (FCI) 。</span><span class="sxs-lookup"><span data-stu-id="d5775-103">As part of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Always On offering, Always On Failover Cluster Instances leverages Windows Server Failover Clustering (WSFC) functionality to provide local high availability through redundancy at the server-instance level-a *failover cluster instance* (FCI).</span></span> <span data-ttu-id="d5775-104">FCI 是跨 Windows Server 容錯移轉叢集 (WSFC) 節點且可能跨多個子網路安裝的單一 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體。</span><span class="sxs-lookup"><span data-stu-id="d5775-104">An FCI is a single instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is installed across Windows Server Failover Clustering (WSFC) nodes and, possibly, across multiple subnets.</span></span> <span data-ttu-id="d5775-105">在網路上，FCI 看似單一電腦上的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體，但是 FCI 提供容錯移轉，可以在目前的 WSFC 節點無法使用時，從該節點容錯移轉到另一個節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-105">On the network, an FCI appears to be an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] running on a single computer, but the FCI provides failover from one WSFC node to another if the current node becomes unavailable.</span></span>  
  
 <span data-ttu-id="d5775-106">FCI 可以利用 [AlwaysOn 可用性群組](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)提供資料庫層級的遠端災害復原。</span><span class="sxs-lookup"><span data-stu-id="d5775-106">An FCI can leverage [Always On Availability Groups](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)to provide remote disaster recovery at the database level.</span></span> <span data-ttu-id="d5775-107">如需詳細資訊，請參閱[容錯移轉叢集和 AlwaysOn 可用性群組 (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="d5775-107">For more information, see [Failover Clustering and Always On Availability Groups (;SQL Server);](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d5775-108">從 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 開始，AlwaysOn 容錯移轉叢集執行個體在 [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] 和 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] 中都支援叢集共用磁碟區 (CSV)。</span><span class="sxs-lookup"><span data-stu-id="d5775-108">Beginning in [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], Always On Failover Cluster Instances supports Clustered Shared Volumes (CSV) in both [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] and [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span></span> <span data-ttu-id="d5775-109">如需有關 CSV 的詳細資訊，請參閱 [了解容錯移轉叢集的叢集共用磁碟區](https://technet.microsoft.com/library/dd759255.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d5775-109">For more information on CSV, see [Understanding Cluster Shared Volumes in a Failover Cluster](https://technet.microsoft.com/library/dd759255.aspx).</span></span>  
  
 <span data-ttu-id="d5775-110">**本主題內容：**</span><span class="sxs-lookup"><span data-stu-id="d5775-110">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="d5775-111">優點</span><span class="sxs-lookup"><span data-stu-id="d5775-111">Benefits</span></span>](#Benefits)  
  
-   [<span data-ttu-id="d5775-112">建議</span><span class="sxs-lookup"><span data-stu-id="d5775-112">Recommendations</span></span>](#Recommendations)  
  
-   [<span data-ttu-id="d5775-113">容錯移轉叢集執行個體概觀</span><span class="sxs-lookup"><span data-stu-id="d5775-113">Failover Cluster Instance Overview</span></span>](#Overview)  
  
-   [<span data-ttu-id="d5775-114">容錯移轉叢集執行個體的元素</span><span class="sxs-lookup"><span data-stu-id="d5775-114">Elements of a Failover Cluster Instance</span></span>](#FCIelements)  
  
-   [<span data-ttu-id="d5775-115">SQL Server 容錯移轉概念和工作</span><span class="sxs-lookup"><span data-stu-id="d5775-115">SQL Server Failover Concepts and Tasks</span></span>](#ConceptsAndTasks)  
  
-   [<span data-ttu-id="d5775-116">相關主題</span><span class="sxs-lookup"><span data-stu-id="d5775-116">Related Topics</span></span>](#RelatedTopics)  
  
##  <a name="benefits-of-a-failover-cluster-instance"></a><a name="Benefits"></a> <span data-ttu-id="d5775-117">容錯移轉叢集執行個體的優點</span><span class="sxs-lookup"><span data-stu-id="d5775-117">Benefits of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="d5775-118">伺服器的硬體故障或軟體失敗時，連接至伺服器的應用程式或用戶端可能會停機。</span><span class="sxs-lookup"><span data-stu-id="d5775-118">When there is hardware or software failure of a server, the applications or clients connecting to the server will experience downtime.</span></span> <span data-ttu-id="d5775-119">當 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體設定成 FCI (而不是獨立執行個體) 時，該 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體的高可用性會受到 FCI 中存在的重複節點保護。</span><span class="sxs-lookup"><span data-stu-id="d5775-119">When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is configured to be an FCI (instead of a standalone instance), the high availability of that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is protected by the presence of redundant nodes in the FCI.</span></span> <span data-ttu-id="d5775-120">在任何時候，FCI 中僅其中一個節點擁有 WSFC 資源群組。</span><span class="sxs-lookup"><span data-stu-id="d5775-120">Only one of the nodes in the FCI owns the WSFC resource group at a time.</span></span> <span data-ttu-id="d5775-121">如果發生失敗 (硬體故障、作業系統失敗、應用程式或服務失敗) 或進行計畫的升級，資源群組擁有權就會移至另一個 WSFC 節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-121">In case of a failure (hardware failures, operating system failures, application or service failures), or a planned upgrade, the resource group ownership is moved to another WSFC node.</span></span> <span data-ttu-id="d5775-122">此程序對連接至 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的用戶端或應用程式而言是透明的，而且會將應用程式或用戶端在失敗期間遭遇停機時間的機會降到最低。</span><span class="sxs-lookup"><span data-stu-id="d5775-122">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span> <span data-ttu-id="d5775-123">下面列出 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體所提供的一些主要優點：</span><span class="sxs-lookup"><span data-stu-id="d5775-123">The following lists some key benefits that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instances provide:</span></span>  
  
-   <span data-ttu-id="d5775-124">透過備援性在執行個體層級提供保護</span><span class="sxs-lookup"><span data-stu-id="d5775-124">Protection at the instance level through redundancy</span></span>  
  
-   <span data-ttu-id="d5775-125">如果發生失敗 (硬體故障、作業系統失敗、應用程式或服務失敗) 時的自動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="d5775-125">Automatic failover in the event of a failure (hardware failures, operating system failures, application or service failures)</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d5775-126">在 AlwaysOn 可用性群組中，不支援從 FCI 自動容錯移轉至可用性群組中的其他節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-126">In an Always On availability group, automatic failover from an FCI to other nodes within the availability group is not supported.</span></span> <span data-ttu-id="d5775-127">這表示，如果自動容錯移轉是高可用性方案的重要元件，FCI 和獨立節點不應該在可用性群組內耦合。</span><span class="sxs-lookup"><span data-stu-id="d5775-127">This means that FCIs and standalone nodes should not be coupled together within an availability group if automatic failover is an important component your high availability solution.</span></span> <span data-ttu-id="d5775-128">\*\* 不過，這種耦合適用於「災害復原」方案。</span><span class="sxs-lookup"><span data-stu-id="d5775-128">However, this coupling can be made for your *disaster recovery* solution.</span></span>  
  
-   <span data-ttu-id="d5775-129">支援眾多儲存方案，包括 WSFC 叢集磁碟 (iSCSI、光纖通道等) 和伺服器訊息區塊 (SMB) 檔案共用。</span><span class="sxs-lookup"><span data-stu-id="d5775-129">Support for a broad array of storage solutions, including WSFC cluster disks (iSCSI, Fiber Channel, and so on) and server message block (SMB) file shares.</span></span>  
  
-   <span data-ttu-id="d5775-130">使用多重子網路 FCI 或在 AlwaysOn 可用性群組內執行一個 FCI 裝載資料庫的災害復原解決方案。</span><span class="sxs-lookup"><span data-stu-id="d5775-130">Disaster recovery solution using a multi-subnet FCI or running an FCI-hosted database inside an Always On availability group.</span></span> <span data-ttu-id="d5775-131">利用 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]的新多重子網路支援，多重子網路 FCI 不再需要虛擬 LAN，提高了多重子網路 FCI 的管理能力和安全性。</span><span class="sxs-lookup"><span data-stu-id="d5775-131">With the new multi-subnet support in [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], a multi-subnet FCI no longer requires a virtual LAN, increasing the manageability and security of a multi-subnet FCI.</span></span>  
  
-   <span data-ttu-id="d5775-132">在容錯移轉期間，應用程式和用戶端的零重新組態</span><span class="sxs-lookup"><span data-stu-id="d5775-132">Zero reconfiguration of applications and clients during failovers</span></span>  
  
-   <span data-ttu-id="d5775-133">自動容錯移轉之細微觸發程序事件的彈性容錯移轉原則</span><span class="sxs-lookup"><span data-stu-id="d5775-133">Flexible failover policy for granular trigger events for automatic failovers</span></span>  
  
-   <span data-ttu-id="d5775-134">透過使用專用和保存連接的定期和詳細健全狀況偵測，可靠的容錯移轉</span><span class="sxs-lookup"><span data-stu-id="d5775-134">Reliable failovers through periodic and detailed health detection using dedicated and persisted connections</span></span>  
  
-   <span data-ttu-id="d5775-135">在容錯移轉時間透過間接背景檢查點的可設定性和可預測性</span><span class="sxs-lookup"><span data-stu-id="d5775-135">Configurability and predictability in failover time through indirect background checkpoints</span></span>  
  
-   <span data-ttu-id="d5775-136">在容錯移轉期間節流的資源使用情況</span><span class="sxs-lookup"><span data-stu-id="d5775-136">Throttled resource usage during failovers</span></span>  
  
##  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d5775-137">建議</span><span class="sxs-lookup"><span data-stu-id="d5775-137">Recommendations</span></span>  
 <span data-ttu-id="d5775-138">在實際執行環境中，我們建議您搭配容錯移轉叢集執行個體的虛擬 IP 位址使用靜態 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="d5775-138">In a production environment, we recommend that you use static IP addresses in conjunction the virtual IP address of a Failover Cluster Instance.</span></span>  <span data-ttu-id="d5775-139">我們建議您不要在實際執行環境中使用 DHCP。</span><span class="sxs-lookup"><span data-stu-id="d5775-139">We recommend against using DHCP in a production environment.</span></span> <span data-ttu-id="d5775-140">在停機時，如果 DHCP IP 租用過期，則需要額外的時間來重新註冊與 DNS 名稱相關聯的新 DHCP IP 位址。</span><span class="sxs-lookup"><span data-stu-id="d5775-140">In the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the DNS name.</span></span>  
  
##  <a name="failover-cluster-instance-overview"></a><a name="Overview"></a><span data-ttu-id="d5775-141">容錯移轉叢集實例總覽</span><span class="sxs-lookup"><span data-stu-id="d5775-141">Failover Cluster Instance Overview</span></span>  
 <span data-ttu-id="d5775-142">FCI 在具有一個或多個 WSFC 節點的 WSFC 資源群組中執行。</span><span class="sxs-lookup"><span data-stu-id="d5775-142">An FCI runs in a WSFC resource group with one or more WSFC nodes.</span></span> <span data-ttu-id="d5775-143">當 FCI 啟動時，其中一個節點會取得資源群組擁有權，並使其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體上線。</span><span class="sxs-lookup"><span data-stu-id="d5775-143">When the FCI starts up, one of the nodes assume ownership of the resource group and brings its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance online.</span></span> <span data-ttu-id="d5775-144">此節點所擁有的資源包括：</span><span class="sxs-lookup"><span data-stu-id="d5775-144">The resources owned by this node include:</span></span>  
  
-   <span data-ttu-id="d5775-145">網路名稱</span><span class="sxs-lookup"><span data-stu-id="d5775-145">Network name</span></span>  
  
-   <span data-ttu-id="d5775-146">IP 位址</span><span class="sxs-lookup"><span data-stu-id="d5775-146">IP address</span></span>  
  
-   <span data-ttu-id="d5775-147">共用磁碟</span><span class="sxs-lookup"><span data-stu-id="d5775-147">Shared disks</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d5775-148">Database Engine 服務</span><span class="sxs-lookup"><span data-stu-id="d5775-148">Database Engine service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d5775-149">Agent 服務</span><span class="sxs-lookup"><span data-stu-id="d5775-149">Agent service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d5775-150">Analysis Services 服務 (如果已安裝)</span><span class="sxs-lookup"><span data-stu-id="d5775-150">Analysis Services service, if installed</span></span>  
  
-   <span data-ttu-id="d5775-151">一個檔案共用資源 (如果已安裝 FILESTREAM 功能)</span><span class="sxs-lookup"><span data-stu-id="d5775-151">One file share resource, if the FILESTREAM feature is installed</span></span>  
  
 <span data-ttu-id="d5775-152">在任何時候，僅資源群組擁有者在資源群組中執行其各自 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服務，FCI 中的其他節點並不執行。</span><span class="sxs-lookup"><span data-stu-id="d5775-152">At any time, only the resource group owner (and no other node in the FCI) is running its respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group.</span></span> <span data-ttu-id="d5775-153">當發生容錯移轉時，無論是自動容錯移轉或計畫的容錯移轉，就會依下列順序發生事件：</span><span class="sxs-lookup"><span data-stu-id="d5775-153">When a failover occurs, whether it be an automatic failover or a planned failover, the following sequence of events happen:</span></span>  
  
1.  <span data-ttu-id="d5775-154">除非發生硬體或系統失敗，否則在緩衝快取中的所有中途分頁都會寫入磁碟。</span><span class="sxs-lookup"><span data-stu-id="d5775-154">Unless a hardware or system failure occurs, all dirty pages in the buffer cache are written to disk.</span></span>  
  
2.  <span data-ttu-id="d5775-155">在使用中節點上資源群組的所有各自 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服務都會停止。</span><span class="sxs-lookup"><span data-stu-id="d5775-155">All respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group are stopped on the active node.</span></span>  
  
3.  <span data-ttu-id="d5775-156">資源群組擁有權將轉移到 FCI 中的另一個節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-156">The resource group ownership is transferred to another node in the FCI.</span></span>  
  
4.  <span data-ttu-id="d5775-157">新資源群組擁有者啟動其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服務。</span><span class="sxs-lookup"><span data-stu-id="d5775-157">The new resource group owner starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services.</span></span>  
  
5.  <span data-ttu-id="d5775-158">用戶端應用程式的連接要求自動導向至使用相同虛擬網路名稱 (VNN) 的新使用中節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-158">Client application connection requests are automatically directed to the new active node using the same virtual network name (VNN).</span></span>  
  
 <span data-ttu-id="d5775-159">只要其基礎 WSFC 叢集保持良好的仲裁狀況 (多數仲裁 WSFC 節點可做為自動容錯移轉目標使用)，FCI 就是線上狀態。</span><span class="sxs-lookup"><span data-stu-id="d5775-159">The FCI is online as long as its underlying WSFC cluster is in good quorum health (the majority of the quorum WSFC nodes are available as automatic failover targets).</span></span> <span data-ttu-id="d5775-160">當 WSFC 叢集失去其仲裁時 (無論由於硬體、軟體、網路失敗或仲裁組態不正確)，整個 WSFC 叢集與 FCI 就會離線。</span><span class="sxs-lookup"><span data-stu-id="d5775-160">When the WSFC cluster loses its quorum, whether due to hardware, software, network failure, or improper quorum configuration, the entire WSFC cluster, along with the FCI, is brought offline.</span></span> <span data-ttu-id="d5775-161">在此未規劃的容錯移轉情況下，需要手動介入，在剩餘可用的節點中重新建立仲裁，以使 WSFC 叢集和 FCI 恢復連線。</span><span class="sxs-lookup"><span data-stu-id="d5775-161">Manual intervention is then required in this unplanned failover scenario to reestablish quorum in the remaining available nodes in order to bring the WSFC cluster and FCI back online.</span></span> <span data-ttu-id="d5775-162">如需詳細資訊，請參閱[WSFC 仲裁模式和投票設定 (;SQL Server) ;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="d5775-162">For more information, see [WSFC Quorum Modes and Voting Configuration (;SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
### <a name="predictable-failover-time"></a><span data-ttu-id="d5775-163">可預測的容錯移轉時間</span><span class="sxs-lookup"><span data-stu-id="d5775-163">Predictable Failover Time</span></span>  
 <span data-ttu-id="d5775-164">根據 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體上次執行檢查點作業的時間，緩衝快取中可能有相當多的中途分頁。</span><span class="sxs-lookup"><span data-stu-id="d5775-164">Depending on when your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance last performed a checkpoint operation, there can be a substantial amount of dirty pages in the buffer cache.</span></span> <span data-ttu-id="d5775-165">因此，容錯移轉的持續時間與剩餘中途分頁寫入磁碟所需的時間一樣長，這可能導致冗長且不可預測的容錯移轉時間。</span><span class="sxs-lookup"><span data-stu-id="d5775-165">Consequently, failovers last as long as it takes to write the remaining dirty pages to disk, which can lead to long and unpredictable failover time.</span></span> <span data-ttu-id="d5775-166">從 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]開始，FCI 可以使用間接檢查點，節流緩衝快取中保留的中途分頁數量。</span><span class="sxs-lookup"><span data-stu-id="d5775-166">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the FCI can use indirect checkpoints to throttle the amount of dirty pages kept in the buffer cache.</span></span> <span data-ttu-id="d5775-167">雖然在一般工作負載下這會耗用額外資源，但更能預測和設定容錯移轉時間。</span><span class="sxs-lookup"><span data-stu-id="d5775-167">While this does consume additional resources under regular workload, it makes the failover time more predictable as well as more configurable.</span></span> <span data-ttu-id="d5775-168">當您組織的服務層級合約規定高可用性方案的復原時間目標 (RTO) 時，此功能非常有用。</span><span class="sxs-lookup"><span data-stu-id="d5775-168">This is very useful when the service-level agreement in your organization specifies the recovery time objective (RTO) for your high availability solution.</span></span> <span data-ttu-id="d5775-169">如需有關間接檢查點的詳細資訊，請參閱＜ [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt)＞。</span><span class="sxs-lookup"><span data-stu-id="d5775-169">For more information on indirect checkpoints, see [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt).</span></span>  
  
### <a name="reliable-health-monitoring-and-flexible-failover-policy"></a><span data-ttu-id="d5775-170">可靠的健全狀況監測和彈性的容錯移轉原則</span><span class="sxs-lookup"><span data-stu-id="d5775-170">Reliable Health Monitoring and Flexible Failover Policy</span></span>  
 <span data-ttu-id="d5775-171">在 FCI 成功啟動之後，WSFC 服務會監視基礎 WSFC 叢集和 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="d5775-171">After the FCI starts successfully, the WSFC service monitors both the health of the underlying WSFC cluster, as well as the health of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="d5775-172">從 [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]開始，WSFC 服務使用專用連接，透過系統預存程序來輪詢使用中 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體，以取得詳細元件診斷。</span><span class="sxs-lookup"><span data-stu-id="d5775-172">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the WSFC service uses a dedicated connection to poll the active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for detailed component diagnostics through a system stored procedure.</span></span> <span data-ttu-id="d5775-173">這具有三方面的意義：</span><span class="sxs-lookup"><span data-stu-id="d5775-173">The implication of this is three-fold:</span></span>  
  
-   <span data-ttu-id="d5775-174">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體的專用連接可一直可靠地輪詢元件診斷，即使 FCI 負載過重也一樣。</span><span class="sxs-lookup"><span data-stu-id="d5775-174">The dedicated connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance makes it possible to reliably poll for component diagnostics all the time, even when the FCI is under heavy load.</span></span> <span data-ttu-id="d5775-175">這能夠區別負載過重的系統和實際發生失敗狀況的系統，因此防止假容錯移轉等問題發生。</span><span class="sxs-lookup"><span data-stu-id="d5775-175">This makes it possible to distinguish between a system that is under heavy load and a system that actually has failure conditions, thus preventing issues such as false failovers.</span></span>  
  
-   <span data-ttu-id="d5775-176">詳細元件診斷能夠設定更有彈性的容錯移轉原則，讓您可以選擇何種失敗條件觸發容錯移轉，何種失敗條件不觸發。</span><span class="sxs-lookup"><span data-stu-id="d5775-176">The detailed component diagnostics makes it possible to configure a more flexible failover policy, whereby you can choose what failure conditions trigger failovers and which failure conditions do not.</span></span>  
  
-   <span data-ttu-id="d5775-177">詳細的元件診斷也啟用自動容錯移轉更好的、追溯性的疑難排解。</span><span class="sxs-lookup"><span data-stu-id="d5775-177">The detailed component diagnostics also enables better troubleshooting of automatic failovers retroactively.</span></span> <span data-ttu-id="d5775-178">診斷資訊儲存在記錄檔中，與 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 錯誤記錄檔共置。</span><span class="sxs-lookup"><span data-stu-id="d5775-178">The diagnostic information is stored to log files, which are collocated with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error logs.</span></span> <span data-ttu-id="d5775-179">您可以將它們載入記錄檔檢視器中，檢查容錯移轉發生前的元件狀態，以便判斷何種狀況導致該容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="d5775-179">You can load them into the Log File Viewer to inspect the component states leading up to the failover occurrence in order to determine what cause that failover.</span></span>  
  
 <span data-ttu-id="d5775-180">如需詳細資訊，請參閱[容錯移轉叢集實例的容錯移轉原則](failover-policy-for-failover-cluster-instances.md)</span><span class="sxs-lookup"><span data-stu-id="d5775-180">For more information, see [Failover Policy for Failover Cluster Instances](failover-policy-for-failover-cluster-instances.md)</span></span>  
  
##  <a name="elements-of-a-failover-cluster-instance"></a><a name="FCIelements"></a><span data-ttu-id="d5775-181">容錯移轉叢集實例的元素</span><span class="sxs-lookup"><span data-stu-id="d5775-181">Elements of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="d5775-182">FCI 是由一組實體伺服器 (節點) 所組成，包含相似硬體組態和相同軟體組態，包括作業系統版本和修補程式等級，以及 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 版本、修補程式等級、元件和執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="d5775-182">An FCI consists of a set of physical servers (nodes) that contain similar hardware configuration as well as identical software configuration that includes operating system version and patch level, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] version, patch level, components, and instance name.</span></span> <span data-ttu-id="d5775-183">需要相同軟體組態，以確保 FCI 在節點之間容錯移轉時可完整運作。</span><span class="sxs-lookup"><span data-stu-id="d5775-183">Identical software configuration is necessary to ensure that the FCI can be fully functional as it fails over between the nodes.</span></span>  
  
 <span data-ttu-id="d5775-184">WSFC 資源群組</span><span class="sxs-lookup"><span data-stu-id="d5775-184">WSFC Resource Group</span></span>  
 <span data-ttu-id="d5775-185">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI 在 WSFC 資源群組中執行。</span><span class="sxs-lookup"><span data-stu-id="d5775-185">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI runs in a WSFC resource group.</span></span> <span data-ttu-id="d5775-186">資源群組中的每個節點都會維護組態設定和檢查點登錄機碼的同步副本，以確保在容錯移轉後 FCI 可完整運作，而且在任何時候叢集中僅其中一個節點 (使用中節點) 擁有資源群組。</span><span class="sxs-lookup"><span data-stu-id="d5775-186">Each node in the resource group maintains a synchronized copy of the configuration settings and check-pointed registry keys to ensure full functionality of the FCI after a failover, and only one of the nodes in the cluster owns the resource group at a time (the active node).</span></span> <span data-ttu-id="d5775-187">WSFC 服務管理伺服器叢集、仲裁組態、容錯移轉原則和容錯移轉作業，以及 FCI 的 VNN 和虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="d5775-187">The WSFC service manages the server cluster, quorum configuration, failover policy, and failover operations, as well as the VNN and virtual IP addresses for the FCI.</span></span> <span data-ttu-id="d5775-188">如果發生失敗 (硬體故障、作業系統失敗、應用程式或服務失敗) 或進行計畫的升級，資源群組擁有權就會移至 FCI 中的另一個節點。WSFC 資源群組支援的節點數目取決於 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 版本。</span><span class="sxs-lookup"><span data-stu-id="d5775-188">In case of a failure (hardware failures, operating system failures, application or service failures) or a planned upgrade, the resource group ownership is moved to another node in the FCI.The number of nodes that are supported in a WSFC resource group depends on your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] edition.</span></span> <span data-ttu-id="d5775-189">此外，相同 WSFC 叢集可以執行多個 FCI (多個資源群組)，視 CPU、記憶體和磁碟數目等硬體容量而定。</span><span class="sxs-lookup"><span data-stu-id="d5775-189">Also, the same WSFC cluster can run multiple FCIs (multiple resource groups), depending on your hardware capacity, such as CPUs, memory, and number of disks.</span></span>  
  
 <span data-ttu-id="d5775-190">SQL Server 二進位檔</span><span class="sxs-lookup"><span data-stu-id="d5775-190">SQL Server Binaries</span></span>  
 <span data-ttu-id="d5775-191">產品二進位檔案會在 FCI 的每個節點上本機安裝，此程序類似於 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 獨立安裝。</span><span class="sxs-lookup"><span data-stu-id="d5775-191">The product binaries are installed locally on each node of the FCI, a process similar to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] stand-alone installations.</span></span> <span data-ttu-id="d5775-192">不過，在啟動期間，這些服務並不會自動啟動，而是透過 WSFC 進行管理。</span><span class="sxs-lookup"><span data-stu-id="d5775-192">However, during startup, the services are not started automatically, but managed by WSFC.</span></span>  
  
 <span data-ttu-id="d5775-193">儲存體</span><span class="sxs-lookup"><span data-stu-id="d5775-193">Storage</span></span>  
 <span data-ttu-id="d5775-194">FCI 與 AlwaysOn 可用性群組相反，前者必須針對資料庫和記錄檔儲存體，在 FCI 的所有節點之間使用共用儲存體。</span><span class="sxs-lookup"><span data-stu-id="d5775-194">Contrary to the Always On availability group, an FCI must use shared storage between all nodes of the FCI for database and log storage.</span></span> <span data-ttu-id="d5775-195">共用儲存體可以採用 WSFC 叢集磁碟、SAN 磁碟或 SMB 檔案共用的形式。</span><span class="sxs-lookup"><span data-stu-id="d5775-195">The shared storage can be in the form of WSFC cluster disks, disks on a SAN, or file shares on an SMB.</span></span> <span data-ttu-id="d5775-196">如此一來，每當發生容錯移轉時，FCI 中的所有節點都有相同的執行個體資料檢視。</span><span class="sxs-lookup"><span data-stu-id="d5775-196">This way, all nodes in the FCI have the same view of instance data whenever a failover occurs.</span></span> <span data-ttu-id="d5775-197">不過，這表示共用儲存體是潛在的單一失敗點，而 FCI 仰賴基礎儲存方案以確保資料保護。</span><span class="sxs-lookup"><span data-stu-id="d5775-197">This does mean, however, that the shared storage has the potential of being the single point of failure, and FCI depends on the underlying storage solution to ensure data protection.</span></span>  
  
 <span data-ttu-id="d5775-198">網路名稱</span><span class="sxs-lookup"><span data-stu-id="d5775-198">Network Name</span></span>  
 <span data-ttu-id="d5775-199">FCI 的 VNN 為 FCI 提供統一的連接點。</span><span class="sxs-lookup"><span data-stu-id="d5775-199">The VNN for the FCI provides a unified connection point for the FCI.</span></span> <span data-ttu-id="d5775-200">這允許應用程式連接到 VNN，而無需知道目前使用中的節點。</span><span class="sxs-lookup"><span data-stu-id="d5775-200">This allows applications to connect to the VNN without the need to know the currently active node.</span></span> <span data-ttu-id="d5775-201">當發生容錯移轉時，VNN 會在新使用中節點啟動後註冊給它。</span><span class="sxs-lookup"><span data-stu-id="d5775-201">When a failover occurs, the VNN is registered to the new active node after it starts.</span></span> <span data-ttu-id="d5775-202">此程序對連接至 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的用戶端或應用程式而言是透明的，而且會將應用程式或用戶端在失敗期間遭遇停機時間的機會降到最低。</span><span class="sxs-lookup"><span data-stu-id="d5775-202">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span>  
  
 <span data-ttu-id="d5775-203">虛擬 IP</span><span class="sxs-lookup"><span data-stu-id="d5775-203">Virtual IPs</span></span>  
 <span data-ttu-id="d5775-204">在多重子網路 FCI 的情況下，FCI 中的每個子網路會被指派一個虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="d5775-204">In the case of a multi-subnet FCI, a virtual IP address is assigned to each subnet in the FCI.</span></span> <span data-ttu-id="d5775-205">在容錯移轉期間，DNS 伺服器上的 VNN 會更新，以指向各自子網路的虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="d5775-205">During a failover, the VNN on the DNS server is updated to point to the virtual IP address for the respective subnet.</span></span> <span data-ttu-id="d5775-206">在多重子網路容錯移轉後，應用程式和用戶端可以使用相同 VNN 連接到 FCI。</span><span class="sxs-lookup"><span data-stu-id="d5775-206">Applications and clients can then connect to the FCI using the same VNN after a multi-subnet failover.</span></span>  
  
##  <a name="sql-server-failover-concepts-and-tasks"></a><a name="ConceptsAndTasks"></a> <span data-ttu-id="d5775-207">SQL Server 容錯移轉概念和工作</span><span class="sxs-lookup"><span data-stu-id="d5775-207">SQL Server Failover Concepts and Tasks</span></span>  
  
|<span data-ttu-id="d5775-208">概念和工作</span><span class="sxs-lookup"><span data-stu-id="d5775-208">Concepts and Tasks</span></span>|<span data-ttu-id="d5775-209">主題</span><span class="sxs-lookup"><span data-stu-id="d5775-209">Topic</span></span>|  
|------------------------|-----------|  
|<span data-ttu-id="d5775-210">描述失敗偵測機制和彈性的容錯移轉原則。</span><span class="sxs-lookup"><span data-stu-id="d5775-210">Describes the failure detection mechanism and the flexible failover policy.</span></span>|[<span data-ttu-id="d5775-211">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="d5775-211">Failover Policy for Failover Cluster Instances</span></span>](failover-policy-for-failover-cluster-instances.md)|  
|<span data-ttu-id="d5775-212">描述 FCI 管理和維護的概念。</span><span class="sxs-lookup"><span data-stu-id="d5775-212">Describes concepts in FCI administration and maintenance.</span></span>|[<span data-ttu-id="d5775-213">容錯移轉叢集執行個體管理及維護</span><span class="sxs-lookup"><span data-stu-id="d5775-213">Failover Cluster Instance Administration and Maintenance</span></span>](failover-cluster-instance-administration-and-maintenance.md)|  
|<span data-ttu-id="d5775-214">描述多重子網路組態和概念</span><span class="sxs-lookup"><span data-stu-id="d5775-214">Describes multi-subnet configuration and concepts</span></span>|[<span data-ttu-id="d5775-215">SQL Server 多重子網叢集 (;SQL Server) ;</span><span class="sxs-lookup"><span data-stu-id="d5775-215">SQL Server Multi-Subnet Clustering (;SQL Server);</span></span>](sql-server-multi-subnet-clustering-sql-server.md)|  
  
##  <a name="related-topics"></a><a name="RelatedTopics"></a><span data-ttu-id="d5775-216">相關主題</span><span class="sxs-lookup"><span data-stu-id="d5775-216">Related Topics</span></span>  
  
|<span data-ttu-id="d5775-217">**主題描述**</span><span class="sxs-lookup"><span data-stu-id="d5775-217">**Topic descriptions**</span></span>|<span data-ttu-id="d5775-218">**主題**</span><span class="sxs-lookup"><span data-stu-id="d5775-218">**Topic**</span></span>|  
|----------------------------|---------------|  
|<span data-ttu-id="d5775-219">描述如何安裝新的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI。</span><span class="sxs-lookup"><span data-stu-id="d5775-219">Describes how to install a new [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI.</span></span>|[<span data-ttu-id="d5775-220">建立新的 SQL Server 容錯移轉叢集 (;安裝) ;</span><span class="sxs-lookup"><span data-stu-id="d5775-220">Create a New SQL Server Failover Cluster (;Setup);</span></span>](../install/create-a-new-sql-server-failover-cluster-setup.md)|  
|<span data-ttu-id="d5775-221">描述如何升級至 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="d5775-221">Describes how to upgrade to a [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] failover cluster.</span></span>|[<span data-ttu-id="d5775-222">升級 SQL Server 容錯移轉叢集</span><span class="sxs-lookup"><span data-stu-id="d5775-222">Upgrade a SQL Server Failover Cluster</span></span>](upgrade-a-sql-server-failover-cluster-instance.md)|  
|<span data-ttu-id="d5775-223">描述 Windows 容錯移轉叢集概念，並提供 Windows 容錯移轉叢集相關工作的連結</span><span class="sxs-lookup"><span data-stu-id="d5775-223">Describes Windows Failover Clustering Concepts and provides links to tasks related to Windows Failover Clustering</span></span>|[!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)]<span data-ttu-id="d5775-224">： [容錯移轉叢集概觀](https://go.microsoft.com/fwlink/?LinkId=177878)</span><span class="sxs-lookup"><span data-stu-id="d5775-224">: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177878)</span></span><br /><br /> [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)] <span data-ttu-id="d5775-225">R2： [容錯移轉叢集概觀](https://go.microsoft.com/fwlink/?LinkId=177879)</span><span class="sxs-lookup"><span data-stu-id="d5775-225">R2: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177879)</span></span>|  
|<span data-ttu-id="d5775-226">描述 FCI 節點和可用性群組複本之間的概念差異，以及使用 FCI 裝載可用性群組複本的考量。</span><span class="sxs-lookup"><span data-stu-id="d5775-226">Describes the distinctions in concepts between nodes in an FCI and replicas within an availability group and considerations for using an FCI to host a replica for an availability group.</span></span>|[<span data-ttu-id="d5775-227">容錯移轉叢集和 AlwaysOn 可用性群組 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d5775-227">Failover Clustering and Always On Availability Groups (SQL Server)</span></span>](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)|  
  
  
