---
title: 角色切換後針對登入和作業進行管理 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595582"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a><span data-ttu-id="e4591-102">角色切換後針對登入和作業進行管理 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e4591-102">Management of Logins and Jobs After Role Switching (SQL Server)</span></span>
  <span data-ttu-id="e4591-103"> 針對 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 資料庫部署高可用性或災害復原解決方案時，為該資料庫儲存的相關資訊務必完整重現於 **master** 或 **msdb** 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="e4591-103">When deploying a high-availability or disaster-recovery solution for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, it is important to reproduce relevant information that is stored for the database in the **master** or **msdb** databases.</span></span> <span data-ttu-id="e4591-104">這類相關資訊通常包括主要/主體資料庫的各項作業，以及需要連接到該資料庫的使用者或處理序的登入。</span><span class="sxs-lookup"><span data-stu-id="e4591-104">Typically, the relevant information includes the jobs of the primary/principal database and the logins of users or processes that need to connect to the database.</span></span> <span data-ttu-id="e4591-105">您應將此資訊複寫於裝載次要/鏡像資料庫的任何 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體上。</span><span class="sxs-lookup"><span data-stu-id="e4591-105">You should duplicate this information on any instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts a secondary/mirror database.</span></span> <span data-ttu-id="e4591-106">可能的話，最好在角色切換之後，以程式設計方式在新的主要/主體資料庫上重現此資訊。</span><span class="sxs-lookup"><span data-stu-id="e4591-106">If possible after roles are switched, it is best to programmatically reproduce the information on the new primary/principal database.</span></span>  
  
## <a name="logins"></a><span data-ttu-id="e4591-107">登入</span><span class="sxs-lookup"><span data-stu-id="e4591-107">Logins</span></span>  
 <span data-ttu-id="e4591-108">您應該在裝載資料庫副本的每個伺服器執行個體上，重現對主體資料庫具有存取權限的登入。</span><span class="sxs-lookup"><span data-stu-id="e4591-108">On every server instances that hosts a copy of the database, you should reproduce the logins that have permission to access the principal database.</span></span> <span data-ttu-id="e4591-109">當主要/主體角色切換時，只有其登入存在於新的主要/主體伺服器執行個體上的使用者才能存取新的主要/主體資料庫。</span><span class="sxs-lookup"><span data-stu-id="e4591-109">When the primary/principal role switches, only users whose logins exist on the new primary/principal server instance can access the new primary/principal database.</span></span> <span data-ttu-id="e4591-110">凡是未在新的主要/主體伺服器執行個體上定義登入的使用者都將遭到遺棄，以致無法存取資料庫。</span><span class="sxs-lookup"><span data-stu-id="e4591-110">Users whose logins are not defined on the new primary/principal server instance are orphaned and cannot access the database.</span></span>  
  
 <span data-ttu-id="e4591-111">若有使用者遭到遺棄，請在新的主要/主體伺服器執行個體上建立其登入並執行 [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="e4591-111">If a user is orphaned, create the login on the new primary/principal server instance and run [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span></span> <span data-ttu-id="e4591-112">如需詳細資訊，請參閱[孤立的使用者疑難排解 &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="e4591-112">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="e4591-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span><span class="sxs-lookup"><span data-stu-id="e4591-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="e4591-114">如果應用程式使用 SQL Server 驗證或本機 Windows 登入，可能會由於 SID 不相符造成遠端 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體無法解析該應用程式的登入。</span><span class="sxs-lookup"><span data-stu-id="e4591-114">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e4591-115">SID 不相符將導致此登入成為遠端伺服器執行個體上的被遺棄使用者。</span><span class="sxs-lookup"><span data-stu-id="e4591-115">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="e4591-116">若應用程式是在容錯移轉後連接到鏡像資料庫或記錄傳送資料庫，或者連接到從備份初始化的複寫訂閱者資料庫，可能就會發生這個問題。</span><span class="sxs-lookup"><span data-stu-id="e4591-116">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="e4591-117">建議您在設定這類應用程式而要使用由遠端 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體所裝載的資料庫時，應採取預防措施以避免此問題。</span><span class="sxs-lookup"><span data-stu-id="e4591-117">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e4591-118">預防的方法包括從本機 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體傳送登入和密碼到遠端 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體。</span><span class="sxs-lookup"><span data-stu-id="e4591-118">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e4591-119">如需如何預防此問題的詳細資訊，請參閱知識庫文章 918992：[如何在 SQL Server 的執行個體之間傳送登入和密碼](https://support.microsoft.com/kb/918992/)。</span><span class="sxs-lookup"><span data-stu-id="e4591-119">For more information about how to prevent this issue, see KB article 918992 -[How to transfer logins and passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e4591-120">此問題會影響位於不同電腦上的 Windows 本機帳戶。</span><span class="sxs-lookup"><span data-stu-id="e4591-120">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="e4591-121">但是，網域帳戶不至於發生此問題，因為每一部電腦上的 SID 都相同。</span><span class="sxs-lookup"><span data-stu-id="e4591-121">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="e4591-122">如需詳細資訊，請參閱 Database Engine 部落格文章： [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (孤立的使用者與資料庫鏡像及記錄傳送)。</span><span class="sxs-lookup"><span data-stu-id="e4591-122">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
## <a name="jobs"></a><span data-ttu-id="e4591-123">工作</span><span class="sxs-lookup"><span data-stu-id="e4591-123">Jobs</span></span>  
 <span data-ttu-id="e4591-124">像是備份工作這類的工作，也需要特別注意。</span><span class="sxs-lookup"><span data-stu-id="e4591-124">Jobs, such as backup jobs, require special consideration.</span></span> <span data-ttu-id="e4591-125">通常在角色切換之後，資料庫擁有者或系統管理員必須為新的主要/主體資料庫重新建立各項作業。</span><span class="sxs-lookup"><span data-stu-id="e4591-125">Typically, after a role switch, the database owner or system administrator must re-create the jobs for the new primary/principal database.</span></span>  
  
 <span data-ttu-id="e4591-126">一旦原先的主要/主體伺服器執行個體已可使用，您便應該刪除前述 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體上的原始作業。</span><span class="sxs-lookup"><span data-stu-id="e4591-126">When the former primary/principal server instance is available, you should delete the original jobs on that instanceof [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e4591-127">請注意，由於目前的鏡像資料庫是在 RESTORING 狀態以致無法使用，該資料庫上的作業都將失敗。</span><span class="sxs-lookup"><span data-stu-id="e4591-127">Note that jobs on the current mirror database fail because it is in the RESTORING state, making it unavailable.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e4591-128">不同的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體可能以不同的磁碟機代號等方式個別進行設定。</span><span class="sxs-lookup"><span data-stu-id="e4591-128">Different instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be configured differently, with different drive letters or such.</span></span> <span data-ttu-id="e4591-129">每個夥伴的工作都必須允許此種差異。</span><span class="sxs-lookup"><span data-stu-id="e4591-129">The jobs for each partner must allow for any such differences.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e4591-130">另請參閱</span><span class="sxs-lookup"><span data-stu-id="e4591-130">See Also</span></span>  
 <span data-ttu-id="e4591-131">[在另一個伺服器執行個體上提供可用的資料庫時，管理中繼資料 &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span><span class="sxs-lookup"><span data-stu-id="e4591-131">[Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span></span>  
 [<span data-ttu-id="e4591-132">孤立的使用者疑難排解 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e4591-132">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](troubleshoot-orphaned-users-sql-server.md)  
  
  
