---
title: 設定 Windows 防火牆以允許 SQL Server 存取 | Microsoft Docs
ms.custom: ''
ms.date: 06/22/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- Windows Firewall ports
- WMI firewall ports
- Windows Firewall [Database Engine]
- firewall systems, configuring
- advfirewall
- firewall systems
- rules firewall
- firewall systems, overview and port list
- 1433 TCP port
- portopening using netsh
- ports [SQL Server], TCP
- netsh to open firewall ports
ms.assetid: f55c6a0e-b6bd-4803-b51a-f3a419803024
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: d1a0bc32040fc90e5f73faa708f314722bc8f3b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87593787"
---
# <a name="configure-the-windows-firewall-to-allow-sql-server-access"></a><span data-ttu-id="edd85-102">Configure the Windows Firewall to Allow SQL Server Access</span><span class="sxs-lookup"><span data-stu-id="edd85-102">Configure the Windows Firewall to Allow SQL Server Access</span></span>
  <span data-ttu-id="edd85-103">防火牆系統有助於預防未經授權存取電腦資源。</span><span class="sxs-lookup"><span data-stu-id="edd85-103">Firewall systems help prevent unauthorized access to computer resources.</span></span> <span data-ttu-id="edd85-104">如果防火牆已開啟，但是設定不正確，則嘗試連接至 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的行為可能會被封鎖。</span><span class="sxs-lookup"><span data-stu-id="edd85-104">If a firewall is turned on but not correctly configured, attempts to connect to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be blocked.</span></span>  
  
 <span data-ttu-id="edd85-105">若要透過防火牆存取 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的執行個體，您必須在執行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的電腦上，將防火牆設定成允許存取。</span><span class="sxs-lookup"><span data-stu-id="edd85-105">To access an instance of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] through a firewall, you must configure the firewall on the computer that is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to allow access.</span></span> <span data-ttu-id="edd85-106">防火牆是 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 的元件。</span><span class="sxs-lookup"><span data-stu-id="edd85-106">The firewall is a component of [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.</span></span> <span data-ttu-id="edd85-107">您也可以安裝來自其他公司的防火牆。</span><span class="sxs-lookup"><span data-stu-id="edd85-107">You can also install a firewall from another company.</span></span> <span data-ttu-id="edd85-108">雖然本主題將討論如何設定 Windows 防火牆，但是基本原則也適用於其他防火牆程式。</span><span class="sxs-lookup"><span data-stu-id="edd85-108">This topic discusses how to configure the Windows firewall, but the basic principles apply to other firewall programs.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="edd85-109">本主題會提供防火牆組態的概觀，並且摘要列出 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 管理員感興趣的資訊。</span><span class="sxs-lookup"><span data-stu-id="edd85-109">This topic provides an overview of firewall configuration and summarizes information of interest to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administrator.</span></span> <span data-ttu-id="edd85-110">如需有關防火牆的詳細資訊以及授權的防火牆資訊，請參閱防火牆文件集，例如 [具有進階安全性的 Windows 防火牆和 IPsec](https://go.microsoft.com/fwlink/?LinkID=116904)。</span><span class="sxs-lookup"><span data-stu-id="edd85-110">For more information about the firewall and for authoritative firewall information, see the firewall documentation, such as [Windows Firewall with Advanced Security and IPsec](https://go.microsoft.com/fwlink/?LinkID=116904).</span></span>  
  
 <span data-ttu-id="edd85-111">熟悉 [控制台] 中 [Windows 防火牆]\*\*\*\* 項目與 [具有進階安全性的 Windows 防火牆] Microsoft Management Console (MMC) 嵌入式管理單元，以及知道自己想要設定之防火牆設定的使用者，可以直接移至下列清單中的主題：</span><span class="sxs-lookup"><span data-stu-id="edd85-111">Users familiar with the **Windows Firewall** item in Control Panel and with the Windows Firewall with Advanced Security Microsoft Management Console (MMC) snap-in and who know which firewall settings they want to configure can move directly to the topics in the following list:</span></span>  
  
-   [<span data-ttu-id="edd85-112">設定用於 Database Engine 存取的 Windows 防火牆</span><span class="sxs-lookup"><span data-stu-id="edd85-112">Configure a Windows Firewall for Database Engine Access</span></span>](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)  
  
-   [<span data-ttu-id="edd85-113">設定 Windows 防火牆以允許 Analysis Services 存取</span><span class="sxs-lookup"><span data-stu-id="edd85-113">Configure the Windows Firewall to Allow Analysis Services Access</span></span>](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md)  
  
-   [<span data-ttu-id="edd85-114">設定供報表伺服器存取的防火牆</span><span class="sxs-lookup"><span data-stu-id="edd85-114">Configure a Firewall for Report Server Access</span></span>](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md)  
  

  
##  <a name="basic-firewall-information"></a><a name="BKMK_basic"></a> <span data-ttu-id="edd85-115">基本防火牆資訊</span><span class="sxs-lookup"><span data-stu-id="edd85-115">Basic Firewall Information</span></span>  
 <span data-ttu-id="edd85-116">防火牆的運作方式是檢查內送封包，以及針對一組規則比較這些封包。</span><span class="sxs-lookup"><span data-stu-id="edd85-116">Firewalls work by inspecting incoming packets, and comparing them against a set of rules.</span></span> <span data-ttu-id="edd85-117">如果這些規則允許封包，防火牆就會將該封包傳遞給 TCP/IP 通訊協定，進行其他處理。</span><span class="sxs-lookup"><span data-stu-id="edd85-117">If the rules allow the packet, the firewall passes the packet to the TCP/IP protocol for additional processing.</span></span> <span data-ttu-id="edd85-118">如果這些規則不允許封包，防火牆就會捨棄該封包，而且如果啟用記錄的話，還會在防火牆記錄檔中建立項目。</span><span class="sxs-lookup"><span data-stu-id="edd85-118">If the rules do not allow the packet, the firewall discards the packet and, if logging is enabled, creates an entry in the firewall logging file.</span></span>  
  
 <span data-ttu-id="edd85-119">允許傳輸的清單是以下列其中一種方式填入：</span><span class="sxs-lookup"><span data-stu-id="edd85-119">The list of allowed traffic is populated in one of the following ways:</span></span>  
  
-   <span data-ttu-id="edd85-120">當啟用防火牆的電腦起始通訊時，防火牆就會在清單中建立項目，以便允許回應。</span><span class="sxs-lookup"><span data-stu-id="edd85-120">When the computer that has the firewall enabled initiates communication, the firewall creates an entry in the list so that the response is allowed.</span></span> <span data-ttu-id="edd85-121">內送回應會被視為要求的傳輸，而且您不需要設定這個項目。</span><span class="sxs-lookup"><span data-stu-id="edd85-121">The incoming response is considered solicited traffic and you do not have to configure this.</span></span>  
  
-   <span data-ttu-id="edd85-122">管理員設定防火牆的例外。</span><span class="sxs-lookup"><span data-stu-id="edd85-122">An administrator configures exceptions to the firewall.</span></span> <span data-ttu-id="edd85-123">這樣會允許存取在電腦上執行的指定程式，或存取電腦上的指定連接通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-123">This allows either access to specified programs running on your computer, or access to specified connection ports on your computer.</span></span> <span data-ttu-id="edd85-124">在此情況下，當此電腦當做伺服器、接聽程式或對等運作時，它就會接受未經要求的內送傳輸。</span><span class="sxs-lookup"><span data-stu-id="edd85-124">In this case, the computer accepts unsolicited incoming traffic when acting as a server, a listener, or a peer.</span></span> <span data-ttu-id="edd85-125">這是必須完成才能連接至 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的組態類型。</span><span class="sxs-lookup"><span data-stu-id="edd85-125">This is the type of configuration that must be completed to connect to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="edd85-126">選擇防火牆策略比單獨決定給定的通訊埠應該開啟或關閉更複雜。</span><span class="sxs-lookup"><span data-stu-id="edd85-126">Choosing a firewall strategy is more complex than just deciding if a given port should be open or closed.</span></span> <span data-ttu-id="edd85-127">為企業設計防火牆策略時，請務必考慮所有適用的規則和組態選項。</span><span class="sxs-lookup"><span data-stu-id="edd85-127">When designing a firewall strategy for your enterprise, make sure that you consider all the rules and configuration options available to you.</span></span> <span data-ttu-id="edd85-128">本主題不會檢閱所有可能的防火牆選項。</span><span class="sxs-lookup"><span data-stu-id="edd85-128">This topic does not review all the possible firewall options.</span></span> <span data-ttu-id="edd85-129">我們建議您檢閱下列文件：</span><span class="sxs-lookup"><span data-stu-id="edd85-129">We recommend that you review the following documents:</span></span>  
  
 [<span data-ttu-id="edd85-130">具有進階安全性的 Windows 防火牆入門指南</span><span class="sxs-lookup"><span data-stu-id="edd85-130">Windows Firewall with Advanced Security Getting Started Guide</span></span>](https://go.microsoft.com/fwlink/?LinkId=116080)  
  
 [<span data-ttu-id="edd85-131">具有進階安全性的 Windows 防火牆設計指南</span><span class="sxs-lookup"><span data-stu-id="edd85-131">Windows Firewall with Advanced Security Design Guide</span></span>](https://go.microsoft.com/fwlink/?LinkId=116904)  
  
 [<span data-ttu-id="edd85-132">伺服器及網域隔離簡介</span><span class="sxs-lookup"><span data-stu-id="edd85-132">Introduction to Server and Domain Isolation</span></span>](https://go.microsoft.com/fwlink/?LinkId=116081)  
  
##  <a name="default-firewall-settings"></a><a name="BKMK_default"></a> <span data-ttu-id="edd85-133">預設防火牆設定</span><span class="sxs-lookup"><span data-stu-id="edd85-133">Default Firewall Settings</span></span>  
 <span data-ttu-id="edd85-134">規劃防火牆組態的第一個步驟是判斷作業系統之防火牆的目前狀態。</span><span class="sxs-lookup"><span data-stu-id="edd85-134">The first step in planning your firewall configuration is to determine the current status of the firewall for your operating system.</span></span> <span data-ttu-id="edd85-135">如果作業系統是從舊版升級，先前的防火牆設定可能已經保留下來。</span><span class="sxs-lookup"><span data-stu-id="edd85-135">If the operating system was upgraded from a previous version, the earlier firewall settings may have been preserved.</span></span> <span data-ttu-id="edd85-136">此外，其他管理員或網域中的「群組原則」可能已經變更了防火牆設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-136">Also, the firewall settings could have been changed by another administrator or by a Group Policy in your domain.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="edd85-137">開啟防火牆將會影響存取此電腦的其他程式，例如檔案及列印共用，以及遠端桌面連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-137">Turning on the firewall will affect other programs that access this computer, such as file and print sharing, and remote desktop connections.</span></span> <span data-ttu-id="edd85-138">調整防火牆設定之前，管理員應該考慮在電腦上執行的所有應用程式。</span><span class="sxs-lookup"><span data-stu-id="edd85-138">Administrators should consider all applications that are running on the computer before adjusting the firewall settings.</span></span>  
  
##  <a name="programs-to-configure-the-firewall"></a><a name="BKMK_programs"></a> <span data-ttu-id="edd85-139">設定防火牆的程式</span><span class="sxs-lookup"><span data-stu-id="edd85-139">Programs to Configure the Firewall</span></span>  
 <span data-ttu-id="edd85-140">有三種方式可設定 Windows 防火牆設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-140">There are three ways to configure the Windows Firewall settings.</span></span>  
  
-   <span data-ttu-id="edd85-141">**控制台中的 Windows 防火牆項目**</span><span class="sxs-lookup"><span data-stu-id="edd85-141">**Windows Firewall item in Control Panel**</span></span>  
  
     <span data-ttu-id="edd85-142">您可以從 [控制台] 開啟 **[Windows 防火牆]** 項目。</span><span class="sxs-lookup"><span data-stu-id="edd85-142">The **Windows Firewall** item can be opened from Control Panel.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="edd85-143">在 [控制台] 之 **[Windows 防火牆]** 項目中進行的變更只會影響目前的設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-143">Changes made in the **Windows Firewall** item in Control Panel only affect the current profile.</span></span> <span data-ttu-id="edd85-144">筆記型電腦等行動裝置不應該使用 [控制台] 中的 **[Windows 防火牆]** 項目，因為此設定檔可能會在不同的組態中連接時變更。</span><span class="sxs-lookup"><span data-stu-id="edd85-144">Mobile devices, for example a laptop, should not use the **Windows Firewall** item in Control Panel as the profile might change when it is connected in a different configuration.</span></span> <span data-ttu-id="edd85-145">然後，先前設定的設定檔將不會生效。</span><span class="sxs-lookup"><span data-stu-id="edd85-145">Then the previously-configured profile will not be in effect.</span></span> <span data-ttu-id="edd85-146">如需有關設定檔的詳細資訊，請參閱＜ [具有進階安全性的 Windows 防火牆入門指南](https://go.microsoft.com/fwlink/?LinkId=116080)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-146">For more information about profiles, see [Windows Firewall with Advanced Security Getting Started Guide](https://go.microsoft.com/fwlink/?LinkId=116080).</span></span>  
  
     <span data-ttu-id="edd85-147">[控制台] 中的 **[Windows 防火牆]** 項目可讓您設定一些基本選項。</span><span class="sxs-lookup"><span data-stu-id="edd85-147">The **Windows Firewall** item in Control Panel allows you to configure basic options.</span></span> <span data-ttu-id="edd85-148">這些選項包括：</span><span class="sxs-lookup"><span data-stu-id="edd85-148">These include the following:</span></span>  
  
    -   <span data-ttu-id="edd85-149">開啟或關閉 [控制台] 中的 **[Windows 防火牆]** 項目。</span><span class="sxs-lookup"><span data-stu-id="edd85-149">Turning the **Windows Firewall** item in Control Panel on or off</span></span>  
  
    -   <span data-ttu-id="edd85-150">啟用和停用規則</span><span class="sxs-lookup"><span data-stu-id="edd85-150">Enabling and disabling rules</span></span>  
  
    -   <span data-ttu-id="edd85-151">授與通訊埠和程式的例外</span><span class="sxs-lookup"><span data-stu-id="edd85-151">Granting exceptions for ports and programs</span></span>  
  
    -   <span data-ttu-id="edd85-152">設定某些範圍限制</span><span class="sxs-lookup"><span data-stu-id="edd85-152">Setting some scope restrictions</span></span>  
  
     <span data-ttu-id="edd85-153">[控制台] 中的 **[Windows 防火牆]** 項目最適合沒有防火牆組態設定經驗的使用者，以及針對非行動式電腦設定基本防火牆選項的使用者。</span><span class="sxs-lookup"><span data-stu-id="edd85-153">The **Windows Firewall** item in Control Panel is most appropriate for users who are not experienced in firewall configuration, and who are configuring basic firewall options for computers that are not mobile.</span></span> <span data-ttu-id="edd85-154">您也可以使用下列程式，從命令開啟 [控制台] 中的 [ **Windows 防火牆**] 專案 `run` ：</span><span class="sxs-lookup"><span data-stu-id="edd85-154">You can also open the **Windows Firewall** item in Control Panel from the `run` command by using the following procedure:</span></span>  
  
    #### <a name="to-open-the-windows-firewall-item"></a><span data-ttu-id="edd85-155">開啟 Windows 防火牆項目</span><span class="sxs-lookup"><span data-stu-id="edd85-155">To open the Windows Firewall item</span></span>  
  
    1.  <span data-ttu-id="edd85-156">在 **[開始]** 功能表按一下 **[執行]**，然後輸入 `firewall.cpl`。</span><span class="sxs-lookup"><span data-stu-id="edd85-156">On the **Start** menu, click **Run**, and then enter `firewall.cpl`.</span></span>  
  
    2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
-   <span data-ttu-id="edd85-157">**Microsoft Management Console (MMC)**</span><span class="sxs-lookup"><span data-stu-id="edd85-157">**Microsoft Management Console (MMC)**</span></span>  
  
     <span data-ttu-id="edd85-158">[具有進階安全性的 Windows 防火牆] MMC 嵌入式管理單元可讓您設定更多進階的防火牆設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-158">The Windows Firewall with Advanced Security MMC snap-in lets you configure more advanced firewall settings.</span></span> <span data-ttu-id="edd85-159">這個嵌入式管理單元會以容易使用的方式呈現大部分防火牆選項，而且它會呈現所有防火牆設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-159">This snap-in presents most of the firewall options in an easy-to-use manner, and presents all firewall profiles.</span></span> <span data-ttu-id="edd85-160">如需詳細資訊，請參閱本主題稍後的 [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) (使用具有進階安全性的 Windows 防火牆嵌入式管理單元)。</span><span class="sxs-lookup"><span data-stu-id="edd85-160">For more information, see [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) later in this topic.</span></span>  
  
-   <span data-ttu-id="edd85-161">**netsh**</span><span class="sxs-lookup"><span data-stu-id="edd85-161">**netsh**</span></span>  
  
     <span data-ttu-id="edd85-162">系統管理員可以使用 **netsh.exe** 工具，在命令提示字元中設定及監視 Windows 電腦，或是利用批次檔執行此作業 **。**</span><span class="sxs-lookup"><span data-stu-id="edd85-162">The **netsh.exe** tool can be used by an administrator to configure and monitor Windows-based computers at a command prompt or using a batch file **.**</span></span> <span data-ttu-id="edd85-163">藉由使用 **netsh** 工具，您可以指示輸入適當協助程式的內容命令，讓協助程式執行該命令。</span><span class="sxs-lookup"><span data-stu-id="edd85-163">By using the **netsh** tool, you can direct the context commands you enter to the appropriate helper, and the helper then performs the command.</span></span> <span data-ttu-id="edd85-164">協助程式為一動態連結程式庫 (.dll) 檔案，可為一或多項服務、公用程式或通訊協定提供組態、監視與支援，從而延伸 **netsh** 工具的功能。</span><span class="sxs-lookup"><span data-stu-id="edd85-164">A helper is a Dynamic Link Library (.dll) file that extends the functionality of the **netsh** tool by providing configuration, monitoring, and support for one or more services, utilities, or protocols.</span></span> <span data-ttu-id="edd85-165">所有支援 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的作業系統都有防火牆協助程式。</span><span class="sxs-lookup"><span data-stu-id="edd85-165">All operating systems that support [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] have a firewall helper.</span></span> [!INCLUDE[firstref_longhorn](../../includes/firstref-longhorn-md.md)] <span data-ttu-id="edd85-166">也提供進階防火牆協助程式，稱為 **advfirewall**。</span><span class="sxs-lookup"><span data-stu-id="edd85-166">also has an advanced firewall helper called **advfirewall**.</span></span> <span data-ttu-id="edd85-167">本主題將不會討論使用 **netsh** 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="edd85-167">The details of using **netsh** are not discussed in this topic.</span></span> <span data-ttu-id="edd85-168">不過，您可以使用 **netsh**設定本文所描述的許多組態選項。</span><span class="sxs-lookup"><span data-stu-id="edd85-168">However, many of the configuration options described can be configured by using **netsh**.</span></span> <span data-ttu-id="edd85-169">例如，在命令提示字元中執行下列指令碼，即可開啟</span><span class="sxs-lookup"><span data-stu-id="edd85-169">For example, run the following script at a command prompt to open TCP port 1433:</span></span>  
  
    ```  
    netsh firewall set portopening protocol = TCP port = 1433 name = SQLPort mode = ENABLE scope = SUBNET profile = CURRENT  
    ```  
  
     <span data-ttu-id="edd85-170">針對進階安全性協助程式使用 Windows 防火牆的類似範例：</span><span class="sxs-lookup"><span data-stu-id="edd85-170">A similar example using the Windows Firewall for Advanced Security helper:</span></span>  
  
    ```  
    netsh advfirewall firewall add rule name = SQLPort dir = in protocol = tcp action = allow localport = 1433 remoteip = localsubnet profile = DOMAIN  
    ```  
  
     <span data-ttu-id="edd85-171">如需有關 **netsh**的詳細資訊，請參閱下列連結：</span><span class="sxs-lookup"><span data-stu-id="edd85-171">For more information about **netsh**, see the following links:</span></span>  
  
    -   [<span data-ttu-id="edd85-172">如何使用 Netsh.exe 工具和命令列參數</span><span class="sxs-lookup"><span data-stu-id="edd85-172">How to Use the Netsh.exe Tool and Command-Line Switches</span></span>](https://support.microsoft.com/kb/242468)  
  
    -   <span data-ttu-id="edd85-173">[How to use the "netsh advfirewall firewall" context instead of the "netsh firewall" context to control Windows Firewall behavior in Windows Server 2008 and in Windows Vista](https://support.microsoft.com/kb/947709) (如何使用 "netsh advfirewall firewall" 內容而非 "netsh firewall" 內容來控制 Windows Server 2008 和 Windows Vista 的 Windows 防火牆行為)</span><span class="sxs-lookup"><span data-stu-id="edd85-173">[How to use the "netsh advfirewall firewall" context instead of the "netsh firewall" context to control Windows Firewall behavior in Windows Server 2008 and in Windows Vista](https://support.microsoft.com/kb/947709)</span></span>  
  
    -   [<span data-ttu-id="edd85-174">搭配 "profile=all" 參數使用的 "netsh firewall" 命令不會在 Windows Vista 架構的電腦上設定公用設定檔</span><span class="sxs-lookup"><span data-stu-id="edd85-174">The "netsh firewall" command together with the "profile=all" parameter does not configure the public profile on a Windows Vista-based computer</span></span>](https://support.microsoft.com/kb/947213)  
  
## <a name="ports-used-by-ssnoversion"></a><span data-ttu-id="edd85-175">使用的通訊埠 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="edd85-175">Ports Used By [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span></span>  
 <span data-ttu-id="edd85-176">下列表格可以協助您識別 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-176">The following tables can help you identify the ports being used by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
###  <a name="ports-used-by-the-database-engine"></a><a name="BKMK_ssde"></a> <span data-ttu-id="edd85-177">Ports Used By the Database Engine</span><span class="sxs-lookup"><span data-stu-id="edd85-177">Ports Used By the Database Engine</span></span>  
 <span data-ttu-id="edd85-178">下表將列出 [!INCLUDE[ssDE](../../includes/ssde-md.md)]常用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-178">The following table lists the ports that are frequently used by the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>  
  
|<span data-ttu-id="edd85-179">狀況</span><span class="sxs-lookup"><span data-stu-id="edd85-179">Scenario</span></span>|<span data-ttu-id="edd85-180">連接埠</span><span class="sxs-lookup"><span data-stu-id="edd85-180">Port</span></span>|<span data-ttu-id="edd85-181">註解</span><span class="sxs-lookup"><span data-stu-id="edd85-181">Comments</span></span>|  
|--------------|----------|--------------|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-182">預設執行個體</span><span class="sxs-lookup"><span data-stu-id="edd85-182">default instance running over TCP</span></span>|<span data-ttu-id="edd85-183">TCP 通訊埠 1433</span><span class="sxs-lookup"><span data-stu-id="edd85-183">TCP port 1433</span></span>|<span data-ttu-id="edd85-184">這是允許通過防火牆最常見的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-184">This is the most common port allowed through the firewall.</span></span> <span data-ttu-id="edd85-185">它適用於 [!INCLUDE[ssDE](../../includes/ssde-md.md)]預設安裝的一般連接，或在電腦上唯一執行之執行個體的具名執行個體</span><span class="sxs-lookup"><span data-stu-id="edd85-185">It applies to routine connections to the default installation of the [!INCLUDE[ssDE](../../includes/ssde-md.md)], or a named instance that is the only instance running on the computer.</span></span> <span data-ttu-id="edd85-186">(具名執行個體具有特殊考量。</span><span class="sxs-lookup"><span data-stu-id="edd85-186">(Named instances have special considerations.</span></span> <span data-ttu-id="edd85-187">請參閱本主題稍後的[動態通訊埠](#BKMK_dynamic_ports)。 ) </span><span class="sxs-lookup"><span data-stu-id="edd85-187">See [Dynamic Ports](#BKMK_dynamic_ports) later in this topic.)</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-188">具名執行個體</span><span class="sxs-lookup"><span data-stu-id="edd85-188">named instances in the default configuration</span></span>|<span data-ttu-id="edd85-189">此 TCP 通訊埠是在 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 啟動時決定的動態通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-189">The TCP port is a dynamic port determined at the time the [!INCLUDE[ssDE](../../includes/ssde-md.md)] starts.</span></span>|<span data-ttu-id="edd85-190">請參閱下面「 [動態通訊埠](#BKMK_dynamic_ports)」一節的討論。</span><span class="sxs-lookup"><span data-stu-id="edd85-190">See the discussion below in the section [Dynamic Ports](#BKMK_dynamic_ports).</span></span> <span data-ttu-id="edd85-191">當您使用具名執行個體時， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服務可能會需要 UDP 通訊埠 1434。</span><span class="sxs-lookup"><span data-stu-id="edd85-191">UDP port 1434 might be required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser Service when you are using named instances.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-192">具名執行個體</span><span class="sxs-lookup"><span data-stu-id="edd85-192">named instances when they are configured to use a fixed port</span></span>|<span data-ttu-id="edd85-193">管理員所設定的通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-193">The port number configured by the administrator.</span></span>|<span data-ttu-id="edd85-194">請參閱下面「 [動態通訊埠](#BKMK_dynamic_ports)」一節的討論。</span><span class="sxs-lookup"><span data-stu-id="edd85-194">See the discussion below in the section [Dynamic Ports](#BKMK_dynamic_ports).</span></span>|  
|<span data-ttu-id="edd85-195">專用管理員連接</span><span class="sxs-lookup"><span data-stu-id="edd85-195">Dedicated Admin Connection</span></span>|<span data-ttu-id="edd85-196">TCP 通訊埠 1434 (預設執行個體)。</span><span class="sxs-lookup"><span data-stu-id="edd85-196">TCP port 1434 for the default instance.</span></span> <span data-ttu-id="edd85-197">其他通訊埠則用於具名執行個體。</span><span class="sxs-lookup"><span data-stu-id="edd85-197">Other ports are used for named instances.</span></span> <span data-ttu-id="edd85-198">請檢查錯誤記錄檔，以取得通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-198">Check the error log for the port number.</span></span>|<span data-ttu-id="edd85-199">根據預設，系統不會啟用專用管理員連接 (DAC) 的遠端連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-199">By default, remote connections to the Dedicated Administrator Connection (DAC) are not enabled.</span></span> <span data-ttu-id="edd85-200">若要啟用遠端 DAC，請使用介面區組態 Facet。</span><span class="sxs-lookup"><span data-stu-id="edd85-200">To enable remote DAC, use the Surface Area Configuration facet.</span></span> <span data-ttu-id="edd85-201">如需詳細資訊，請參閱＜ [Surface Area Configuration](../../relational-databases/security/surface-area-configuration.md)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-201">For more information, see [Surface Area Configuration](../../relational-databases/security/surface-area-configuration.md).</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-202">Browser 服務</span><span class="sxs-lookup"><span data-stu-id="edd85-202">Browser service</span></span>|<span data-ttu-id="edd85-203">UDP 通訊埠 1434</span><span class="sxs-lookup"><span data-stu-id="edd85-203">UDP port 1434</span></span>|<span data-ttu-id="edd85-204">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服務會接聽具名執行個體的內送連接，並且將對應至該具名執行個體的 TCP 通訊埠編號提供給用戶端。</span><span class="sxs-lookup"><span data-stu-id="edd85-204">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service listens for incoming connections to a named instance and provides the client the TCP port number that corresponds to that named instance.</span></span> <span data-ttu-id="edd85-205">每當使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的具名執行個體時，通常就會啟動 [!INCLUDE[ssDE](../../includes/ssde-md.md)] Browser 服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-205">Normally the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service is started whenever named instances of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] are used.</span></span> <span data-ttu-id="edd85-206">如果用戶端設定成連接至具名執行個體的特定通訊埠，就不需要啟動 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-206">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser service does not have to be started if the client is configured to connect to the specific port of the named instance.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-207">執行個體。</span><span class="sxs-lookup"><span data-stu-id="edd85-207">instance running over an HTTP endpoint.</span></span>|<span data-ttu-id="edd85-208">可以在建立 HTTP 端點時指定。</span><span class="sxs-lookup"><span data-stu-id="edd85-208">Can be specified when an HTTP endpoint is created.</span></span> <span data-ttu-id="edd85-209">預設值為 TCP 通訊埠 80 (用於 CLEAR_PORT 傳輸) 和 443 (用於 SSL_PORT 傳輸)。</span><span class="sxs-lookup"><span data-stu-id="edd85-209">The default is TCP port 80 for CLEAR_PORT traffic and 443 for SSL_PORT traffic.</span></span>|<span data-ttu-id="edd85-210">用於透過 URL 進行 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-210">Used for an HTTP connection through a URL.</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-211">預設執行個體</span><span class="sxs-lookup"><span data-stu-id="edd85-211">default instance running over an HTTPS endpoint.</span></span>|<span data-ttu-id="edd85-212">TCP 通訊埠 443</span><span class="sxs-lookup"><span data-stu-id="edd85-212">TCP port 443</span></span>|<span data-ttu-id="edd85-213">用於透過 URL 進行 HTTPS 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-213">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="edd85-214">HTTPS 是使用安全通訊端層 (SSL) 的 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-214">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span>|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|<span data-ttu-id="edd85-215">TCP 通訊埠 4022。</span><span class="sxs-lookup"><span data-stu-id="edd85-215">TCP port 4022.</span></span> <span data-ttu-id="edd85-216">若要確認使用的通訊埠，請執行下列查詢：</span><span class="sxs-lookup"><span data-stu-id="edd85-216">To verify the port used, execute the following query:</span></span><br /><br /> `SELECT name, protocol_desc, port, state_desc`<br /><br /> `FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'SERVICE_BROKER'`|<span data-ttu-id="edd85-217">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssSB](../../includes/sssb-md.md)]沒有預設連接埠，但這是線上叢書範例中的傳統組態。</span><span class="sxs-lookup"><span data-stu-id="edd85-217">There is no default port for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssSB](../../includes/sssb-md.md)], but this is the conventional configuration used in Books Online examples.</span></span>|  
|<span data-ttu-id="edd85-218">資料庫鏡像</span><span class="sxs-lookup"><span data-stu-id="edd85-218">Database Mirroring</span></span>|<span data-ttu-id="edd85-219">管理員所選擇的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-219">Administrator chosen port.</span></span> <span data-ttu-id="edd85-220">若要判斷此通訊埠，請執行下列查詢：</span><span class="sxs-lookup"><span data-stu-id="edd85-220">To determine the port, execute the following query:</span></span><br /><br /> `SELECT name, protocol_desc, port, state_desc FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'DATABASE_MIRRORING'`|<span data-ttu-id="edd85-221">雖然資料庫鏡像沒有預設通訊埠，不過線上叢書範例會使用 TCP 通訊埠 7022。</span><span class="sxs-lookup"><span data-stu-id="edd85-221">There is no default port for database mirroring however Books Online examples use TCP port 7022.</span></span> <span data-ttu-id="edd85-222">請務必避免中斷使用中的鏡像端點，尤其是在具有自動容錯移轉的高安全性模式中。</span><span class="sxs-lookup"><span data-stu-id="edd85-222">It is very important to avoid interrupting an in-use mirroring endpoint, especially in high-safety mode with automatic failover.</span></span> <span data-ttu-id="edd85-223">您的防火牆組態必須避免中斷仲裁。</span><span class="sxs-lookup"><span data-stu-id="edd85-223">Your firewall configuration must avoid breaking quorum.</span></span> <span data-ttu-id="edd85-224">如需詳細資訊，請參閱 [指定伺服器網路位址 &#40;資料庫鏡像&#41;](../../database-engine/database-mirroring/specify-a-server-network-address-database-mirroring.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-224">For more information, see [Specify a Server Network Address &#40;Database Mirroring&#41;](../../database-engine/database-mirroring/specify-a-server-network-address-database-mirroring.md).</span></span>|  
|<span data-ttu-id="edd85-225">複寫</span><span class="sxs-lookup"><span data-stu-id="edd85-225">Replication</span></span>|<span data-ttu-id="edd85-226">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的複寫連接會使用一般的 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 通訊埠 (例如，預設執行個體的 TCP 通訊埠 1433)。</span><span class="sxs-lookup"><span data-stu-id="edd85-226">Replication connections to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] use the typical regular [!INCLUDE[ssDE](../../includes/ssde-md.md)] ports (TCP port 1433 for the default instance, etc.)</span></span><br /><br /> <span data-ttu-id="edd85-227">複寫快照集的 Web 同步處理和 FTP/UNC 存取需要在防火牆上開啟其他通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-227">Web synchronization and FTP/UNC access for replication snapshot require additional ports to be opened on the firewall.</span></span> <span data-ttu-id="edd85-228">為了將初始資料和結構描述從某個位置傳送至另一個位置，複寫可能會使用 FTP (TCP 通訊埠 21)、透過 HTTP 同步處理 (TCP 通訊埠 80) 或檔案共用。</span><span class="sxs-lookup"><span data-stu-id="edd85-228">To transfer initial data and schema from one location to another, replication can use FTP (TCP port 21), or sync over HTTP (TCP port 80) or File Sharing.</span></span> <span data-ttu-id="edd85-229">檔案共用會使用 UDP 通訊埠 137 和 138，以及 TCP 通訊埠 139 (如果使用 NetBIOS)。</span><span class="sxs-lookup"><span data-stu-id="edd85-229">File sharing uses UDP port 137 and 138, and TCP port 139 if it using NetBIOS.</span></span> <span data-ttu-id="edd85-230">檔案共用使用 TCP 通訊埠 445。</span><span class="sxs-lookup"><span data-stu-id="edd85-230">File Sharing uses TCP port 445.</span></span>|<span data-ttu-id="edd85-231">若為透過 HTTP 同步處理，複寫會使用 IIS 端點 (其通訊埠可設定，但預設為通訊埠 80)，不過 IIS 處理序會透過預設執行個體的標準通訊埠 (1433) 連接至後端 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="edd85-231">For sync over HTTP, replication uses the IIS endpoint (ports for which are configurable but is port 80 by default), but the IIS process connects to the backend [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] through the standard ports (1433 for the default instance.</span></span><br /><br /> <span data-ttu-id="edd85-232">在使用 FTP 進行 Web 同步處理期間，FTP 傳送是介於 IIS 與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 發行者之間，而非介於訂閱者與 IIS 之間。</span><span class="sxs-lookup"><span data-stu-id="edd85-232">During Web synchronization using FTP, the FTP transfer is between IIS and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] publisher, not between subscriber and IIS.</span></span>|  
|[!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="edd85-233">偵錯工具</span><span class="sxs-lookup"><span data-stu-id="edd85-233">debugger</span></span>|<span data-ttu-id="edd85-234">TCP 通訊埠 135</span><span class="sxs-lookup"><span data-stu-id="edd85-234">TCP port 135</span></span><br /><br /> <span data-ttu-id="edd85-235">請參閱「 [通訊埠 135 的特殊考量](#BKMK_port_135)」</span><span class="sxs-lookup"><span data-stu-id="edd85-235">See [Special Considerations for Port 135](#BKMK_port_135)</span></span><br /><br /> <span data-ttu-id="edd85-236">可能也需要「 [IPsec](#BKMK_additional_ports) 」例外。</span><span class="sxs-lookup"><span data-stu-id="edd85-236">The [IPsec](#BKMK_additional_ports) exception might also be required.</span></span>|<span data-ttu-id="edd85-237">如果您正在使用 [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]，也必須在 [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] 主機電腦上，將 **Devenv.exe** 加入至「例外」清單並開啟 TCP 通訊埠 135。</span><span class="sxs-lookup"><span data-stu-id="edd85-237">If using [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)], on the [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] host computer, you must also add **Devenv.exe** to the Exceptions list and open TCP port 135.</span></span><br /><br /> <span data-ttu-id="edd85-238">如果您正在使用 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]，也必須在 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 主機電腦上，將 **ssms.exe** 加入至「例外」清單並開啟</span><span class="sxs-lookup"><span data-stu-id="edd85-238">If using [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], on the [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] host computer, you must also add **ssms.exe** to the Exceptions list and open TCP port 135.</span></span> <span data-ttu-id="edd85-239">如需詳細資訊，請參閱[設定 Transact-sql 偵錯工具](../../relational-databases/scripting/configure-firewall-rules-before-running-the-tsql-debugger.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-239">For more information, see [Configure the Transact-SQL Debugger](../../relational-databases/scripting/configure-firewall-rules-before-running-the-tsql-debugger.md).</span></span>|  
  
 <span data-ttu-id="edd85-240">如需為 [!INCLUDE[ssDE](../../includes/ssde-md.md)]設定 Windows 防火牆的逐步解說指示，請參閱 [設定用於 Database Engine 存取的 Windows 防火牆](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-240">For step by step instructions to configure the Windows Firewall for the [!INCLUDE[ssDE](../../includes/ssde-md.md)], see [Configure a Windows Firewall for Database Engine Access](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).</span></span>  
  
####  <a name="dynamic-ports"></a><a name="BKMK_dynamic_ports"></a> <span data-ttu-id="edd85-241">動態通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-241">Dynamic Ports</span></span>  
 <span data-ttu-id="edd85-242">根據預設，具名執行個體 (包括 [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]) 會使用動態通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-242">By default, named instances (including [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]) use dynamic ports.</span></span> <span data-ttu-id="edd85-243">這表示每次 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 啟動時，它就會識別可用的通訊埠並使用該通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-243">That means that every time that the [!INCLUDE[ssDE](../../includes/ssde-md.md)] starts, it identifies an available port and uses that port number.</span></span> <span data-ttu-id="edd85-244">如果具名執行個體是唯一安裝的 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 執行個體，它可能會使用 TCP 通訊埠 1433。</span><span class="sxs-lookup"><span data-stu-id="edd85-244">If the named instance is the only instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] installed, it will probably use TCP port 1433.</span></span> <span data-ttu-id="edd85-245">如果安裝了其他 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 執行個體，它可能會使用不同的 TCP 通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-245">If other instances of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] are installed, it will probably use a different TCP port.</span></span> <span data-ttu-id="edd85-246">由於選取的通訊埠可能會在每次 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 啟動時變更，所以很難將防火牆設定成允許存取正確的通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-246">Because the port selected might change every time that the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is started, it is difficult to configure the firewall to enable access to the correct port number.</span></span> <span data-ttu-id="edd85-247">因此，如果已使用防火牆，我們建議您將 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 重新設定成每次都使用相同的通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-247">Therefore, if a firewall is used, we recommend reconfiguring the [!INCLUDE[ssDE](../../includes/ssde-md.md)] to use the same port number every time.</span></span> <span data-ttu-id="edd85-248">這個通訊埠就稱為固定通訊埠或靜態通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-248">This is called a fixed port or a static port.</span></span> <span data-ttu-id="edd85-249">如需詳細資訊，請參閱[設定伺服器接聽特定 TCP 通訊埠 &#40;SQL Server 組態管理員&#41;](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-249">For more information, see [Configure a Server to Listen on a Specific TCP Port &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md).</span></span>  
  
 <span data-ttu-id="edd85-250">另一種設定具名執行個體接聽固定通訊埠的方法，是在防火牆中為 **sqlservr.exe** (適用於[!INCLUDE[ssDE](../../includes/ssde-md.md)]) 一類的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 程式建立例外狀況。</span><span class="sxs-lookup"><span data-stu-id="edd85-250">An alternative to configuring a named instance to listen on a fixed port is to create an exception in the firewall for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] program such as **sqlservr.exe** (for the [!INCLUDE[ssDE](../../includes/ssde-md.md)]).</span></span> <span data-ttu-id="edd85-251">雖然這樣很方便，但當您使用具有進階安全性的 Windows 防火牆 MMC 嵌入式管理單元時，通訊埠編號將不會顯示在 [輸入規則]  頁面的 [本機通訊埠]  資料行中。</span><span class="sxs-lookup"><span data-stu-id="edd85-251">This can be convenient, but the port number will not appear in the **Local Port** column of the **Inbound Rules** page when you are using the Windows Firewall with Advanced Security MMC snap-in.</span></span> <span data-ttu-id="edd85-252">如此一來可能會讓您更難以稽核哪些通訊埠已開啟。</span><span class="sxs-lookup"><span data-stu-id="edd85-252">This can make it more difficult to audit which ports are open.</span></span> <span data-ttu-id="edd85-253">其他考量是 Service Pack 或累積更新可能會變更 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可執行檔的路徑，因而使防火牆規則失效。</span><span class="sxs-lookup"><span data-stu-id="edd85-253">Another consideration is that a service pack or cumulative update can change the path to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] executable which will invalidate the firewall rule.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="edd85-254">下列程序會使用 [控制台] 中的 **[Windows 防火牆]** 項目。</span><span class="sxs-lookup"><span data-stu-id="edd85-254">The following procedure uses the **Windows Firewall** item in Control Panel.</span></span> <span data-ttu-id="edd85-255">[具有進階安全性的 Windows 防火牆] MMC 嵌入式管理單元可以設定更複雜的規則。</span><span class="sxs-lookup"><span data-stu-id="edd85-255">The Windows Firewall with Advanced Security MMC snap-in can configure a more complex rule.</span></span> <span data-ttu-id="edd85-256">這包括設定服務例外，以便用於提供深度防禦。</span><span class="sxs-lookup"><span data-stu-id="edd85-256">This includes configuring a service exception which can be useful for providing defense in depth.</span></span> <span data-ttu-id="edd85-257">請參閱下面的 [使用具有進階安全的 Windows 防火牆性嵌入式管理單元](#BKMK_WF_msc) 。</span><span class="sxs-lookup"><span data-stu-id="edd85-257">See [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) below.</span></span>  
  
###### <a name="to-add-a-program-exception-to-the-firewall-using-the-windows-firewall-item-in-control-panel"></a><span data-ttu-id="edd85-258">使用控制台中的 Windows 防火牆項目，將程式例外加入至防火牆</span><span class="sxs-lookup"><span data-stu-id="edd85-258">To add a program exception to the firewall using the Windows Firewall item in Control Panel.</span></span>  
  
1.  <span data-ttu-id="edd85-259">在 [控制台] 中，於 **[Windows 防火牆]** 項目的 **[例外]** 索引標籤上，按一下 **[新增程式]**。</span><span class="sxs-lookup"><span data-stu-id="edd85-259">On the **Exceptions** tab of the **Windows Firewall** item in Control Panel, click **Add a program**.</span></span>  
  
2.  <span data-ttu-id="edd85-260">流覽至 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 您想要允許通過防火牆的實例位置，例如**C:\Program Files\Microsoft SQL Server\MSSQL12. <instance_name> \mssql\binn**]、選取 [ **sqlservr.exe**]，然後按一下 [**開啟**]。</span><span class="sxs-lookup"><span data-stu-id="edd85-260">Browse to the location of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that you want to allow through the firewall, for example **C:\Program Files\Microsoft SQL Server\MSSQL12.<instance_name>\MSSQL\Binn**, select **sqlservr.exe**, and then click **Open**.</span></span>  
  
3.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
 <span data-ttu-id="edd85-261">如需端點的詳細資訊，請參閱[設定 Database Engine 接聽多個 TCP 通訊埠](../../database-engine/configure-windows/configure-the-database-engine-to-listen-on-multiple-tcp-ports.md)和[端點目錄檢視 &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/endpoints-catalog-views-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="edd85-261">For more information about endpoints, see [Configure the Database Engine to Listen on Multiple TCP Ports](../../database-engine/configure-windows/configure-the-database-engine-to-listen-on-multiple-tcp-ports.md) and [Endpoints Catalog Views &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/endpoints-catalog-views-transact-sql).</span></span>  
  
###  <a name="ports-used-by-analysis-services"></a><a name="BKMK_ssas"></a> <span data-ttu-id="edd85-262">Analysis Services 所使用的通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-262">Ports Used By Analysis Services</span></span>  
 <span data-ttu-id="edd85-263">下表將列出 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]常用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-263">The following table lists the ports that are frequently used by [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>  
  
|<span data-ttu-id="edd85-264">功能</span><span class="sxs-lookup"><span data-stu-id="edd85-264">Feature</span></span>|<span data-ttu-id="edd85-265">連接埠</span><span class="sxs-lookup"><span data-stu-id="edd85-265">Port</span></span>|<span data-ttu-id="edd85-266">註解</span><span class="sxs-lookup"><span data-stu-id="edd85-266">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]|<span data-ttu-id="edd85-267">TCP 通訊埠 2383 (預設執行個體)</span><span class="sxs-lookup"><span data-stu-id="edd85-267">TCP port 2383 for the default instance</span></span>|<span data-ttu-id="edd85-268">[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]預設執行個體的標準通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-268">The standard port for the default instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-269">Browser 服務</span><span class="sxs-lookup"><span data-stu-id="edd85-269">Browser service</span></span>|<span data-ttu-id="edd85-270">TCP 通訊埠 2382 (只有 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 具名執行個體需要)</span><span class="sxs-lookup"><span data-stu-id="edd85-270">TCP port 2382 only needed for an [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] named instance</span></span>|<span data-ttu-id="edd85-271">沒有指定通訊埠編號之 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] 具名執行個體的用戶端連接要求會被導向至通訊埠 2382，亦即 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 所接聽的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-271">Client connection requests for a named instance of [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] that do not specify a port number are directed to port 2382, the port on which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser listens.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-272">Browser 會將要求重新導向至具名執行個體所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-272">Browser then redirects the request to the port that the named instance uses.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="edd85-273">設定成可透過 IIS/HTTP 使用</span><span class="sxs-lookup"><span data-stu-id="edd85-273">configured for use through IIS/HTTP</span></span><br /><br /> <span data-ttu-id="edd85-274"> (樞紐分析表嗎？</span><span class="sxs-lookup"><span data-stu-id="edd85-274">(The PivotTable??</span></span> <span data-ttu-id="edd85-275">服務使用 HTTP 或 HTTPS) </span><span class="sxs-lookup"><span data-stu-id="edd85-275">Service uses HTTP or HTTPS)</span></span>|<span data-ttu-id="edd85-276">TCP 通訊埠 80</span><span class="sxs-lookup"><span data-stu-id="edd85-276">TCP port 80</span></span>|<span data-ttu-id="edd85-277">用於透過 URL 進行 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-277">Used for an HTTP connection through a URL.</span></span>|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] <span data-ttu-id="edd85-278">設定成可透過 IIS/HTTPS 使用</span><span class="sxs-lookup"><span data-stu-id="edd85-278">configured for use through IIS/HTTPS</span></span><br /><br /> <span data-ttu-id="edd85-279"> (樞紐分析表嗎？</span><span class="sxs-lookup"><span data-stu-id="edd85-279">(The PivotTable??</span></span> <span data-ttu-id="edd85-280">服務使用 HTTP 或 HTTPS) </span><span class="sxs-lookup"><span data-stu-id="edd85-280">Service uses HTTP or HTTPS)</span></span>|<span data-ttu-id="edd85-281">TCP 通訊埠 443</span><span class="sxs-lookup"><span data-stu-id="edd85-281">TCP port 443</span></span>|<span data-ttu-id="edd85-282">用於透過 URL 進行 HTTPS 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-282">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="edd85-283">HTTPS 是使用安全通訊端層 (SSL) 的 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-283">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span>|  
  
 <span data-ttu-id="edd85-284">如果使用者透過 IIS 和網際網路存取 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] ，您就必須開啟 IIS 所接聽的通訊埠，並且在用戶端連接字串中指定該通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-284">If users access [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] through IIS and the Internet, you must open the port on which IIS is listening and specify that port in the client connection string.</span></span> <span data-ttu-id="edd85-285">在此情況下，針對直接存取 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]，則不必開啟任何通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-285">In this case, no ports have to be open for direct access to [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].</span></span> <span data-ttu-id="edd85-286">不過，您應該限制預設通訊埠 2389 和通訊埠 2382 與所有不需要的其他通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-286">The default port 2389, and port 2382, should be restricted together with all other ports that are not required.</span></span>  
  
 <span data-ttu-id="edd85-287">如需設定 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的 Windows 防火牆之逐步解說指示，請參閱 [Configure the Windows Firewall to Allow Analysis Services Access](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md)(設定 Windows 防火牆以允許 Analysis Services 存取)。</span><span class="sxs-lookup"><span data-stu-id="edd85-287">For step by step instructions to configure the Windows Firewall for [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], see [Configure the Windows Firewall to Allow Analysis Services Access](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md).</span></span>  
  
###  <a name="ports-used-by-reporting-services"></a><a name="BKMK_ssrs"></a> <span data-ttu-id="edd85-288">Reporting Services 所使用的通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-288">Ports Used By Reporting Services</span></span>  
 <span data-ttu-id="edd85-289">下表將列出 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]常用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-289">The following table lists the ports that are frequently used by [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].</span></span>  
  
|<span data-ttu-id="edd85-290">功能</span><span class="sxs-lookup"><span data-stu-id="edd85-290">Feature</span></span>|<span data-ttu-id="edd85-291">連接埠</span><span class="sxs-lookup"><span data-stu-id="edd85-291">Port</span></span>|<span data-ttu-id="edd85-292">註解</span><span class="sxs-lookup"><span data-stu-id="edd85-292">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="edd85-293">Web 服務</span><span class="sxs-lookup"><span data-stu-id="edd85-293">Web Services</span></span>|<span data-ttu-id="edd85-294">TCP 通訊埠 80</span><span class="sxs-lookup"><span data-stu-id="edd85-294">TCP port 80</span></span>|<span data-ttu-id="edd85-295">用於透過 URL 進行 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 的 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-295">Used for an HTTP connection to [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] through a URL.</span></span> <span data-ttu-id="edd85-296">建議您不要使用預先設定的規則 **World Wide Web 服務 (HTTP)** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-296">We recommend that you do not use the preconfigured rule **World Wide Web Services (HTTP)**.</span></span> <span data-ttu-id="edd85-297">如需詳細資訊，請參閱下面的「 [與其他防火牆規則的互動](#BKMK_other_rules) 」一節。</span><span class="sxs-lookup"><span data-stu-id="edd85-297">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="edd85-298">設定成可透過 HTTPS 使用</span><span class="sxs-lookup"><span data-stu-id="edd85-298">configured for use through HTTPS</span></span>|<span data-ttu-id="edd85-299">TCP 通訊埠 443</span><span class="sxs-lookup"><span data-stu-id="edd85-299">TCP port 443</span></span>|<span data-ttu-id="edd85-300">用於透過 URL 進行 HTTPS 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-300">Used for an HTTPS connection through a URL.</span></span> <span data-ttu-id="edd85-301">HTTPS 是使用安全通訊端層 (SSL) 的 HTTP 連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-301">HTTPS is an HTTP connection that uses secure sockets layer (SSL).</span></span> <span data-ttu-id="edd85-302">建議您不要使用預先設定的規則 **Secure World Wide Web 服務 (HTTPS)** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-302">We recommend that you do not use the preconfigured rule **Secure World Wide Web Services (HTTPS)**.</span></span> <span data-ttu-id="edd85-303">如需詳細資訊，請參閱下面的「 [與其他防火牆規則的互動](#BKMK_other_rules) 」一節。</span><span class="sxs-lookup"><span data-stu-id="edd85-303">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
  
 <span data-ttu-id="edd85-304">當 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] 連接至 [!INCLUDE[ssDE](../../includes/ssde-md.md)] 或 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]的執行個體時，您也必須針對這些服務開啟適當的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-304">When [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] connects to an instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] or [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)], you must also open the appropriate ports for those services.</span></span> <span data-ttu-id="edd85-305">如需設定 [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]Windows 防火牆的逐步指示， [Configure a Firewall for Report Server Access](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md)(設定報表伺服器存取的防火牆)。</span><span class="sxs-lookup"><span data-stu-id="edd85-305">For step-by-step instructions to configure the Windows Firewall for [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], [Configure a Firewall for Report Server Access](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md).</span></span>  
  
###  <a name="ports-used-by-integration-services"></a><a name="BKMK_ssis"></a> <span data-ttu-id="edd85-306">Integration Services 所使用的通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-306">Ports Used By Integration Services</span></span>  
 <span data-ttu-id="edd85-307">下表將列出 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服務所使用的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-307">The following table lists the ports that are used by the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service.</span></span>  
  
|<span data-ttu-id="edd85-308">功能</span><span class="sxs-lookup"><span data-stu-id="edd85-308">Feature</span></span>|<span data-ttu-id="edd85-309">連接埠</span><span class="sxs-lookup"><span data-stu-id="edd85-309">Port</span></span>|<span data-ttu-id="edd85-310">註解</span><span class="sxs-lookup"><span data-stu-id="edd85-310">Comments</span></span>|  
|-------------|----------|--------------|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="edd85-311">遠端程序呼叫 (MS RPC)</span><span class="sxs-lookup"><span data-stu-id="edd85-311">remote procedure calls (MS RPC)</span></span><br /><br /> <span data-ttu-id="edd85-312">由 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 執行階段所使用。</span><span class="sxs-lookup"><span data-stu-id="edd85-312">Used by the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] runtime.</span></span>|<span data-ttu-id="edd85-313">TCP 通訊埠 135</span><span class="sxs-lookup"><span data-stu-id="edd85-313">TCP port 135</span></span><br /><br /> <span data-ttu-id="edd85-314">請參閱「 [通訊埠 135 的特殊考量](#BKMK_port_135)」</span><span class="sxs-lookup"><span data-stu-id="edd85-314">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|<span data-ttu-id="edd85-315">[!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服務會在通訊埠 135 上使用 DCOM。</span><span class="sxs-lookup"><span data-stu-id="edd85-315">The [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service uses DCOM on port 135.</span></span> <span data-ttu-id="edd85-316">服務控制管理員會使用通訊埠 135 來執行一些工作，例如啟動和停止 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 服務，以及將控制要求傳送至執行中服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-316">The Service Control Manager uses port 135 to perform tasks such as starting and stopping the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service and transmitting control requests to the running service.</span></span> <span data-ttu-id="edd85-317">您無法變更此通訊埠編號。</span><span class="sxs-lookup"><span data-stu-id="edd85-317">The port number cannot be changed.</span></span><br /><br /> <span data-ttu-id="edd85-318">只有當您要從 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 或自訂應用程式連接至 [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 服務的遠端執行個體時，才需要開啟這個通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-318">This port is only required to be open if you are connecting to a remote instance of the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] service from [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] or a custom application.</span></span>|  
  
 <span data-ttu-id="edd85-319">如需為 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]設定 Windows 防火牆的逐步解說指示，請參閱 [設定用於 Database Engine 存取的 Windows 防火牆](../../../2014/integration-services/configure-a-windows-firewall-for-access-to-the-ssis-service.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-319">For step-by-step instructions to configure the Windows Firewall for [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], see [Configure a Windows Firewall for Access to the SSIS Service](../../../2014/integration-services/configure-a-windows-firewall-for-access-to-the-ssis-service.md).</span></span>  
  
###  <a name="additional-ports-and-services"></a><a name="BKMK_additional_ports"></a> <span data-ttu-id="edd85-320">其他通訊埠和服務</span><span class="sxs-lookup"><span data-stu-id="edd85-320">Additional Ports and Services</span></span>  
 <span data-ttu-id="edd85-321">下表將列出 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 可能會相依的通訊埠和服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-321">The following table lists ports and services that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might depend on.</span></span>  
  
|<span data-ttu-id="edd85-322">狀況</span><span class="sxs-lookup"><span data-stu-id="edd85-322">Scenario</span></span>|<span data-ttu-id="edd85-323">連接埠</span><span class="sxs-lookup"><span data-stu-id="edd85-323">Port</span></span>|<span data-ttu-id="edd85-324">註解</span><span class="sxs-lookup"><span data-stu-id="edd85-324">Comments</span></span>|  
|--------------|----------|--------------|  
|<span data-ttu-id="edd85-325">Windows Management Instrumentation</span><span class="sxs-lookup"><span data-stu-id="edd85-325">Windows Management Instrumentation</span></span><br /><br /> <span data-ttu-id="edd85-326">如需有關 WMI 的詳細資訊，請參閱＜ [WMI Provider for Configuration Management Concepts](../../relational-databases/wmi-provider-configuration/wmi-provider-for-configuration-management.md)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-326">For more information about WMI, see [WMI Provider for Configuration Management Concepts](../../relational-databases/wmi-provider-configuration/wmi-provider-for-configuration-management.md)</span></span>|<span data-ttu-id="edd85-327">WMI 會使用透過 DCOM 所指派的通訊埠，當做共用服務主機執行。</span><span class="sxs-lookup"><span data-stu-id="edd85-327">WMI runs as part of a shared service host with ports assigned through DCOM.</span></span> <span data-ttu-id="edd85-328">WMI 可能正在使用 TCP 通訊埠 135。</span><span class="sxs-lookup"><span data-stu-id="edd85-328">WMI might be using TCP port 135.</span></span><br /><br /> <span data-ttu-id="edd85-329">請參閱「 [通訊埠 135 的特殊考量](#BKMK_port_135)」</span><span class="sxs-lookup"><span data-stu-id="edd85-329">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-330">組態管理員會使用 WMI 來列出並管理服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-330">Configuration Manager uses WMI to list and manage services.</span></span> <span data-ttu-id="edd85-331">建議您使用預先設定的規則群組 **Windows Management Instrumentation (WMI)** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-331">We recommend that you use the preconfigured rule group **Windows Management Instrumentation (WMI)**.</span></span> <span data-ttu-id="edd85-332">如需詳細資訊，請參閱下面的「 [與其他防火牆規則的互動](#BKMK_other_rules) 」一節。</span><span class="sxs-lookup"><span data-stu-id="edd85-332">For more information, see the [Interaction with Other Firewall Rules](#BKMK_other_rules) section below.</span></span>|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="edd85-333">分散式交易協調器 (MS DTC)</span><span class="sxs-lookup"><span data-stu-id="edd85-333">Distributed Transaction Coordinator (MS DTC)</span></span>|<span data-ttu-id="edd85-334">TCP 通訊埠 135</span><span class="sxs-lookup"><span data-stu-id="edd85-334">TCP port 135</span></span><br /><br /> <span data-ttu-id="edd85-335">請參閱「 [通訊埠 135 的特殊考量](#BKMK_port_135)」</span><span class="sxs-lookup"><span data-stu-id="edd85-335">See [Special Considerations for Port 135](#BKMK_port_135)</span></span>|<span data-ttu-id="edd85-336">如果應用程式使用分散式交易，您可能必須將防火牆設定成允許 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 分散式交易協調器 (MS DTC) 傳輸在個別 MS DTC 執行個體之間，以及在 MS DTC 與資源管理員 (例如 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]) 之間流動。</span><span class="sxs-lookup"><span data-stu-id="edd85-336">If your application uses distributed transactions, you might have to configure the firewall to allow [!INCLUDE[msCoName](../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC) traffic to flow between separate MS DTC instances, and between the MS DTC and resource managers such as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="edd85-337">我們建議您使用預先設定的規則群組 **[分散式交易協調器]** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-337">We recommend that you use the preconfigured **Distributed Transaction Coordinator** rule group.</span></span><br /><br /> <span data-ttu-id="edd85-338">針對個別資源群組中的整個叢集設定了單一共用 MS DTC 時，您應該將 sqlservr.exe 當做例外加入至防火牆。</span><span class="sxs-lookup"><span data-stu-id="edd85-338">When a single shared MS DTC is configured for the entire cluster in a separate resource group you should add sqlservr.exe as an exception to the firewall.</span></span>|  
|<span data-ttu-id="edd85-339">[!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] 中的瀏覽按鈕會使用 UDP 來連接至 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser 服務。</span><span class="sxs-lookup"><span data-stu-id="edd85-339">The browse button in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] uses UDP to connect to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser Service.</span></span> <span data-ttu-id="edd85-340">如需詳細資訊，請參閱 [SQL Server Browser 服務 &#40;Database Engine and SSAS&#41;](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-340">For more information, see [SQL Server Browser Service &#40;Database Engine and SSAS&#41;](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md).</span></span>|<span data-ttu-id="edd85-341">UDP 通訊埠 1434</span><span class="sxs-lookup"><span data-stu-id="edd85-341">UDP port 1434</span></span>|<span data-ttu-id="edd85-342">UDP 是一種無連接的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="edd85-342">UDP is a connectionless protocol.</span></span><br /><br /> <span data-ttu-id="edd85-343">防火牆具有一項名為 [INetFwProfile 介面的 UnicastResponsesToMulticastBroadcastDisabled 屬性](https://go.microsoft.com/fwlink/?LinkId=118371) 的設定，可在廣播 (或多點傳送) UDP 要求的單點傳送回應方面控制防火牆的行為。</span><span class="sxs-lookup"><span data-stu-id="edd85-343">The firewall has a setting, which is named [UnicastResponsesToMulticastBroadcastDisabled Property of the INetFwProfile Interface](https://go.microsoft.com/fwlink/?LinkId=118371) which controls the behavior of the firewall with respect to unicast responses to a broadcast (or multicast) UDP request.</span></span>  <span data-ttu-id="edd85-344">它有兩種行為：</span><span class="sxs-lookup"><span data-stu-id="edd85-344">It has two behaviors:</span></span><br /><br /> <span data-ttu-id="edd85-345">如果此設定為 TRUE，就完全不允許廣播的任何單點傳送回應。</span><span class="sxs-lookup"><span data-stu-id="edd85-345">If the setting is TRUE, no unicast responses to a broadcast are permitted at all.</span></span> <span data-ttu-id="edd85-346">列舉服務將會失敗。</span><span class="sxs-lookup"><span data-stu-id="edd85-346">Enumerating services will fail.</span></span><br /><br /> <span data-ttu-id="edd85-347">如果此設定為 FALSE (預設值)，就允許單點傳送回應 3 秒。</span><span class="sxs-lookup"><span data-stu-id="edd85-347">If the setting is FALSE (default), unicast responses are permitted for 3 seconds.</span></span> <span data-ttu-id="edd85-348">您無法設定時間的長度。</span><span class="sxs-lookup"><span data-stu-id="edd85-348">The length of time is not configurable.</span></span> <span data-ttu-id="edd85-349">在擁塞或高延遲的網路中，或是負載繁重的伺服器上，嘗試列舉 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的執行個體可能會傳回部分清單，因而誤導使用者。</span><span class="sxs-lookup"><span data-stu-id="edd85-349">in a congested or high-latency network, or for heavily loaded servers, tries to enumerate instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might return a partial list, which might mislead users.</span></span>|  
|<span data-ttu-id="edd85-350">IPsec 傳輸</span><span class="sxs-lookup"><span data-stu-id="edd85-350">IPsec traffic</span></span>|<span data-ttu-id="edd85-351">UDP 通訊埠 500 和 UDP 通訊埠 4500</span><span class="sxs-lookup"><span data-stu-id="edd85-351">UDP port 500 and UDP port 4500</span></span>|<span data-ttu-id="edd85-352">如果網域原則要求透過 IPsec 完成網路通訊，您也必須將 UDP 通訊埠 4500 和 UDP 通訊埠 500 加入至例外清單。</span><span class="sxs-lookup"><span data-stu-id="edd85-352">If the domain policy requires network communications to be done through IPsec, you must also add UDP port 4500 and UDP port 500 to the exception list.</span></span> <span data-ttu-id="edd85-353">IPsec 是在 Windows 防火牆嵌入式管理單元中使用 [新增輸入規則精靈]  的選項。</span><span class="sxs-lookup"><span data-stu-id="edd85-353">IPsec is an option using the **New Inbound Rule Wizard** in the Windows Firewall snap-in.</span></span> <span data-ttu-id="edd85-354">如需詳細資訊，請參閱稍後的 [使用具有進階安全性嵌入式管理單元的 Windows 防火牆](#BKMK_WF_msc) 。</span><span class="sxs-lookup"><span data-stu-id="edd85-354">For more information, see [Using the Windows Firewall with Advanced Security Snap-in](#BKMK_WF_msc) below.</span></span>|  
|<span data-ttu-id="edd85-355">使用 Windows 驗證搭配信任的網域</span><span class="sxs-lookup"><span data-stu-id="edd85-355">Using Windows Authentication with Trusted Domains</span></span>|<span data-ttu-id="edd85-356">防火牆必須設定成允許驗證要求。</span><span class="sxs-lookup"><span data-stu-id="edd85-356">Firewalls must be configured to allow authentication requests.</span></span>|<span data-ttu-id="edd85-357">如需詳細資訊，請參閱＜ [如何設定網域和信任的防火牆](https://support.microsoft.com/kb/179442/)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-357">For more information, see [How to configure a firewall for domains and trusts](https://support.microsoft.com/kb/179442/).</span></span>|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="edd85-358">和 Windows 叢集</span><span class="sxs-lookup"><span data-stu-id="edd85-358">and Windows Clustering</span></span>|<span data-ttu-id="edd85-359">叢集需要與 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]沒有直接相關的其他通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-359">Clustering requires additional ports that are not directly related to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|<span data-ttu-id="edd85-360">如需詳細資訊，請參閱＜ [啟用可供叢集使用的網路](https://go.microsoft.com/fwlink/?LinkId=118372)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-360">For more information, see [Enable a network for cluster use](https://go.microsoft.com/fwlink/?LinkId=118372).</span></span>|  
|<span data-ttu-id="edd85-361">保留在 HTTP 伺服器 API (HTTP.SYS) 中的 URL 命名空間</span><span class="sxs-lookup"><span data-stu-id="edd85-361">URL namespaces reserved in the HTTP Server API (HTTP.SYS)</span></span>|<span data-ttu-id="edd85-362">可能是 TCP 通訊埠 80，但是可以設定成其他通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-362">Probably TCP port 80, but can be configured to other ports.</span></span> <span data-ttu-id="edd85-363">如需一般資訊，請參閱＜ [設定 HTTP 和 HTTPS](https://go.microsoft.com/fwlink/?LinkId=118373)＞。</span><span class="sxs-lookup"><span data-stu-id="edd85-363">For general information, see [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=118373).</span></span>|<span data-ttu-id="edd85-364">如需有關使用 HttpCfg.exe 保留 HTTP.SYS 端點的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 特定資訊，請參閱[關於 URL 保留項目和註冊 &#40;SSRS 組態管理員&#41;](../../reporting-services/install-windows/about-url-reservations-and-registration-ssrs-configuration-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="edd85-364">For [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] specific information about reserving an HTTP.SYS endpoint using HttpCfg.exe, see [About URL Reservations and Registration  &#40;SSRS Configuration Manager&#41;](../../reporting-services/install-windows/about-url-reservations-and-registration-ssrs-configuration-manager.md).</span></span>|  
  
##  <a name="special-considerations-for-port-135"></a><a name="BKMK_port_135"></a> <span data-ttu-id="edd85-365">通訊埠 135 的特殊考量</span><span class="sxs-lookup"><span data-stu-id="edd85-365">Special Considerations for Port 135</span></span>  
 <span data-ttu-id="edd85-366">當您使用 RPC 搭配 TCP/IP 或 UDP/IP 當做傳輸時，系統通常會視需要以動態方式將傳入通訊埠指派給系統服務。所使用的是大於通訊埠 1024 的 TCP/IP 和 UDP/IP 通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-366">When you use RPC with TCP/IP or with UDP/IP as the transport, inbound ports are frequently dynamically assigned to system services as required; TCP/IP and UDP/IP ports that are larger than port 1024 are used.</span></span> <span data-ttu-id="edd85-367">這些通訊埠通常非正式地稱為「隨機 RPC 通訊埠」。</span><span class="sxs-lookup"><span data-stu-id="edd85-367">These are frequently informally referred to as "random RPC ports."</span></span> <span data-ttu-id="edd85-368">在這些情況下，RPC 用戶端會仰賴 RPC 端點對應程式來告知它們哪些動態通訊埠已經指派給伺服器。</span><span class="sxs-lookup"><span data-stu-id="edd85-368">In these cases, RPC clients rely on the RPC endpoint mapper to tell them which dynamic ports were assigned to the server.</span></span> <span data-ttu-id="edd85-369">對於某些以 RPC 為基礎的服務而言，您可以設定特定通訊埠，而非讓 RPC 以動態方式指派通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-369">For some RPC-based services, you can configure a specific port instead of letting RPC assign one dynamically.</span></span> <span data-ttu-id="edd85-370">不論服務為何，您都可以將 RPC 以動態方式指派的通訊埠範圍限制成小範圍。</span><span class="sxs-lookup"><span data-stu-id="edd85-370">You can also restrict the range of ports that RPC dynamically assigns to a small range, regardless of the service.</span></span> <span data-ttu-id="edd85-371">由於通訊埠 135 用於許多服務，所以它經常會受到惡意使用者的攻擊。</span><span class="sxs-lookup"><span data-stu-id="edd85-371">Because port 135 is used for many services it is frequently attacked by malicious users.</span></span> <span data-ttu-id="edd85-372">開啟通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-372">When opening port 135, consider restricting the scope of the firewall rule.</span></span>  
  
 <span data-ttu-id="edd85-373">如需有關通訊埠 135 的詳細資訊，請參閱下列參考：</span><span class="sxs-lookup"><span data-stu-id="edd85-373">For more information about port 135, see the following references:</span></span>  
  
-   [<span data-ttu-id="edd85-374">Windows Server 系統的服務概觀和網路通訊埠需求 (機器翻譯)</span><span class="sxs-lookup"><span data-stu-id="edd85-374">Service overview and network port requirements for the Windows Server system</span></span>](https://support.microsoft.com/kb/832017)  
  
-   [<span data-ttu-id="edd85-375">使用產品光碟的 Windows Server 2003 支援工具對 RPC 端點對應程式錯誤進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="edd85-375">Troubleshooting RPC Endpoint Mapper errors using the Windows Server 2003 Support Tools from the product CD</span></span>](https://support.microsoft.com/kb/839880)  
  
-   [<span data-ttu-id="edd85-376">遠端程序呼叫 (RPC)</span><span class="sxs-lookup"><span data-stu-id="edd85-376">Remote procedure call (RPC)</span></span>](https://go.microsoft.com/fwlink/?LinkId=118375)  
  
-   [<span data-ttu-id="edd85-377">如何設定 RPC 動態連接埠配置以使用防火牆</span><span class="sxs-lookup"><span data-stu-id="edd85-377">How to configure RPC dynamic port allocation to work with firewalls</span></span>](https://support.microsoft.com/kb/154596/)  
  
##  <a name="interaction-with-other-firewall-rules"></a><a name="BKMK_other_rules"></a> <span data-ttu-id="edd85-378">與其他防火牆規則的互動</span><span class="sxs-lookup"><span data-stu-id="edd85-378">Interaction with Other Firewall Rules</span></span>  
 <span data-ttu-id="edd85-379">[Windows 防火牆] 會使用規則和規則群組來建立其組態。</span><span class="sxs-lookup"><span data-stu-id="edd85-379">The Windows Firewall uses rules and rule groups to establish its configuration.</span></span> <span data-ttu-id="edd85-380">每個規則或規則群組通常會與特定的程式或服務相關聯，而且該程式或服務可能會不經通知而修改或刪除該項規則。</span><span class="sxs-lookup"><span data-stu-id="edd85-380">Each rule or rule group is generally associated with a particular program or service, and that program or service might modify or delete that rule without your knowledge.</span></span> <span data-ttu-id="edd85-381">例如，規則群組 **World Wide Web 服務 (HTTP)** 和 **World Wide Web 服務 (HTTPS)** 會與 IIS 相關聯。</span><span class="sxs-lookup"><span data-stu-id="edd85-381">For example, the rule groups **World Wide Web Services (HTTP)** and **World Wide Web Services (HTTPS)** are associated with IIS.</span></span> <span data-ttu-id="edd85-382">啟用這些規則將會開啟通訊埠 80 和 443，而且如果您啟用了這些規則，相依於通訊埠 80 和 443 的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 功能將會正常運作。</span><span class="sxs-lookup"><span data-stu-id="edd85-382">Enabling those rules will open ports 80 and 443, and [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] features that depend on ports 80 and 443 will function if those rules are enabled.</span></span> <span data-ttu-id="edd85-383">不過，設定 IIS 的管理員可能會修改或停用這些規則。</span><span class="sxs-lookup"><span data-stu-id="edd85-383">However, administrators configuring IIS might modify or disable those rules.</span></span> <span data-ttu-id="edd85-384">因此，如果您要針對 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]使用通訊埠 80 或通訊埠 443，就應該建立維護所需通訊埠組態的自訂規則或規則群組 (獨立於其他 IIS 規則)。</span><span class="sxs-lookup"><span data-stu-id="edd85-384">Therefore, if you are using port 80 or port 443 for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you should create your own rule or rule group that maintains your desired port configuration independently of the other IIS rules.</span></span>  
  
 <span data-ttu-id="edd85-385">[具有進階安全性的 Windows 防火牆] MMC 嵌入式管理單元允許符合任何適用允許規則的任何傳輸。</span><span class="sxs-lookup"><span data-stu-id="edd85-385">The Windows Firewall with Advanced Security MMC snap-in allows any traffic that matches any applicable allow rule.</span></span> <span data-ttu-id="edd85-386">因此，如果有兩項同時套用至通訊埠 80 的規則 (具有不同的參數)，系統就會允許符合任何一項規則的傳輸。</span><span class="sxs-lookup"><span data-stu-id="edd85-386">So if there are two rules that both apply to port 80 (with different parameters), traffic that matches either rule will be permitted.</span></span> <span data-ttu-id="edd85-387">所以，如果其中一項規則允許來自區域子網路而且透過通訊埠 80 的傳輸，而另一項規則允許來自任何位址的傳輸，其結果就是允許通訊埠 80 的所有傳輸，不論來源為何。</span><span class="sxs-lookup"><span data-stu-id="edd85-387">So if one rule allows traffic over port 80 from local subnet and one rule allows traffic from any address, the net effect is that all traffic to port 80 is permitted regardless of the source.</span></span> <span data-ttu-id="edd85-388">若要有效管理 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的存取權，管理員應該定期檢閱在伺服器上啟用的所有防火牆規則。</span><span class="sxs-lookup"><span data-stu-id="edd85-388">To effectively manage access to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], administrators should periodically review all firewall rules enabled on the server.</span></span>  
  
##  <a name="overview-of-firewall-profiles"></a><a name="BKMK_profiles"></a> <span data-ttu-id="edd85-389">防火牆設定檔的概觀</span><span class="sxs-lookup"><span data-stu-id="edd85-389">Overview of Firewall Profiles</span></span>  
 <span data-ttu-id="edd85-390">[具有進階安全性的 Windows 防火牆入門指南](https://go.microsoft.com/fwlink/?LinkId=116080) 中的 **網路位置感知主機防火牆**一節會討論防火牆設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-390">Firewall profiles are discussed in [Windows Firewall with Advanced Security Getting Started Guide](https://go.microsoft.com/fwlink/?LinkId=116080) in the section **Network location-aware host firewall**.</span></span> <span data-ttu-id="edd85-391">簡而言之，作業系統會在連接性、連接和類別方面識別並記憶它們所連接的每個網路。</span><span class="sxs-lookup"><span data-stu-id="edd85-391">To summarize, the operating systems identify and remember each of the networks to which they connect with regard to connectivity, connections, and category.</span></span>  
  
 <span data-ttu-id="edd85-392">[具有進階安全性的 Windows 防火牆] 具有三種網路位置類型：</span><span class="sxs-lookup"><span data-stu-id="edd85-392">There are three network location types in Windows Firewall with Advanced Security:</span></span>  
  
-   <span data-ttu-id="edd85-393">網域。</span><span class="sxs-lookup"><span data-stu-id="edd85-393">Domain.</span></span> <span data-ttu-id="edd85-394">Windows 可以針對電腦所加入的網域，驗證網域控制站的存取權。</span><span class="sxs-lookup"><span data-stu-id="edd85-394">Windows can authenticate access to the domain controller for the domain to which the computer is joined.</span></span>  
  
-   <span data-ttu-id="edd85-395">公用。</span><span class="sxs-lookup"><span data-stu-id="edd85-395">Public.</span></span> <span data-ttu-id="edd85-396">除了網域網路以外，所有網路一開始都會分類成公用。</span><span class="sxs-lookup"><span data-stu-id="edd85-396">Other than domain networks, all networks are initially categorized as public.</span></span> <span data-ttu-id="edd85-397">代表直接連接至網際網路或位於公共場所 (例如機場和咖啡店) 的網路應該會保持公用。</span><span class="sxs-lookup"><span data-stu-id="edd85-397">Networks that represent direct connections to the Internet or are in public locations, such as airports and coffee shops should be left public.</span></span>  
  
-   <span data-ttu-id="edd85-398">私人。</span><span class="sxs-lookup"><span data-stu-id="edd85-398">Private.</span></span> <span data-ttu-id="edd85-399">由使用者或應用程式識別成私人的網路。</span><span class="sxs-lookup"><span data-stu-id="edd85-399">A network identified by a user or application as private.</span></span> <span data-ttu-id="edd85-400">只有受信任的網路才應該識別成私人網路。</span><span class="sxs-lookup"><span data-stu-id="edd85-400">Only trusted networks should be identified as private networks.</span></span> <span data-ttu-id="edd85-401">使用者可能會想要將家庭或小型企業網路識別成私人。</span><span class="sxs-lookup"><span data-stu-id="edd85-401">Users will likely want to identify home or small business networks as private.</span></span>  
  
 <span data-ttu-id="edd85-402">管理員可以針對每種網路位置類型建立設定檔，而且每個設定檔都含有不同的防火牆原則。</span><span class="sxs-lookup"><span data-stu-id="edd85-402">The administrator can create a profile for each network location type, with each profile containing different firewall policies.</span></span> <span data-ttu-id="edd85-403">不過，一次只會套用一個設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-403">Only one profile is applied at any time.</span></span> <span data-ttu-id="edd85-404">設定檔的套用順序如下所示：</span><span class="sxs-lookup"><span data-stu-id="edd85-404">Profile order is applied as follows:</span></span>  
  
1.  <span data-ttu-id="edd85-405">如果所有介面都經過電腦屬於其成員之網域的網域控制站驗證，就會套用網域設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-405">If all interfaces are authenticated to the domain controller for the domain of which the computer is a member, the domain profile is applied.</span></span>  
  
2.  <span data-ttu-id="edd85-406">如果所有介面都經過網域控制站驗證或連接至分類成私人網路位置的網路，就會套用私人設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-406">If all interfaces are either authenticated to the domain controller or are connected to networks that are classified as private network locations, the private profile is applied.</span></span>  
  
3.  <span data-ttu-id="edd85-407">否則，就會套用公用設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-407">Otherwise, the public profile is applied.</span></span>  
  
 <span data-ttu-id="edd85-408">您可以使用 [具有進階安全性的 Windows 防火牆] MMC 嵌入式管理單元來檢視和設定所有防火牆設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-408">Use the Windows Firewall with Advanced Security MMC snap-in to view and configure all firewall profiles.</span></span> <span data-ttu-id="edd85-409">[控制台] 中的 **[Windows 防火牆]** 項目只會設定目前的設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-409">The **Windows Firewall** item in Control Panel only configures the current profile.</span></span>  
  
##  <a name="additional-firewall-settings-using-the-windows-firewall-item-in-control-panel"></a><a name="BKMK_additional_settings"></a> <span data-ttu-id="edd85-410">使用控制台中的 Windows 防火牆項目進行其他防火牆設定</span><span class="sxs-lookup"><span data-stu-id="edd85-410">Additional Firewall Settings Using the Windows Firewall Item in Control Panel</span></span>  
 <span data-ttu-id="edd85-411">您加入至防火牆的例外可以限制針對來自特定電腦或區域子網路的內送連接開啟通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-411">Exceptions that you add to the firewall can restrict the opening of the port to incoming connections from specific computers or the local subnet.</span></span> <span data-ttu-id="edd85-412">這種通訊埠開啟範圍的限制可以減少電腦遭受惡意使用者攻擊的風險，而且建議使用這種限制。</span><span class="sxs-lookup"><span data-stu-id="edd85-412">This restriction of the scope of the port opening can reduce how much your computer is exposed to malicious users, and is recommended.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="edd85-413">使用 [控制台] 中的 [Windows 防火牆]  項目只會設定目前的防火牆設定檔。</span><span class="sxs-lookup"><span data-stu-id="edd85-413">Using the **Windows Firewall** item in Control Panel only configures the current firewall profile.</span></span>  
  
#### <a name="to-change-the-scope-of-a-firewall-exception-using-the-windows-firewall-item-in-control-panel"></a><span data-ttu-id="edd85-414">使用控制台中的 Windows 防火牆項目來變更防火牆例外的範圍</span><span class="sxs-lookup"><span data-stu-id="edd85-414">To change the scope of a firewall exception using the Windows Firewall item in Control Panel</span></span>  
  
1.  <span data-ttu-id="edd85-415">在 [控制台] 的 **[Windows 防火牆]** 中，選取 **[例外]** 索引標籤上的程式或通訊埠，然後按一下 **[內容]** 或 **[編輯]** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-415">In the **Windows Firewall** item in Control Panel, select a program or port on the **Exceptions** tab, and then click **Properties** or **Edit**.</span></span>  
  
2.  <span data-ttu-id="edd85-416">在 **[編輯程式]** 或 **[編輯連接埠]** 對話方塊中，按一下 **[變更領域]** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-416">In the **Edit a Program** or **Edit a Port** dialog box, click **Change Scope**.</span></span>  
  
3.  <span data-ttu-id="edd85-417">選擇下列其中一個選項：</span><span class="sxs-lookup"><span data-stu-id="edd85-417">Choose one of the following options:</span></span>  
  
    -   <span data-ttu-id="edd85-418">**任何電腦 (包括在網際網路上的)**</span><span class="sxs-lookup"><span data-stu-id="edd85-418">**Any computer (including those on the Internet)**</span></span>  
  
         <span data-ttu-id="edd85-419">不建議使用。</span><span class="sxs-lookup"><span data-stu-id="edd85-419">Not recommended.</span></span> <span data-ttu-id="edd85-420">這個選項會允許可設定您電腦位址的任何電腦連接至指定的程式或通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-420">This will allow any computer that can address your computer to connect to the specified program or port.</span></span> <span data-ttu-id="edd85-421">雖然您可能需要這項設定才能將資訊呈現給網際網路上的匿名使用者，不過這樣做會增加遭受惡意使用者攻擊的風險。</span><span class="sxs-lookup"><span data-stu-id="edd85-421">This setting might be necessary to allow information to be presented to anonymous users on the internet, but increases your exposure to malicious users.</span></span> <span data-ttu-id="edd85-422">如果您啟用了這項設定，而且也允許網路位址轉譯 (NAT) 周遊 (例如 [允許邊緣周遊] 選項)，就會進一步增加遭受攻擊的風險。</span><span class="sxs-lookup"><span data-stu-id="edd85-422">Your exposure can be further increased if you enable this setting and also allow Network Address Translation (NAT) traversal, such as the Allow edge traversal option.</span></span>  
  
    -   <span data-ttu-id="edd85-423">**只有我的網路 (子網路)**</span><span class="sxs-lookup"><span data-stu-id="edd85-423">**My network (subnet) only**</span></span>  
  
         <span data-ttu-id="edd85-424">這是比 **[任何電腦]** 更安全的設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-424">This is a more secure setting than **Any computer**.</span></span> <span data-ttu-id="edd85-425">只有位於網路之區域子網路的電腦才能連接至程式或通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-425">Only computers on the local subnet of your network can connect to the program or port.</span></span>  
  
    -   <span data-ttu-id="edd85-426">**自訂清單:**</span><span class="sxs-lookup"><span data-stu-id="edd85-426">**Custom list:**</span></span>  
  
     <span data-ttu-id="edd85-427">只有具備您所列出之 IP 位址的電腦才能連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-427">Only computers that have the IP addresses you list can connect.</span></span> <span data-ttu-id="edd85-428">這可能是比 [只有我的網路 (子網路)]  更安全的設定。不過，使用 DHCP 的用戶端電腦可能偶爾會變更其 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="edd85-428">This can be a more secure setting than **My network (subnet) only**, however, client computers using DHCP can occasionally change their IP address.</span></span> <span data-ttu-id="edd85-429">接著，預期的電腦將無法連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-429">Then the intended computer will not be able to connect.</span></span> <span data-ttu-id="edd85-430">您不想要授權的其他電腦可能會接受列出的 IP 位址，然後就能夠連接。</span><span class="sxs-lookup"><span data-stu-id="edd85-430">Another computer, which you had not intended to authorize, might accept the listed IP address and then be able to connect.</span></span> <span data-ttu-id="edd85-431">**[自訂清單]** 選項可能適用於列出設定成使用固定 IP 位址的其他伺服器。不過，入侵者可能會假冒這些 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="edd85-431">The **Custom list** option might be appropriate for listing other servers which are configured to use a fixed IP address; however, IP addresses might be spoofed by an intruder.</span></span> <span data-ttu-id="edd85-432">限制性防火牆規則只會與您的網路基礎結構同樣強固。</span><span class="sxs-lookup"><span data-stu-id="edd85-432">Restricting firewall rules are only as strong as your network infrastructure.</span></span>  
  
##  <a name="using-the-windows-firewall-with-advanced-security-snap-in"></a><a name="BKMK_WF_msc"></a> <span data-ttu-id="edd85-433">使用具有進階安全性的 Windows 防火牆嵌入式管理單元</span><span class="sxs-lookup"><span data-stu-id="edd85-433">Using the Windows Firewall with Advanced Security Snap-in</span></span>  
 <span data-ttu-id="edd85-434">您可以使用具有進階安全性的 Windows 防火牆 MMC 嵌入式管理單元來設定其他進階的防火牆設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-434">Additional advanced firewall settings can be configured by using the Windows Firewall with Advanced Security MMC snap-in.</span></span> <span data-ttu-id="edd85-435">此嵌入式管理單元包含規則精靈，而且它會公開 [控制台] 中 [Windows 防火牆]  項目無法使用的額外設定。</span><span class="sxs-lookup"><span data-stu-id="edd85-435">The snap-in includes a rule wizard and exposes additional settings that are not available in the **Windows Firewall** item in Control Panel.</span></span> <span data-ttu-id="edd85-436">這些設定包括：</span><span class="sxs-lookup"><span data-stu-id="edd85-436">These settings include the following:</span></span>  
  
-   <span data-ttu-id="edd85-437">加密設定</span><span class="sxs-lookup"><span data-stu-id="edd85-437">Encryption settings</span></span>  
  
-   <span data-ttu-id="edd85-438">服務限制</span><span class="sxs-lookup"><span data-stu-id="edd85-438">Services restrictions</span></span>  
  
-   <span data-ttu-id="edd85-439">依據名稱限制電腦的連接</span><span class="sxs-lookup"><span data-stu-id="edd85-439">Restricting connections for computers by name</span></span>  
  
-   <span data-ttu-id="edd85-440">限制特定使用者或設定檔的連接</span><span class="sxs-lookup"><span data-stu-id="edd85-440">Restricting connections to specific users or profiles</span></span>  
  
-   <span data-ttu-id="edd85-441">允許傳輸通過網路位址轉譯 (NAT) 路由器的邊緣周遊</span><span class="sxs-lookup"><span data-stu-id="edd85-441">Edge traversal allowing traffic to bypass Network Address Translation (NAT) routers</span></span>  
  
-   <span data-ttu-id="edd85-442">設定輸出規則</span><span class="sxs-lookup"><span data-stu-id="edd85-442">Configuring outbound rules</span></span>  
  
-   <span data-ttu-id="edd85-443">設定安全性規則</span><span class="sxs-lookup"><span data-stu-id="edd85-443">Configuring security rules</span></span>  
  
-   <span data-ttu-id="edd85-444">針對內送連接要求 IPsec</span><span class="sxs-lookup"><span data-stu-id="edd85-444">Requiring IPsec for incoming connections</span></span>  
  
#### <a name="to-create-a-new-firewall-rule-using-the-new-rule-wizard"></a><span data-ttu-id="edd85-445">使用新增規則精靈來建立新的防火牆規則</span><span class="sxs-lookup"><span data-stu-id="edd85-445">To create a new firewall rule using the New Rule wizard</span></span>  
  
1.  <span data-ttu-id="edd85-446">在 [開始] 功能表上、按一下 **[執行]** ，輸入 **WF.msc**，然後按一下 **[確定]** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-446">On the Start menu, click **Run**, type **WF.msc**, and then click **OK**.</span></span>  
  
2.  <span data-ttu-id="edd85-447">在 [具有進階安全性的 Windows 防火牆]\*\*\*\* 的左窗格中，以滑鼠右鍵按一下 [輸入規則]\*\*\*\*，然後按一下 [新增規則]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="edd85-447">In the **Windows Firewall with Advanced Security**, in the left pane, right-click **Inbound Rules**, and then click **New Rule**.</span></span>  
  
3.  <span data-ttu-id="edd85-448">使用您想要的設定來完成 **[新增輸入規則精靈]** 。</span><span class="sxs-lookup"><span data-stu-id="edd85-448">Complete the **New Inbound Rule Wizard** using the settings that you want.</span></span>  
  
##  <a name="troubleshooting-firewall-settings"></a><a name="BKMK_troubleshooting"></a> <span data-ttu-id="edd85-449">疑難排解防火牆設定</span><span class="sxs-lookup"><span data-stu-id="edd85-449">Troubleshooting Firewall Settings</span></span>  
 <span data-ttu-id="edd85-450">下列工具和技巧可用於疑難排解防火牆問題：</span><span class="sxs-lookup"><span data-stu-id="edd85-450">The following tools and techniques can be useful in troubleshooting firewall issues:</span></span>  
  
-   <span data-ttu-id="edd85-451">有效的通訊埠狀態是與該通訊埠相關之所有規則的聯集。</span><span class="sxs-lookup"><span data-stu-id="edd85-451">The effective port status is the union of all rules related to the port.</span></span> <span data-ttu-id="edd85-452">嘗試封鎖透過某個通訊埠的存取時，檢閱描述通訊埠編號的所有規則可能會很有用。</span><span class="sxs-lookup"><span data-stu-id="edd85-452">When trying to block access through a port, it can be helpful to review all the rules which cite the port number.</span></span> <span data-ttu-id="edd85-453">若要這樣做，請使用 [具有進階安全性的 Windows 防火牆] MMC 嵌入式管理單元，然後依據通訊埠編號來排序輸入和輸出規則。</span><span class="sxs-lookup"><span data-stu-id="edd85-453">To do this, use the Windows Firewall with Advanced Security MMC snap-in and sort the inbound and outbound rules by port number.</span></span>  
  
-   <span data-ttu-id="edd85-454">檢閱在執行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 之電腦上作用中的通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-454">Review the ports that are active on the computer on which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running.</span></span> <span data-ttu-id="edd85-455">此檢閱程序包括確認哪些是接聽的 TCP/IP 通訊埠，並確認通訊埠的狀態。</span><span class="sxs-lookup"><span data-stu-id="edd85-455">This review process includes verifying which TCP/IP ports are listening and also verifying the status of the ports.</span></span>  
  
     <span data-ttu-id="edd85-456">若要驗證接聽的通訊埠，請使用 **netstat** 命令列公用程式。</span><span class="sxs-lookup"><span data-stu-id="edd85-456">To verify which ports are listening, use the **netstat** command-line utility.</span></span> <span data-ttu-id="edd85-457">除了顯示使用中的 TCP 連接之外， **netstat** 公用程式也會顯示各種 IP 統計資料與資訊。</span><span class="sxs-lookup"><span data-stu-id="edd85-457">In addition to displaying active TCP connections, the **netstat** utility also displays a variety of IP statistics and information.</span></span>  
  
    #### <a name="to-list-which-tcpip-ports-are-listening"></a><span data-ttu-id="edd85-458">列出哪些是接聽的 TCP/IP 通訊埠</span><span class="sxs-lookup"><span data-stu-id="edd85-458">To list which TCP/IP ports are listening</span></span>  
  
    1.  <span data-ttu-id="edd85-459">開啟命令提示字元視窗。</span><span class="sxs-lookup"><span data-stu-id="edd85-459">Open the Command Prompt window.</span></span>  
  
    2.  <span data-ttu-id="edd85-460">在命令提示字元中，輸入 `netstat -n -a`。</span><span class="sxs-lookup"><span data-stu-id="edd85-460">At the command prompt, type `netstat -n -a`.</span></span>  
  
         <span data-ttu-id="edd85-461">**-n** 參數會指示 **netstat** 以數值方式顯示使用中 TCP 連線的位址與通訊埠號碼。</span><span class="sxs-lookup"><span data-stu-id="edd85-461">The **-n** switch instructs **netstat** to numerically display the address and port number of active TCP connections.</span></span> <span data-ttu-id="edd85-462">**-a** 參數會指示 **netstat** 顯示電腦所接聽之電腦上的 TCP 與 UDP 通訊埠。</span><span class="sxs-lookup"><span data-stu-id="edd85-462">The **-a** switch instructs **netstat** to display the TCP and UDP ports on which the computer is listening.</span></span>  
  
-   <span data-ttu-id="edd85-463">**PortQry** 公用程式可用於將 TCP/IP 通訊埠的狀態回報為接聽中、未接聽或已篩選。</span><span class="sxs-lookup"><span data-stu-id="edd85-463">The **PortQry** utility can be used to report the status of TCP/IP ports as listening, not listening, or filtered.</span></span> <span data-ttu-id="edd85-464">(若為已篩選狀態，表示通訊埠不一定是接聽中。此狀態會指出公用程式未接收到通訊埠的回應)。**PortQry** 公用程式可從 [Microsoft 下載中心](https://www.microsoft.com/download/details.aspx?id=17148)下載。</span><span class="sxs-lookup"><span data-stu-id="edd85-464">(With a filtered status, the port might or might not be listening; this status indicates that the utility did not receive a response from the port.) The **PortQry** utility is available for download from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=17148).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="edd85-465">另請參閱</span><span class="sxs-lookup"><span data-stu-id="edd85-465">See Also</span></span>  
 [<span data-ttu-id="edd85-466">Windows Server System 的服務概觀和網路連接埠需求</span><span class="sxs-lookup"><span data-stu-id="edd85-466">Service overview and network port requirements for the Windows Server system</span></span>](https://support.microsoft.com/kb/832017)  
