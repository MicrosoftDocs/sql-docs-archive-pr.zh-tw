---
title: 建立自訂工作流程 (Master Data Services) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: reference
ms.assetid: 8e4403e9-595c-4b6b-9d0c-f6ae1b2bc99d
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: cac53946d83eda178328b153875a86440517a560
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87607430"
---
# <a name="create-a-custom-workflow-master-data-services"></a><span data-ttu-id="4dc31-102">建立自訂工作流程 (Master Data Services)</span><span class="sxs-lookup"><span data-stu-id="4dc31-102">Create a Custom Workflow (Master Data Services)</span></span>
  [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] <span data-ttu-id="4dc31-103">使用商務規則建立基本工作流程解決方案，以便根據您所指定的條件，自動更新與驗證資料，並傳送電子郵件通知。</span><span class="sxs-lookup"><span data-stu-id="4dc31-103">uses business rules to create basic workflow solutions, such as to automatically update and validate data and have e-mail notifications sent, based on conditions you specify.</span></span> <span data-ttu-id="4dc31-104">當您需要做的處理比內建工作流程動作所提供的處理還要複雜時，請使用自訂工作流程。</span><span class="sxs-lookup"><span data-stu-id="4dc31-104">When you require processing that is more complex than what the built-in workflow actions provide, use a custom workflow.</span></span> <span data-ttu-id="4dc31-105">自訂工作流程是您所建立的 .NET 組件。</span><span class="sxs-lookup"><span data-stu-id="4dc31-105">A custom workflow is a .NET assembly that you create.</span></span> <span data-ttu-id="4dc31-106">呼叫您的工作流程組件時，程式碼會採取您的情況所需的任何動作。</span><span class="sxs-lookup"><span data-stu-id="4dc31-106">When your workflow assembly is called, your code can take whatever action your situation requires.</span></span> <span data-ttu-id="4dc31-107">例如，如果您的工作流程需要自訂的事件處理 (例如多層審核或複雜決策樹)，可以設定 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 啟動一個自訂工作流程，這個工作流程會分析資料並決定將該資料傳送至何處以待審核。</span><span class="sxs-lookup"><span data-stu-id="4dc31-107">For example, if your workflow requires complex event processing, such as multi-tiered approvals or complicated decision trees, you can configure [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to start a custom workflow that analyzes the data and determines where to send it for approval.</span></span>  
  
## <a name="how-custom-workflows-are-processed"></a><span data-ttu-id="4dc31-108">如何處理自訂工作流程</span><span class="sxs-lookup"><span data-stu-id="4dc31-108">How Custom Workflows Are Processed</span></span>  
 <span data-ttu-id="4dc31-109">與處理自訂工作流程有關的主要元件有三個：[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] Web 應用程式、SQL Server MDS 工作流程整合服務，以及工作流程處理常式組件。</span><span class="sxs-lookup"><span data-stu-id="4dc31-109">There are three main components involved to process custom workflows: the [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] web application, SQL Server MDS Workflow Integration Service, and the workflow handler assembly.</span></span> <span data-ttu-id="4dc31-110">這些元件處理自訂工作流程的方式如下：</span><span class="sxs-lookup"><span data-stu-id="4dc31-110">These components process a custom workflow as follows:</span></span>  
  
1.  <span data-ttu-id="4dc31-111">您要使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 驗證啟動工作流程的實體。</span><span class="sxs-lookup"><span data-stu-id="4dc31-111">You use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to validate an entity that starts a workflow.</span></span>  
  
2.  [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] <span data-ttu-id="4dc31-112">會將符合商務規則條件的成員傳送至 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫中的 Service Broker 佇列。</span><span class="sxs-lookup"><span data-stu-id="4dc31-112">sends members that meet the business rule conditions to a Service Broker queue in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
3.  <span data-ttu-id="4dc31-113">SQL Server MDS 工作流程整合服務會定期呼叫 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫中的預存程序。</span><span class="sxs-lookup"><span data-stu-id="4dc31-113">At regular intervals, SQL Server MDS Workflow Integration Service calls a stored procedure in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
4.  <span data-ttu-id="4dc31-114">當此預存程序在 Service Broker 佇列中找到記錄時，會將其傳回 SQL Server MDS 工作流程整合服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-114">When this stored procedure finds records in the Service Broker queue, it returns them to SQL Server MDS Workflow Integration Service.</span></span>  
  
5.  <span data-ttu-id="4dc31-115">SQL Server MDS 工作流程整合服務會將資料路由傳送至您的工作流程處理常式組件。</span><span class="sxs-lookup"><span data-stu-id="4dc31-115">SQL Server MDS Workflow Integration Services routes the data to your workflow handler assembly.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4dc31-116">注意：SQL Server MDS 工作流程整合服務是要觸發單一處理序。</span><span class="sxs-lookup"><span data-stu-id="4dc31-116">Note: SQL Server MDS Workflow Integration Service is meant to trigger simple processes.</span></span> <span data-ttu-id="4dc31-117">如果您的自訂程式碼需要複雜處理，請在個別的執行緒中，或在工作流程處理序外部，完成您的處理。</span><span class="sxs-lookup"><span data-stu-id="4dc31-117">If your custom code requires complex processing, complete your processing either in a separate thread or outside of the workflow process.</span></span>  
  
## <a name="configure-master-data-services-for-custom-workflows"></a><span data-ttu-id="4dc31-118">設定自訂工作流程的 Master Data Services</span><span class="sxs-lookup"><span data-stu-id="4dc31-118">Configure Master Data Services for Custom Workflows</span></span>  
 <span data-ttu-id="4dc31-119">建立自訂工作流程需要撰寫特定的自訂程式碼，並設定 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 將工作流程資料傳遞至您的工作流程處理常式。</span><span class="sxs-lookup"><span data-stu-id="4dc31-119">Creating a custom workflow requires writing some custom code and configuring [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to pass workflow data to your workflow handler.</span></span> <span data-ttu-id="4dc31-120">遵循以下步驟啟用自訂工作流程處理：</span><span class="sxs-lookup"><span data-stu-id="4dc31-120">Follow these steps to enable custom workflow processing:</span></span>  
  
1.  <span data-ttu-id="4dc31-121">建立[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))的 .net 元件。</span><span class="sxs-lookup"><span data-stu-id="4dc31-121">Create a .NET assembly that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span></span>  
  
2.  <span data-ttu-id="4dc31-122">設定 SQL Server MDS 工作流程整合服務連線至您的 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫，並讓某個標記與您的工作流程處理常式產生關聯。</span><span class="sxs-lookup"><span data-stu-id="4dc31-122">Configure SQL Server MDS Workflow Integration Service to connect to your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler.</span></span>  
  
3.  <span data-ttu-id="4dc31-123">啟動 SQL Server MDS 工作流程整合服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-123">Start SQL Server MDS Workflow Integration Service.</span></span>  
  
4.  <span data-ttu-id="4dc31-124">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中，建立一個啟動工作流程的商務規則，此工作流程會以您工作流程處理常式的名稱標記。</span><span class="sxs-lookup"><span data-stu-id="4dc31-124">Create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] that starts a workflow that is tagged with the name of your workflow handler.</span></span>  
  
5.  <span data-ttu-id="4dc31-125">將商務規則套用至觸發您自訂工作流程的成員。</span><span class="sxs-lookup"><span data-stu-id="4dc31-125">Apply the business rule to a member that triggers your custom workflow.</span></span>  
  
### <a name="create-the-workflow-handler-assembly"></a><span data-ttu-id="4dc31-126">建立工作流程處理常式組件</span><span class="sxs-lookup"><span data-stu-id="4dc31-126">Create the Workflow Handler Assembly</span></span>  
 <span data-ttu-id="4dc31-127">自訂工作流程是一個 .NET 類別庫元件，它會實[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))介面。</span><span class="sxs-lookup"><span data-stu-id="4dc31-127">A custom workflow is a .NET class library assembly that implements the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="4dc31-128">SQL Server MDS 工作流程整合服務會呼叫[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender. StartWorkflow \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))方法來執行您的程式碼。</span><span class="sxs-lookup"><span data-stu-id="4dc31-128">SQL Server MDS Workflow Integration Service calls the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method to run your code.</span></span> <span data-ttu-id="4dc31-129">如需執行[IWorkflowTypeExtender StartWorkflow \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))的範例程式碼，請參閱[自訂工作流程範例 &#40;Master Data Services&#41;](create-a-custom-workflow-example.md)。</span><span class="sxs-lookup"><span data-stu-id="4dc31-129">For example code that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)), see [Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md).</span></span>  
  
 <span data-ttu-id="4dc31-130">請遵循以下步驟，使用 Visual Studio 2010 建立 SQL Server MDS 工作流程整合服務可以呼叫的組件，以處理自訂工作流程：</span><span class="sxs-lookup"><span data-stu-id="4dc31-130">Follow these steps to use Visual Studio 2010 to create an assembly that SQL Server MDS Workflow Integration Service can call to handle a custom workflow:</span></span>  
  
1.  <span data-ttu-id="4dc31-131">在 Visual Studio 2010 中，建立一個使用所選語言的新 [類別庫]\*\*\*\* 專案。</span><span class="sxs-lookup"><span data-stu-id="4dc31-131">In Visual Studio 2010, create a new **Class Library** project that uses the language of your choice.</span></span> <span data-ttu-id="4dc31-132">若要建立 C# 類別庫，請選取 [Visual C#\Windows]\*\*\*\* 專案類型，然後選取 [類別庫]\*\*\*\* 範本。</span><span class="sxs-lookup"><span data-stu-id="4dc31-132">To create a C# Class Library, select the **Visual C#\Windows** project types and select the **Class Library** template.</span></span> <span data-ttu-id="4dc31-133">輸入您專案的名稱 (例如 **MDSWorkflowTest**)，然後按一下 [確定]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4dc31-133">Enter a name for your project, such as **MDSWorkflowTest**, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="4dc31-134">加入 Microsoft.MasterDataServices.WorkflowTypeExtender.dll 的參考。</span><span class="sxs-lookup"><span data-stu-id="4dc31-134">Add a reference to Microsoft.MasterDataServices.WorkflowTypeExtender.dll.</span></span> <span data-ttu-id="4dc31-135">此元件可以在 \<Your installation folder> \Master 資料 services\webapplication\bin 中找到。</span><span class="sxs-lookup"><span data-stu-id="4dc31-135">This assembly can be found in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
3.  <span data-ttu-id="4dc31-136">將 'using Microsoft.MasterDataServices.Core.Workflow;' 新增至您的 C# 程式碼檔案。</span><span class="sxs-lookup"><span data-stu-id="4dc31-136">Add 'using Microsoft.MasterDataServices.Core.Workflow;' to your C# code file.</span></span>  
  
4.  <span data-ttu-id="4dc31-137">繼承自您的類別宣告中的[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) 。</span><span class="sxs-lookup"><span data-stu-id="4dc31-137">Inherit from [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) in your class declaration.</span></span> <span data-ttu-id="4dc31-138">類別宣告應該類似：'public class WorkflowTester : IWorkflowTypeExtender'。</span><span class="sxs-lookup"><span data-stu-id="4dc31-138">The class declaration should be similar to: 'public class WorkflowTester : IWorkflowTypeExtender'.</span></span>  
  
5.  <span data-ttu-id="4dc31-139">執行[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))介面。</span><span class="sxs-lookup"><span data-stu-id="4dc31-139">Implement the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="4dc31-140">SQL Server MDS 工作流程整合服務會呼叫[MasterDataServices. WorkflowTypeExtender. IWorkflowTypeExtender. StartWorkflow \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))方法來啟動您的工作流程。</span><span class="sxs-lookup"><span data-stu-id="4dc31-140">The [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method is called by SQL Server MDS Workflow Integration Service to start your workflow.</span></span>  
  
6.  <span data-ttu-id="4dc31-141">將您的元件複製到 \<Your installation folder> \Master 資料 services\webapplication\bin 中名為 Microsoft.MasterDataServices.Workflow.exe 之 SQL SERVER MDS 工作流程整合服務可執行檔的位置</span><span class="sxs-lookup"><span data-stu-id="4dc31-141">Copy your assembly to the location of the SQL Server MDS Workflow Integration Service executable, named Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
### <a name="configure-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="4dc31-142">設定 SQL Server MDS 工作流程整合服務</span><span class="sxs-lookup"><span data-stu-id="4dc31-142">Configure SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="4dc31-143">遵循以下步驟，編輯 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 組態檔，以包含您 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫的連線資訊，並讓某個標記與您的工作流程處理常式組件產生關聯：</span><span class="sxs-lookup"><span data-stu-id="4dc31-143">Edit the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] configuration file to include connection information for your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler assembly by following these steps:</span></span>  
  
1.  <span data-ttu-id="4dc31-144">在 \<Your installation folder> \Master 資料 services\webapplication\bin 中尋找 Microsoft.MasterDataServices.Workflow.exe.config</span><span class="sxs-lookup"><span data-stu-id="4dc31-144">Find Microsoft.MasterDataServices.Workflow.exe.config in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
2.  <span data-ttu-id="4dc31-145">將 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫連線資訊新增至 "ConnectionString" 設定。</span><span class="sxs-lookup"><span data-stu-id="4dc31-145">Add the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database connection information to the "ConnectionString" setting.</span></span> <span data-ttu-id="4dc31-146">如果您的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 安裝使用區分大小寫的定序，資料庫的名稱就必須以資料庫中相同的大小寫輸入。</span><span class="sxs-lookup"><span data-stu-id="4dc31-146">If your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] installation uses case-sensitive collation, the name of the database must be entered in the same case as in the database.</span></span> <span data-ttu-id="4dc31-147">例如，完整的設定標記可能如以下所示：</span><span class="sxs-lookup"><span data-stu-id="4dc31-147">For example, the complete setting tag might look like this:</span></span>  
  
    ```xml  
    <setting name="ConnectionString" serializeAs="String">  
        <value>Server=myServer;Database=myDatabase;Integrated Security=True</value>  
    </setting>  
    ```  
  
3.  <span data-ttu-id="4dc31-148">在 "ConnectionString" 設定下方新增 "WorkflowTypeExtenders" 設定，讓標籤名稱與您的工作流程處理常式組件建立關聯。</span><span class="sxs-lookup"><span data-stu-id="4dc31-148">Below the "ConnectionString" setting add a "WorkflowTypeExtenders" setting to associate a tag name with your workflow handler assembly.</span></span> <span data-ttu-id="4dc31-149">例如：</span><span class="sxs-lookup"><span data-stu-id="4dc31-149">For example:</span></span>  
  
    ```xml  
    <setting name="WorkflowTypeExtenders" serializeAs="String">  
        <value>TEST=MDSWorkflowTestLib.WorkflowTester, MDSWorkflowTestLib</value>  
    </setting>  
    ```  
  
     <span data-ttu-id="4dc31-150">標記的內部文字的 \<value> 格式為 \<Workflow tag> = \<assembly-qualified workflow type name> 。</span><span class="sxs-lookup"><span data-stu-id="4dc31-150">The inner text of the \<value> tag is in the form of \<Workflow tag>=\<assembly-qualified workflow type name>.</span></span> <span data-ttu-id="4dc31-151">\<Workflow tag>這是當您在中建立商務規則時，用來識別工作流程處理常式元件的名稱 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="4dc31-151">\<Workflow tag> is a name you use to identify the workflow handler assembly when you create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)].</span></span> <span data-ttu-id="4dc31-152">\<assembly-qualified workflow type name>是您工作流程類別的命名空間限定名稱，後面接著逗號，後面接著元件的顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="4dc31-152">\<assembly-qualified workflow type name> is the namespace-qualified name of your workflow class, followed by a comma, followed by the display name of the assembly.</span></span> <span data-ttu-id="4dc31-153">如果您的組件具備強式名稱，也必須包含版本資訊及其 PublicKeyToken。</span><span class="sxs-lookup"><span data-stu-id="4dc31-153">If your assembly is strongly named, you also have to include version information and its PublicKeyToken.</span></span> <span data-ttu-id="4dc31-154">\<setting>如果您已針對不同種類的工作流程建立多個工作流程處理常式，則可以包含多個標記。</span><span class="sxs-lookup"><span data-stu-id="4dc31-154">You can include multiple \<setting> tags if you have created multiple workflow handlers for different kinds of workflows.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4dc31-155">根據您伺服器的設定，可以在嘗試儲存 Microsoft.MasterDataServices.Workflow.exe.config 檔案時，看到「存取遭拒」錯誤。</span><span class="sxs-lookup"><span data-stu-id="4dc31-155">Depending on the configuration of your server, you may see an "Access is denied" error when you try to save the Microsoft.MasterDataServices.Workflow.exe.config file.</span></span> <span data-ttu-id="4dc31-156">如果發生這個情形，請暫時停用伺服器上的 [使用者帳戶控制 (UAC)]。</span><span class="sxs-lookup"><span data-stu-id="4dc31-156">If this occurs, temporarily disable User Account Control (UAC) on the server.</span></span> <span data-ttu-id="4dc31-157">若要這麼做，開啟 [控制台]，然後按一下 [系統及安全性]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4dc31-157">To do this, open Control Panel, click **System and Security**.</span></span> <span data-ttu-id="4dc31-158">在 [控制中心]\*\*\*\* 底下，按一下 [變更使用者帳戶控制設定]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4dc31-158">Under **Action Center**, click **Change User Account Control Settings**.</span></span> <span data-ttu-id="4dc31-159">在 [使用者帳戶控制設定]\*\*\*\* 對話方塊中，將長條滑動到底部，讓您絕不會收到通知。</span><span class="sxs-lookup"><span data-stu-id="4dc31-159">In the **User Account Control Settings** dialog, slide the bar to the bottom so that you are never notified.</span></span> <span data-ttu-id="4dc31-160">重新啟動電腦，然後重複以上的步驟以編輯您的組態檔。</span><span class="sxs-lookup"><span data-stu-id="4dc31-160">Restart your computer and repeat the preceding steps to edit your configuration file.</span></span> <span data-ttu-id="4dc31-161">儲存此檔案之後，將您的 UAC 設定重設為預設層級。</span><span class="sxs-lookup"><span data-stu-id="4dc31-161">After saving the file, reset your UAC settings to the default level.</span></span>  
  
### <a name="start-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="4dc31-162">啟動 SQL Server MDS 工作流程整合服務</span><span class="sxs-lookup"><span data-stu-id="4dc31-162">Start SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="4dc31-163">根據預設，不會安裝 SQL Server MDS 工作流程整合服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-163">By default, SQL Server MDS Workflow Integration Service is not installed.</span></span> <span data-ttu-id="4dc31-164">您必須先安裝此服務，才能使用它。</span><span class="sxs-lookup"><span data-stu-id="4dc31-164">You must install the service before it can be used.</span></span> <span data-ttu-id="4dc31-165">為獲得更大的安全性，請為服務建立本機使用者，並僅授與此使用者執行工作流程作業所需的權限。</span><span class="sxs-lookup"><span data-stu-id="4dc31-165">For the greatest security, create a local user for the service and grant this user only the permissions needed to perform workflow operations.</span></span> <span data-ttu-id="4dc31-166">若要建立使用者，請安裝服務、啟動服務，然後遵循以下步驟進行：</span><span class="sxs-lookup"><span data-stu-id="4dc31-166">To create a user, install the service, and start the service, follow these steps:</span></span>  
  
1.  <span data-ttu-id="4dc31-167">使用 [本機使用者和群組] 管理員建立區域使用者，例如， mds_workflow_service。</span><span class="sxs-lookup"><span data-stu-id="4dc31-167">Use the Local Users and Groups manager to create a local user named, for example, mds_workflow_service.</span></span>  
  
2.  <span data-ttu-id="4dc31-168">使用 SQL Server Management Studio 授與 mds_workflow_service 使用者權限以執行 [mdm].[udpExternalActionsGet] 預存程序。</span><span class="sxs-lookup"><span data-stu-id="4dc31-168">Use SQL Server Management Studio to grant the mds_workflow_service user permission to execute the [mdm].[udpExternalActionsGet] stored procedure.</span></span> <span data-ttu-id="4dc31-169">若要這麼做，請為 mds_workflow_service account 建立一個新的登入，在 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫中建立新使用者、將此使用者對應至 mds_workflow_service login，並授與使用者對於 [mdm].[udpExternalActionsGet] 預存程序的 EXECUTE 權限。</span><span class="sxs-lookup"><span data-stu-id="4dc31-169">To do this, create a new login for the mds_workflow_service account, create a new user in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database, map this user to the mds_workflow_service login, and grant the user EXECUTE permission to the [mdm].[udpExternalActionsGet] stored procedure.</span></span>  
  
3.  <span data-ttu-id="4dc31-170">授與 mds_workflow_service 使用者權限以執行工作流程處理常式組件。</span><span class="sxs-lookup"><span data-stu-id="4dc31-170">Grant the mds_workflow_service user permission to execute the workflow handler assembly.</span></span> <span data-ttu-id="4dc31-171">若要這麼做，請將 mds_workflow_service user 新增至工作流程處理常式組件之 [內容]\*\*\*\* 的 [安全性]\*\*\*\* 索引標籤，然後授與 mds_workflow_service user 的 READ 和 EXECUTE 權限。</span><span class="sxs-lookup"><span data-stu-id="4dc31-171">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of the workflow handler assembly and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
4.  <span data-ttu-id="4dc31-172">授與 mds_workflow_service 使用者權限以執行 SQL Server MDS 工作流程整合服務可執行檔。</span><span class="sxs-lookup"><span data-stu-id="4dc31-172">Grant the mds_workflow_service user permission to execute the SQL Server MDS Workflow Integration Service executable.</span></span> <span data-ttu-id="4dc31-173">若要這麼做，請在 \Master 資料 Services\webapplication\bin) 中，將 mds_workflow_service 使用者新增至 Microsoft.MasterDataServices.Workflow.exe**屬性**的 [**安全性**] 索引標籤，並將 [ \<Your installation folder> 讀取] 和 [執行] 許可權授與 mds_workflow_service 使用者。</span><span class="sxs-lookup"><span data-stu-id="4dc31-173">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
5.  <span data-ttu-id="4dc31-174">使用名稱為 InstallUtil.exe 的 .NET 安裝公用程式，安裝 SQL Server MDS 工作流程整合服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-174">Install SQL Server MDS Workflow Integration Service by using the .NET installation utility, named InstallUtil.exe.</span></span> <span data-ttu-id="4dc31-175">InstallUtil.exe 可以在 .NET 安裝資料夾 (例如 C:\Windows\Microsoft.NET\Framework\v4.0.30319\\) 中找到。</span><span class="sxs-lookup"><span data-stu-id="4dc31-175">InstallUtil.exe can be found in the .NET installation folder, such as C:\Windows\Microsoft.NET\Framework\v4.0.30319\\.</span></span> <span data-ttu-id="4dc31-176">在提升權限的命令提示字元下輸入以下內容，安裝 SQL Server MDS 工作流程整合服務：</span><span class="sxs-lookup"><span data-stu-id="4dc31-176">Install SQL Server MDS Workflow Integration Service by entering the following in an elevated command prompt:</span></span>  
  
    ```  
    C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil Microsoft.MasterDataServices.Workflow.exe  
    ```  
  
     <span data-ttu-id="4dc31-177">在安裝期間出現提示時，指定 mds_workflow_service user。</span><span class="sxs-lookup"><span data-stu-id="4dc31-177">Specify the mds_workflow_service user when prompted during installation.</span></span>  
  
6.  <span data-ttu-id="4dc31-178">使用 Services 嵌入式管理單元啟動 SQL Server MDS 工作流程整合服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-178">Start SQL Server MDS Workflow Integration Service by using the Services snap-in.</span></span> <span data-ttu-id="4dc31-179">若要這麼做，請在 Services 嵌入式管理單元中尋找 SQL Server MDS 工作流程整合服務，選取該服務，然後按一下 [啟動]\*\*\*\* 連結。</span><span class="sxs-lookup"><span data-stu-id="4dc31-179">To do this, find SQL Server MDS Workflow Integration Service in the Services snap-in, select it, and click the  **Start** link.</span></span>  
  
### <a name="create-a-workflow-business-rule"></a><span data-ttu-id="4dc31-180">建立工作流程商務規則</span><span class="sxs-lookup"><span data-stu-id="4dc31-180">Create a Workflow Business Rule</span></span>  
 <span data-ttu-id="4dc31-181">使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 建立並發佈套用時啟動工作流程的商務規則。</span><span class="sxs-lookup"><span data-stu-id="4dc31-181">Use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to create and publish a business rule that will start the workflow when applied.</span></span> <span data-ttu-id="4dc31-182">您應該確定您的商務規則中包含變更屬性值的動作，讓規則在套用一次之後，評估為 false。</span><span class="sxs-lookup"><span data-stu-id="4dc31-182">You should ensure that your business rule contains actions that change attribute values, so that the rule evaluates to false after it has been applied once.</span></span> <span data-ttu-id="4dc31-183">例如，當 Price 屬性值大於 500，且 Approved 屬性值為空白時，您的商務規則可能會評估為 true。</span><span class="sxs-lookup"><span data-stu-id="4dc31-183">For example, your business rule might evaluate to true when a Price attribute value is greater than 500 and the Approved attribute value is blank.</span></span> <span data-ttu-id="4dc31-184">接著，此規則可能會包含兩個動作：一個是將 Approved 屬性值設定為 Pending，另一個是啟動工作流程。</span><span class="sxs-lookup"><span data-stu-id="4dc31-184">The rule can then include two actions: one to set the Approved attribute value to Pending and one to start the workflow.</span></span> <span data-ttu-id="4dc31-185">或者，建議您建立一個使用「已變更」條件的規則，並新增您的屬性以變更追蹤群組。</span><span class="sxs-lookup"><span data-stu-id="4dc31-185">Alternatively, you may want to create a rule that uses the "has changed" condition and add your attributes to change tracking groups.</span></span> <span data-ttu-id="4dc31-186">如需商務規則的詳細資訊，請參閱[商務規則 &#40;Master Data Services&#41;](../business-rules-master-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="4dc31-186">For more information about business rules, see [Business Rules &#40;Master Data Services&#41;](../business-rules-master-data-services.md).</span></span>  
  
 <span data-ttu-id="4dc31-187">依照以下步驟，建立在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中啟動自訂工作流程的商務規則。</span><span class="sxs-lookup"><span data-stu-id="4dc31-187">Create a business rule that starts a custom workflow in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] by following these steps:</span></span>  
  
1.  <span data-ttu-id="4dc31-188">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 的商務規則編輯器中指定您商務規則的條件之後，將 [啟動工作流程]\*\*\*\* 動作從 [外部動作]\*\*\*\* 清單拖曳到 [THEN]\*\*\*\* 窗格的 [動作]\*\*\*\* 標籤中。</span><span class="sxs-lookup"><span data-stu-id="4dc31-188">In the business rule editor of [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], after you have specified the conditions of your business rule, drag the **Start Workflow** action from the **External actions** list to the **THEN** pane's **Action** label.</span></span>  
  
2.  <span data-ttu-id="4dc31-189">在 [編輯動作]\*\*\*\* 窗格的 [工作流程類型]\*\*\*\* 方塊中，輸入可識別您工作流程處理常式組件的標記。</span><span class="sxs-lookup"><span data-stu-id="4dc31-189">In the **Edit Action** pane, in the **Workflow type** box, type the tag that identifies your workflow handler assembly.</span></span> <span data-ttu-id="4dc31-190">這是您在組態檔中，為組件指定的標記，例如 TEST。</span><span class="sxs-lookup"><span data-stu-id="4dc31-190">This is the tag you specified in the configuration file for your assembly, for example, TEST.</span></span>  
  
3.  <span data-ttu-id="4dc31-191">或者，選取 [包含成員資料]\*\*\*\* 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="4dc31-191">Optionally, select the **Include member data** check box.</span></span> <span data-ttu-id="4dc31-192">選擇此核取方塊以便在 XML 中包含傳遞至工作流程處理常式的屬性名稱和值。</span><span class="sxs-lookup"><span data-stu-id="4dc31-192">Choose this to include attribute names and values in the XML that is passed to the workflow handler.</span></span>  
  
4.  <span data-ttu-id="4dc31-193">在 [工作流程網站]\*\*\*\* 方塊中，鍵入網站的名稱。</span><span class="sxs-lookup"><span data-stu-id="4dc31-193">In the **Workflow site** box, type the name of a website.</span></span> <span data-ttu-id="4dc31-194">這可能不適用於您的自訂工作流程，但是可用於加入的內容。</span><span class="sxs-lookup"><span data-stu-id="4dc31-194">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
5.  <span data-ttu-id="4dc31-195">在 [工作流程名稱]\*\*\*\* 方塊中，從 Visual Studio 鍵入工作流程的名稱。</span><span class="sxs-lookup"><span data-stu-id="4dc31-195">In the **Workflow name** box, type the name of your workflow from Visual Studio.</span></span> <span data-ttu-id="4dc31-196">這可能不適用於您的自訂工作流程，但是可用於加入的內容。</span><span class="sxs-lookup"><span data-stu-id="4dc31-196">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
6.  <span data-ttu-id="4dc31-197">儲存並發佈商務規則。</span><span class="sxs-lookup"><span data-stu-id="4dc31-197">Save and publish the business rule.</span></span>  
  
### <a name="apply-business-rules-to-start-a-workflow"></a><span data-ttu-id="4dc31-198">套用商務規則以啟動工作流程</span><span class="sxs-lookup"><span data-stu-id="4dc31-198">Apply Business Rules to Start a Workflow</span></span>  
 <span data-ttu-id="4dc31-199">將商務規則套用至您的資料以啟動工作流程。</span><span class="sxs-lookup"><span data-stu-id="4dc31-199">Apply the business rule to your data to start the workflow.</span></span> <span data-ttu-id="4dc31-200">若要這麼做，請使用 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 編輯包含您要驗證之成員的實體。</span><span class="sxs-lookup"><span data-stu-id="4dc31-200">To do this, use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to edit the entity that contains the members you want to validate.</span></span> <span data-ttu-id="4dc31-201">按一下 [套用商務規則]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="4dc31-201">Click **Apply business rules**.</span></span> <span data-ttu-id="4dc31-202">[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 會擴展 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫的 Service Broker 佇列，以回應商務規則。</span><span class="sxs-lookup"><span data-stu-id="4dc31-202">In response to the business rule, [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] populates the Service Broker queue of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="4dc31-203">當 SQL Server MDS 工作流程整合服務檢查佇列時，會將資料傳送至指定的工作流程處理常式組件，然後清除佇列。</span><span class="sxs-lookup"><span data-stu-id="4dc31-203">When SQL Server MDS Workflow Integration Service checks the queue, it sends the data to the specified workflow handler assembly and clears the queue.</span></span> <span data-ttu-id="4dc31-204">工作流程處理常式組件會執行您已經為其撰寫程式碼的動作。</span><span class="sxs-lookup"><span data-stu-id="4dc31-204">The workflow handler assembly performs whatever actions you have coded into it.</span></span>  
  
## <a name="troubleshoot-custom-workflows"></a><span data-ttu-id="4dc31-205">疑難排解自訂工作流程</span><span class="sxs-lookup"><span data-stu-id="4dc31-205">Troubleshoot Custom Workflows</span></span>  
 <span data-ttu-id="4dc31-206">如果您的工作流程處理常式組件沒有收到資料，可以嘗試為 SQL Server MDS 工作流程整合服務偵錯，或檢視 Service Broker 佇列。</span><span class="sxs-lookup"><span data-stu-id="4dc31-206">If your workflow handler assembly doesn't receive data, you can try debugging SQL Server MDS Workflow Integration Service or viewing the Service Broker queue.</span></span>  
  
### <a name="debug-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="4dc31-207">為 SQL Server MDS 工作流程整合服務偵錯</span><span class="sxs-lookup"><span data-stu-id="4dc31-207">Debug SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="4dc31-208">若要為 SQL Server 工作流程整合服務偵錯，請採取下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4dc31-208">To debug SQL Server Workflow Integration Service, take the following steps:</span></span>  
  
1.  <span data-ttu-id="4dc31-209">使用服務嵌入式管理單元停止服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-209">Use the Services snap-in to stop the service.</span></span>  
  
2.  <span data-ttu-id="4dc31-210">開啟命令提示字元、導覽到服務的位置，然後在主控台模式下輸入 Microsoft.MasterDataServices.Workflow.exe -console 來執行服務。</span><span class="sxs-lookup"><span data-stu-id="4dc31-210">Open a command prompt, navigate to the location of the service, and run the service in console mode by entering: Microsoft.MasterDataServices.Workflow.exe -console.</span></span>  
  
3.  <span data-ttu-id="4dc31-211">在 [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 中，更新您的成員，然後再次套用商務規則。</span><span class="sxs-lookup"><span data-stu-id="4dc31-211">In [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], update your member and apply business rules again.</span></span> <span data-ttu-id="4dc31-212">詳細的記錄顯示在主控台視窗中。</span><span class="sxs-lookup"><span data-stu-id="4dc31-212">Detailed logs are displayed in the console window.</span></span>  
  
### <a name="view-the-service-broker-queue"></a><span data-ttu-id="4dc31-213">檢視 Service Broker 佇列</span><span class="sxs-lookup"><span data-stu-id="4dc31-213">View the Service Broker Queue</span></span>  
 <span data-ttu-id="4dc31-214">包含當做工作流程一部分傳遞之主資料的 Service Broker 佇列為：mdm.microsoft/mdm/queue/externalaction。</span><span class="sxs-lookup"><span data-stu-id="4dc31-214">The Service Broker queue that contains the master data passed as part of the workflow is: mdm.microsoft/mdm/queue/externalaction.</span></span> <span data-ttu-id="4dc31-215">佇列可以在 SQL Management Studio **物件總管** 之 [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 資料庫的 Service Broker 節點底下找到。</span><span class="sxs-lookup"><span data-stu-id="4dc31-215">Queues can be found in the **Object Explorer** of SQL Management Studio under the Service Broker node of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="4dc31-216">請注意，如果服務已正確清除佇列，此佇列將是空的。</span><span class="sxs-lookup"><span data-stu-id="4dc31-216">Be aware that, if the service cleared the queue properly, this queue will be empty.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4dc31-217">另請參閱</span><span class="sxs-lookup"><span data-stu-id="4dc31-217">See Also</span></span>  
 <span data-ttu-id="4dc31-218">[自訂工作流程範例 &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span><span class="sxs-lookup"><span data-stu-id="4dc31-218">[Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span></span>  
 [<span data-ttu-id="4dc31-219">自訂工作流程 XML 描述 &#40;Master Data Services&#41;</span><span class="sxs-lookup"><span data-stu-id="4dc31-219">Custom Workflow XML Description &#40;Master Data Services&#41;</span></span>](create-a-custom-workflow-xml-description.md)  
  
  
