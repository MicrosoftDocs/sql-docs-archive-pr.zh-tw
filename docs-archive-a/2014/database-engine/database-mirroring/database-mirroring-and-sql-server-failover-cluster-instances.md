---
title: 資料庫鏡像及 SQL Server 容錯移轉叢集執行個體 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- failover clustering [SQL Server], database mirroring
- database mirroring [SQL Server], failover
- high-availability mode [SQL Server]
ms.assetid: f1dd6a79-698b-4e31-b923-6bfc3ea0b617
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 378f834b4482f44f6a84abf419f027b353c7771a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87705414"
---
# <a name="database-mirroring-and-sql-server-failover-cluster-instances"></a><span data-ttu-id="1e193-102">資料庫鏡像及 SQL Server 容錯移轉叢集執行個體</span><span class="sxs-lookup"><span data-stu-id="1e193-102">Database Mirroring and SQL Server Failover Cluster Instances</span></span>
  <span data-ttu-id="1e193-103">容錯移轉叢集是 [!INCLUDE[msCoName](../../includes/msconame-md.md)] 叢集服務 (MSCS) 叢集群組 (即所謂的資源群組) 中一或多個實體磁碟的結合，它們是叢集的參與節點。</span><span class="sxs-lookup"><span data-stu-id="1e193-103">A failover cluster is a combination of one or more physical disks in a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) cluster group, known as a resource group, that are participating nodes of the cluster.</span></span> <span data-ttu-id="1e193-104">資源群組會設定為主控 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]執行個體的容錯移轉叢集執行個體。</span><span class="sxs-lookup"><span data-stu-id="1e193-104">The resource group is configured as a failover clustered instance that hosts an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="1e193-105">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體會以單一電腦的型態出現在網路上，但是它具有在一個節點無法使用時，提供從一個節點容錯移轉到另一個節點的功能。</span><span class="sxs-lookup"><span data-stu-id="1e193-105">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance appears on the network as if it were a single computer, but has functionality that provides failover from one node to another if one node becomes unavailable.</span></span> <span data-ttu-id="1e193-106">如需詳細資訊，請參閱 [AlwaysOn 容錯移轉叢集執行個體 (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="1e193-106">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
 <span data-ttu-id="1e193-107">與可為單一資料庫提供高可用性支援的資料庫鏡像相比，容錯移轉叢集提供整個 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體的高可用性支援。</span><span class="sxs-lookup"><span data-stu-id="1e193-107">Failover clusters provide high-availability support for an entire [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance, in contrast to database mirroring, which provides high-availability support for a single database.</span></span> <span data-ttu-id="1e193-108">資料庫鏡像可在容錯移轉叢集之間運作，也可以在容錯移轉叢集與非叢集主機之間運作。</span><span class="sxs-lookup"><span data-stu-id="1e193-108">Database mirroring works between failover clusters and, also, between a failover cluster and a nonclustered host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1e193-109">如需資料庫鏡像的簡介，請參閱 [資料庫鏡像 &#40;SQL Server&#41;](database-mirroring-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="1e193-109">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
## <a name="mirroring-and-clustering"></a><span data-ttu-id="1e193-110">鏡像與叢集</span><span class="sxs-lookup"><span data-stu-id="1e193-110">Mirroring and Clustering</span></span>  
 <span data-ttu-id="1e193-111">一般而言，將鏡像與叢集搭配使用時，主體伺服器和鏡像伺服器都是位在叢集上，其中主體伺服器是在某個叢集的容錯移轉叢集執行個體上執行，而鏡像伺服器則是在其他叢集的容錯移轉叢集執行個體上執行。</span><span class="sxs-lookup"><span data-stu-id="1e193-111">Typically, when mirroring is used with clustering, the principal server and mirror server both reside on clusters, with the principal server running on the failover clustered instance of one cluster and the mirror server running on the failover clustered instance of a different cluster.</span></span> <span data-ttu-id="1e193-112">您可以建立一個鏡像工作階段，其中有一個夥伴位在叢集的容錯移轉叢集執行個體，而另一個夥伴則位在不同的非叢集電腦。</span><span class="sxs-lookup"><span data-stu-id="1e193-112">You can establish a mirroring session in which one partner resides on the failover clustered instance of a cluster and the other partner resides on a separate, unclustered computer, however.</span></span>  
  
 <span data-ttu-id="1e193-113">如果叢集容錯移轉使得主體伺服器暫時無法使用，用戶端與資料庫的連接將會中斷。</span><span class="sxs-lookup"><span data-stu-id="1e193-113">If a cluster failover makes a principal server temporarily unavailable, client connections are disconnected from the database.</span></span> <span data-ttu-id="1e193-114">完成叢集容錯移轉之後，視 [作業模式](database-mirroring-operating-modes.md)而定，用戶端可以重新連接到相同叢集或不同叢集上的主體伺服器或非叢集電腦。</span><span class="sxs-lookup"><span data-stu-id="1e193-114">After the cluster failover completes, clients can reconnect to the principal server on the same cluster, or on a different cluster or an unclustered computer, depending on the [operating mode](database-mirroring-operating-modes.md).</span></span> <span data-ttu-id="1e193-115">因此，在決定如何於叢集環境中設定資料庫鏡像時，用於鏡像的作業模式十分重要。</span><span class="sxs-lookup"><span data-stu-id="1e193-115">Therefore, when deciding how to configure database mirroring in a clustered environment, the operating mode you use for mirroring is significant.</span></span>  
  
### <a name="high-safety-mode-session-with-automatic-failover"></a><span data-ttu-id="1e193-116">具有自動容錯移轉的高安全性模式工作階段</span><span class="sxs-lookup"><span data-stu-id="1e193-116">High-Safety mode Session with Automatic Failover</span></span>  
 <span data-ttu-id="1e193-117">如果您想要在具有自動容錯移轉的高安全性模式下建立資料庫鏡像，則建議夥伴使用兩個叢集的組態。</span><span class="sxs-lookup"><span data-stu-id="1e193-117">If you intend to mirror a database in high-safety mode with automatic failover, a two-cluster configuration is recommended for the partners.</span></span> <span data-ttu-id="1e193-118">這種組態可提供最大的可用性。</span><span class="sxs-lookup"><span data-stu-id="1e193-118">This configuration provides maximum availability.</span></span> <span data-ttu-id="1e193-119">見證可以位在第三個叢集或非叢集電腦上。</span><span class="sxs-lookup"><span data-stu-id="1e193-119">The witness can reside either on a third cluster or on an unclustered computer.</span></span>  
  
 <span data-ttu-id="1e193-120">如果目前執行主體伺服器的節點失敗，資料庫的自動容錯移轉將在幾秒內開始，這段時間叢集仍會容錯移轉到另一個節點。</span><span class="sxs-lookup"><span data-stu-id="1e193-120">If the node running the current principal server fails, automatic failover of the database begins within a few seconds, while the cluster is still failing over to another node.</span></span> <span data-ttu-id="1e193-121">資料庫鏡像工作階段會容錯移轉至另一個叢集上的鏡像伺服器或非叢集電腦，而先前的鏡像伺服器會變成主體伺服器。</span><span class="sxs-lookup"><span data-stu-id="1e193-121">The database mirroring session fails over to the mirror server on the other cluster or unclustered computer, and the former mirror server becomes the principal server.</span></span> <span data-ttu-id="1e193-122">新的主體伺服器會儘快向前復原其資料庫副本，並使該副本上線作為主體資料庫。</span><span class="sxs-lookup"><span data-stu-id="1e193-122">The new principal server rolls forward its copy of the database as quickly as possible and brings it online as the principal database.</span></span> <span data-ttu-id="1e193-123">叢集容錯移轉完成 (這個動作通常需要數分鐘) 之後，先前作為主體伺服器的容錯移轉叢集執行個體將變成鏡像伺服器。</span><span class="sxs-lookup"><span data-stu-id="1e193-123">After the cluster failover completes, which typically takes several minutes, the failover clustered instance that was formerly the principal server becomes the mirror server.</span></span>  
  
 <span data-ttu-id="1e193-124">下圖說明在含有見證 (支援自動容錯移轉) 之高安全性模式下執行的鏡像工作階段中，叢集之間的自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1e193-124">The following illustration shows an automatic failover between clusters in a mirroring session running in high-safety mode with a witness (which supports automatic failover).</span></span>  
  
 <span data-ttu-id="1e193-125">![叢集上的容錯移轉](../media/dbm-and-failover-clustering.gif "叢集上的容錯移轉")</span><span class="sxs-lookup"><span data-stu-id="1e193-125">![A failover on a cluster](../media/dbm-and-failover-clustering.gif "A failover on a cluster")</span></span>  
  
 <span data-ttu-id="1e193-126">鏡像工作階段中的三個伺服器執行個體位於三個不同的叢集：**Cluster_A**、**Cluster_B** 和 **Cluster_C**。</span><span class="sxs-lookup"><span data-stu-id="1e193-126">The three server instances in the mirroring session reside on three distinct clusters: **Cluster_A**, **Cluster_B**, and **Cluster_C**.</span></span> <span data-ttu-id="1e193-127">在每一個叢集上， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的預設執行個體會以 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體的身分來執行。</span><span class="sxs-lookup"><span data-stu-id="1e193-127">On each cluster, a default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance.</span></span> <span data-ttu-id="1e193-128">鏡像工作階段啟動時， **Cluster_A** 上的容錯移轉叢集執行個體是主體伺服器、 **Cluster_B** 上的容錯移轉叢集執行個體是鏡像伺服器，而 **Cluster_C** 上的容錯移轉叢集執行個體則是鏡像工作階段中的見證。</span><span class="sxs-lookup"><span data-stu-id="1e193-128">When the mirroring session starts, the failover clustered instance on **Cluster_A** is the principal server, the failover clustered instance on **Cluster_B** is the mirror server, and the failover clustered instance on **Cluster_C** is the witness in the mirroring session.</span></span> <span data-ttu-id="1e193-129">最後， **Cluster_A** 上的使用中節點失敗，這造成主體伺服器無法使用。</span><span class="sxs-lookup"><span data-stu-id="1e193-129">Eventually, the active node on **Cluster_A** fails, which causes the principal server to become unavailable.</span></span>  
  
 <span data-ttu-id="1e193-130">在叢集有時間進行容錯移轉之前，鏡像伺服器透過見證的協助，而偵測到主體伺服器遺失。</span><span class="sxs-lookup"><span data-stu-id="1e193-130">Before the cluster has time to fail over, the loss of the principal server is detected by the mirror server, with the help of the witness.</span></span> <span data-ttu-id="1e193-131">鏡像伺服器會向前復原它的資料庫，並儘快將它與新的主體資料庫連線。</span><span class="sxs-lookup"><span data-stu-id="1e193-131">The mirror server rolls forward its database and brings it online as the new principal database as quickly as possible.</span></span> <span data-ttu-id="1e193-132">**Cluster_A** 完成容錯移轉時，先前的主體伺服器現在是鏡像伺服器，而且它會與目前在 **Cluster_B**上的主體資料庫同步處理其資料庫。</span><span class="sxs-lookup"><span data-stu-id="1e193-132">When **Cluster_A** finishes failing over, the former principal server is now the mirror server, and it synchronizes its database with the current principal database on **Cluster_B**.</span></span>  
  
### <a name="high-safety-mode-session-without-automatic-failover"></a><span data-ttu-id="1e193-133">不含自動容錯移轉的高安全性模式工作階段</span><span class="sxs-lookup"><span data-stu-id="1e193-133">High-Safety Mode Session Without Automatic Failover</span></span>  
 <span data-ttu-id="1e193-134">如果您是在不含自動容錯移轉的高安全性模式下建立資料庫鏡像，則在執行目前主體伺服器的節點失敗時，叢集中的另一個節點就會成為主體伺服器。</span><span class="sxs-lookup"><span data-stu-id="1e193-134">If you are mirroring a database in high-safety mode without automatic failover, another node in the cluster will act as the principal server if the node running the current principal server fails.</span></span> <span data-ttu-id="1e193-135">請注意，在叢集無法使用的這段期間，資料庫也會無法使用。</span><span class="sxs-lookup"><span data-stu-id="1e193-135">Note that while the cluster is unavailable, the database is unavailable.</span></span>  
  
### <a name="high-performance-mode-session"></a><span data-ttu-id="1e193-136">高效能模式工作階段</span><span class="sxs-lookup"><span data-stu-id="1e193-136">High-Performance Mode Session</span></span>  
 <span data-ttu-id="1e193-137">如果您想要以高效能模式建立資料庫鏡像，請考慮將主體伺服器放在叢集的容錯移轉叢集執行個體上，並將鏡像伺服器放在遠端位置的非叢集伺服器上。</span><span class="sxs-lookup"><span data-stu-id="1e193-137">If you intend to mirror a database in high-performance mode, consider placing the principal server on the failover clustered instance of a cluster and placing the mirror server on an unclustered server in a remote location.</span></span> <span data-ttu-id="1e193-138">如果叢集容錯移轉到不同節點，容錯移轉叢集執行個體將會繼續作為鏡像工作階段中的主體伺服器。</span><span class="sxs-lookup"><span data-stu-id="1e193-138">If the cluster fails over to a different node, the failover clustered instance will continue as the principal server in the mirroring session.</span></span> <span data-ttu-id="1e193-139">如果整個叢集都發生問題，則您可在鏡像伺服器上強制執行服務。</span><span class="sxs-lookup"><span data-stu-id="1e193-139">If the entire cluster has problems, you can force service onto the mirror server.</span></span>  
  
 <span data-ttu-id="1e193-140">**若要設定新的 SQL Server 容錯移轉叢集**</span><span class="sxs-lookup"><span data-stu-id="1e193-140">**To set up a new SQL Server failover cluster**</span></span>  
  
-   [<span data-ttu-id="1e193-141">建立新的 SQL Server 容錯移轉叢集 &#40;安裝程式&#41;</span><span class="sxs-lookup"><span data-stu-id="1e193-141">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)  
  
 <span data-ttu-id="1e193-142">**若要設定資料庫鏡像**</span><span class="sxs-lookup"><span data-stu-id="1e193-142">**To set up database mirroring**</span></span>  
  
-   [<span data-ttu-id="1e193-143">設定資料庫鏡像 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="1e193-143">Setting Up Database Mirroring &#40;SQL Server&#41;</span></span>](setting-up-database-mirroring-sql-server.md)  
  
-   [<span data-ttu-id="1e193-144">使用 Windows 驗證建立資料庫鏡像工作階段 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="1e193-144">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
## <a name="see-also"></a><span data-ttu-id="1e193-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="1e193-145">See Also</span></span>  
 <span data-ttu-id="1e193-146">[資料庫鏡像 &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="1e193-146">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 <span data-ttu-id="1e193-147">[資料庫鏡像作業模式](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="1e193-147">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 [<span data-ttu-id="1e193-148">AlwaysOn 容錯移轉叢集執行個體 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1e193-148">AlwaysOn Failover Cluster Instances (SQL Server)</span></span>](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
