---
title: 資料庫鏡像和記錄傳送 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87593571"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="0f711-102">資料庫鏡像和記錄傳送 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="0f711-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="0f711-103">給定的資料庫可以進行鏡像或記錄傳送；它也可以同時進行鏡像和記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="0f711-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="0f711-104">選擇使用的方式時，請考慮下列事項：</span><span class="sxs-lookup"><span data-stu-id="0f711-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="0f711-105">您需要多少個目的地伺服器？</span><span class="sxs-lookup"><span data-stu-id="0f711-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="0f711-106">若您只需要一個目的地資料庫，則建議您採用資料庫鏡像作為方案。</span><span class="sxs-lookup"><span data-stu-id="0f711-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="0f711-107">若您需要多個目的地資料庫，則必須使用記錄傳送，並視情況單獨或搭配資料庫鏡像使用。</span><span class="sxs-lookup"><span data-stu-id="0f711-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="0f711-108">結合這些方式，可讓您享有資料庫鏡像功能以及記錄傳送所提供的多重目的地支援。</span><span class="sxs-lookup"><span data-stu-id="0f711-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="0f711-109">若必須延遲在目的地資料庫上還原記錄檔 (通常是為了防止邏輯錯誤)，請使用記錄傳送，並視情況搭配資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="0f711-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="0f711-110">此主題將討論結合記錄傳送與資料庫鏡像時，應注意的事項。</span><span class="sxs-lookup"><span data-stu-id="0f711-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f711-111">如需這些技術的簡介，請參閱[資料庫鏡像 &#40;SQL Server&#41;](database-mirroring-sql-server.md) 和[關於記錄傳送 &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="0f711-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="0f711-112">結合記錄傳送與資料庫鏡像</span><span class="sxs-lookup"><span data-stu-id="0f711-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="0f711-113">鏡像工作階段中的主體資料庫，也可作為記錄傳送組態中的主要資料庫，反之亦然，只要記錄傳送備份共用仍完整即可。</span><span class="sxs-lookup"><span data-stu-id="0f711-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="0f711-114">資料庫鏡像工作階段可在任何作業模式中執行，無論是同步 (交易安全性設為 FULL) 或非同步 (交易安全性設為 OFF)。</span><span class="sxs-lookup"><span data-stu-id="0f711-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f711-115">若要在資料庫上使用資料庫鏡像，一定需要完整復原模式。</span><span class="sxs-lookup"><span data-stu-id="0f711-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="0f711-116">一般而言，在結合記錄傳送與資料庫鏡像時，會先建立鏡像工作階段然後再傳送記錄，不過這個步驟並非必要。</span><span class="sxs-lookup"><span data-stu-id="0f711-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="0f711-117">接著，會將目前的主體資料庫設定為記錄傳送主要資料庫 (「主體/主要資料庫」)，搭配一或多個遠端次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="0f711-118">此外，鏡像資料庫必須設定為記錄傳送主要資料庫 (「鏡像/主要資料庫」)。</span><span class="sxs-lookup"><span data-stu-id="0f711-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="0f711-119">記錄傳送次要資料庫應與「主體/主要伺服器」或「鏡像/主要伺服器」位於不同的伺服器執行個體上。</span><span class="sxs-lookup"><span data-stu-id="0f711-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f711-120">與記錄傳送有關的各伺服器，其大小寫設定必須相符。</span><span class="sxs-lookup"><span data-stu-id="0f711-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="0f711-121">在記錄傳送工作階段中，主要資料庫上的備份作業會在備份資料夾中建立記錄備份，</span><span class="sxs-lookup"><span data-stu-id="0f711-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="0f711-122">而次要伺服器的複製作業會從此處複製備份。</span><span class="sxs-lookup"><span data-stu-id="0f711-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="0f711-123">若要順利執行備份作業與複製作業，這些作業必須具備記錄傳送備份資料夾的存取權。</span><span class="sxs-lookup"><span data-stu-id="0f711-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="0f711-124">為了盡可能提高主要伺服器的可用性，建議您將備份資料夾建立在個別主機電腦的共用備份位置上。</span><span class="sxs-lookup"><span data-stu-id="0f711-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="0f711-125">請確定所有記錄傳送伺服器 (包括鏡像/主要伺服器) 都能存取共用備份位置 (稱為「備份共用」)。</span><span class="sxs-lookup"><span data-stu-id="0f711-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="0f711-126">若在資料庫鏡像容錯移轉後要讓記錄傳送還能繼續執行，您必須同時將鏡像伺服器設為主要伺服器，而所使用的組態必須與主體資料庫上主要伺服器所使用的相同。</span><span class="sxs-lookup"><span data-stu-id="0f711-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="0f711-127">鏡像資料庫會處於還原狀態，以防止備份作業備份鏡像資料庫上的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="0f711-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="0f711-128">如此可確定鏡像/主要資料庫不會對主體/主要資料庫有所影響 (而後者的記錄備份目前正由次要伺服器進行複製中)。</span><span class="sxs-lookup"><span data-stu-id="0f711-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="0f711-129">為防止假警示，當備份作業在鏡像/主要資料庫上執行後，備份作業會將一則訊息記錄到**log_shipping_monitor_history_detail** 資料表中，然後代理程式作業會傳回成功狀態。</span><span class="sxs-lookup"><span data-stu-id="0f711-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="0f711-130">鏡像/主要資料庫在記錄傳送工作階段中是處於非使用中狀態，</span><span class="sxs-lookup"><span data-stu-id="0f711-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="0f711-131">然而，若發生鏡像容錯移轉，先前的鏡像資料庫就會連線成為主體資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="0f711-132">此時，該資料庫也會變成使用中的記錄傳送主要資料庫，</span><span class="sxs-lookup"><span data-stu-id="0f711-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="0f711-133">而先前無法將記錄傳送至該資料庫的記錄傳送備份作業，則會開始傳送記錄。</span><span class="sxs-lookup"><span data-stu-id="0f711-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="0f711-134">相反地，容錯移轉會使先前的主體/主要資料庫成為新的鏡像/主要資料庫，並進入還原狀態，而該資料庫上的備份作業也會停止備份記錄。</span><span class="sxs-lookup"><span data-stu-id="0f711-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f711-135">若是發生自動容錯移轉，則當先前的主體/主要資料庫重新加入鏡像工作階段時，它會切換為鏡像角色。</span><span class="sxs-lookup"><span data-stu-id="0f711-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="0f711-136">若要在具有自動容錯移轉的高安全性模式下執行，就應該使用稱為「見證」的其他伺服器執行個體來設定鏡像工作階段。</span><span class="sxs-lookup"><span data-stu-id="0f711-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="0f711-137">如果在資料庫同步處理後，主體資料庫因故失效，而鏡像伺服器與見證之間仍可彼此通訊，就會產生自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="0f711-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="0f711-138">自動容錯移轉會使鏡像伺服器擔任主體角色，並使其資料庫連線成為主體資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="0f711-139">若新的主體/主要伺服器可以存取記錄傳送備份位置，伺服器的備份作業就會開始傳送記錄備份至該位置上。</span><span class="sxs-lookup"><span data-stu-id="0f711-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="0f711-140">資料庫鏡像同步模式可確保記錄鏈結不會受到鏡像容錯移轉的影響，並確保只有有效記錄才會還原。</span><span class="sxs-lookup"><span data-stu-id="0f711-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="0f711-141">次要伺服器會繼續複製記錄備份，而不知道已由另一個伺服器執行個體變成主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="0f711-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="0f711-142">在此狀況中，使用本機記錄傳送監視器時，沒有特別需要注意的因應事項。</span><span class="sxs-lookup"><span data-stu-id="0f711-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="0f711-143">如需在此狀況中使用遠端監視執行個體的相關資訊，請參閱本主題稍後的「資料庫鏡像對遠端監視執行個體的影響」。</span><span class="sxs-lookup"><span data-stu-id="0f711-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="0f711-144">從主體資料庫容錯移轉至鏡像資料庫</span><span class="sxs-lookup"><span data-stu-id="0f711-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="0f711-145">下圖將說明當鏡像在具有自動容錯移轉的高安全性模式下執行時，記錄傳送與資料庫鏡像將如何搭配運作。</span><span class="sxs-lookup"><span data-stu-id="0f711-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="0f711-146">起初， **Server_A** 既是鏡像的主體伺服器，也是記錄傳送的主要伺服器。</span><span class="sxs-lookup"><span data-stu-id="0f711-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="0f711-147">**Server_B** 是鏡像伺服器，同時也設定為主要伺服器，目前處於非使用中狀態。</span><span class="sxs-lookup"><span data-stu-id="0f711-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="0f711-148">**Server_C** 與 **Server_D** 是記錄傳送的次要伺服器。</span><span class="sxs-lookup"><span data-stu-id="0f711-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="0f711-149">為盡可能提高記錄傳送工作階段的可用性，備份位置位於個別主機電腦的共用目錄上。</span><span class="sxs-lookup"><span data-stu-id="0f711-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="0f711-150">![記錄傳送和資料庫鏡像](../media/logshipping-and-dbm-automatic-failover.gif "記錄傳送和資料庫鏡像")</span><span class="sxs-lookup"><span data-stu-id="0f711-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="0f711-151">在鏡像容錯移轉後，次要伺服器上所定義的主要伺服器名稱不會變更。</span><span class="sxs-lookup"><span data-stu-id="0f711-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="0f711-152">.</span><span class="sxs-lookup"><span data-stu-id="0f711-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="0f711-153">資料庫鏡像對遠端監視執行個體的影響</span><span class="sxs-lookup"><span data-stu-id="0f711-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="0f711-154">當記錄傳送與遠端監視執行個體搭配使用時，若將記錄傳送工作階段與資料庫鏡像結合，將會影響到監視器資料表中的資訊。</span><span class="sxs-lookup"><span data-stu-id="0f711-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="0f711-155">主要監視器的相關資訊，來自於主體/主要監視器以及每部次要監視器所設定之監視器的資訊組合。</span><span class="sxs-lookup"><span data-stu-id="0f711-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="0f711-156">為盡可能維持監視的緊密性，當您使用遠端監視器時，建議您在設定次要監視器上的主要監視器時，指定原始主要監視器的名稱。</span><span class="sxs-lookup"><span data-stu-id="0f711-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="0f711-157">這種方式也有助於變更 Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 的記錄傳送組態。</span><span class="sxs-lookup"><span data-stu-id="0f711-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="0f711-158">如需監視的詳細資訊，請參閱[監視記錄傳送 &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md)。</span><span class="sxs-lookup"><span data-stu-id="0f711-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="0f711-159">同時設定鏡像和記錄傳送</span><span class="sxs-lookup"><span data-stu-id="0f711-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="0f711-160">若要同時設定資料庫鏡像和記錄傳送，必須進行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="0f711-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="0f711-161">使用 NORECOVERY，將主體/主要資料庫的備份還原到另一個伺服器執行個體上，以便稍後作為主體/主要資料庫用來進行資料庫鏡像的鏡像資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="0f711-162">如需詳細資訊，請參閱 [準備鏡像資料庫以進行鏡像 &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="0f711-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="0f711-163">設定資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="0f711-163">Set up database mirroring.</span></span> <span data-ttu-id="0f711-164">如需詳細資訊，請參閱[使用 Windows 驗證建立資料庫鏡像工作階段 &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) 或[設定資料庫鏡像 &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="0f711-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="0f711-165">將主體/主要資料庫的備份還原到其他伺服器執行個體，以便稍後作為主要資料庫的記錄傳送次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="0f711-166">針對一或多個次要資料庫，將主體資料庫上的記錄傳送設成與主要資料庫的相同。</span><span class="sxs-lookup"><span data-stu-id="0f711-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="0f711-167">您應設定單一共用作為備份目錄 (備份共用)。</span><span class="sxs-lookup"><span data-stu-id="0f711-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="0f711-168">如此可確保在主體與鏡像伺服器之間的角色切換後，備份作業仍會繼續寫入和以前相同的目錄中。</span><span class="sxs-lookup"><span data-stu-id="0f711-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="0f711-169">最好的作法是，確定此共用所在的實體伺服器，不同於主控鏡像及記錄傳送的相關資料庫之伺服器。</span><span class="sxs-lookup"><span data-stu-id="0f711-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="0f711-170">如需詳細資訊，請參閱[設定記錄傳送 &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="0f711-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="0f711-171">從主體資料庫手動容錯移轉至鏡像資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="0f711-172">若要執行手動容錯移轉：</span><span class="sxs-lookup"><span data-stu-id="0f711-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="0f711-173">手動容錯移轉資料庫鏡像工作階段 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="0f711-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="0f711-174">手動容錯移轉資料庫鏡像工作階段 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="0f711-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="0f711-175">在當做主要資料庫的新主體資料庫 (之前為鏡像資料庫) 上設定記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="0f711-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="0f711-176">不要從次要資料庫執行任何設定。</span><span class="sxs-lookup"><span data-stu-id="0f711-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="0f711-177">您必須使用與步驟 4 中相同的備份共用。</span><span class="sxs-lookup"><span data-stu-id="0f711-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="0f711-178">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] 中的 [交易記錄傳送] 介面，在每個記錄傳送設定中只支援一個主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="0f711-179">因此，您必須使用預存程序，將新的主體資料庫設定為主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="0f711-180">執行另一個手動容錯移轉作業，在錯誤後回復至原始主體資料庫。</span><span class="sxs-lookup"><span data-stu-id="0f711-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
