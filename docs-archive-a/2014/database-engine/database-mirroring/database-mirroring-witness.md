---
title: 資料庫鏡像見證 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87592211"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="5af1b-102">資料庫鏡像見證</span><span class="sxs-lookup"><span data-stu-id="5af1b-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="5af1b-103">若要支援自動容錯移轉，就必須在高安全性模式下設定資料庫鏡像工作階段，而且它也會包含第三個伺服器執行個體，稱為「見證」。</span><span class="sxs-lookup"><span data-stu-id="5af1b-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="5af1b-104">見證是 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的選擇性執行個體，可以讓在高安全性模式工作階段中的鏡像伺服器辨別是否啟動自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="5af1b-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="5af1b-105">與兩位夥伴不同的是，見證並不是為資料庫服務。</span><span class="sxs-lookup"><span data-stu-id="5af1b-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="5af1b-106">支援自動容錯移轉是見證的唯一角色。</span><span class="sxs-lookup"><span data-stu-id="5af1b-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5af1b-107">在高效能模式中，見證可能會對可用性有負面影響。</span><span class="sxs-lookup"><span data-stu-id="5af1b-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="5af1b-108">如果見證是設定供資料庫鏡像工作階段使用，則主體伺服器必須至少連接到一個其他伺服器執行個體、鏡像伺服器或見證，或者兩者都連接。</span><span class="sxs-lookup"><span data-stu-id="5af1b-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="5af1b-109">否則，資料庫會變得無法使用，而又不可能強制服務 (可能會有資料遺失)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="5af1b-110">因此，對於高效能模式，強烈建議您永遠將見證設定為 OFF。</span><span class="sxs-lookup"><span data-stu-id="5af1b-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="5af1b-111">如需見證對高效能模式影響的資訊，請參閱 [資料庫鏡像作業模式](database-mirroring-operating-modes.md)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="5af1b-112">下圖將說明含有見證的高安全性模式工作階段。</span><span class="sxs-lookup"><span data-stu-id="5af1b-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="5af1b-113">![含有見證的鏡像工作階段](../media/dbm-3-way-session-intro.gif "含有見證的鏡像工作階段")</span><span class="sxs-lookup"><span data-stu-id="5af1b-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="5af1b-114">**本主題內容：**</span><span class="sxs-lookup"><span data-stu-id="5af1b-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="5af1b-115">在多個工作階段中使用見證</span><span class="sxs-lookup"><span data-stu-id="5af1b-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="5af1b-116">軟體和硬體建議</span><span class="sxs-lookup"><span data-stu-id="5af1b-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="5af1b-117">自動容錯移轉中見證的角色</span><span class="sxs-lookup"><span data-stu-id="5af1b-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="5af1b-118">加入或移除見證</span><span class="sxs-lookup"><span data-stu-id="5af1b-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="5af1b-119">在多個工作階段中使用見證</span><span class="sxs-lookup"><span data-stu-id="5af1b-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="5af1b-120">特定伺服器執行個體可以做為並行資料庫鏡像工作階段中的見證，每個不同的資料庫都有一個工作階段。</span><span class="sxs-lookup"><span data-stu-id="5af1b-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="5af1b-121">不同的工作階段可以有不同的夥伴。</span><span class="sxs-lookup"><span data-stu-id="5af1b-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="5af1b-122">下圖示範做為兩個有不同夥伴的資料庫鏡像工作階段之見證的伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="5af1b-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="5af1b-123">![作為 2 個資料庫見證的伺服器執行個體](../media/dbm-witness-in-2-sessions.gif "作為 2 個資料庫見證的伺服器執行個體")</span><span class="sxs-lookup"><span data-stu-id="5af1b-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="5af1b-124">單一伺服器執行個體也可以同時做為某些工作階段的見證與其他工作階段的夥伴。</span><span class="sxs-lookup"><span data-stu-id="5af1b-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="5af1b-125">但是實務上，伺服器執行個體通常是做為見證或夥伴。</span><span class="sxs-lookup"><span data-stu-id="5af1b-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="5af1b-126">這是因為夥伴需要配備足夠硬體的精密電腦以支援實際執行的資料庫，而見證則可以在支援 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]的任何可用 Windows 系統上執行。</span><span class="sxs-lookup"><span data-stu-id="5af1b-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="5af1b-127">軟體和硬體建議</span><span class="sxs-lookup"><span data-stu-id="5af1b-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="5af1b-128">我們強烈建議見證應該與任何夥伴位於不同的電腦上。</span><span class="sxs-lookup"><span data-stu-id="5af1b-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="5af1b-129">只有 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard Edition 和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition 支援資料庫鏡像夥伴伺服器。</span><span class="sxs-lookup"><span data-stu-id="5af1b-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="5af1b-130">相較之下， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup 和 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express 還支援見證。</span><span class="sxs-lookup"><span data-stu-id="5af1b-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="5af1b-131">除了從舊版 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]升級的期間以外，鏡像工作階段中的伺服器執行個體全都必須執行相同版本的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5af1b-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5af1b-132">例如，當您從 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 鏡像組態升級時可支援 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 見證，但是此見證無法加入至現有或新的 [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] 或更新版本的鏡像組態中。</span><span class="sxs-lookup"><span data-stu-id="5af1b-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="5af1b-133">見證可以在支援這些任何版本 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]的任何可靠電腦系統上執行。</span><span class="sxs-lookup"><span data-stu-id="5af1b-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5af1b-134">不過，建議每一個當做見證使用的伺服器執行個體具有對應於所執行之 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard 版本所需的最低組態。</span><span class="sxs-lookup"><span data-stu-id="5af1b-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="5af1b-135">如需這些需求的詳細資訊，請參閱[安裝 SQL Server 2014 的硬體和軟體需求](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="5af1b-136">自動容錯移轉中見證的角色</span><span class="sxs-lookup"><span data-stu-id="5af1b-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="5af1b-137">在資料庫鏡像工作階段內，所有伺服器執行個體會監視其連接狀態。</span><span class="sxs-lookup"><span data-stu-id="5af1b-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="5af1b-138">如果夥伴彼此之間中斷連接，就要依靠見證，確保目前只有其中一個為資料庫服務。</span><span class="sxs-lookup"><span data-stu-id="5af1b-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="5af1b-139">如果同步處理鏡像伺服器失去主體伺服器的連接，但仍然連接到見證，鏡像伺服器就會連絡見證，判斷見證是否失去與主體伺服器的連接。</span><span class="sxs-lookup"><span data-stu-id="5af1b-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="5af1b-140">如果主體伺服器仍然與見證連接，就不會發生自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="5af1b-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="5af1b-141">而是，主體伺服器繼續為資料庫服務，同時累積記錄，在夥伴重新連接時傳送鏡像伺服器。</span><span class="sxs-lookup"><span data-stu-id="5af1b-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="5af1b-142">如果見證也與主體伺服器中斷連接，鏡像伺服器知道主體資料庫已無法使用。</span><span class="sxs-lookup"><span data-stu-id="5af1b-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="5af1b-143">在此情況下，鏡像伺服器會立即啟動自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="5af1b-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="5af1b-144">如果鏡像伺服器與見證中斷連接，而且也與主體伺服器中斷連接，則不管主體伺服器的狀態如何，都不可能進行自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="5af1b-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="5af1b-145">至少連接兩個伺服器執行個體的需求，即所謂的 *「仲裁」* 。</span><span class="sxs-lookup"><span data-stu-id="5af1b-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="5af1b-146">仲裁確保資料庫一次只能由一個夥伴提供服務。</span><span class="sxs-lookup"><span data-stu-id="5af1b-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="5af1b-147">如需仲裁運作方式及其對工作階段影響的資訊，請參閱[仲裁：見證如何影響資料庫可用性 &#40;資料庫鏡像&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md)。</span><span class="sxs-lookup"><span data-stu-id="5af1b-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="5af1b-148">加入或移除見證</span><span class="sxs-lookup"><span data-stu-id="5af1b-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="5af1b-149">**加入見證**</span><span class="sxs-lookup"><span data-stu-id="5af1b-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="5af1b-150">新增或取代資料庫鏡像見證 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="5af1b-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="5af1b-151">使用 Windows 驗證新增資料庫鏡像見證 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5af1b-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="5af1b-152">**移除見證**</span><span class="sxs-lookup"><span data-stu-id="5af1b-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="5af1b-153">從資料庫鏡像工作階段移除見證 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5af1b-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="5af1b-154">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5af1b-154">See Also</span></span>  
 <span data-ttu-id="5af1b-155">[資料庫鏡像工作階段期間的角色切換 &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5af1b-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="5af1b-156">[資料庫鏡像作業模式](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="5af1b-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="5af1b-157">[仲裁：見證如何影響資料庫可用性 &#40;資料庫鏡像&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="5af1b-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="5af1b-158">[資料庫鏡像期間可能發生的失敗](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="5af1b-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="5af1b-159">鏡像狀態 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5af1b-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
