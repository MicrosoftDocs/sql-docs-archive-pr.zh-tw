---
title: SQL Server 2014 中資料庫引擎功能的重大變更 |Microsoft Docs
ms.custom: ''
ms.date: 01/19/2019
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: release-landing
ms.topic: conceptual
helpviewer_keywords:
- Database Engine [SQL Server], what's new
- breaking changes [SQL Server]
ms.assetid: 47edefbd-a09b-4087-937a-453cd5c6e061
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: bf1a25aabde1e684407218da7365ae7a2b4265a7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709945"
---
# <a name="breaking-changes-to-database-engine-features-in-sql-server-2014"></a><span data-ttu-id="71881-102">SQL Server 2014 中對於 Database Engine 的重大變更</span><span class="sxs-lookup"><span data-stu-id="71881-102">Breaking Changes to Database Engine Features in SQL Server 2014</span></span>
  <span data-ttu-id="71881-103">本主題描述 [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] 和舊版的重大變更 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="71881-103">This topic describes breaking changes in the [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] and earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="71881-104">這些變更可能會中斷以舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]為根據的應用程式、指令碼或功能。</span><span class="sxs-lookup"><span data-stu-id="71881-104">These changes might break applications, scripts, or functionalities that are based on earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="71881-105">當您升級時可能會遇到這些問題。</span><span class="sxs-lookup"><span data-stu-id="71881-105">You might encounter these issues when you upgrade.</span></span> <span data-ttu-id="71881-106">如需詳細資訊，請參閱＜ [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md)＞。</span><span class="sxs-lookup"><span data-stu-id="71881-106">For more information, see [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span></span>  
  
##  <a name="breaking-changes-in-sssql14"></a><a name="SQL14"></a><span data-ttu-id="71881-107">[!INCLUDE[ssSQL14](../includes/sssql14-md.md)] 的重大變更</span><span class="sxs-lookup"><span data-stu-id="71881-107">Breaking Changes in [!INCLUDE[ssSQL14](../includes/sssql14-md.md)]</span></span>  
 <span data-ttu-id="71881-108">沒有任何新的問題。</span><span class="sxs-lookup"><span data-stu-id="71881-108">No new issues.</span></span>  
  
##  <a name="breaking-changes-in-sssql11"></a><a name="Denali"></a><span data-ttu-id="71881-109">中的重大變更[!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span><span class="sxs-lookup"><span data-stu-id="71881-109">Breaking Changes in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span></span>  
  
### <a name="transact-sql"></a><span data-ttu-id="71881-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="71881-110">Transact-SQL</span></span>  
  
|<span data-ttu-id="71881-111">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-111">Feature</span></span>|<span data-ttu-id="71881-112">描述</span><span class="sxs-lookup"><span data-stu-id="71881-112">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-113">從名為 NEXT 的資料行或資料表選取</span><span class="sxs-lookup"><span data-stu-id="71881-113">Selecting from columns or tables named NEXT</span></span>|<span data-ttu-id="71881-114">序列會使用 ANSI 標準 NEXT VALUE FOR 函數。</span><span class="sxs-lookup"><span data-stu-id="71881-114">Sequences use the ANSI standard NEXT VALUE FOR function.</span></span> <span data-ttu-id="71881-115">如果資料表或資料行名為 NEXT，而且資料表或資料行的別名為 VALUE，而且如果省略 ANSI 標準 AS，則結果語句可能會導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-115">If a table or a column is named NEXT and the table or column is aliased as VALUE, and if the ANSI standard AS is omitted, the resultant statement can cause an error.</span></span> <span data-ttu-id="71881-116">若要解決這個問題，請加入 ANSI 標準 AS 關鍵字。</span><span class="sxs-lookup"><span data-stu-id="71881-116">To work around, include the ANSI standard AS keyword.</span></span> <span data-ttu-id="71881-117">例如，`SELECT NEXT VALUE FROM Table` 應該改寫成 `SELECT NEXT AS VALUE FROM Table`，而 `SELECT Col1 FROM NEXT VALUE` 應該改寫成 `SELECT Col1 FROM NEXT AS VALUE`。</span><span class="sxs-lookup"><span data-stu-id="71881-117">For example, `SELECT NEXT VALUE FROM Table` should be rewritten as `SELECT NEXT AS VALUE FROM Table` and `SELECT Col1 FROM NEXT VALUE` should be rewritten as `SELECT Col1 FROM NEXT AS VALUE`.</span></span>|  
|<span data-ttu-id="71881-118">PIVOT 運算子</span><span class="sxs-lookup"><span data-stu-id="71881-118">PIVOT operator</span></span>|<span data-ttu-id="71881-119">當資料庫相容性層級設定為 110 時，不允許在遞迴通用資料表運算式 (CTE) 查詢中使用 PIVOT 運算子。</span><span class="sxs-lookup"><span data-stu-id="71881-119">The PIVOT operator is not allowed in a recursive common table expression (CTE) query when the database compatibility level is set to 110.</span></span> <span data-ttu-id="71881-120">請重寫查詢，或將相容性層級變更為 100 或更低。</span><span class="sxs-lookup"><span data-stu-id="71881-120">Rewrite the query, or change the compatibility level to 100 or lower.</span></span> <span data-ttu-id="71881-121">當每個群組具有多個資料列時，在遞迴 CTE 查詢中使用 PIVOT 會產生錯誤的結果。</span><span class="sxs-lookup"><span data-stu-id="71881-121">Using PIVOT in a recursive CTE query produces incorrect results when there is more than a single row per grouping.</span></span>|  
|<span data-ttu-id="71881-122">sp_setapprole 和 sp_unsetapprole</span><span class="sxs-lookup"><span data-stu-id="71881-122">sp_setapprole and sp_unsetapprole</span></span>|<span data-ttu-id="71881-123"> 的 Cookie  參數目前記載成 ，是正確的長度上限。</span><span class="sxs-lookup"><span data-stu-id="71881-123">The cookie `OUTPUT` parameter for `sp_setapprole` is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="71881-124">但目前的實作會傳回 `varbinary(50)`。</span><span class="sxs-lookup"><span data-stu-id="71881-124">However the current implementation returns `varbinary(50)`.</span></span> <span data-ttu-id="71881-125">應用程式應繼續保留 `varbinary(8000)`，如此後續版本的 Cookie 傳回大小如有增加，應用程式才可繼續正常地運作。</span><span class="sxs-lookup"><span data-stu-id="71881-125">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="71881-126">如需詳細資訊，請參閱 [sp_setapprole &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="71881-126">For more information, see [sp_setapprole &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql).</span></span>|  
|<span data-ttu-id="71881-127">EXECUTE AS</span><span class="sxs-lookup"><span data-stu-id="71881-127">EXECUTE AS</span></span>|<span data-ttu-id="71881-128">EXECUTE AS 的 Cookie OUTPUT 參數目前記載成 `varbinary(8000)`，這是正確的長度上限。</span><span class="sxs-lookup"><span data-stu-id="71881-128">The cookie OUTPUT parameter for EXECUTE AS is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="71881-129">但目前的實作會傳回 `varbinary(100)`。</span><span class="sxs-lookup"><span data-stu-id="71881-129">However the current implementation returns `varbinary(100)`.</span></span> <span data-ttu-id="71881-130">應用程式應繼續保留 `varbinary(8000)`，如此後續版本的 Cookie 傳回大小如有增加，應用程式才可繼續正常地運作。</span><span class="sxs-lookup"><span data-stu-id="71881-130">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="71881-131">如需詳細資訊，請參閱 [EXECUTE AS &#40;Transact-SQL&#41;](/sql/t-sql/statements/execute-as-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="71881-131">For more information, see [EXECUTE AS &#40;Transact-SQL&#41;](/sql/t-sql/statements/execute-as-transact-sql).</span></span>|  
|<span data-ttu-id="71881-132">sys.fn_get_audit_file 函數</span><span class="sxs-lookup"><span data-stu-id="71881-132">sys.fn_get_audit_file function</span></span>|<span data-ttu-id="71881-133">已加入兩個額外的資料行 (**user_defined_event_id**和**user_defined_information**) ，以支援使用者定義的 audit 事件。</span><span class="sxs-lookup"><span data-stu-id="71881-133">Two additional columns (**user_defined_event_id** and **user_defined_information**) have been added to support user-defined audit events.</span></span> <span data-ttu-id="71881-134">沒有依照名稱選取資料行的應用程式可能會傳回超過預期數目的資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-134">Applications that do not select columns by name might return more columns than expected.</span></span> <span data-ttu-id="71881-135">請依照名稱選取資料行，或調整應用程式以接受這些額外的資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-135">Either select columns by name, or adjust the application to accept these additional columns.</span></span>|  
|<span data-ttu-id="71881-136">WITHIN 保留關鍵字</span><span class="sxs-lookup"><span data-stu-id="71881-136">WITHIN reserved keyword</span></span>|<span data-ttu-id="71881-137">WITHIN 現在是保留關鍵字。</span><span class="sxs-lookup"><span data-stu-id="71881-137">WITHIN is now a reserved keyword.</span></span> <span data-ttu-id="71881-138">名為 'within' 之物件或資料行的參考將會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-138">References to objects or columns named 'within' will fail.</span></span> <span data-ttu-id="71881-139">請重新命名物件或資料行名稱，或者使用括號或引號來分隔名稱。</span><span class="sxs-lookup"><span data-stu-id="71881-139">Rename the object or column name or delimit the name by using brackets or quotes.</span></span>  <span data-ttu-id="71881-140">例如： `SELECT * FROM [within]` 。</span><span class="sxs-lookup"><span data-stu-id="71881-140">For example, `SELECT * FROM [within]`.</span></span>|  
|<span data-ttu-id="71881-141"> 或  類型之計算資料行的 CAST 和 CONVERT 作業</span><span class="sxs-lookup"><span data-stu-id="71881-141">CAST and CONVERT operations on computed columns of type `time` or `datetime2`</span></span>|<span data-ttu-id="71881-142">在舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，除非用於計算資料行運算式，否則 `time` 和 `datetime2` 資料類型之 CAST 和 CONVERT 作業的預設樣式為 121。</span><span class="sxs-lookup"><span data-stu-id="71881-142">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the default style for CAST and CONVERT operations on `time` and `datetime2` data types is 121 except when either type is used in a computed column expression.</span></span> <span data-ttu-id="71881-143">若為計算資料行，預設樣式為 0。</span><span class="sxs-lookup"><span data-stu-id="71881-143">For computed columns, the default style is 0.</span></span> <span data-ttu-id="71881-144">當您建立計算資料行、將它們用於包含自動參數化的查詢或用於條件約束定義時，這種行為就會影響計算資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-144">This behavior impacts computed columns when they are created, used in queries involving auto-parameterization, or used in constraint definitions.</span></span><br /><br /> <span data-ttu-id="71881-145">在相容性層級 110 底下，`time` 和 `datetime2` 資料類型之 CAST 和 CONVERT 作業的預設樣式一律為 121。</span><span class="sxs-lookup"><span data-stu-id="71881-145">Under compatibility level 110, the default style for CAST and CONVERT operations on `time` and `datetime2` data types is always 121.</span></span> <span data-ttu-id="71881-146">如果您的查詢仰賴舊的行為，請使用低於 110 的相容性層級，或在受影響的查詢中明確指定 0 樣式。</span><span class="sxs-lookup"><span data-stu-id="71881-146">If your query relies on the old behavior, use a compatibility level less than 110, or explicitly specify the 0 style in the affected query.</span></span><br /><br /> <span data-ttu-id="71881-147">將資料庫升級為相容性層級 110 不會變更已經儲存至磁碟的使用者資料。</span><span class="sxs-lookup"><span data-stu-id="71881-147">Upgrading the database to compatibility level 110 will not change user data that has been stored to disk.</span></span> <span data-ttu-id="71881-148">您必須依適當情況手動更正這項資料。</span><span class="sxs-lookup"><span data-stu-id="71881-148">You must manually correct this data as appropriate.</span></span> <span data-ttu-id="71881-149">例如，如果您使用了 SELECT INTO，根據包含上述計算資料行運算式的來源建立資料表，系統就會儲存資料 (使用樣式 0) 而非計算資料行定義本身。</span><span class="sxs-lookup"><span data-stu-id="71881-149">For example, if you used SELECT INTO to create a table from a source that contained a computed column expression described above, the data (using style 0) would be stored rather than the computed column definition itself.</span></span> <span data-ttu-id="71881-150">您必須手動將這項資料更新為符合樣式 121。</span><span class="sxs-lookup"><span data-stu-id="71881-150">You would need to manually update this data to match style 121.</span></span>|  
|<span data-ttu-id="71881-151">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="71881-151">ALTER TABLE</span></span>|<span data-ttu-id="71881-152">ALTER TABLE 陳述式只允許兩部分 (schema.object) 資料表名稱。</span><span class="sxs-lookup"><span data-stu-id="71881-152">The ALTER TABLE statement allows only two-part (schema.object) table names.</span></span> <span data-ttu-id="71881-153">使用下列格式來指定資料表名稱，現在會在編譯時期失敗，錯誤為117：</span><span class="sxs-lookup"><span data-stu-id="71881-153">Specifying a table name using the following formats now fails at compile time with error 117:</span></span><br /><br /> <span data-ttu-id="71881-154">server.database.schema.table</span><span class="sxs-lookup"><span data-stu-id="71881-154">server.database.schema.table</span></span><br /><br /> <span data-ttu-id="71881-155">.database.schema.table</span><span class="sxs-lookup"><span data-stu-id="71881-155">.database.schema.table</span></span><br /><br /> <span data-ttu-id="71881-156">..schema.table</span><span class="sxs-lookup"><span data-stu-id="71881-156">..schema.table</span></span><br /><br /> <span data-ttu-id="71881-157">在舊版中，指定 server.database.schema.table 格式會傳回錯誤 4902。</span><span class="sxs-lookup"><span data-stu-id="71881-157">In earlier versions specifying the format server.database.schema.table returned error 4902.</span></span> <span data-ttu-id="71881-158">不過，指定 .database.schema.table 格式或 ..schema.table 格式會成功。</span><span class="sxs-lookup"><span data-stu-id="71881-158">Specifying the format .database.schema.table or the format ..schema.table succeeded.</span></span> <span data-ttu-id="71881-159">若要解決此問題，請移除 4 部分前置詞的用法。</span><span class="sxs-lookup"><span data-stu-id="71881-159">To resolve the problem, remove the use of a 4-part prefix.</span></span>|  
|<span data-ttu-id="71881-160">瀏覽中繼資料</span><span class="sxs-lookup"><span data-stu-id="71881-160">Browsing metadata</span></span>|<span data-ttu-id="71881-161">使用 FOR BROWSE 或 SET NO_BROWSETABLE ON 來查詢檢視現在會傳回檢視的中繼資料，而非基礎物件的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="71881-161">Querying a view using FOR BROWSE or SET NO_BROWSETABLE ON now returns the metadata of the view, not the metadata of the underlying object.</span></span> <span data-ttu-id="71881-162">這種行為現在與其他瀏覽中繼資料的方法相符。</span><span class="sxs-lookup"><span data-stu-id="71881-162">This behavior now matches other methods of browsing metadata.</span></span>|  
|<span data-ttu-id="71881-163">SOUNDEX</span><span class="sxs-lookup"><span data-stu-id="71881-163">SOUNDEX</span></span>|<span data-ttu-id="71881-164">在資料庫相容性層級 110 下，SOUNDEX 函式會實作新的規則，這些規則可能會使此函式將值計算成不同於在舊版相容性層級下計算的值。</span><span class="sxs-lookup"><span data-stu-id="71881-164">Under database compatibility level 110, the SOUNDEX function implements new rules that may cause the values computed by the function to be different than the values computed under earlier compatibility levels.</span></span> <span data-ttu-id="71881-165">升級到相容性層級 110 之後，您可能需要重建使用 SOUNDEX 函數的索引、堆積或 CHECK 條件約束。</span><span class="sxs-lookup"><span data-stu-id="71881-165">After upgrading to compatibility level 110, you may need to rebuild the indexes, heaps, or CHECK constraints that use the SOUNDEX function.</span></span> <span data-ttu-id="71881-166">如需詳細資訊，請參閱[SOUNDEX &#40;transact-sql&#41;](/sql/t-sql/functions/soundex-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="71881-166">For more information, see [SOUNDEX &#40;Transact-SQL&#41;](/sql/t-sql/functions/soundex-transact-sql)</span></span>
|<span data-ttu-id="71881-167">失敗之 DML 陳述式的資料列計數訊息</span><span class="sxs-lookup"><span data-stu-id="71881-167">Row count message for failed DML statements</span></span>|<span data-ttu-id="71881-168">在 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 中，當 DML 陳述式失敗時，[!INCLUDE[ssDE](../includes/ssde-md.md)] 會以一致的方式將含有 RowCount: 0 的 TDS DONE Token 傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="71881-168">In [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], the [!INCLUDE[ssDE](../includes/ssde-md.md)] will consistently send the TDS DONE token with RowCount: 0 to clients when a DML statement fails.</span></span> <span data-ttu-id="71881-169">在舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，當失敗的 DML 陳述式包含在 TRY-CATCH 區塊中，而且由 [!INCLUDE[ssDE](../includes/ssde-md.md)] 自動參數化，或者 TRY-CATCH 區塊與失敗的陳述式不在相同的層級上時，系統會將錯誤的值 -1 傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="71881-169">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], an incorrect value of -1 is sent to the client when the DML statement that fails is contained in a TRY-CATCH block and is either autoparameterized by the [!INCLUDE[ssDE](../includes/ssde-md.md)] or the TRY-CATCH block is not on the same level as the failed statement.</span></span> <span data-ttu-id="71881-170">例如，如果 TRY-CATCH 區塊呼叫了預存程序，而且此程序中的 DML 陳述式失敗，則用戶端將收到錯誤的 -1 值。</span><span class="sxs-lookup"><span data-stu-id="71881-170">For example, if a TRY-CATCH block calls a stored procedure and a DML statement in the procedure fails, the client will incorrectly receive a -1 value.</span></span><br /><br /> <span data-ttu-id="71881-171">仰賴此錯誤行為的應用程式將會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-171">Applications that rely on this incorrect behavior will fail.</span></span>|  
|<span data-ttu-id="71881-172">SERVERPROPERTY ( ' 版本 ' ) </span><span class="sxs-lookup"><span data-stu-id="71881-172">SERVERPROPERTY ('Edition')</span></span>|<span data-ttu-id="71881-173">已安裝的 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 執行個體產品版本。</span><span class="sxs-lookup"><span data-stu-id="71881-173">Installed product edition of the instance of [!INCLUDE[ssSQL11](../includes/sssql11-md.md)].</span></span> <span data-ttu-id="71881-174">請利用這個屬性值來判斷已安裝的產品所支援的功能和限制 (如最大 CPU 數目)。</span><span class="sxs-lookup"><span data-stu-id="71881-174">Use the value of this property to determine the features and the limits, such as maximum number of CPUs that are supported by the installed product.</span></span><br /><br /> <span data-ttu-id="71881-175">根據已安裝的 Enterprise edition，這會傳回「Enterprise Edition」或「Enterprise Edition：核心授權」。</span><span class="sxs-lookup"><span data-stu-id="71881-175">Based on the installed Enterprise edition, this can return 'Enterprise Edition' or 'Enterprise Edition: Core-based Licensing'.</span></span> <span data-ttu-id="71881-176">Enterprise 版本會根據單一 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 執行個體的計算容量上限而區分。</span><span class="sxs-lookup"><span data-stu-id="71881-176">The Enterprise editions are differentiated based on the maximum compute capacity by a single instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="71881-177">如需有關中計算容量限制的詳細資訊 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] ，請參閱[依版本 SQL Server 的計算容量限制](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="71881-177">For more information on Compute capacity limits in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], see [Compute Capacity Limits by Edition of SQL Server](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md).</span></span>|  
|<span data-ttu-id="71881-178">CREATE LOGIN</span><span class="sxs-lookup"><span data-stu-id="71881-178">CREATE LOGIN</span></span>|<span data-ttu-id="71881-179">`CREATE LOGIN WITH PASSWORD = '` *Password* `' HASHED` 選項無法與 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 或更早版本所建立的雜湊搭配使用。</span><span class="sxs-lookup"><span data-stu-id="71881-179">The `CREATE LOGIN WITH PASSWORD = '`*password*`' HASHED` option cannot be used with hashes created by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 or earlier.</span></span>|  
|<span data-ttu-id="71881-180">`datetimeoffset` 的 CAST 和 CONVERT 作業</span><span class="sxs-lookup"><span data-stu-id="71881-180">CAST and CONVERT operations for `datetimeoffset`</span></span>|<span data-ttu-id="71881-181">從日期和時間類型轉換成 `datetimeoffset` 時，唯一支援的樣式是 0 或 1。</span><span class="sxs-lookup"><span data-stu-id="71881-181">The only styles that are supported when converting from date and time types to `datetimeoffset` are 0 or 1.</span></span> <span data-ttu-id="71881-182">所有其他轉換樣式都會傳回錯誤 9809。</span><span class="sxs-lookup"><span data-stu-id="71881-182">All other conversion styles return error 9809.</span></span> <span data-ttu-id="71881-183">例如，下列程式碼會傳回錯誤 9809。</span><span class="sxs-lookup"><span data-stu-id="71881-183">For example, the following code returns error 9809.</span></span><br /><br /> `SELECT CONVERT(date, CAST('7070-11-25 16:25:01.00986 -02:07' as datetimeoffset(5)), 107);`|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="71881-184">動態管理檢視</span><span class="sxs-lookup"><span data-stu-id="71881-184">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="71881-185">檢視</span><span class="sxs-lookup"><span data-stu-id="71881-185">View</span></span>|<span data-ttu-id="71881-186">描述</span><span class="sxs-lookup"><span data-stu-id="71881-186">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="71881-187">sys.dm_exec_requests</span><span class="sxs-lookup"><span data-stu-id="71881-187">sys.dm_exec_requests</span></span>|<span data-ttu-id="71881-188">命令資料行從 `nvarchar(16)` 變更為 `nvarchar(32)`。</span><span class="sxs-lookup"><span data-stu-id="71881-188">The command column changes from `nvarchar(16)` to `nvarchar(32)`.</span></span>|  
|<span data-ttu-id="71881-189">sys.dm_os_memory_cache_counters</span><span class="sxs-lookup"><span data-stu-id="71881-189">sys.dm_os_memory_cache_counters</span></span>|<span data-ttu-id="71881-190">下列資料行已經重新命名：</span><span class="sxs-lookup"><span data-stu-id="71881-190">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="71881-191">single_pages_kb 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-191">single_pages_kb is now:</span></span> <br />                          <span data-ttu-id="71881-192">pages_kb</span><span class="sxs-lookup"><span data-stu-id="71881-192">pages_kb</span></span><br /><br /> <span data-ttu-id="71881-193">multi_pages_kb</span><span class="sxs-lookup"><span data-stu-id="71881-193">multi_pages_kb</span></span><br />                           <span data-ttu-id="71881-194">現在是： pages_in_use_kb</span><span class="sxs-lookup"><span data-stu-id="71881-194">is now: pages_in_use_kb</span></span>|  
|<span data-ttu-id="71881-195">sys.dm_os_memory_cache_entries</span><span class="sxs-lookup"><span data-stu-id="71881-195">sys.dm_os_memory_cache_entries</span></span>|<span data-ttu-id="71881-196">Pages_kb 重新命名資料行 pages_allocated_count 資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-196">The column pages_allocated_count column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="71881-197">sys.dm_os_memory_clerks</span><span class="sxs-lookup"><span data-stu-id="71881-197">sys.dm_os_memory_clerks</span></span>|<span data-ttu-id="71881-198">已移除資料行 multi_pages_kb。</span><span class="sxs-lookup"><span data-stu-id="71881-198">The column multi_pages_kb has been removed.</span></span><br /><br /> <span data-ttu-id="71881-199">Pages_kb 重新命名資料行 single_pages_kb 資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-199">The column single_pages_kb column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="71881-200">sys.dm_os_memory_nodes</span><span class="sxs-lookup"><span data-stu-id="71881-200">sys.dm_os_memory_nodes</span></span>|<span data-ttu-id="71881-201">下列資料行已經重新命名：</span><span class="sxs-lookup"><span data-stu-id="71881-201">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="71881-202">single_pages_kb 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-202">single_pages_kb is now:</span></span> <br />                            <span data-ttu-id="71881-203">pages_kb</span><span class="sxs-lookup"><span data-stu-id="71881-203">pages_kb</span></span><br /><br /> <span data-ttu-id="71881-204">multi_pages_kb 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-204">multi_pages_kb is now:</span></span> <br />                            <span data-ttu-id="71881-205">foreign_committed_kb</span><span class="sxs-lookup"><span data-stu-id="71881-205">foreign_committed_kb</span></span>|  
|<span data-ttu-id="71881-206">sys.dm_os_memory_objects</span><span class="sxs-lookup"><span data-stu-id="71881-206">sys.dm_os_memory_objects</span></span>|<span data-ttu-id="71881-207">下列資料行已經重新命名。</span><span class="sxs-lookup"><span data-stu-id="71881-207">The following columns have been renamed.</span></span><br /><br /> <span data-ttu-id="71881-208">pages_allocated_count 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-208">pages_allocated_count is now:</span></span><br />                            <span data-ttu-id="71881-209">pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="71881-209">pages_in_bytes</span></span><br /><br /> <span data-ttu-id="71881-210">max_pages_allocated_count 現在是： max_pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="71881-210">max_pages_allocated_count is now: max_pages_in_bytes</span></span>|  
|<span data-ttu-id="71881-211">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="71881-211">sys.dm_os_sys_info</span></span>|<span data-ttu-id="71881-212">下列資料行已經重新命名：</span><span class="sxs-lookup"><span data-stu-id="71881-212">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="71881-213">physical_memory_in_bytes 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-213">physical_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="71881-214">physical_memory_kb</span><span class="sxs-lookup"><span data-stu-id="71881-214">physical_memory_kb</span></span><br /><br /> <span data-ttu-id="71881-215">bpool_commit_target 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-215">bpool_commit_target is now:</span></span> <br />                            <span data-ttu-id="71881-216">committed_target_kb</span><span class="sxs-lookup"><span data-stu-id="71881-216">committed_target_kb</span></span><br /><br /> <span data-ttu-id="71881-217">bpool_visible 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-217">bpool_visible is now:</span></span> <br />                            <span data-ttu-id="71881-218">visible_target_kb</span><span class="sxs-lookup"><span data-stu-id="71881-218">visible_target_kb</span></span><br /><br /> <span data-ttu-id="71881-219">virtual_memory_in_bytes 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-219">virtual_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="71881-220">virtual_memory_kb</span><span class="sxs-lookup"><span data-stu-id="71881-220">virtual_memory_kb</span></span><br /><br /> <span data-ttu-id="71881-221">bpool_commited 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-221">bpool_commited is now:</span></span><br />                            <span data-ttu-id="71881-222">committed_kb</span><span class="sxs-lookup"><span data-stu-id="71881-222">committed_kb</span></span>|  
|<span data-ttu-id="71881-223">sys.dm_os_workers</span><span class="sxs-lookup"><span data-stu-id="71881-223">sys.dm_os_workers</span></span>|<span data-ttu-id="71881-224">地區設定資料行已經被移除。</span><span class="sxs-lookup"><span data-stu-id="71881-224">The locale column has been removed.</span></span>|  
  
### <a name="catalog-views"></a><span data-ttu-id="71881-225">目錄檢視</span><span class="sxs-lookup"><span data-stu-id="71881-225">Catalog Views</span></span>  
  
|<span data-ttu-id="71881-226">檢視</span><span class="sxs-lookup"><span data-stu-id="71881-226">View</span></span>|<span data-ttu-id="71881-227">描述</span><span class="sxs-lookup"><span data-stu-id="71881-227">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="71881-228">sys.data_spaces</span><span class="sxs-lookup"><span data-stu-id="71881-228">sys.data_spaces</span></span><br /><br /> <span data-ttu-id="71881-229">sys.partition_schemes</span><span class="sxs-lookup"><span data-stu-id="71881-229">sys.partition_schemes</span></span><br /><br /> <span data-ttu-id="71881-230">sys.filegroups</span><span class="sxs-lookup"><span data-stu-id="71881-230">sys.filegroups</span></span><br /><br /> <span data-ttu-id="71881-231">sys.partition_functions</span><span class="sxs-lookup"><span data-stu-id="71881-231">sys.partition_functions</span></span>|<span data-ttu-id="71881-232">新的資料行 is_system 已經加入至 sys.data_spaces 和 sys.partition_functions </span><span class="sxs-lookup"><span data-stu-id="71881-232">A new column, is_system, has been added to sys.data_spaces and sys.partition_functions.</span></span> <span data-ttu-id="71881-233">(sys.partition_schemes 和 sys.filegroups 會繼承 sys.data_spaces 的資料行)。</span><span class="sxs-lookup"><span data-stu-id="71881-233">(sys.partition_schemes and sys.filegroups inherit the columns of sys.data_spaces.)</span></span><br /><br /> <span data-ttu-id="71881-234">這個資料行中的值 1 表示此物件用於全文檢索索引片段。</span><span class="sxs-lookup"><span data-stu-id="71881-234">A value of 1 in this column indicates that the object is used for full-text index fragments.</span></span><br /><br /> <span data-ttu-id="71881-235">在 sys.partition_functions、sys.partition_schemes 和 sys.filegroups 中，新的資料行不是最後一個資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-235">In sys.partition_functions, sys.partition_schemes, and sys.filegroups, the new column is not the last column.</span></span> <span data-ttu-id="71881-236">請修訂仰賴這些目錄檢視所傳回之資料行順序的現有查詢。</span><span class="sxs-lookup"><span data-stu-id="71881-236">Revise existing queries that rely on the order of columns returned from these catalog views.</span></span>|  
  
### <a name="sql-clr-data-types-geometry-geography-and-hierarchyid"></a><span data-ttu-id="71881-237">SQL CLR 資料類型 (geometry、geography 和 hierarchyid)</span><span class="sxs-lookup"><span data-stu-id="71881-237">SQL CLR Data Types (geometry, geography, and hierarchyid)</span></span>  
 <span data-ttu-id="71881-238">元件**Microsoft.SqlServer.Types.dll**（其中包含空間資料類型和 hierarchyid 類型）已從版本10.0 升級為11.0 版。</span><span class="sxs-lookup"><span data-stu-id="71881-238">The assembly **Microsoft.SqlServer.Types.dll**, which contains the spatial data types and the hierarchyid type, has been upgraded from version 10.0 to version 11.0.</span></span> <span data-ttu-id="71881-239">當下列條件成立時，參考這個組件的自訂應用程式可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-239">Custom applications that reference this assembly may fail when the following conditions are true.</span></span>  
  
-   <span data-ttu-id="71881-240">當您將自訂應用程式從安裝的電腦移 [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] 至只安裝了的電腦時 [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] ，應用程式將會失敗，因為參考的10.0 版**SqlTypes**元件不存在。</span><span class="sxs-lookup"><span data-stu-id="71881-240">When you move a custom application from a computer on which [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] was installed to a computer on which only [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] is installed, the application will fail because the referenced version 10.0 of the **SqlTypes** assembly is not present.</span></span> <span data-ttu-id="71881-241">您可能會收到下列錯誤訊息：`"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span><span class="sxs-lookup"><span data-stu-id="71881-241">You may see this error message: `"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span></span>  
  
-   <span data-ttu-id="71881-242">當您參考**SqlTypes**元件版本11.0，而且也安裝了10.0 版時，您可能會看到此錯誤訊息：`"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span><span class="sxs-lookup"><span data-stu-id="71881-242">When you reference the **SqlTypes** assembly version 11.0, and version 10.0 is also installed, you may see this error message: `"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span></span>  
  
-   <span data-ttu-id="71881-243">當您從以 .NET 3.5、4或4.5 為目標的自訂應用程式參考**SqlTypes**元件版本11.0 時，應用程式將會失敗，因為 SqlClient 的設計會載入版本10.0 的元件。</span><span class="sxs-lookup"><span data-stu-id="71881-243">When you reference the **SqlTypes** assembly version 11.0 from a custom application that targets .NET 3.5, 4, or 4.5, the application will fail because SqlClient by design loads version 10.0 of the assembly.</span></span> <span data-ttu-id="71881-244">當應用程式呼叫下列其中一個方法時，就會發生這項失敗：</span><span class="sxs-lookup"><span data-stu-id="71881-244">This failure occurs when the application calls one of the following methods:</span></span>  
  
    -   <span data-ttu-id="71881-245">`GetValue` 類別的 `SqlDataReader` 方法</span><span class="sxs-lookup"><span data-stu-id="71881-245">`GetValue` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="71881-246">`GetValues` 類別的 `SqlDataReader` 方法</span><span class="sxs-lookup"><span data-stu-id="71881-246">`GetValues` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="71881-247">`SqlDataReader` 類別的括號索引運算子 []</span><span class="sxs-lookup"><span data-stu-id="71881-247">bracket index operator [] of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="71881-248">`ExecuteScalar` 類別的 `SqlCommand` 方法</span><span class="sxs-lookup"><span data-stu-id="71881-248">`ExecuteScalar` method of the `SqlCommand` class</span></span>  
  
 <span data-ttu-id="71881-249">您可以使用下列其中一個方法來解決這個問題：</span><span class="sxs-lookup"><span data-stu-id="71881-249">You can work around this issue by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="71881-250">您可以在程式碼中呼叫 `GetSqlBytes` 方法 (而非上列 Get 方法) 來擷取 CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 系統類型，藉以解決此問題，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="71881-250">You can work around this issue in your code by calling the `GetSqlBytes` method, instead of the Get methods listed above, to retrieve CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] system types, as shown in the following example:</span></span>  
  
    ```csharp  
    string query = "SELECT [SpatialColumn] FROM [SpatialTable]";  
          using (SqlConnection conn = new SqlConnection("..."))  
          {  
                SqlCommand cmd = new SqlCommand(query, conn);  
  
                conn.Open();  
                SqlDataReader reader = cmd.ExecuteReader();  
  
                while (reader.Read())  
                {  
                      // In version 11.0 only  
                      SqlGeometry g =   
    SqlGeometry.Deserialize(reader.GetSqlBytes(0));  
  
                      // In version 10.0 or 11.0  
                      SqlGeometry g2 = new SqlGeometry();  
                      g.Read(new BinaryReader(reader.GetSqlBytes(0).Stream));  
                }  
          }  
    ```  
  
-   <span data-ttu-id="71881-251">您可以在應用程式組態檔中使用組件重新導向，藉以解決此問題，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="71881-251">You can work around this issue by using assembly redirection in the application configuration file, as shown in the following example:</span></span>  
  
    ```xml  
    <runtime>  
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">  
        ...  
        <dependentAssembly>  
            <assemblyIdentity name="Microsoft.SqlServer.Types" publicKeyToken="89845dcd8080cc91" culture="neutral" />  
            <bindingRedirect oldVersion="10.0.0.0" newVersion="11.0.0.0" />  
        </dependentAssembly>  
        ...  
    </assemblyBinding>  
    <runtime>  
    ```  
  
-   <span data-ttu-id="71881-252">您可以在連接字串中針對 "Type System Version" 屬性指定 "SQL Server 2012" 值，強制 SqlClient 載入組件 11.0 版，藉以解決此問題。</span><span class="sxs-lookup"><span data-stu-id="71881-252">You can work around this issue in your connection string by specifying a value of "SQL Server 2012" for the "Type System Version" attribute to force SqlClient to load version 11.0 of the assembly.</span></span> <span data-ttu-id="71881-253">此連接字串屬性僅適用於 .NET 4.5 和更新版本。</span><span class="sxs-lookup"><span data-stu-id="71881-253">This connection string attribute is available only in .NET 4.5 and above.</span></span>  
  
-   <span data-ttu-id="71881-254"> 標記應該包裝在  標記下。</span><span class="sxs-lookup"><span data-stu-id="71881-254">The `assemblyBinding` tag should be wrapped under the `runtime` tag.</span></span>  
  
### <a name="support-for-awe"></a><span data-ttu-id="71881-255">支援 AWE</span><span class="sxs-lookup"><span data-stu-id="71881-255">Support for AWE</span></span>  
 <span data-ttu-id="71881-256">32 位元 Address Windowing Extensions (AWE) 支援已停用。</span><span class="sxs-lookup"><span data-stu-id="71881-256">32-bit Address Windowing Extensions (AWE) support is discontinued.</span></span> <span data-ttu-id="71881-257">這可能會導致 32 位元作業系統的效能降低。</span><span class="sxs-lookup"><span data-stu-id="71881-257">This might result in slower performance on 32-bit operating systems.</span></span> <span data-ttu-id="71881-258">若為使用大量記憶體的安裝，請移轉至 64 位元作業系統。</span><span class="sxs-lookup"><span data-stu-id="71881-258">For installations using large amounts of memory, migrate to a 64-bit operating system.</span></span>  
  
### <a name="xquery-functions-are-surrogate-aware"></a><span data-ttu-id="71881-259">XQuery 函數能夠感知 Surrogate</span><span class="sxs-lookup"><span data-stu-id="71881-259">XQuery Functions Are Surrogate-Aware</span></span>  
 <span data-ttu-id="71881-260">XQuery 函數和運算子的 W3C 建議要求它們將代表高範圍 Unicode 字元的 Surrogate 字組視為 UTF-16 編碼中的單一影像。</span><span class="sxs-lookup"><span data-stu-id="71881-260">The W3C recommendation for XQuery functions and operators requires them to count a surrogate pair that represents a high-range Unicode character as a single glyph in UTF-16 encoding.</span></span> <span data-ttu-id="71881-261">不過，在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 之前的 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 版本中，字串函數無法將 Surrogate 字組辨識成單一字元。</span><span class="sxs-lookup"><span data-stu-id="71881-261">However, in versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], string functions did not recognize surrogate pairs as a single character.</span></span> <span data-ttu-id="71881-262">某些字串作業-例如字串長度計算和子字串提取-傳回不正確的結果。</span><span class="sxs-lookup"><span data-stu-id="71881-262">Some string operations - such as string length calculations and substring extractions - returned incorrect results.</span></span> [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] <span data-ttu-id="71881-263">現在完全支援 UTF-16，而且能夠正確處理 Surrogate 字組。</span><span class="sxs-lookup"><span data-stu-id="71881-263">now fully supports UTF-16 and the correct handling of surrogate pairs.</span></span>  
  
 <span data-ttu-id="71881-264"> 中的 XML 資料類型僅允許格式正確的 Surrogate 字組。</span><span class="sxs-lookup"><span data-stu-id="71881-264">The XML data type in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] only allows well-formed surrogate pairs.</span></span> <span data-ttu-id="71881-265">不過，在某些情況下，部分函數仍然可能傳回未定義或非預期的結果，因為您可以將無效或部分 Surrogate 字組當做字串值傳遞給 XQuery 函數。</span><span class="sxs-lookup"><span data-stu-id="71881-265">However, some functions can still return undefined or unexpected results in certain circumstances, since it is possible to pass invalid or partial surrogate pairs to XQuery functions as string values.</span></span> <span data-ttu-id="71881-266">在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中使用 XQuery 時，請考慮採用下列方法來產生字串值：</span><span class="sxs-lookup"><span data-stu-id="71881-266">Consider the following methods for generating string values when using XQuery in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="71881-267">以二進位值的形式提供常數字串值。</span><span class="sxs-lookup"><span data-stu-id="71881-267">Provide a constant string value as a binary value.</span></span> <span data-ttu-id="71881-268">使用此方法時，您仍然可以傳遞無效或部分 Surrogate 字組。</span><span class="sxs-lookup"><span data-stu-id="71881-268">When using this method, it remains possible to pass invalid or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="71881-269">透過提供字元實體，提供常數字串值。</span><span class="sxs-lookup"><span data-stu-id="71881-269">Provide a constant string value by providing character entities.</span></span> <span data-ttu-id="71881-270">使用此方法時，您無法傳遞無效的 Surrogate 字組。</span><span class="sxs-lookup"><span data-stu-id="71881-270">When using this method, it is not possible to pass invalid surrogate pairs.</span></span> <span data-ttu-id="71881-271">XQuery 函數需要高層級字元的單一字元實體。</span><span class="sxs-lookup"><span data-stu-id="71881-271">The XQuery functions require a single character entity for the high-level character.</span></span> <span data-ttu-id="71881-272">如果您提供了 Surrogate 字組字元的字元實體，這些函數會引發錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-272">These functions raise an error if the character entities for the surrogate pair characters are provided.</span></span>  
  
-   <span data-ttu-id="71881-273">使用**sql： column**或**sql： variable**來匯入外部值。</span><span class="sxs-lookup"><span data-stu-id="71881-273">Import external values by using **sql:column** or **sql:variable**.</span></span> <span data-ttu-id="71881-274">使用這些方法時，您仍然可以導入無效或部分 Surrogate 字組。</span><span class="sxs-lookup"><span data-stu-id="71881-274">When using these methods, it remains possible to introduce invalid or partial surrogate pairs.</span></span>  
  
#### <a name="affected-xquery-functions-and-operators"></a><span data-ttu-id="71881-275">受影響的 XQuery 函數和運算子</span><span class="sxs-lookup"><span data-stu-id="71881-275">Affected XQuery Functions and Operators</span></span>  
 <span data-ttu-id="71881-276">下列 XQuery 函數和運算子現在能夠正確地在 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 中處理 UTF-16 Surrogate 字組：</span><span class="sxs-lookup"><span data-stu-id="71881-276">The following XQuery functions and operators now handle UTF-16 surrogate pairs correctly in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]:</span></span>  
  
-   <span data-ttu-id="71881-277">**fn：字串長度**。</span><span class="sxs-lookup"><span data-stu-id="71881-277">**fn:string-length**.</span></span> <span data-ttu-id="71881-278">不過，如果將無效或部分的代理配對當做引數傳遞，則**字串長度**的行為會是未定義的。</span><span class="sxs-lookup"><span data-stu-id="71881-278">However, if an invalid or partial surrogate pair is passed as an argument, the behavior of **string-length** is undefined.</span></span>  
  
-   <span data-ttu-id="71881-279">**fn： substring**。</span><span class="sxs-lookup"><span data-stu-id="71881-279">**fn:substring**.</span></span>  
  
-   <span data-ttu-id="71881-280">**fn： contains**。</span><span class="sxs-lookup"><span data-stu-id="71881-280">**fn:contains**.</span></span> <span data-ttu-id="71881-281">不過，如果將部分代理組當做值傳遞， **contains**可能會傳回非預期的結果，因為它可能會發現包含在格式正確之代理配對中的部分代理項組。</span><span class="sxs-lookup"><span data-stu-id="71881-281">However, if a partial surrogate pair is passed as a value, **contains** may return unexpected results, since it may find the partial surrogate pair contained in well-formed surrogate pair.</span></span>  
  
-   <span data-ttu-id="71881-282">**fn： concat**。</span><span class="sxs-lookup"><span data-stu-id="71881-282">**fn:concat**.</span></span> <span data-ttu-id="71881-283">不過，如果將部分代理組當做值傳遞， **concat**可能會產生不正確的代理配對或部分代理配對。</span><span class="sxs-lookup"><span data-stu-id="71881-283">However, if a partial surrogate pair is passed as a value, **concat** can produce incorrect surrogate pairs or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="71881-284">比較運算子和**order by**子句。</span><span class="sxs-lookup"><span data-stu-id="71881-284">Comparison operators and the **order by** clause.</span></span> <span data-ttu-id="71881-285">比較運算子包括 +、 \<, > 、 \<=, > =、 `eq` 、、、 `lt` `gt` `le` 和 `ge` 。</span><span class="sxs-lookup"><span data-stu-id="71881-285">Comparison operators include +, \<, >, \<=, >=, `eq`, `lt`, `gt`, `le`, and `ge`.</span></span>  
  
#### <a name="distributed-query-calls-to-a-system-procedure"></a><span data-ttu-id="71881-286">對系統程序的分散式查詢呼叫</span><span class="sxs-lookup"><span data-stu-id="71881-286">Distributed Query Calls to a System Procedure</span></span>  
 <span data-ttu-id="71881-287">透過 `OPENQUERY` 對某些系統程序的分散式查詢呼叫，在從某個 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 伺服器呼叫到另一個伺服器時會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-287">Distributed query calls through `OPENQUERY` to some system procedures will fail when called from one [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] server to another.</span></span> <span data-ttu-id="71881-288">在 [!INCLUDE[ssDE](../includes/ssde-md.md)] 找不到程序的中繼資料時會出現此情況。</span><span class="sxs-lookup"><span data-stu-id="71881-288">This occurs when the [!INCLUDE[ssDE](../includes/ssde-md.md)] cannot discovery metadata for a procedure.</span></span> <span data-ttu-id="71881-289">例如： `SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')` 。</span><span class="sxs-lookup"><span data-stu-id="71881-289">For example, `SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')`.</span></span>  
  
#### <a name="isolation-level-and-sp_reset_connection"></a><span data-ttu-id="71881-290">隔離等級與 sp_reset_connection</span><span class="sxs-lookup"><span data-stu-id="71881-290">Isolation Level and sp_reset_connection</span></span>  
 <span data-ttu-id="71881-291">用戶端驅動程式會以下列方式處理連接的隔離等級：</span><span class="sxs-lookup"><span data-stu-id="71881-291">The isolation level for connections is handled in the following way by client drivers:</span></span>  
  
-   <span data-ttu-id="71881-292">所有原生的驅動程式 (SNAC、MDAC、ODBC) 都會在 sp_reset_connection 時設定隔離等級 (根據應用程式設定)。</span><span class="sxs-lookup"><span data-stu-id="71881-292">All of the native drivers (SNAC, MDAC, ODBC) set the isolation level (based on app setting) upon sp_reset_connection.</span></span>  
  
-   <span data-ttu-id="71881-293">對於 ADO.NET，原則上您會依據您從集區中取得的連線，而隨機獲取一個隔離等級 (但前提是應用程式使用了不同的隔離等級)。</span><span class="sxs-lookup"><span data-stu-id="71881-293">For ADO.NET you will essentially get a random isolation level depending on which connection you get from the pool (and if the application uses different isolation level).</span></span> <span data-ttu-id="71881-294">因為 ADO.NET 集區可以不著痕跡地從內部回收連線，所以您無法預測集區所提供的連接。</span><span class="sxs-lookup"><span data-stu-id="71881-294">Since ADO.NET pool can recycle connections internally and transparently, you cannot predict what will come out of the pool.</span></span>  
  
-   <span data-ttu-id="71881-295">JDBC 驅動程式的行為與 ADO.NET 相同。</span><span class="sxs-lookup"><span data-stu-id="71881-295">For the JDBC driver you get same behavior as ADO.NET</span></span>  
  
     <span data-ttu-id="71881-296">應用程式必須在開啟連接之後，明確地設定隔離等級，如此才能取得所需要的連接。</span><span class="sxs-lookup"><span data-stu-id="71881-296">The application must always explicitly set isolation level after opening the connection to get what it wants.</span></span>  
  
     <span data-ttu-id="71881-297">JDBC 連接可能會存放在集區中，所以應用程式可能會得到隨機的隔離等級並無從得知。</span><span class="sxs-lookup"><span data-stu-id="71881-297">The JDBC connection can be pooled, so the application may get a random isolation level and not know about it.</span></span>  
  
 <span data-ttu-id="71881-298">若要保留這項新行為的回溯相容性，請只對 TDS 7.4 之後的新版用戶端套用此行為。</span><span class="sxs-lookup"><span data-stu-id="71881-298">To preserve backward compatibility this new behavior only applies for recent clients beginning with TDS 7.4.</span></span>  
  
#### <a name="backward-compatibility"></a><span data-ttu-id="71881-299">回溯相容性</span><span class="sxs-lookup"><span data-stu-id="71881-299">Backward Compatibility</span></span>  
 <span data-ttu-id="71881-300">**新的行為取決於相容性層級**</span><span class="sxs-lookup"><span data-stu-id="71881-300">**New behavior depends on compatibility level**</span></span>  
  
 <span data-ttu-id="71881-301">只有當相容性層級為 110 或更高時，下列函數和運算子才會呈現上述新行為：</span><span class="sxs-lookup"><span data-stu-id="71881-301">The following functions and operators demonstrate the new behavior described above only when the compatibility level is 110 or higher:</span></span>  
  
-   <span data-ttu-id="71881-302">**fn： contains**。</span><span class="sxs-lookup"><span data-stu-id="71881-302">**fn:contains**.</span></span>  
  
-   <span data-ttu-id="71881-303">**fn： concat**。</span><span class="sxs-lookup"><span data-stu-id="71881-303">**fn:concat**.</span></span>  
  
-   <span data-ttu-id="71881-304">比較運算子和**order by**子句</span><span class="sxs-lookup"><span data-stu-id="71881-304">comparison operators and **order by** clause</span></span>  
  
 <span data-ttu-id="71881-305">**新的行為取決於函數的預設命名空間 URI**</span><span class="sxs-lookup"><span data-stu-id="71881-305">**New behavior depends on default namespace URI for functions**</span></span>  
  
 <span data-ttu-id="71881-306">下列函式只會在預設命名空間 URI 對應至最終建議中的命名空間（也就是）時，示範上述的新行為 [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions) 。</span><span class="sxs-lookup"><span data-stu-id="71881-306">The following functions demonstrate the new behavior described above only when the default namespace URI corresponds to the namespace in the final recommendation, that is, [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions).</span></span> <span data-ttu-id="71881-307">當相容性層級為 110 或更高時，則 [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] 預設會將預設函數命名空間繫結至這個命名空間。</span><span class="sxs-lookup"><span data-stu-id="71881-307">When the compatibility level is 110 or higher, then by default [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] binds the default function namespace to this namespace.</span></span> <span data-ttu-id="71881-308">不過，不論相容性層級為何，只要使用這個命名空間，這些函數就會呈現新行為。</span><span class="sxs-lookup"><span data-stu-id="71881-308">However these functions demonstrate the new behavior when this namespace is used regardless of the compatibility level.</span></span>  
  
-   <span data-ttu-id="71881-309">**fn:string-length**</span><span class="sxs-lookup"><span data-stu-id="71881-309">**fn:string-length**</span></span>  
  
-   <span data-ttu-id="71881-310">**fn： substring**</span><span class="sxs-lookup"><span data-stu-id="71881-310">**fn:substring**</span></span>  
  
##  <a name="breaking-changes-in-sql-server-2008sql-server-2008r2"></a><a name="KJKatmai"></a><span data-ttu-id="71881-311">SQL Server 2008/SQL Server 2008R2 中的重大變更</span><span class="sxs-lookup"><span data-stu-id="71881-311">Breaking Changes in SQL Server 2008/SQL Server 2008R2</span></span>  
 <span data-ttu-id="71881-312">本節包含 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中導入的重大變更。</span><span class="sxs-lookup"><span data-stu-id="71881-312">This section contains the breaking changes introduced in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-313"> 並未導入任何變更。</span><span class="sxs-lookup"><span data-stu-id="71881-313">No changes were introduced in [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)].</span></span>  
  
### <a name="collations"></a><span data-ttu-id="71881-314">定序</span><span class="sxs-lookup"><span data-stu-id="71881-314">Collations</span></span>  
  
|<span data-ttu-id="71881-315">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-315">Feature</span></span>|<span data-ttu-id="71881-316">描述</span><span class="sxs-lookup"><span data-stu-id="71881-316">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-317">新的定序</span><span class="sxs-lookup"><span data-stu-id="71881-317">New collations</span></span>|[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="71881-318">導入了與 Windows Server 2008 所提供之定序完全一致的新定序。</span><span class="sxs-lookup"><span data-stu-id="71881-318">introduces new collations that are in full alignment with the collations provided by Windows Server 2008.</span></span> <span data-ttu-id="71881-319">這 80 個新定序具有改進的語言精確度，而且是由 \*_100 版本參考所表示。</span><span class="sxs-lookup"><span data-stu-id="71881-319">These 80 new collations have improved linguistic accuracy and are denoted by \*_100 version references.</span></span> <span data-ttu-id="71881-320">如果您針對伺服器或資料庫選擇新的定序，請注意，具有舊版用戶端驅動程式的用戶端可能無法辨識此定序。</span><span class="sxs-lookup"><span data-stu-id="71881-320">If you choose a new collation for your server or database, be aware that the collation may not be recognized by clients with older client drivers.</span></span> <span data-ttu-id="71881-321">無法辨識的定序可能會導致應用程式傳回錯誤並失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-321">Unrecognized collations can cause the application to return errors and fail.</span></span> <span data-ttu-id="71881-322">請考慮下列解決方案：</span><span class="sxs-lookup"><span data-stu-id="71881-322">Consider the following solutions:</span></span><br /><br /> <span data-ttu-id="71881-323">升級用戶端作業系統，以便更新基礎系統定序。</span><span class="sxs-lookup"><span data-stu-id="71881-323">Upgrade the client operating system so that the underlying system collations are updated.</span></span><br /><br /> <span data-ttu-id="71881-324">如果您的用戶端已經安裝了資料庫用戶端軟體，請考慮將服務更新套用至資料庫用戶端軟體。</span><span class="sxs-lookup"><span data-stu-id="71881-324">If your client has database client software installed, consider applying a service update to the database client software.</span></span><br /><br /> <span data-ttu-id="71881-325">選擇會對應至用戶端字碼頁的現有定序。</span><span class="sxs-lookup"><span data-stu-id="71881-325">Choose an existing collation that maps to a code page on the client.</span></span>|  
  
### <a name="common-language-runtime-clr"></a><span data-ttu-id="71881-326">Common Language Runtime (CLR)</span><span class="sxs-lookup"><span data-stu-id="71881-326">Common Language Runtime (CLR)</span></span>  
  
|<span data-ttu-id="71881-327">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-327">Feature</span></span>|<span data-ttu-id="71881-328">描述</span><span class="sxs-lookup"><span data-stu-id="71881-328">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-329">CLR 組件</span><span class="sxs-lookup"><span data-stu-id="71881-329">CLR Assemblies</span></span>|<span data-ttu-id="71881-330">當資料庫升級為 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 時，就會自動安裝支援新資料類型的 `Microsoft.SqlServer.Types` 組件。</span><span class="sxs-lookup"><span data-stu-id="71881-330">When a database is upgraded to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the `Microsoft.SqlServer.Types` assembly to support new data types is automatically installed.</span></span> <span data-ttu-id="71881-331">Upgrade Advisor 規則會偵測任何具有衝突名稱的使用者類型或組件。</span><span class="sxs-lookup"><span data-stu-id="71881-331">Upgrade Advisor rules detect any user type or assemblies with conflicting names.</span></span> <span data-ttu-id="71881-332">Upgrade Advisor 將建議您重新命名任何衝突的組件，以及重新命名任何衝突的類型，或在程式碼中使用兩部分名稱來參考預先存在的使用者類型。</span><span class="sxs-lookup"><span data-stu-id="71881-332">The Upgrade Advisor will advise renaming of any conflicting assembly, and either renaming any conflicting type, or using two-part names in the code to refer to that preexisting user type.</span></span><br /><br /> <span data-ttu-id="71881-333">如果資料庫升級偵測到具有衝突名稱的使用者組件，它將自動重新命名該組件並讓資料庫進入質疑模式。</span><span class="sxs-lookup"><span data-stu-id="71881-333">If a database upgrade detects a user assembly with a conflicting name, it will automatically rename that assembly and put the database into suspect mode.</span></span><br /><br /> <span data-ttu-id="71881-334">如果具有衝突名稱的使用者類型在升級期間存在，將不會採取任何特殊步驟。</span><span class="sxs-lookup"><span data-stu-id="71881-334">If a user type with conflicting name exists during the upgrade, no special steps are taken.</span></span> <span data-ttu-id="71881-335">在升級之後，舊的使用者類型和新的系統類型都會一起存在。</span><span class="sxs-lookup"><span data-stu-id="71881-335">After the upgrade, both the old user type, and the new system type, will exist.</span></span> <span data-ttu-id="71881-336">但是，該使用者類型只能透過兩部分名稱使用。</span><span class="sxs-lookup"><span data-stu-id="71881-336">The user type will be available only through two-part names.</span></span>|  
|<span data-ttu-id="71881-337">CLR 組件</span><span class="sxs-lookup"><span data-stu-id="71881-337">CLR Assemblies</span></span>|[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="71881-338">會安裝 .NET Framework 3.5 SP1，以便更新全域組件快取 (GAC) 中的程式庫。</span><span class="sxs-lookup"><span data-stu-id="71881-338">installs .NET Framework 3.5 SP1, which updates libraries in the Global Assembly Cache (GAC).</span></span> <span data-ttu-id="71881-339">如果您在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 資料庫中註冊了不支援的程式庫，則升級至 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 之後，[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 應用程式可能會停止運作。</span><span class="sxs-lookup"><span data-stu-id="71881-339">If you have unsupported libraries registered in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database, your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] application may stop working after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-340">這是因為服務或升級 GAC 中的程式庫並不會更新 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 內部的組件。</span><span class="sxs-lookup"><span data-stu-id="71881-340">This is because servicing or upgrading libraries in the GAC does not update assemblies inside [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="71881-341">如果某個組件同時存在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 資料庫和 GAC 中，這個組件的兩個副本就必須完全相符。</span><span class="sxs-lookup"><span data-stu-id="71881-341">If an assembly exists both in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database and in the GAC, the two copies of the assembly must exactly match.</span></span> <span data-ttu-id="71881-342">如果它們不相符，當 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR 整合使用該組件時，將會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-342">If they do not match, an error will occur when the assembly is used by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR integration.</span></span> <span data-ttu-id="71881-343">如需詳細資訊，請參閱[支援的 .NET Framework 程式庫](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md)。</span><span class="sxs-lookup"><span data-stu-id="71881-343">For more information, see [Supported .NET Framework Libraries](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md).</span></span><br /><br /> <span data-ttu-id="71881-344">升級您的資料庫之後，請使用 ALTER ASSEMBLY 陳述式來服務或升級 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 資料庫內部的組件副本。</span><span class="sxs-lookup"><span data-stu-id="71881-344">After upgrading your database, service or upgrade the copy of the assembly inside your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] databases with the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="71881-345">如需詳細資訊，請參閱[知識庫文章 949080](https://go.microsoft.com/fwlink/?LinkId=154563)。</span><span class="sxs-lookup"><span data-stu-id="71881-345">For more information, see [Knowledge Base article 949080](https://go.microsoft.com/fwlink/?LinkId=154563).</span></span><br /><br /> <span data-ttu-id="71881-346">若要偵測您是否正在應用程式中使用任何不支援的 .NET Framework 程式庫，請在資料庫中執行下列查詢。</span><span class="sxs-lookup"><span data-stu-id="71881-346">To detect whether you are using any unsupported .NET framework library in your application, run the following query in your database.</span></span><br /><br /> `SELECT name FROM sys.assemblies WHERE clr_name LIKE '%publickeytoken=b03f5f7f11d50a3a,%';`|  
|<span data-ttu-id="71881-347">CLR 常式</span><span class="sxs-lookup"><span data-stu-id="71881-347">CLR Routines</span></span>|<span data-ttu-id="71881-348">在 CLR 使用者定義函數、使用者定義彙總或使用者定義型別 (UDT) 內部使用模擬可能會導致您的應用程式在升級至 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 之後失敗並顯示錯誤 6522。</span><span class="sxs-lookup"><span data-stu-id="71881-348">Using impersonation inside CLR user-defined functions, user-defined aggregates, or user-defined types (UDTs) may cause your application to fail with error 6522 after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-349">下列狀況在 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 中會成功，但在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中則會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-349">The following scenarios succeed in [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] but fail in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-350">我們已針對每個狀況提供解決方案。</span><span class="sxs-lookup"><span data-stu-id="71881-350">Resolutions are provided for each scenario.</span></span><br /><br /> <span data-ttu-id="71881-351">使用模擬的 CLR 使用者定義函數、使用者定義匯總或 UDT 方法具有類型為 `nvarchar(max)` 、、 `varchar(max)` `varbinary(max)` 、 `ntext` 、、或大型 udt 的參數，而且沒有 `text` `image` 方法上的**dataaccesskind.read**屬性。</span><span class="sxs-lookup"><span data-stu-id="71881-351">A CLR user-defined function, user-defined aggregate, or UDT method that uses impersonation has a parameter of type `nvarchar(max)`, `varchar(max)`, `varbinary(max)`, `ntext`, `text`, `image`, or a large UDT, and does not have the **DataAccessKind.Read** attribute on the method.</span></span> <span data-ttu-id="71881-352">若要解決此問題，請在方法上加入**dataaccesskind.read**屬性、重新編譯元件，然後重新部署常式和元件。</span><span class="sxs-lookup"><span data-stu-id="71881-352">To resolve this issue, add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="71881-353">具有執行模擬之**Init**方法的 CLR 資料表值函式。</span><span class="sxs-lookup"><span data-stu-id="71881-353">A CLR table-valued function that has an **Init** method that performs impersonation.</span></span> <span data-ttu-id="71881-354">若要解決此問題，請在方法上新增**dataaccesskind.read**屬性、重新編譯元件，然後重新部署常式和元件。</span><span class="sxs-lookup"><span data-stu-id="71881-354">To resolve this issue add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="71881-355">具有執行模擬之**FillRow**方法的 CLR 資料表值函式。</span><span class="sxs-lookup"><span data-stu-id="71881-355">A CLR table-valued function that has a **FillRow** method that performs impersonation.</span></span> <span data-ttu-id="71881-356">若要解決此問題，請從**FillRow**方法中移除模擬。</span><span class="sxs-lookup"><span data-stu-id="71881-356">To resolve this issue, remove impersonation from the **FillRow** method.</span></span> <span data-ttu-id="71881-357">請勿使用**FillRow**方法來存取外部資源。</span><span class="sxs-lookup"><span data-stu-id="71881-357">Do not access external resources by using the **FillRow** method.</span></span> <span data-ttu-id="71881-358">相反地，請從**Init**方法存取外部資源。</span><span class="sxs-lookup"><span data-stu-id="71881-358">Instead, access external resources from the **Init** method.</span></span>|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="71881-359">動態管理檢視</span><span class="sxs-lookup"><span data-stu-id="71881-359">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="71881-360">檢視</span><span class="sxs-lookup"><span data-stu-id="71881-360">View</span></span>|<span data-ttu-id="71881-361">描述</span><span class="sxs-lookup"><span data-stu-id="71881-361">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="71881-362">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="71881-362">sys.dm_os_sys_info</span></span>|<span data-ttu-id="71881-363">已移除 cpu_ticks_in_ms 和 sqlserver_start_time_cpu_ticks 資料行。</span><span class="sxs-lookup"><span data-stu-id="71881-363">Removed the cpu_ticks_in_ms and sqlserver_start_time_cpu_ticks columns.</span></span>|  
|<span data-ttu-id="71881-364">dm_exec_query_resource_semaphoressys. dm_exec_query_memory_grants</span><span class="sxs-lookup"><span data-stu-id="71881-364">sys.dm_exec_query_resource_semaphoressys.dm_exec_query_memory_grants</span></span>|<span data-ttu-id="71881-365">resource_semaphore_id 資料行不是 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="71881-365">The resource_semaphore_id column is not a unique ID in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-366">這項變更可以影響疑難排解的查詢執行。</span><span class="sxs-lookup"><span data-stu-id="71881-366">This change can affect troubleshooting query execution.</span></span> <span data-ttu-id="71881-367">如需詳細資訊，請參閱[dm_exec_query_resource_semaphores &#40;transact-sql&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="71881-367">For more information, see [sys.dm_exec_query_resource_semaphores &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql).</span></span>|  
  
### <a name="errors-and-events"></a><span data-ttu-id="71881-368">錯誤和事件</span><span class="sxs-lookup"><span data-stu-id="71881-368">Errors and Events</span></span>  
  
|<span data-ttu-id="71881-369">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-369">Feature</span></span>|<span data-ttu-id="71881-370">描述</span><span class="sxs-lookup"><span data-stu-id="71881-370">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-371">登入錯誤</span><span class="sxs-lookup"><span data-stu-id="71881-371">Login errors</span></span>|<span data-ttu-id="71881-372">在 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 中，當 SQL 登入用來連接至設定成只使用 Windows 驗證的伺服器時，就會傳回錯誤 18452。</span><span class="sxs-lookup"><span data-stu-id="71881-372">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], error 18452 is returned when a SQL login is used to connect to a server configured to use only Windows Authentication.</span></span> <span data-ttu-id="71881-373">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，系統會改為傳回錯誤 18456。</span><span class="sxs-lookup"><span data-stu-id="71881-373">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 18456 is returned instead.</span></span>|  
  
### <a name="showplan"></a><span data-ttu-id="71881-374">Showplan</span><span class="sxs-lookup"><span data-stu-id="71881-374">Showplan</span></span>  
  
|<span data-ttu-id="71881-375">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-375">Feature</span></span>|<span data-ttu-id="71881-376">描述</span><span class="sxs-lookup"><span data-stu-id="71881-376">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-377">執行程序表 XML 結構描述</span><span class="sxs-lookup"><span data-stu-id="71881-377">Showplan XML schema</span></span>|<span data-ttu-id="71881-378">新的**SeekPredicateNew**專案會加入至執行程式表 XML 架構中，而封閉式 xsd 序列 (**SqlPredicatesType**) 會轉換成 **\<xsd:choice>** 專案。</span><span class="sxs-lookup"><span data-stu-id="71881-378">A new **SeekPredicateNew** element is added to the Showplan XML schema, and the enclosing xsd sequence (**SqlPredicatesType**) is converted into an **\<xsd:choice>** item.</span></span> <span data-ttu-id="71881-379">除了一或多個**SeekPredicate**元素，一個或多個**SeekPredicateNew**元素現在可能會出現在執行程式表 XML 中。</span><span class="sxs-lookup"><span data-stu-id="71881-379">Instead of one or more **SeekPredicate** elements, one or more **SeekPredicateNew** elements may now appear in the Showplan XML.</span></span> <span data-ttu-id="71881-380">這兩個元素互斥。</span><span class="sxs-lookup"><span data-stu-id="71881-380">The two elements are mutually exclusive.</span></span> <span data-ttu-id="71881-381">**SeekPredicate**會保留在執行程式表 XML 架構中，以提供回溯相容性;不過，在中建立的查詢計劃 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 可能會包含**SeekPredicateNew**元素。</span><span class="sxs-lookup"><span data-stu-id="71881-381">**SeekPredicate** is maintained in the Showplan XML schema for backwards compatibility; however, query plans created in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] may contain the **SeekPredicateNew** element.</span></span> <span data-ttu-id="71881-382">只有當**QueryPlan**元素不存在時，預期會從 node ShowPlanXML/BatchSequence/批次/語句/StmtSimple/RelOp/IndexScan/SeekPredicates/SeekPredicate 中取出**SeekPredicate**子系的應用程式可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-382">Applications that expect to retrieve only the **SeekPredicate** child from the node ShowPlanXML/BatchSequence/Batch/Statements/StmtSimple/QueryPlan/RelOp/IndexScan/SeekPredicates may fail if the **SeekPredicate** element does not exist.</span></span> <span data-ttu-id="71881-383">請重寫應用程式，以預期此節點中的**SeekPredicate**或**SeekPredicateNew**元素。</span><span class="sxs-lookup"><span data-stu-id="71881-383">Rewrite the application to expect either the **SeekPredicate** or **SeekPredicateNew** element in this node.</span></span> <span data-ttu-id="71881-384">若需相關資訊，請參閱 。</span><span class="sxs-lookup"><span data-stu-id="71881-384">For more information, see .</span></span>|  
|<span data-ttu-id="71881-385">執行程序表 XML 結構描述</span><span class="sxs-lookup"><span data-stu-id="71881-385">Showplan XML schema</span></span>|<span data-ttu-id="71881-386">新的**IndexKind**屬性會加入至執行程式表 XML 架構中的**ObjectType**複雜類型。</span><span class="sxs-lookup"><span data-stu-id="71881-386">A new **IndexKind** attribute is added to the **ObjectType** complex type in the Showplan XML schema.</span></span> <span data-ttu-id="71881-387">針對 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 結構描述嚴格驗證 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 計畫的應用程式將會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-387">Applications that strictly validate [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] plans against the [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] schema will fail.</span></span>|  
  
### <a name="transact-sql"></a><span data-ttu-id="71881-388">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="71881-388">Transact-SQL</span></span>  
  
|<span data-ttu-id="71881-389">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-389">Feature</span></span>|<span data-ttu-id="71881-390">描述</span><span class="sxs-lookup"><span data-stu-id="71881-390">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-391">ALTER_AUTHORIZATION_DATABASE DDL 事件</span><span class="sxs-lookup"><span data-stu-id="71881-391">ALTER_AUTHORIZATION_DATABASE DDL event</span></span>|<span data-ttu-id="71881-392">在中 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ，當 ddl 事件 ALTER_AUTHORIZATION_DATABASE 引發時，如果資料定義語言中的安全性實體類型 (DDL) 作業是物件，則會在此事件之 EVENTDATA xml 的**ObjectType**元素中傳回值 ' object '。</span><span class="sxs-lookup"><span data-stu-id="71881-392">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], when the DDL event ALTER_AUTHORIZATION_DATABASE fires, the value 'object' is returned in the **ObjectType** element of the EVENTDATA xml for this event when the entity type of the securable in the data definition language (DDL) operation is an object.</span></span> <span data-ttu-id="71881-393">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，則會傳回實際類型 (例如 'table' 或 'function')。</span><span class="sxs-lookup"><span data-stu-id="71881-393">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the actual type (for example, 'table', or 'function') is returned.</span></span>|  
|<span data-ttu-id="71881-394">CONVERT</span><span class="sxs-lookup"><span data-stu-id="71881-394">CONVERT</span></span>|<span data-ttu-id="71881-395">如果您將無效的樣式傳遞給 CONVERT 函數，當轉換類型為二進位對字元或字元對二進位時，系統就會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-395">If an invalid style is passed to the CONVERT function, an error is returned when the type of conversion is binary to character or character to binary.</span></span> <span data-ttu-id="71881-396">在舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，無效的樣式會設定為二進位對字元或字元對二進位轉換的預設樣式。</span><span class="sxs-lookup"><span data-stu-id="71881-396">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the invalid style is set to the default style for binary-to-character and character-to-binary conversions.</span></span>|  
|<span data-ttu-id="71881-397">GRANT/DENY/REVOKE 組件的 EXECUTE</span><span class="sxs-lookup"><span data-stu-id="71881-397">GRANT/DENY/REVOKE EXECUTE on assemblies</span></span>|<span data-ttu-id="71881-398">您無法針對組件授與、拒絕或撤銷 EXECUTE 權限。</span><span class="sxs-lookup"><span data-stu-id="71881-398">EXECUTE permission cannot be granted, denied, or revoked to assemblies.</span></span> <span data-ttu-id="71881-399">這個權限沒有任何作用，而且現在會導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-399">This permission has no affect and now causes an error.</span></span> <span data-ttu-id="71881-400">請改為針對參考此組件方法的預存程序或函數授與、拒絕或撤銷 EXECUTE 權限。</span><span class="sxs-lookup"><span data-stu-id="71881-400">Grant, deny, or revoke EXECUTE permission on the stored procedures or functions that reference the assembly method instead.</span></span>|  
|<span data-ttu-id="71881-401">GRANT/DENY/REVOKE 系統類型的權限</span><span class="sxs-lookup"><span data-stu-id="71881-401">GRANT/DENY/REVOKE permissions on system types</span></span>|<span data-ttu-id="71881-402">您無法針對系統類型授與、拒絕或撤銷權限。</span><span class="sxs-lookup"><span data-stu-id="71881-402">Permissions cannot be granted, denied, or revoked to system types.</span></span> <span data-ttu-id="71881-403">在舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，雖然這些陳述式會成功，但是沒有任何作用。</span><span class="sxs-lookup"><span data-stu-id="71881-403">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], these statements succeed but have no effect.</span></span> <span data-ttu-id="71881-404">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，則會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="71881-404">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], an error is returned.</span></span>|  
|<span data-ttu-id="71881-405">GROUP BY</span><span class="sxs-lookup"><span data-stu-id="71881-405">GROUP BY</span></span>|<span data-ttu-id="71881-406">在 GROUP BY 子句在用於依清單分組的運算式中，不得包含子查詢。</span><span class="sxs-lookup"><span data-stu-id="71881-406">The GROUP BY clause cannot contain a subquery in an expression that is used for the group by list.</span></span> <span data-ttu-id="71881-407">在舊版 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 中，允許這個動作。</span><span class="sxs-lookup"><span data-stu-id="71881-407">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], this was allowed.</span></span> <span data-ttu-id="71881-408">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中，則會傳回錯誤 144。</span><span class="sxs-lookup"><span data-stu-id="71881-408">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 144 is returned.</span></span><br /><br /> <span data-ttu-id="71881-409">例如，下列程式碼在 SQL Server 2005 中將會成功，而在 SQL Server 2008 中則會失敗。</span><span class="sxs-lookup"><span data-stu-id="71881-409">For example, the following code will succeed in SQL Server 2005 and fail in SQL Server 2008.</span></span><br /><br /> `DECLARE @Test TABLE(a int NOT NULL);` <br /> `INSERT INTO @Test SELECT 1 union ALL SELECT 2;` <br /> `SELECT COUNT(*)` <br /> `FROM @Test` <br /> `GROUP BY CASE WHEN a IN (SELECT t.a FROM @Test AS t)` <br /> `THEN 1 ELSE 0` <br /> `END;`|  
|<span data-ttu-id="71881-410">OUTPUT 子句</span><span class="sxs-lookup"><span data-stu-id="71881-410">OUTPUT clause</span></span>|<span data-ttu-id="71881-411">若要避免不具決定性的行為，當檢視表或嵌入資料表值函式中的資料行是由下列其中一種方法所定義時，OUTPUT 子句便不得參考該資料行：</span><span class="sxs-lookup"><span data-stu-id="71881-411">To prevent nondeterministic behavior, the OUTPUT clause cannot reference a column from a view or inline table-valued function when that column is defined by one of the following methods:</span></span><br /><br /> <span data-ttu-id="71881-412">子查詢。</span><span class="sxs-lookup"><span data-stu-id="71881-412">A subquery.</span></span><br /><br /> <span data-ttu-id="71881-413">執行使用者或系統資料存取的使用者定義函數，或假設會執行這類存取的使用者定義函數。</span><span class="sxs-lookup"><span data-stu-id="71881-413">A user-defined function that performs user- or system-data access, or is assumed to perform such access.</span></span><br /><br /> <span data-ttu-id="71881-414">在其定義中包含使用者定義函數的計算資料行，而該函數會執行使用者或系統資料存取。</span><span class="sxs-lookup"><span data-stu-id="71881-414">A computed column that contains in its definition a user-defined function that performs user- or system-data access.</span></span><br /><br /> <br /><br /> <span data-ttu-id="71881-415">當 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 在 OUTPUT 子句中偵測到這類資料行時，就會引發錯誤 4186。</span><span class="sxs-lookup"><span data-stu-id="71881-415">When [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects such a column in the OUTPUT clause, error 4186 is raised.</span></span> <span data-ttu-id="71881-416">如需詳細資訊，請參閱[MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md)。</span><span class="sxs-lookup"><span data-stu-id="71881-416">For more information, see [MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md).</span></span>|  
|<span data-ttu-id="71881-417">OUTPUT INTO 子句</span><span class="sxs-lookup"><span data-stu-id="71881-417">OUTPUT INTO clause</span></span>|<span data-ttu-id="71881-418">OUTPUT INTO 子句的目標資料表不可以有任何啟用的觸發程序。</span><span class="sxs-lookup"><span data-stu-id="71881-418">The target table of the OUTPUT INTO clause cannot have any enabled triggers.</span></span>|  
|<span data-ttu-id="71881-419">precompute rank 伺服器層級選項</span><span class="sxs-lookup"><span data-stu-id="71881-419">precompute rank server-level option</span></span>|<span data-ttu-id="71881-420">[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 不支援這個選項。</span><span class="sxs-lookup"><span data-stu-id="71881-420">This option is not supported in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="71881-421">請盡快修改目前仍使用這項功能的應用程式。</span><span class="sxs-lookup"><span data-stu-id="71881-421">Modify applications that currently use this feature as soon as possible.</span></span>|  
|<span data-ttu-id="71881-422">READPAST 資料表提示</span><span class="sxs-lookup"><span data-stu-id="71881-422">READPAST table hint</span></span>|<span data-ttu-id="71881-423">您在快照集隔離的情況下指定 READPAST 提示。</span><span class="sxs-lookup"><span data-stu-id="71881-423">You cannot specify the READPAST hint under Snapshot Isolation.</span></span><br /><br /> <span data-ttu-id="71881-424">當 READ_COMMITED_SNAPSHOT 或 ALLOW_SNAPSHOT_ISOLATION 資料庫選項設為 ON 時，將會忽略 READPAST 提示。</span><span class="sxs-lookup"><span data-stu-id="71881-424">The READPAST hint is ignored when either the READ_COMMITED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION database option is set to ON.</span></span> <span data-ttu-id="71881-425">但您若是合併了 READPAST 提示及 READCOMMITTEDLOCK，READPAST 的行為將與封鎖 READCOMMITTED 提示相同。</span><span class="sxs-lookup"><span data-stu-id="71881-425">However, if you combine the READPAST hint with READCOMMITTEDLOCK, the READPAST behavior is same as with the blocking READCOMMITTED hint.</span></span>|  
|<span data-ttu-id="71881-426">sp_helpuser</span><span class="sxs-lookup"><span data-stu-id="71881-426">sp_helpuser</span></span>|<span data-ttu-id="71881-427">下列在 sp_helpuser 預存程式的結果集中傳回的資料行名稱已變更：</span><span class="sxs-lookup"><span data-stu-id="71881-427">The following column names that are returned in the result set of the sp_helpuser stored procedure have changed:</span></span><br /><br /> <span data-ttu-id="71881-428">目前的擁有：</span><span class="sxs-lookup"><span data-stu-id="71881-428">GroupName is now:</span></span><br />                            <span data-ttu-id="71881-429">RoleName</span><span class="sxs-lookup"><span data-stu-id="71881-429">RoleName</span></span><br /><br /> <span data-ttu-id="71881-430">Group_name 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-430">Group_name is now:</span></span><br />                            <span data-ttu-id="71881-431">Role_name</span><span class="sxs-lookup"><span data-stu-id="71881-431">Role_name</span></span><br /><br /> <span data-ttu-id="71881-432">Group_id 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-432">Group_id is now:</span></span><br />                            <span data-ttu-id="71881-433">Role_id</span><span class="sxs-lookup"><span data-stu-id="71881-433">Role_id</span></span><br /><br /> <span data-ttu-id="71881-434">Users_in_group 現在：</span><span class="sxs-lookup"><span data-stu-id="71881-434">Users_in_group is now:</span></span><br />                            <span data-ttu-id="71881-435">Users_in_role</span><span class="sxs-lookup"><span data-stu-id="71881-435">Users_in_role</span></span>|  
|<span data-ttu-id="71881-436">透明資料加密</span><span class="sxs-lookup"><span data-stu-id="71881-436">Transparent Data Encryption</span></span>|<span data-ttu-id="71881-437">透明資料加密 (TDE) 是在 I/O 層級執行：頁面結構在記憶體中處於未加密狀態，而且只有當頁面寫入磁碟時，才會進行加密。</span><span class="sxs-lookup"><span data-stu-id="71881-437">Transparent data encryption (TDE) is performed at the I/O level: the page structure is unencrypted in memory and is encrypted only when the page is written to disk.</span></span> <span data-ttu-id="71881-438">資料庫檔案和記錄檔都會進行加密。</span><span class="sxs-lookup"><span data-stu-id="71881-438">Both the database files and log files are encrypted.</span></span> <span data-ttu-id="71881-439">當資料庫使用 TDE 時，略過存取頁面之一般 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 機制 (例如，直接掃描資料或記錄檔) 的協力廠商應用程式將會失敗，因為資料已在檔案中加密。</span><span class="sxs-lookup"><span data-stu-id="71881-439">Third-party applications that bypass the regular [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] mechanism for accessing pages (for example, by scanning the data or log files directly), will fail when a database uses TDE because the data is encrypted in the files.</span></span> <span data-ttu-id="71881-440">這類應用程式可以運用 Window Cryptographic API 來開發在 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 外部解密資料的解決方案。</span><span class="sxs-lookup"><span data-stu-id="71881-440">Such applications can leverage the Window Cryptographic API to develop a solution for decrypting the data outside of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>|  
  
### <a name="xquery"></a><span data-ttu-id="71881-441">XQuery</span><span class="sxs-lookup"><span data-stu-id="71881-441">XQuery</span></span>  
  
|<span data-ttu-id="71881-442">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-442">Feature</span></span>|<span data-ttu-id="71881-443">描述</span><span class="sxs-lookup"><span data-stu-id="71881-443">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-444">日期時間支援</span><span class="sxs-lookup"><span data-stu-id="71881-444">Datetime support</span></span>|<span data-ttu-id="71881-445">在中，、 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] 和資料類型沒有 `xs:time` `xs:date` `xs:dateTime` 時區支援。</span><span class="sxs-lookup"><span data-stu-id="71881-445">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], the data types `xs:time`, `xs:date`, and `xs:dateTime` do not have timezone support.</span></span> <span data-ttu-id="71881-446">時區資料會對應至 UTC 時區。</span><span class="sxs-lookup"><span data-stu-id="71881-446">Timezone data is mapped to the UTC timezone.</span></span> [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="71881-447">提供了符合標準的行為，因而產生下列變更：</span><span class="sxs-lookup"><span data-stu-id="71881-447">, provides standard conformant behavior, resulting in the following changes:</span></span><br /><br /> <span data-ttu-id="71881-448">驗證不含時區的值。</span><span class="sxs-lookup"><span data-stu-id="71881-448">Values without timezone are validated.</span></span><br /><br /> <span data-ttu-id="71881-449">保留提供的時區或缺少的時區。</span><span class="sxs-lookup"><span data-stu-id="71881-449">The provided timezone or the absence of a timezone is preserved.</span></span><br /><br /> <span data-ttu-id="71881-450">修改內部儲存體表示法。</span><span class="sxs-lookup"><span data-stu-id="71881-450">The internal storage representation is modified.</span></span><br /><br /> <span data-ttu-id="71881-451">增加預存值的解析。</span><span class="sxs-lookup"><span data-stu-id="71881-451">Resolution of stored values is increased.</span></span><br /><br /> <span data-ttu-id="71881-452">不允許使用負值年份。</span><span class="sxs-lookup"><span data-stu-id="71881-452">Negative years are disallowed.</span></span><br /><br /> <br /><br /> <span data-ttu-id="71881-453">注意：修改應用程式和 XQuery 運算式，以考慮新的類型值。</span><span class="sxs-lookup"><span data-stu-id="71881-453">Note: Modify applications and XQuery expressions to account for the new type values.</span></span>|  
|<span data-ttu-id="71881-454">XQuery 和 Xpath 運算式</span><span class="sxs-lookup"><span data-stu-id="71881-454">XQuery and Xpath expressions</span></span>|<span data-ttu-id="71881-455">在中 [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ，可以使用 XQuery 或 XPath 運算式中以冒號開頭的步驟 ( '： ' ) 。</span><span class="sxs-lookup"><span data-stu-id="71881-455">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], steps in an XQuery or XPath expression that begin with a colon (':') are allowed.</span></span> <span data-ttu-id="71881-456">例如，下列陳述式在冒號開頭的路徑運算式中，包含一個名稱測試 (`CTR02)`)。</span><span class="sxs-lookup"><span data-stu-id="71881-456">For example, the following statement contains a name test (`CTR02)` within the path expression that begins with a colon.</span></span><br /><br /> `SELECT FileContext.query('for n$ in //CTR return <C>{data )(n$/:CTR02)} </C>) AS Files FROM dbo.MyTable;`<br /><br /> <span data-ttu-id="71881-457">在 [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] 中不允許此種用法，因為它不符合 XML 標準。</span><span class="sxs-lookup"><span data-stu-id="71881-457">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], this usage is disallowed because it does not conform to XML standards.</span></span> <span data-ttu-id="71881-458">傳回錯誤 9341。</span><span class="sxs-lookup"><span data-stu-id="71881-458">Error 9341 is returned.</span></span> <span data-ttu-id="71881-459">移除開頭的冒號，或為名稱測試指定一個前置詞，例如，(n$/CTR02) 或 (n$/p1:CTR02)。</span><span class="sxs-lookup"><span data-stu-id="71881-459">Remove the leading colon or specify a prefix for the name test--for example, (n$/CTR02) or (n$/p1:CTR02).</span></span>|  
  
### <a name="connecting"></a><span data-ttu-id="71881-460">Connecting</span><span class="sxs-lookup"><span data-stu-id="71881-460">Connecting</span></span>  
  
|<span data-ttu-id="71881-461">特徵</span><span class="sxs-lookup"><span data-stu-id="71881-461">Feature</span></span>|<span data-ttu-id="71881-462">描述</span><span class="sxs-lookup"><span data-stu-id="71881-462">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="71881-463">使用 SSL 從 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client 連接</span><span class="sxs-lookup"><span data-stu-id="71881-463">Connecting from [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client using SSL</span></span>|<span data-ttu-id="71881-464">當使用 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client 連接時，使用 "SERVER=shortname; FORCE ENCRYPTION=true" 而且憑證的主旨可指定完整網域名稱 (FQDN) 的應用程式在過去因為寬鬆的驗證所以已經連接。</span><span class="sxs-lookup"><span data-stu-id="71881-464">When connecting with [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client, applications that use "SERVER=shortname; FORCE ENCRYPTION=true" with certificate whose Subjects specify Fully Qualified Domain Names (FQDN's) have connected in the past due to relaxed validation.</span></span> <span data-ttu-id="71881-465">SQL Server 2008 R2 藉由強制施行憑證的 FQDN 主旨來增強安全性。</span><span class="sxs-lookup"><span data-stu-id="71881-465">SQL Server 2008 R2 enhances security by enforcing FQDN subjects for certificates.</span></span> <span data-ttu-id="71881-466">依賴寬鬆驗證的應用程式必須採取下列其中一項動作：</span><span class="sxs-lookup"><span data-stu-id="71881-466">Applications that rely upon relaxed validation must take one of the following actions:</span></span><br /><br /> <span data-ttu-id="71881-467">使用連接字串中的 FQDN。</span><span class="sxs-lookup"><span data-stu-id="71881-467">Use the FQDN in the connection string.</span></span><br /><br /> <span data-ttu-id="71881-468">-如果在應用程式外部設定連接字串的 SERVER 關鍵字，這個選項就不需要重新編譯應用程式。</span><span class="sxs-lookup"><span data-stu-id="71881-468">-This option does not require recompiling the application if the SERVER keyword of the connection string is configured outside the application.</span></span><br /><br /> <span data-ttu-id="71881-469">-此選項不適用於將其連接字串硬式編碼的應用程式。</span><span class="sxs-lookup"><span data-stu-id="71881-469">-This option does not work for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="71881-470">-此選項不適用於使用資料庫鏡像的應用程式，因為鏡像伺服器會以簡單的名稱回復。</span><span class="sxs-lookup"><span data-stu-id="71881-470">-This option does not work for applications that use Database Mirroring since the mirrored server replies with a simple name.</span></span>|  
||<span data-ttu-id="71881-471">加入簡短名稱的別名來對應至 FQDN。</span><span class="sxs-lookup"><span data-stu-id="71881-471">Add an alias for the shortname to map to the FQDN.</span></span><br /><br /> <span data-ttu-id="71881-472">-即使應用程式已將其連接字串硬式編碼，此選項也適用。</span><span class="sxs-lookup"><span data-stu-id="71881-472">-This option works even for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="71881-473">-此選項不適用於使用資料庫鏡像的應用程式，因為提供者不會查閱所接收之容錯移轉夥伴名稱的別名。</span><span class="sxs-lookup"><span data-stu-id="71881-473">-This option does not work for applications that use Database Mirroring since the providers don't look up aliases for received failover partner names.</span></span>|  
||<span data-ttu-id="71881-474">擁有針對簡短名稱發出的憑證。</span><span class="sxs-lookup"><span data-stu-id="71881-474">Have a certificate issued for shortname.</span></span><br /><br /> <span data-ttu-id="71881-475">-這個選項適用于所有應用程式。</span><span class="sxs-lookup"><span data-stu-id="71881-475">-This option works for all applications.</span></span>|  

## <a name="breaking-changes-in-sql-server-2005"></a><a name="Yukon"></a><span data-ttu-id="71881-476">SQL Server 2005 中的重大變更</span><span class="sxs-lookup"><span data-stu-id="71881-476">Breaking Changes in SQL Server 2005</span></span>  

[!INCLUDE[Archived documentation for very old versions of SQL Server](../includes/paragraph-content/previous-versions-archive-documentation-sql-server.md)]

## <a name="see-also"></a><span data-ttu-id="71881-477">另請參閱</span><span class="sxs-lookup"><span data-stu-id="71881-477">See Also</span></span>  
 <span data-ttu-id="71881-478">[SQL Server 2014 中已淘汰的資料庫引擎功能](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="71881-478">[Deprecated Database Engine Features in SQL Server 2014](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="71881-479">[SQL Server 2014 中資料庫引擎功能的行為變更](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="71881-479">[Behavior Changes to Database Engine Features in SQL Server 2014](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="71881-480">[SQL Server 2014 中已停止的資料庫引擎功能](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="71881-480">[Discontinued Database Engine Functionality in SQL Server 2014](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="71881-481">[SQL Server Database Engine 回溯相容性](sql-server-database-engine-backward-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="71881-481">[SQL Server Database Engine Backward Compatibility](sql-server-database-engine-backward-compatibility.md) </span></span>  
 [<span data-ttu-id="71881-482">ALTER DATABASE 相容性層級 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="71881-482">ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level)  
 [<span data-ttu-id="71881-483">SQL Server 2014 中管理工具功能的突破性變更</span><span class="sxs-lookup"><span data-stu-id="71881-483">Breaking Changes to Management Tools Features in SQL Server 2014</span></span>](breaking-changes-to-management-tools-features-in-sql-server-2014.md?view=sql-server-2014)  
  
