---
title: 針對 AlwaysOn 可用性群組 Configuration (SQL Server) 進行疑難排解 |Microsoft Docs
ms.custom: ''
ms.date: 01/31/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- troubleshooting [SQL Server], deploying
- Availability Groups [SQL Server], troubleshooting
- Availability Groups [SQL Server], configuring
ms.assetid: 8c222f98-7392-4faf-b7ad-5fb60ffa237e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 165036ba539c3392b1944282bd9d6126eb471a97
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708641"
---
# <a name="troubleshoot-alwayson-availability-groups-configuration-sql-server"></a><span data-ttu-id="d323d-102">疑難排解 AlwaysOn 可用性群組組態 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d323d-102">Troubleshoot AlwaysOn Availability Groups Configuration (SQL Server)</span></span>
  <span data-ttu-id="d323d-103">此主題中的資訊可協助您疑難排解為 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]設定伺服器執行個體時常見的問題。</span><span class="sxs-lookup"><span data-stu-id="d323d-103">This topic provides information to help you troubleshoot typical problems with configuring server instances for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="d323d-104">一般組態問題包含 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 未啟用、不正確地設定帳戶、資料庫鏡像端點不存在、端點無法存取 (SQL Server 錯誤 1418)、網路存取不存在，以及聯結資料庫命令失敗 (SQL Server 錯誤 35250)。</span><span class="sxs-lookup"><span data-stu-id="d323d-104">Typical configuration problems include [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is disabled, accounts are incorrectly configured, the database mirroring endpoint does not exist, the endpoint is inaccessible (SQL Server Error 1418), network access does not exist, and a join database command fails (SQL Server Error 35250).</span></span>

> [!NOTE]
>  <span data-ttu-id="d323d-105">請確定您符合 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 必要條件。</span><span class="sxs-lookup"><span data-stu-id="d323d-105">Ensure that you are meeting the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] prerequisites.</span></span> <span data-ttu-id="d323d-106">如需詳細資訊，請參閱 [AlwaysOn 可用性群組的必要條件、限制和建議 &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-106">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>

 <span data-ttu-id="d323d-107">**本主題內容：**</span><span class="sxs-lookup"><span data-stu-id="d323d-107">**In This Topic:**</span></span>

|<span data-ttu-id="d323d-108">區段</span><span class="sxs-lookup"><span data-stu-id="d323d-108">Section</span></span>|<span data-ttu-id="d323d-109">描述</span><span class="sxs-lookup"><span data-stu-id="d323d-109">Description</span></span>|
|-------------|-----------------|
|[<span data-ttu-id="d323d-110">AlwaysOn 可用性群組未啟用</span><span class="sxs-lookup"><span data-stu-id="d323d-110">AlwaysOn Availability Groups Is Not Enabled</span></span>](#IsHadrEnabled)|<span data-ttu-id="d323d-111">如果 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體未啟用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]，此執行個體不會支援可用性群組建立，也無法裝載任何可用性複本。</span><span class="sxs-lookup"><span data-stu-id="d323d-111">If an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the instance does not support availability group creation and cannot host any availability replicas.</span></span>|
|[<span data-ttu-id="d323d-112">帳戶</span><span class="sxs-lookup"><span data-stu-id="d323d-112">Accounts</span></span>](#Accounts)|<span data-ttu-id="d323d-113">討論正確設定在底下執行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 之帳戶的需求。</span><span class="sxs-lookup"><span data-stu-id="d323d-113">Discusses requirements for correctly configuring the accounts under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running.</span></span>|
|[<span data-ttu-id="d323d-114">端點</span><span class="sxs-lookup"><span data-stu-id="d323d-114">Endpoints</span></span>](#Endpoints)|<span data-ttu-id="d323d-115">討論如何診斷伺服器執行個體的資料庫鏡像端點問題。</span><span class="sxs-lookup"><span data-stu-id="d323d-115">Discusses how to diagnose issues with the database mirroring endpoint of a server instance.</span></span>|
|[<span data-ttu-id="d323d-116">系統名稱</span><span class="sxs-lookup"><span data-stu-id="d323d-116">System name</span></span>](#SystemName)|<span data-ttu-id="d323d-117">摘要說明在端點 URL 中指定伺服器執行個體之系統名稱的替代方式。</span><span class="sxs-lookup"><span data-stu-id="d323d-117">Summarizes the alternatives for specifying the system name of a server instance in an endpoint URL.</span></span>|
|[<span data-ttu-id="d323d-118">網路存取</span><span class="sxs-lookup"><span data-stu-id="d323d-118">Network access</span></span>](#NetworkAccess)|<span data-ttu-id="d323d-119">說明裝載可用性複本的每個伺服器執行個體必須要透過 TCP 存取其他伺服器執行個體之通訊埠的需求。</span><span class="sxs-lookup"><span data-stu-id="d323d-119">Documents the requirement that each server instance that is hosting an availability replica must be able to access the port of each of the other server instances over TCP.</span></span>|
|[<span data-ttu-id="d323d-120">端點存取 (SQL Server 錯誤 1418)</span><span class="sxs-lookup"><span data-stu-id="d323d-120">Endpoint Access (SQL Server Error 1418)</span></span>](#Msg1418)|<span data-ttu-id="d323d-121">包含有關此 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 錯誤訊息的資訊。</span><span class="sxs-lookup"><span data-stu-id="d323d-121">Contains information about this [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error message.</span></span>|
|[<span data-ttu-id="d323d-122">聯結資料庫失敗 (SQL Server 錯誤 35250)</span><span class="sxs-lookup"><span data-stu-id="d323d-122">Join Database Fails (SQL Server Error 35250)</span></span>](#JoinDbFails)|<span data-ttu-id="d323d-123">討論因為與主要複本的連接不在作用中，次要資料庫聯結至可用性群組失敗的可能原因和解決方案。</span><span class="sxs-lookup"><span data-stu-id="d323d-123">Discusses the possible causes and resolution of a failure to join secondary databases to an availability group because the connection to the primary replica is not active.</span></span>|
|[<span data-ttu-id="d323d-124">唯讀路由未正確運作</span><span class="sxs-lookup"><span data-stu-id="d323d-124">Read-Only Routing is Not Working Correctly</span></span>](#ROR)||
|[<span data-ttu-id="d323d-125">相關工作</span><span class="sxs-lookup"><span data-stu-id="d323d-125">Related Tasks</span></span>](#RelatedTasks)|<span data-ttu-id="d323d-126">在《 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 線上叢書》中包含工作導向主題的清單，這些主題與疑難排解可用性群組組態特別相關。</span><span class="sxs-lookup"><span data-stu-id="d323d-126">Contains a list of task-oriented topics in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] Books Online that are particularly relevant to troubleshooting an availability group configuration.</span></span>|
|[<span data-ttu-id="d323d-127">相關內容</span><span class="sxs-lookup"><span data-stu-id="d323d-127">Related Content</span></span>](#RelatedContent)|<span data-ttu-id="d323d-128">包含《 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 線上叢書》外部的相關資源清單。</span><span class="sxs-lookup"><span data-stu-id="d323d-128">Contains a list of relevant resources that are external to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Books Online.</span></span>|

##  <a name="alwayson-availability-groups-is-not-enabled"></a><a name="IsHadrEnabled"></a><span data-ttu-id="d323d-129">未啟用 AlwaysOn 可用性群組</span><span class="sxs-lookup"><span data-stu-id="d323d-129">AlwaysOn Availability Groups Is Not Enabled</span></span>
 <span data-ttu-id="d323d-130">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 功能必須在每個 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]執行個體上啟用。</span><span class="sxs-lookup"><span data-stu-id="d323d-130">The [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature must be enabled on each of the instances of [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="d323d-131">如需詳細資訊，請參閱[啟用和停用 AlwaysOn 可用性群組 &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-131">For more information, see [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md).</span></span>

##  <a name="accounts"></a><a name="Accounts"></a> <span data-ttu-id="d323d-132">帳戶</span><span class="sxs-lookup"><span data-stu-id="d323d-132">Accounts</span></span>
 <span data-ttu-id="d323d-133">必須正確設定用來執行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 的帳戶。</span><span class="sxs-lookup"><span data-stu-id="d323d-133">The accounts under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running must be correctly configured.</span></span>

1.  <span data-ttu-id="d323d-134">帳戶有正確的權限嗎？</span><span class="sxs-lookup"><span data-stu-id="d323d-134">Do the accounts have the correct permissions?</span></span>

    1.  <span data-ttu-id="d323d-135">如果夥伴是以相同的網域使用者帳戶身分執行，則兩個 **master** 資料庫中會自動存在正確的使用者登入。</span><span class="sxs-lookup"><span data-stu-id="d323d-135">If the partners run as the same domain user account, the correct user logins exist automatically in both **master** databases.</span></span> <span data-ttu-id="d323d-136">這樣可簡化資料庫的安全性組態，建議您使用。</span><span class="sxs-lookup"><span data-stu-id="d323d-136">This simplifies the security configuration the database and is recommended.</span></span>

    2.  <span data-ttu-id="d323d-137">如果兩個伺服器執行個體是以不同的帳戶身分執行，則必須在遠端伺服器執行個體的 **master** 中建立每一個帳戶的登入，而且該登入必須被授與 CONNECT 權限，才能連接到該伺服器執行個體的資料庫鏡像端點。</span><span class="sxs-lookup"><span data-stu-id="d323d-137">If two server instances run as different accounts, the login each account must be created in **master** on the remote server instance, and that login must be granted CONNECT permissions to connect to the database mirroring endpoint of that server instance.</span></span> <span data-ttu-id="d323d-138">如需詳細資訊，請參閱[設定資料庫鏡像的登入帳戶或 AlwaysOn 可用性群組 &#40;SQL Server&#41;](../../database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-138">For more information, see[Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md).</span></span>

2.  <span data-ttu-id="d323d-139">如果 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 服務是以內建帳戶執行 (例如本機系統、本機服務或網路服務，或是非網域帳戶)，您必須將憑證用於端點驗證。</span><span class="sxs-lookup"><span data-stu-id="d323d-139">If [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running as a built-in account, such as Local System, Local Service, or Network Service, or a nondomain account, you must use certificates for endpoint authentication.</span></span> <span data-ttu-id="d323d-140">如果服務帳戶使用同一個網域中的網域帳戶，您可以選擇在所有複本位置上授與每一個服務帳戶的 CONNECT 存取，或者也可以使用憑證。</span><span class="sxs-lookup"><span data-stu-id="d323d-140">If your service accounts are using domain accounts in the same domain, you can choose to grant CONNECT access for each service account on all the replica locations or you can use certificates.</span></span> <span data-ttu-id="d323d-141">如需詳細資訊，請參閱[使用資料庫鏡像端點憑證 &#40;Transact-SQL&#41;](../../database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-141">For more information, see[Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](../../database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>

##  <a name="endpoints"></a><a name="Endpoints"></a> <span data-ttu-id="d323d-142">Endpoints</span><span class="sxs-lookup"><span data-stu-id="d323d-142">Endpoints</span></span>
 <span data-ttu-id="d323d-143">必須正確設定端點。</span><span class="sxs-lookup"><span data-stu-id="d323d-143">Endpoints must be correctly configured.</span></span>

1.  <span data-ttu-id="d323d-144">確定將要裝載可用性複本的每個 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體 (每個「複本位置」)，都擁有資料庫鏡像端點。</span><span class="sxs-lookup"><span data-stu-id="d323d-144">Make sure that each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is going to host an availability replica (each *replica location*) has a database mirroring endpoint.</span></span> <span data-ttu-id="d323d-145">若要判斷指定的伺服器執行個體上是否有資料庫鏡像端點，請使用 [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) 目錄檢視。</span><span class="sxs-lookup"><span data-stu-id="d323d-145">To determine whether a database mirroring endpoint exists on a given server instance, use the [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) catalog view.</span></span> <span data-ttu-id="d323d-146">如需詳細資訊，請參閱[建立 Windows 驗證的資料庫鏡像端點 &#40;Transact-SQL&#41;](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) 或[允許資料庫鏡像端點使用輸出連線的憑證 &#40;Transact-SQL&#41;](../../database-mirroring/database-mirroring-use-certificates-for-outbound-connections.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-146">For more information, see either [Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) or [Allow a Database Mirroring Endpoint to Use Certificates for Outbound Connections &#40;Transact-SQL&#41;](../../database-mirroring/database-mirroring-use-certificates-for-outbound-connections.md).</span></span>

2.  <span data-ttu-id="d323d-147">檢查通訊埠編號是否正確。</span><span class="sxs-lookup"><span data-stu-id="d323d-147">Check that the port numbers are correct.</span></span>

     <span data-ttu-id="d323d-148">若要識別目前關聯於伺服器執行個體之資料庫鏡像端點的通訊埠，請使用下列 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 陳述式：</span><span class="sxs-lookup"><span data-stu-id="d323d-148">To identify the port currently associated with database mirroring endpoint of a server instance, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT type_desc, port FROM sys.tcp_endpoints;
    GO
    ```

3.  <span data-ttu-id="d323d-149">對於難以解釋的 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 設定問題，我們建議您檢查每個伺服器執行個體，以判斷它是否正在正確的通訊埠上接聽。</span><span class="sxs-lookup"><span data-stu-id="d323d-149">For [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] setup issues that are difficult to explain, we recommend that you inspect each server instance to determine whether it is listening on the correct ports.</span></span> <span data-ttu-id="d323d-150">如需驗證通訊埠可用性的相關資訊，請參閱 [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-150">For information about verifying port availability, see [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>

4.  <span data-ttu-id="d323d-151">確定端點已啟動 (STATE=STARTED)。</span><span class="sxs-lookup"><span data-stu-id="d323d-151">Make sure that the endpoints are started (STATE=STARTED).</span></span> <span data-ttu-id="d323d-152">在每個伺服器執行個體上，使用下列 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 陳述式：</span><span class="sxs-lookup"><span data-stu-id="d323d-152">On each server instance, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT state_desc FROM sys.database_mirroring_endpoints
    ```

     <span data-ttu-id="d323d-153">如需 **state_desc** 資料行的詳細資訊，請參閱 [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d323d-153">For more information about the **state_desc** column, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>

     <span data-ttu-id="d323d-154">若要啟動端點，請使用下列 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 陳述式：</span><span class="sxs-lookup"><span data-stu-id="d323d-154">To start an endpoint, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    ALTER ENDPOINT Endpoint_Mirroring 
    STATE = STARTED 
    AS TCP (LISTENER_PORT = <port_number>)
    FOR database_mirroring (ROLE = ALL);
    GO
    ```

     <span data-ttu-id="d323d-155">如需詳細資訊，請參閱 [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="d323d-155">For more information, see [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span></span>

5.  <span data-ttu-id="d323d-156">確定來自其他伺服器的登入具有 CONNECT 權限。</span><span class="sxs-lookup"><span data-stu-id="d323d-156">Make sure that the login from the other server has CONNECT permission.</span></span> <span data-ttu-id="d323d-157">若要判斷誰具有端點的 CONNECT 權限，請在每個伺服器執行個體上使用下列 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 陳述式：</span><span class="sxs-lookup"><span data-stu-id="d323d-157">To determine who has CONNECT permission for an endpoint, on each server instance use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT 'Metadata Check';
    SELECT EP.name, SP.STATE, 
       CONVERT(nvarchar(38), suser_name(SP.grantor_principal_id)) 
          AS GRANTOR, 
       SP.TYPE AS PERMISSION,
       CONVERT(nvarchar(46),suser_name(SP.grantee_principal_id)) 
          AS GRANTEE 
       FROM sys.server_permissions SP , sys.endpoints EP
       WHERE SP.major_id = EP.endpoint_id
       ORDER BY Permission,grantor, grantee; 
    GO

    ```

##  <a name="system-name"></a><a name="SystemName"></a> <span data-ttu-id="d323d-158">System Name</span><span class="sxs-lookup"><span data-stu-id="d323d-158">System Name</span></span>
 <span data-ttu-id="d323d-159">您可以使用能夠明確識別系統的任何名稱，來當做端點 URL 中伺服器執行個體的系統名稱。</span><span class="sxs-lookup"><span data-stu-id="d323d-159">For the system name of a server instance in an endpoint URL, you can use any name that unambiguously identifies the system.</span></span> <span data-ttu-id="d323d-160">伺服器位址可以是系統名稱 (如果系統位於同一個網域內)、完整網域名稱或 IP 位址 (最好是靜態 IP 位址)。</span><span class="sxs-lookup"><span data-stu-id="d323d-160">The server address can be a system name (if the systems are in the same domain), a fully qualified domain name, or an IP address (preferably, a static IP address).</span></span> <span data-ttu-id="d323d-161">使用完整網域名稱保證可以運作。</span><span class="sxs-lookup"><span data-stu-id="d323d-161">Using the fully qualified domain name is guaranteed to work.</span></span> <span data-ttu-id="d323d-162">如需詳細資訊，請參閱 [在加入或修改可用性複本時指定端點 URL &#40;SQL Server&#41;](specify-endpoint-url-adding-or-modifying-availability-replica.md)設定伺服器執行個體時常見的問題。</span><span class="sxs-lookup"><span data-stu-id="d323d-162">For more information, see [Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;](specify-endpoint-url-adding-or-modifying-availability-replica.md).</span></span>

##  <a name="network-access"></a><a name="NetworkAccess"></a> <span data-ttu-id="d323d-163">Network Access</span><span class="sxs-lookup"><span data-stu-id="d323d-163">Network Access</span></span>
 <span data-ttu-id="d323d-164">裝載可用性複本的每個伺服器執行個體必須要透過 TCP 存取其他伺服器執行個體之通訊埠。</span><span class="sxs-lookup"><span data-stu-id="d323d-164">Each server instance that is hosting an availability replica must be able to access the port of each of the other server instance over TCP.</span></span> <span data-ttu-id="d323d-165">如果伺服器執行個體位在互不信任的不同網域 (不受信任的網域) 中，這點尤其重要。</span><span class="sxs-lookup"><span data-stu-id="d323d-165">This is especially important if the server instances are in different domains that do not trust each other (untrusted domains).</span></span>

##  <a name="endpoint-access-sql-server-error-1418"></a><a name="Msg1418"></a> <span data-ttu-id="d323d-166">端點存取 (SQL Server 錯誤 1418)</span><span class="sxs-lookup"><span data-stu-id="d323d-166">Endpoint Access (SQL Server Error 1418)</span></span>
 <span data-ttu-id="d323d-167">此 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 訊息指出無法連繫端點 URL 中指定的伺服器網路位址或該位址不存在，並建議您確認網路位址名稱，然後重新發出命令。</span><span class="sxs-lookup"><span data-stu-id="d323d-167">This [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] message indicates that the server network address specified in the endpoint URL cannot be reached or does not exist, and it suggests that you verify the network address name and reissue the command.</span></span> <span data-ttu-id="d323d-168">如需詳細資訊，請參閱 [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md)。</span><span class="sxs-lookup"><span data-stu-id="d323d-168">For more information, see [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>

##  <a name="join-database-fails-sql-server-error-35250"></a><a name="JoinDbFails"></a> <span data-ttu-id="d323d-169">聯結資料庫失敗 (SQL Server 錯誤 35250)</span><span class="sxs-lookup"><span data-stu-id="d323d-169">Join Database Fails (SQL Server Error 35250)</span></span>
 <span data-ttu-id="d323d-170">本節討論因為與主要複本的連接不在作用中，次要資料庫聯結至可用性群組失敗的可能原因和解決方案。</span><span class="sxs-lookup"><span data-stu-id="d323d-170">This section discusses the possible causes and resolution of a failure to join secondary databases to the availability group because the connection to the primary replica is not active.</span></span>

 <span data-ttu-id="d323d-171">**解決方案：**</span><span class="sxs-lookup"><span data-stu-id="d323d-171">**Resolution:**</span></span>

1.  <span data-ttu-id="d323d-172">檢查防火牆設定是否允許裝載主要複本和次要複本的伺服器執行個體之間的端點通訊埠通訊 (預設為通訊埠 5022)。</span><span class="sxs-lookup"><span data-stu-id="d323d-172">Check the firewall setting to see if whether allows the endpoint port communication between the server instances that host primary replica and the secondary replica (port 5022 by default).</span></span>

2.  <span data-ttu-id="d323d-173">檢查網路服務帳戶是否有端點的連接權限。</span><span class="sxs-lookup"><span data-stu-id="d323d-173">Check whether the network service account has connect permission to the endpoint.</span></span>

##  <a name="read-only-routing-is-not-working-correctly"></a><a name="ROR"></a> <span data-ttu-id="d323d-174">唯讀路由未正確運作</span><span class="sxs-lookup"><span data-stu-id="d323d-174">Read-Only Routing is Not Working Correctly</span></span>
 <span data-ttu-id="d323d-175">確認下列組態值設定，並視需要加以更正。</span><span class="sxs-lookup"><span data-stu-id="d323d-175">Verify the following configuration values settings and correct them if necessary.</span></span>

||<span data-ttu-id="d323d-176">開啟...</span><span class="sxs-lookup"><span data-stu-id="d323d-176">On...</span></span>|<span data-ttu-id="d323d-177">動作</span><span class="sxs-lookup"><span data-stu-id="d323d-177">Action</span></span>|<span data-ttu-id="d323d-178">註解</span><span class="sxs-lookup"><span data-stu-id="d323d-178">Comments</span></span>|<span data-ttu-id="d323d-179">連結</span><span class="sxs-lookup"><span data-stu-id="d323d-179">Link</span></span>|
|------|---------|------------|--------------|----------|
|<span data-ttu-id="d323d-180">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-180">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-181">目前主要複本</span><span class="sxs-lookup"><span data-stu-id="d323d-181">Current primary replica</span></span>|<span data-ttu-id="d323d-182">確定可用性群組接聽程式在線上。</span><span class="sxs-lookup"><span data-stu-id="d323d-182">Ensure that the availability group listener is online.</span></span>|<span data-ttu-id="d323d-183">**確認接聽程式是否在線上：**</span><span class="sxs-lookup"><span data-stu-id="d323d-183">**To verify whether the listener is online:**</span></span><br /><br /> `SELECT * FROM sys.dm_tcp_listener_states;`<br /><br /> <span data-ttu-id="d323d-184">**重新啟動離線接聽程式：**</span><span class="sxs-lookup"><span data-stu-id="d323d-184">**To restart an offline listener:**</span></span><br /><br /> `ALTER AVAILABILITY GROUP myAG RESTART LISTENER 'myAG_Listener';`|[<span data-ttu-id="d323d-185">sys.dm_tcp_listener_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-185">sys.dm_tcp_listener_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-tcp-listener-states-transact-sql)<br /><br /> [<span data-ttu-id="d323d-186">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-186">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="d323d-187">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-187">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-188">目前主要複本</span><span class="sxs-lookup"><span data-stu-id="d323d-188">Current primary replica</span></span>|<span data-ttu-id="d323d-189">確認 READ_ONLY_ROUTING_LIST 只包含裝載可讀取之次要複本的伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="d323d-189">Ensure that the READ_ONLY_ROUTING_LIST contains only server instances that are hosting a readable secondary replica.</span></span>|<span data-ttu-id="d323d-190">**識別可讀取的次要複本** ：sys.availability_replicas (**secondary_role_allow_connections_desc** 資料行)</span><span class="sxs-lookup"><span data-stu-id="d323d-190">**To identify readable secondary replicas:** sys.availability_replicas  (**secondary_role_allow_connections_desc** column)</span></span><br /><br /> <span data-ttu-id="d323d-191">**檢視唯讀路由清單：** sys.availability_read_only_routing_lists</span><span class="sxs-lookup"><span data-stu-id="d323d-191">**To view a read-only routing list:** sys.availability_read_only_routing_lists</span></span><br /><br /> <span data-ttu-id="d323d-192">**若要變更唯讀路由清單：** ALTER AVAILABILITY GROUP</span><span class="sxs-lookup"><span data-stu-id="d323d-192">**To change a read-only routing list:** ALTER AVAILABILITY GROUP</span></span>|[<span data-ttu-id="d323d-193">sys.availability_replicas &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-193">sys.availability_replicas &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)<br /><br /> [<span data-ttu-id="d323d-194">sys.availability_read_only_routing_lists &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-194">sys.availability_read_only_routing_lists &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-read-only-routing-lists-transact-sql)<br /><br /> [<span data-ttu-id="d323d-195">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-195">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="d323d-196">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-196">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-197">read_only_routing_list 中的每個複本</span><span class="sxs-lookup"><span data-stu-id="d323d-197">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="d323d-198">確定 Windows 防火牆未封鎖 READ_ONLY_ROUTING_URL 通訊埠。</span><span class="sxs-lookup"><span data-stu-id="d323d-198">Ensure that the Windows firewall is not blocking the READ_ONLY_ROUTING_URL port.</span></span>|-|[<span data-ttu-id="d323d-199">設定用於 Database Engine 存取的 Windows 防火牆</span><span class="sxs-lookup"><span data-stu-id="d323d-199">Configure a Windows Firewall for Database Engine Access</span></span>](../../configure-windows/configure-a-windows-firewall-for-database-engine-access.md)|
|<span data-ttu-id="d323d-200">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-200">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-201">read_only_routing_list 中的每個複本</span><span class="sxs-lookup"><span data-stu-id="d323d-201">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="d323d-202">在 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 組態管理員中，確認：</span><span class="sxs-lookup"><span data-stu-id="d323d-202">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager, verify that:</span></span><br /><br /> <span data-ttu-id="d323d-203">SQL Server 遠端連接已啟用。</span><span class="sxs-lookup"><span data-stu-id="d323d-203">SQL Server remote connectivity is enabled.</span></span><br /><br /> <span data-ttu-id="d323d-204">TCP/IP 已啟用。</span><span class="sxs-lookup"><span data-stu-id="d323d-204">TCP/IP is enabled.</span></span><br /><br /> <span data-ttu-id="d323d-205">IP 位址已正確設定。</span><span class="sxs-lookup"><span data-stu-id="d323d-205">The IP addresses are configured correctly.</span></span>|-|[<span data-ttu-id="d323d-206">檢視或變更伺服器屬性 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-206">View or Change Server Properties &#40;SQL Server&#41;</span></span>](../../configure-windows/view-or-change-server-properties-sql-server.md)<br /><br /> [<span data-ttu-id="d323d-207">設定伺服器接聽特定 TCP 通訊埠 &#40;SQL Server 組態管理員&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-207">Configure a Server to Listen on a Specific TCP Port &#40;SQL Server Configuration Manager&#41;</span></span>](../../configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md)|
|<span data-ttu-id="d323d-208">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-208">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-209">read_only_routing_list 中的每個複本</span><span class="sxs-lookup"><span data-stu-id="d323d-209">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="d323d-210">請確定 READ_ONLY_ROUTING_URL (TCP：<strong>// *`system-address`* ：</strong>*port*) 包含正確的完整功能變數名稱 (FQDN) 和埠號碼。</span><span class="sxs-lookup"><span data-stu-id="d323d-210">Ensure that the READ_ONLY_ROUTING_URL (TCP<strong>://*`system-address`*:</strong>*port*) contains the correct fully-qualified domain name (FQDN) and port number.</span></span>|-|[<span data-ttu-id="d323d-211">計算 AlwaysOn 的 read_only_routing_url</span><span class="sxs-lookup"><span data-stu-id="d323d-211">Calculating read_only_routing_url for AlwaysOn</span></span>](https://docs.microsoft.com/archive/blogs/mattn/calculating-read_only_routing_url-for-alwayson)<br /><br /> [<span data-ttu-id="d323d-212">sys.availability_replicas &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-212">sys.availability_replicas &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)<br /><br /> [<span data-ttu-id="d323d-213">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-213">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="d323d-214">![核取方塊](../../media/checkboxemptycenterxtraspacetopandright.gif "核取方塊")</span><span class="sxs-lookup"><span data-stu-id="d323d-214">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="d323d-215">用戶端系統</span><span class="sxs-lookup"><span data-stu-id="d323d-215">Client system</span></span>|<span data-ttu-id="d323d-216">確認用戶端驅動程式支援唯讀路由。</span><span class="sxs-lookup"><span data-stu-id="d323d-216">Verify that the client driver supports read-only routing.</span></span>|-|[<span data-ttu-id="d323d-217">AlwaysOn 用戶端連接性 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d323d-217">AlwaysOn Client Connectivity (SQL Server)</span></span>](always-on-client-connectivity-sql-server.md)|

##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d323d-218">相關工作</span><span class="sxs-lookup"><span data-stu-id="d323d-218">Related Tasks</span></span>

-   [<span data-ttu-id="d323d-219">建立及設定可用性群組 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-219">Creation and Configuration of Availability Groups &#40;SQL Server&#41;</span></span>](creation-and-configuration-of-availability-groups-sql-server.md)

-   [<span data-ttu-id="d323d-220">建立 Windows 驗證的資料庫鏡像端點 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-220">Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;</span></span>](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md)

-   [<span data-ttu-id="d323d-221">在新增或修改可用性複本時指定端點 URL &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-221">Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;</span></span>](specify-endpoint-url-adding-or-modifying-availability-replica.md)

-   [<span data-ttu-id="d323d-222">針對可用性群組手動準備次要資料庫 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-222">Manually Prepare a Secondary Database for an Availability Group &#40;SQL Server&#41;</span></span>](manually-prepare-a-secondary-database-for-an-availability-group-sql-server.md)

-   [<span data-ttu-id="d323d-223">針對失敗的新增檔案作業進行疑難排解 &#40;AlwaysOn 可用性群組&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-223">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)

-   [<span data-ttu-id="d323d-224">管理可用性群組之資料庫的登入及工作 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-224">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)

-   [<span data-ttu-id="d323d-225">在另一個伺服器執行個體上提供可用的資料庫時，管理中繼資料 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d323d-225">Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;</span></span>](../../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)

##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="d323d-226">相關內容</span><span class="sxs-lookup"><span data-stu-id="d323d-226">Related Content</span></span>

-   <span data-ttu-id="d323d-227">[檢視容錯移轉叢集的事件和記錄檔](https://technet.microsoft.com/library/cc772342\(WS.10\).aspx)</span><span class="sxs-lookup"><span data-stu-id="d323d-227">[View Events and Logs for a Failover Cluster](https://technet.microsoft.com/library/cc772342\(WS.10\).aspx)</span></span>

-   [<span data-ttu-id="d323d-228">Get-ClusterLog 容錯移轉叢集指令程式</span><span class="sxs-lookup"><span data-stu-id="d323d-228">Get-ClusterLog Failover Cluster Cmdlet</span></span>](https://technet.microsoft.com/library/ee461045.aspx)

-   [<span data-ttu-id="d323d-229">SQL Server AlwaysOn 團隊部落格：官方 SQL Server AlwaysOn 團隊部落格</span><span class="sxs-lookup"><span data-stu-id="d323d-229">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)

## <a name="see-also"></a><span data-ttu-id="d323d-230">另請參閱</span><span class="sxs-lookup"><span data-stu-id="d323d-230">See Also</span></span>
 <span data-ttu-id="d323d-231">[資料庫鏡像和 AlwaysOn 可用性群組的傳輸安全性 &#40;SQL Server&#41;](../../database-mirroring/transport-security-database-mirroring-always-on-availability.md) AlwaysOn 可用性群組 &#40;SQL Server&#41;的[用戶端網路](../../configure-windows/client-network-configuration.md)設定[必要條件、限制和建議](prereqs-restrictions-recommendations-always-on-availability.md)</span><span class="sxs-lookup"><span data-stu-id="d323d-231">[Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-mirroring/transport-security-database-mirroring-always-on-availability.md) [Client Network Configuration](../../configure-windows/client-network-configuration.md) [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)</span></span>


