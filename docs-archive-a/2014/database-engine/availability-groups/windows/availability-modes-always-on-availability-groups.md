---
title: 可用性模式 (AlwaysOn 可用性群組) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], asynchronous commit
- synchronous-commit availability mode
- Availability Groups [SQL Server], synchronous commit
- asynchronous-commit availability mode
- Availability Groups [SQL Server], availability modes
ms.assetid: 10e7bac7-4121-48c2-be01-10083a8c65af
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 1a3ede790cd024234fe92449546264466355f387
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701932"
---
# <a name="availability-modes-always-on-availability-groups"></a><span data-ttu-id="e0083-102">可用性模式 (AlwaysOn 可用性群組)</span><span class="sxs-lookup"><span data-stu-id="e0083-102">Availability Modes (Always On Availability Groups)</span></span>
  <span data-ttu-id="e0083-103">在 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 中，「可用性模式」\*\* 為複本屬性，可判斷給定可用性複本是否可以在同步認可模式下執行。</span><span class="sxs-lookup"><span data-stu-id="e0083-103">In [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the *availability mode* is a replica property that determines whether a given availability replica can run in synchronous-commit mode.</span></span> <span data-ttu-id="e0083-104">您必須將每個可用性複本的可用性模式設定為同步認可模式或非同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-104">For each availability replica, the availability mode must be configured for either synchronous-commit mode or asynchronous-commit mode.</span></span>  <span data-ttu-id="e0083-105">若將主要複本設定為「非同步認可模式」**，其便不會等候任何次要複本將內送交易記錄檔記錄寫入磁碟 (「強行寫入記錄」**)。</span><span class="sxs-lookup"><span data-stu-id="e0083-105">If the primary replica is configured for *asynchronous-commit mode*, it does not wait for any secondary replica to write incoming transaction log records to disk (to *harden the log*).</span></span> <span data-ttu-id="e0083-106">若將給定次要複本設定為非同步認可模式，主要複本便不會等候次要複本強行寫入記錄。</span><span class="sxs-lookup"><span data-stu-id="e0083-106">If a given secondary replica is configured for asynchronous-commit mode, the primary replica does not wait for that secondary replica to harden the log.</span></span> <span data-ttu-id="e0083-107">若將主要複本與給定次要複本皆設定為「同步認可模式」**，主要複本會等候次要複本確認其已強行寫入記錄 (除非次要複本在主要的「工作階段逾時期限」** 內無法 Ping 主要複本)。</span><span class="sxs-lookup"><span data-stu-id="e0083-107">If both the primary replica and a given secondary replica are both configured for *synchronous-commit mode*, the primary replica waits for the secondary replica to confirm that it has hardened the log (unless the secondary replica fails to ping the primary replica within the primary's *session-timeout period*).</span></span>

> [!NOTE]
>  <span data-ttu-id="e0083-108">若次要複本超過主要的工作階段逾時期限，主要複本將會暫時切換為該次要複本的非同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-108">If primary's session-timeout period is exceeded by a secondary replica, the primary replica temporarily shifts into asynchronous-commit mode for that secondary replica.</span></span> <span data-ttu-id="e0083-109">當次要複本與主要複本重新連接時，即會回復成同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-109">When the secondary replica reconnects with the primary replica, they resume synchronous-commit mode.</span></span>


##  <a name="supported-availability-modes"></a><a name="SupportedAvModes"></a><span data-ttu-id="e0083-110">支援的可用性模式</span><span class="sxs-lookup"><span data-stu-id="e0083-110">Supported Availability Modes</span></span>
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]<span data-ttu-id="e0083-111">支援兩種可用性模式-非同步認可模式和同步認可模式，如下所示：</span><span class="sxs-lookup"><span data-stu-id="e0083-111">supports two availability modes-asynchronous-commit mode and synchronous-commit mode, as follows:</span></span>

-   <span data-ttu-id="e0083-112">「非同步認可模式」\*\* 是一種當可用性複本分散距離相當遠時仍可正常運作的災害復原解決方案。</span><span class="sxs-lookup"><span data-stu-id="e0083-112">*Asynchronous-commit mode* is a disaster-recovery solution that works well when the availability replicas are distributed over considerable distances.</span></span> <span data-ttu-id="e0083-113">如果每個次要複本都在非同步認可模式下執行，主要複本就不會等候任何次要複本強行寫入記錄。</span><span class="sxs-lookup"><span data-stu-id="e0083-113">If every secondary replica is running under asynchronous-commit mode, the primary replica does not wait for any of the secondary replicas to harden the log.</span></span> <span data-ttu-id="e0083-114">而是，將記錄檔記錄寫入本機記錄檔之後，主要複本會立即將交易確認傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="e0083-114">Rather, immediately after writing the log record to the local log file, the primary replica sends the transaction confirmation to the client.</span></span> <span data-ttu-id="e0083-115">主要複本會以相對於設定為非同步認可模式之次要複本的最低交易延遲執行。</span><span class="sxs-lookup"><span data-stu-id="e0083-115">The primary replica runs with minimum transaction latency in relation to a secondary replica that is configured for asynchronous-commit mode.</span></span>  <span data-ttu-id="e0083-116">如果目前主要複本設定為非同步認可的可用性模式，它將會以非同步方式認可所有次要複本的交易，不論其個別可用性模式設定為何。</span><span class="sxs-lookup"><span data-stu-id="e0083-116">If the current primary is configured for asynchronous commit availability mode, it will commit transactions asynchronously for all secondary replicas regardless of their individual availability mode settings.</span></span>

     <span data-ttu-id="e0083-117">如需詳細資訊，請參閱本主題稍後的[非同步認可的可用性模式](#AsyncCommitAvMode)。</span><span class="sxs-lookup"><span data-stu-id="e0083-117">For more information, see [Asynchronous-Commit Availability Mode](#AsyncCommitAvMode), later in this topic.</span></span>

-   <span data-ttu-id="e0083-118">「同步認可模式」\*\* 強調的是高可用性而非效能，但是相對地增加了交易延遲。</span><span class="sxs-lookup"><span data-stu-id="e0083-118">*Synchronous-commit mode* emphasizes high availability over performance, at the cost of increased transaction latency.</span></span> <span data-ttu-id="e0083-119">在同步認可模式下，交易會等候傳送交易確認至用戶端，直到次要複本將記錄強行寫入磁碟為止。</span><span class="sxs-lookup"><span data-stu-id="e0083-119">Under synchronous-commit mode, transactions wait to send the transaction confirmation to the client until the secondary replica has hardened the log to disk.</span></span> <span data-ttu-id="e0083-120">當資料同步處理開始在次要資料庫上執行時，次要複本就會開始套用對應主要資料庫中的內送記錄檔記錄。</span><span class="sxs-lookup"><span data-stu-id="e0083-120">When data synchronization begins on a secondary database, the secondary replica begins applying incoming log records from the corresponding primary database.</span></span> <span data-ttu-id="e0083-121">一旦強行寫入每個記錄檔記錄之後，次要資料庫就會進入 SYNCHRONIZED 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-121">As soon as every log record has been hardened, the secondary database enters the SYNCHRONIZED state.</span></span> <span data-ttu-id="e0083-122">此後，在記錄檔記錄寫入本機記錄檔之前，次要複本會先強行寫入每筆新交易。</span><span class="sxs-lookup"><span data-stu-id="e0083-122">Thereafter, every new transaction is hardened by the secondary replica before the log record is written to the local log file.</span></span> <span data-ttu-id="e0083-123">當給定次要複本的所有次要資料庫都已同步處理時，同步認可模式就會支援手動容錯移轉，並且選擇性地支援自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="e0083-123">When all the secondary databases of a given secondary replica are synchronized, synchronous-commit mode supports manual failover and, optionally, automatic failover.</span></span>

     <span data-ttu-id="e0083-124">如需詳細資訊，請參閱本主題稍後的 [同步認可的可用性模式](#SyncCommitAvMode)。</span><span class="sxs-lookup"><span data-stu-id="e0083-124">For more information, see [Synchronous-Commit Availability Mode](#SyncCommitAvMode), later in this topic.</span></span>

 <span data-ttu-id="e0083-125">下圖顯示包含五個可用性複本的可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0083-125">The following illustration shows an availability group with five availability replicas.</span></span> <span data-ttu-id="e0083-126">主要複本和一個次要複本設定為包含自動容錯移轉的同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-126">The primary replica and one secondary replica are configured for synchronous-commit mode with automatic failover.</span></span> <span data-ttu-id="e0083-127">另一個次要複本則設定為僅包含規劃的手動容錯移轉的同步認可模式，而且兩個次要複本設定為非同步認可模式 (僅支援強制手動容錯移轉，一般稱為「強制容錯移轉」\*\*)。</span><span class="sxs-lookup"><span data-stu-id="e0083-127">Another secondary replica is configured for synchronous-commit mode with only planned manual failover, and two secondary replicas are configured for asynchronous-commit mode, which supports only forced manual failover (typically called *forced failover*).</span></span>

 <span data-ttu-id="e0083-128">![複本的可用性與容錯移轉模式](../../media/aoag-availabilityandfailovermodes.gif "複本的可用性與容錯移轉模式")</span><span class="sxs-lookup"><span data-stu-id="e0083-128">![Availability and failover modes of replicas](../../media/aoag-availabilityandfailovermodes.gif "Availability and failover modes of replicas")</span></span>

 <span data-ttu-id="e0083-129">兩個可用性複本之間的同步處理和容錯移轉行為取決於兩個複本的可用性模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-129">The synchronization and failover behavior between two availability replicas depends on the availability mode of both replicas.</span></span> <span data-ttu-id="e0083-130">例如，如果要發生同步認可，目前相關的主要複本和次要複本都必須設定成同步認可。</span><span class="sxs-lookup"><span data-stu-id="e0083-130">For example, for synchronous commit to occur, both the current primary replica and the secondary replica in question must be configured for synchronous commit.</span></span> <span data-ttu-id="e0083-131">同樣地，若要發生自動容錯移轉，兩個複本都必須設定為自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="e0083-131">Likewise, for automatic failover to occur, both replicas need to be configured for automatic failover.</span></span> <span data-ttu-id="e0083-132">因此，上面所示的部署案例行為可摘要於下表中，該表會探索每個可能主要複本的行為：</span><span class="sxs-lookup"><span data-stu-id="e0083-132">Therefore, the behavior for the illustrated deployment scenario above can be summarized in the following table, which explores the behavior with each potential primary replica:</span></span>

|<span data-ttu-id="e0083-133">目前的主要複本</span><span class="sxs-lookup"><span data-stu-id="e0083-133">Current Primary Replica</span></span>|<span data-ttu-id="e0083-134">自動容錯移轉目標</span><span class="sxs-lookup"><span data-stu-id="e0083-134">Automatic Failover Targets</span></span>|<span data-ttu-id="e0083-135">同步認可模式行為</span><span class="sxs-lookup"><span data-stu-id="e0083-135">Synchronous-Commit Mode Behavior With</span></span>|<span data-ttu-id="e0083-136">非同步認可模式行為</span><span class="sxs-lookup"><span data-stu-id="e0083-136">Asynchronous-Commit Mode Behavior With</span></span>|<span data-ttu-id="e0083-137">自動容錯移轉可行</span><span class="sxs-lookup"><span data-stu-id="e0083-137">Automatic failover possible</span></span>|
|-----------------------------|--------------------------------|--------------------------------------------|---------------------------------------------|---------------------------------|
|<span data-ttu-id="e0083-138">01</span><span class="sxs-lookup"><span data-stu-id="e0083-138">01</span></span>|<span data-ttu-id="e0083-139">02</span><span class="sxs-lookup"><span data-stu-id="e0083-139">02</span></span>|<span data-ttu-id="e0083-140">02 與 03</span><span class="sxs-lookup"><span data-stu-id="e0083-140">02 and 03</span></span>|<span data-ttu-id="e0083-141">04</span><span class="sxs-lookup"><span data-stu-id="e0083-141">04</span></span>|<span data-ttu-id="e0083-142">是</span><span class="sxs-lookup"><span data-stu-id="e0083-142">Yes</span></span>|
|<span data-ttu-id="e0083-143">02</span><span class="sxs-lookup"><span data-stu-id="e0083-143">02</span></span>|<span data-ttu-id="e0083-144">01</span><span class="sxs-lookup"><span data-stu-id="e0083-144">01</span></span>|<span data-ttu-id="e0083-145">01 與 03</span><span class="sxs-lookup"><span data-stu-id="e0083-145">01 and 03</span></span>|<span data-ttu-id="e0083-146">04</span><span class="sxs-lookup"><span data-stu-id="e0083-146">04</span></span>|<span data-ttu-id="e0083-147">是</span><span class="sxs-lookup"><span data-stu-id="e0083-147">Yes</span></span>|
|<span data-ttu-id="e0083-148">03</span><span class="sxs-lookup"><span data-stu-id="e0083-148">03</span></span>||<span data-ttu-id="e0083-149">01 與 02</span><span class="sxs-lookup"><span data-stu-id="e0083-149">01 and 02</span></span>|<span data-ttu-id="e0083-150">04</span><span class="sxs-lookup"><span data-stu-id="e0083-150">04</span></span>|<span data-ttu-id="e0083-151">否</span><span class="sxs-lookup"><span data-stu-id="e0083-151">No</span></span>|
|<span data-ttu-id="e0083-152">04</span><span class="sxs-lookup"><span data-stu-id="e0083-152">04</span></span>|||<span data-ttu-id="e0083-153">01、02 和 03</span><span class="sxs-lookup"><span data-stu-id="e0083-153">01, 02, and 03</span></span>|<span data-ttu-id="e0083-154">否</span><span class="sxs-lookup"><span data-stu-id="e0083-154">No</span></span>|

 <span data-ttu-id="e0083-155">一般而言，當做非同步認可複本的節點 04 會部署在災害復原網站中。</span><span class="sxs-lookup"><span data-stu-id="e0083-155">Typically, Node 04 as an asynchronous-commit replica, is deployed in a disaster recovery site.</span></span> <span data-ttu-id="e0083-156">節點 01、02 和 03 在容錯移轉至節點 04 之後依然處於非同步認可模式的事實，可避免您的可用性群組中因為兩個網站之間的網路延遲而可能較低效能。</span><span class="sxs-lookup"><span data-stu-id="e0083-156">The fact that Nodes 01, 02, and 03 remain at asynchronous-commit mode after failing over to Node 04 helps prevent potential performance degradation in your availability group due to high network latency between the two sites.</span></span>

##  <a name="asynchronous-commit-availability-mode"></a><a name="AsyncCommitAvMode"></a><span data-ttu-id="e0083-157">非同步認可的可用性模式</span><span class="sxs-lookup"><span data-stu-id="e0083-157">Asynchronous-Commit Availability Mode</span></span>
 <span data-ttu-id="e0083-158">在「非同步認可模式」\*\* 下，次要複本永遠不會與主要複本同步處理。</span><span class="sxs-lookup"><span data-stu-id="e0083-158">Under *asynchronous-commit mode*, the secondary replica never becomes synchronized with the primary replica.</span></span> <span data-ttu-id="e0083-159">雖然給定的次要資料庫可能會趕上對應的主要資料庫，不過任何次要資料庫都可能會在任何時間點落後。</span><span class="sxs-lookup"><span data-stu-id="e0083-159">Though a given secondary database might catch up to the corresponding primary database, any secondary database could lag behind at any point.</span></span> <span data-ttu-id="e0083-160">對於主要複本與次要複本相距甚遠、您不希望小錯誤對主要複本造成影響，或是效能勝於同步處理資料保護等災難復原情況下，可以使用非同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-160">Asynchronous-commit mode can be useful in a disaster-recovery scenario in which the primary replica and the secondary replica are separated by a significant distance and where you do not want small errors to impact the primary replica or in or situations where performance is more important than synchronized data protection.</span></span> <span data-ttu-id="e0083-161">此外，因為主要複本不會等候次要複本的確認，所以次要複本的問題永遠不會影響主要複本。</span><span class="sxs-lookup"><span data-stu-id="e0083-161">Furthermore, since the primary replica does not wait for acknowledgements from the secondary replica, problems on the secondary replica never impact the primary replica.</span></span>

 <span data-ttu-id="e0083-162">非同步認可的次要複本會嘗試與主要複本所傳來的記錄檔記錄保持同步。</span><span class="sxs-lookup"><span data-stu-id="e0083-162">An asynchronous-commit secondary replica attempts to keep up with the log records received from the primary replica.</span></span> <span data-ttu-id="e0083-163">但非同步認可的次要資料庫一律會保持未同步處理的狀態，而且可能會稍微落後對應的主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0083-163">But asynchronous-commit secondary databases always remain unsynchronized and are likely to lag somewhat behind the corresponding primary databases.</span></span> <span data-ttu-id="e0083-164">非同步認可之次要資料庫與對應之主要資料庫間的差距通常很小。</span><span class="sxs-lookup"><span data-stu-id="e0083-164">Typically the gap between an asynchronous-commit secondary database and the corresponding primary database is small.</span></span> <span data-ttu-id="e0083-165">但裝載次要複本的伺服器若是超過負載或網路太慢，此差距就會變大。</span><span class="sxs-lookup"><span data-stu-id="e0083-165">But the gap can become substantial if the server hosting the secondary replica is over loaded or the network is slow.</span></span>

 <span data-ttu-id="e0083-166">非同步認可模式唯一支援的容錯移轉形式為強制容錯移轉 (可能會遺失資料)。</span><span class="sxs-lookup"><span data-stu-id="e0083-166">The only form of failover supported by asynchronous-commit mode is forced failover (with possible data loss).</span></span> <span data-ttu-id="e0083-167">強制容錯移轉是最後的方法，當目前的主要複本會有一長段時間無法使用，以及主要資料庫的立即可用性高於遺失資料的潛在風險時，即可使用此方法。容錯移轉目標的複本角色必須處於 SECONDARY 或 RESOLVING 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-167">Forcing failover is a last resort intended only for situations in which the current primary replica will remain unavailable for an extended period and immediate availability of primary databases is more critical than the risk of possible data loss.The failover target must be a replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="e0083-168">容錯移轉目標會轉換成主要角色，而且其資料庫副本會變成主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0083-168">The failover target transitions to the primary role, and its copies of the databases become the primary database.</span></span> <span data-ttu-id="e0083-169">當剩餘的次要資料庫與先前的主要資料庫恢復其可用性時，系統會暫停這些資料庫，直到您手動一一回復為止。</span><span class="sxs-lookup"><span data-stu-id="e0083-169">Any remaining secondary databases, along with the former primary databases, once they become available, are suspended until you manually resume them individually.</span></span> <span data-ttu-id="e0083-170">在非同步認可模式下，所有原始主要複本尚未傳送至先前之次要複本的交易記錄檔皆會遺失。</span><span class="sxs-lookup"><span data-stu-id="e0083-170">Under asynchronous-commit mode, any transaction logs that the original primary replica had not yet sent to the former secondary replica are lost.</span></span> <span data-ttu-id="e0083-171">這表示有部分或全部新主要資料庫可能會缺少最近認可的交易。</span><span class="sxs-lookup"><span data-stu-id="e0083-171">This means that some or all of the new primary databases might be lacking recently committed transactions.</span></span> <span data-ttu-id="e0083-172">如需強制容錯移轉如何運作的詳細資訊，以及其使用方式的最佳作法，請參閱[容錯移轉和容錯移轉模式 &#40;AlwaysOn 可用性群組&#41;](failover-and-failover-modes-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="e0083-172">For more information on how forced failover works and on best practices for using it, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>

##  <a name="synchronous-commit-availability-mode"></a><a name="SyncCommitAvMode"></a><span data-ttu-id="e0083-173">同步認可的可用性模式</span><span class="sxs-lookup"><span data-stu-id="e0083-173">Synchronous-Commit Availability Mode</span></span>
 <span data-ttu-id="e0083-174">在同步認可的可用性模式 (「同步認可模式」\*\*) 下聯結至可用性群組之後，次要資料庫會趕上對應的主要資料庫並且進入 SYNCHRONIZED 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-174">Under synchronous-commit availability mode (*synchronous-commit mode*), after being joined to an availability group, a secondary database catches up to the corresponding primary database and enters the SYNCHRONIZED state.</span></span> <span data-ttu-id="e0083-175">只要資料同步處理繼續進行，次要資料庫就會維持 SYNCHRONIZED 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-175">The secondary database remains SYNCHRONIZED as long as data synchronization continues.</span></span> <span data-ttu-id="e0083-176">這可確保在給定主要資料庫上認可的每筆交易，在對應的次要資料庫上也已獲得認可。</span><span class="sxs-lookup"><span data-stu-id="e0083-176">This guarantees that every transaction that is committed on a given primary database has also been committed on the corresponding secondary database.</span></span> <span data-ttu-id="e0083-177">當給定次要複本上的每個次要資料庫都已同步處理時，整個次要複本的同步處理健全狀態就是 HEALTHY。</span><span class="sxs-lookup"><span data-stu-id="e0083-177">When every secondary database on a given secondary replica is synchronized, the synchronization-health state of the secondary replica as a whole is HEALTHY.</span></span>


###  <a name="factors-that-disrupt-data-synchronization"></a><a name="DisruptSync"></a> <span data-ttu-id="e0083-178">干擾資料同步處理的因素</span><span class="sxs-lookup"><span data-stu-id="e0083-178">Factors That Disrupt Data Synchronization</span></span>
 <span data-ttu-id="e0083-179">一旦次要複本的所有資料庫都已同步處理之後，它就會進入 HEALTHY 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-179">Once all of its databases are synchronized, a secondary replica enters the HEALTHY state.</span></span> <span data-ttu-id="e0083-180">除非發生下列其中一種狀況，否則已同步處理的次要複本將維持狀況良好：</span><span class="sxs-lookup"><span data-stu-id="e0083-180">The synchronized secondary replica will remain healthy unless one of the following occurs:</span></span>

-   <span data-ttu-id="e0083-181">網路或電腦延遲或問題導致次要複本與主要複本之間的工作階段逾時。</span><span class="sxs-lookup"><span data-stu-id="e0083-181">A network or computer delay or glitch causes the session between the secondary replica and primary replica to timeout.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="e0083-182">如需可用性複本之會話時間屬性的詳細資訊，請參閱[AlwaysOn 可用性群組 &#40;SQL Server&#41;的總覽](overview-of-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="e0083-182">For information about the session-time property of availability replicas, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>

-   <span data-ttu-id="e0083-183">您暫停了次要複本上的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0083-183">You suspend a secondary database on the secondary replica.</span></span> <span data-ttu-id="e0083-184">次要複本會停止同步處理，而且其同步處理健全狀態會標記為 NOT_HEALTHY。</span><span class="sxs-lookup"><span data-stu-id="e0083-184">The secondary replica ceases to be synchronized, and its synchronization-health state is marked as NOT_HEALTHY.</span></span> <span data-ttu-id="e0083-185">在暫停的次要資料庫恢復並重新同步處理，或從可用性群組中移除暫停的次要資料庫之前，次要複本無法再次變成狀況良好。</span><span class="sxs-lookup"><span data-stu-id="e0083-185">the secondary replica cannot become healthy again until the suspended secondary database is either resumed and resynchronized or removed from the availability group.</span></span>

-   <span data-ttu-id="e0083-186">您將主要資料庫加入至可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0083-186">You add a primary database the availability group.</span></span> <span data-ttu-id="e0083-187">先前同步處理的次要複本會進入 NOT_HEALTHY 同步處理健全狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-187">Previously synchronized secondary replicas enter the NOT_HEALTHY synchronization-health state.</span></span> <span data-ttu-id="e0083-188">這種狀態表示至少有一個資料庫處於 NOT SYNCHRONIZING 同步處理狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-188">This state indicates that at least one database is in the NOT SYNCHRONIZING synchronization state.</span></span> <span data-ttu-id="e0083-189">在對應的次要資料庫已經在複本上完成準備、已經聯結至可用性群組，而且已經與新的主要資料庫同步處理之前，給定的次要複本無法再次變成 HEALTHY。</span><span class="sxs-lookup"><span data-stu-id="e0083-189">A given secondary replica cannot be HEALTHY again until a corresponding secondary database has been prepared on the replica, has been joined to the availability group, and has become synchronized with the new primary database.</span></span>

-   <span data-ttu-id="e0083-190">您將主要複本或次要複本變更為非同步認可的可用性模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-190">You change the primary replica or the secondary replica to asynchronous-commit availability mode.</span></span> <span data-ttu-id="e0083-191">變更為非同步認可模式之後，只要資料同步處理繼續進行，次要複本將會維持 HEALTHY 同步處理健全狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-191">After changing to asynchronous-commit mode, the secondary replica will remain in the HEALTHY synchronization-health state as long as data synchronization continues.</span></span> <span data-ttu-id="e0083-192">不過，如果只有主要複本變更為非同步認可模式，同步認可次要複本將會進入 PARTIALLY_HEALTHY 同步處理健全狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-192">However, if only the primary replica is changed to asynchronous-commit mode, the synchronous-commit secondary replica will enter the PARTIALLY_HEALTHY synchronization-health state.</span></span> <span data-ttu-id="e0083-193">這種狀態表示至少有一個資料庫處於 SYNCHRONIZING 同步處理狀態，但是沒有任何資料庫處於 NOT SYNCHRONIZING 狀態。</span><span class="sxs-lookup"><span data-stu-id="e0083-193">This state indicates that at least one database is in the SYNCHRONIZING synchronization state, but none of the databases are in the NOT SYNCHRONIZING state.</span></span>

-   <span data-ttu-id="e0083-194">您將任何次要複本變更為同步認可的可用性模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-194">You change any secondary replica to synchronous-commit availability mode.</span></span> <span data-ttu-id="e0083-195">這會導致該次要複本標記為處於 PARTIALLY_HEALTHY 同步處理健全狀態，</span><span class="sxs-lookup"><span data-stu-id="e0083-195">This causes that secondary replica to be marked as  in the PARTIALLY_HEALTHY synchronization-health state.</span></span> <span data-ttu-id="e0083-196">直到其所有資料庫都處於 SYNCHRONIZED 同步處理狀態為止。</span><span class="sxs-lookup"><span data-stu-id="e0083-196">until all of its databases are in the SYNCHRONIZED synchronization state.</span></span>

> [!TIP]
>  <span data-ttu-id="e0083-197">若要檢視可用性群組、可用性複本或可用性資料庫的同步處理健康情況，請分別查詢 **sys.dm_hadr_availability_group_states** 、 **sys.dm_hadr_availability_replica_states** 或 [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-group-states-transact-sql)的 [synchronization_health](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql)或 [synchronization_health_desc](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)資料行。</span><span class="sxs-lookup"><span data-stu-id="e0083-197">To view the synchronization health of an availability group, availability replica, or availability database, query the **synchronization_health** or **synchronization_health_desc** column of [sys.dm_hadr_availability_group_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-group-states-transact-sql), [sys.dm_hadr_availability_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql), or [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql), respectively.</span></span>

###  <a name="how-synchronization-works-on-a-secondary-replica"></a><a name="HowSyncWorks"></a><span data-ttu-id="e0083-198">次要複本上的同步處理如何運作</span><span class="sxs-lookup"><span data-stu-id="e0083-198">How Synchronization Works on a Secondary Replica</span></span>
 <span data-ttu-id="e0083-199">在同步認可模式下，當次要複本聯結可用性群組並且建立包含主要複本的工作階段之後，次要複本就會將內送記錄檔記錄寫入磁碟 (「強行寫入記錄」\*\*) 並將確認訊息傳送至主要複本。</span><span class="sxs-lookup"><span data-stu-id="e0083-199">Under the synchronous-commit mode, after a secondary replica joins the availability group and establishes a session with the primary replica, the secondary replica writes incoming log records to disk (*hardens the log*) and sends a confirmation message to the primary replica.</span></span> <span data-ttu-id="e0083-200">一旦次要資料庫的強行寫入記錄趕上主要資料庫的記錄結尾之後，次要資料庫的狀態就會設定為 SYNCHRONIZED。</span><span class="sxs-lookup"><span data-stu-id="e0083-200">Once the hardened log on the secondary database has caught up the end of log on the primary database, the state of the secondary database is set to SYNCHRONIZED.</span></span> <span data-ttu-id="e0083-201">同步處理所需的時間主要取決於工作階段開始時，次要資料庫落後主要資料庫的程度 (依照一開始從主要複本收到的記錄檔記錄數目計算)、主要資料庫的工作負載以及裝載次要複本之伺服器執行個體的電腦速度。</span><span class="sxs-lookup"><span data-stu-id="e0083-201">The time required for synchronization depends essentially on how far the secondary database was behind the primary database at the start of the session (measured by the number of log records initially received from the primary replica), the work load on the primary database, and the speed of the computer of the server instance that hosts the secondary replica.</span></span>

 <span data-ttu-id="e0083-202">維持同步作業的做法如下：</span><span class="sxs-lookup"><span data-stu-id="e0083-202">Synchronous operation is maintained in the following manner:</span></span>

1.  <span data-ttu-id="e0083-203">從用戶端收到交易時，主要複本會將交易的記錄寫入交易記錄，同時將記錄檔記錄傳送至次要複本。</span><span class="sxs-lookup"><span data-stu-id="e0083-203">On receiving a transaction from a client, the primary replica writes the log for the transaction to the transaction log and concurrently sends the log record to the secondary replicas.</span></span>

2.  <span data-ttu-id="e0083-204">一旦記錄檔記錄寫入主要資料庫的交易記錄之後，只有當此時容錯移轉至沒有收到記錄的次要複本時，才能恢復交易。</span><span class="sxs-lookup"><span data-stu-id="e0083-204">Once a log record is written to the transaction log of the primary database, the transaction can be undone only if there is a failover at this point to a secondary that did not receive the log.</span></span> <span data-ttu-id="e0083-205">主要複本會等候同步認可次要複本的確認。</span><span class="sxs-lookup"><span data-stu-id="e0083-205">The primary replica waits for confirmation from the synchronous-commit secondary replica.</span></span>

3.  <span data-ttu-id="e0083-206">次要複本會強行寫入記錄並將確認傳回給主要複本。</span><span class="sxs-lookup"><span data-stu-id="e0083-206">The secondary replica hardens the log and returns an acknowledgement to the primary replica.</span></span>

4.  <span data-ttu-id="e0083-207">收到次要複本的確認時，主要複本就會完成認可處理並將確認訊息傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="e0083-207">On receiving the confirmation from the secondary replica, the primary replica finishes the commit processing and sends a confirmation message to the client.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="e0083-208">如果同步認可次要複本逾時，而未確認它是否已強行寫入記錄，主要複本就會將該次要複本標記為失敗。</span><span class="sxs-lookup"><span data-stu-id="e0083-208">If a synchronous-commit secondary replica times out without confirming that it has hardened the log, the primary marks that secondary replica as failed.</span></span> <span data-ttu-id="e0083-209">次要複本的連接狀態會變更為 DISCONNECTED，而且主要複本會停止等候次要複本的確認。</span><span class="sxs-lookup"><span data-stu-id="e0083-209">The connected state of the secondary replica changes to DISCONNECTED, and the primary replica stops waiting for confirmation from the secondary replica.</span></span> <span data-ttu-id="e0083-210">這種行為可確保失敗的同步認可次要複本不會防止強行寫入主要複本的交易記錄。</span><span class="sxs-lookup"><span data-stu-id="e0083-210">This behavior ensures that a failed synchronous-commit secondary replica does not prevent hardening of the transaction log on the primary replica.</span></span>

 <span data-ttu-id="e0083-211">同步認可模式會藉由要求同步處理兩地的資料來保護資料，但是相對地稍微增加了交易的延遲。</span><span class="sxs-lookup"><span data-stu-id="e0083-211">Synchronous-commit mode protects your data by requiring the data to be synchronized between two places, at the cost of somewhat increasing the latency of the transaction.</span></span>

### <a name="synchronous-commit-mode-with-only-manual-failover"></a><span data-ttu-id="e0083-212">僅包含手動容錯移轉的同步認可模式</span><span class="sxs-lookup"><span data-stu-id="e0083-212">Synchronous-Commit Mode with Only Manual Failover</span></span>
 <span data-ttu-id="e0083-213">當這些複本都已連接而且資料庫已同步處理時，就會支援手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="e0083-213">When these replicas are connected and the database is synchronized, manual failover is supported.</span></span> <span data-ttu-id="e0083-214">如果次要複本關閉，主要複本將不受影響。</span><span class="sxs-lookup"><span data-stu-id="e0083-214">If the secondary replica goes down, the primary replica is unaffected.</span></span> <span data-ttu-id="e0083-215">如果沒有任何 SYNCHRONIZED 複本存在，主要複本會公開執行 (亦即，不會將資料傳送至任何次要複本)。</span><span class="sxs-lookup"><span data-stu-id="e0083-215">The primary replica runs exposed if no SYNCHRONIZED replicas exist (that is, without sending data to any secondary replica).</span></span> <span data-ttu-id="e0083-216">如果主要複本已遺失，次要複本就會進入 RESOLVING 狀態，但是資料庫擁有者可以強制容錯移轉至次要複本 (可能會遺失資料)。</span><span class="sxs-lookup"><span data-stu-id="e0083-216">If the primary replica is lost, the secondary replicas enter the RESOLVING state, but the database owner can force a failover to the secondary replica (with possible data loss).</span></span> <span data-ttu-id="e0083-217">如需詳細資訊，請參閱[容錯移轉及容錯移轉模式 &#40;AlwaysOn 可用性群組&#41;](failover-and-failover-modes-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="e0083-217">For more information, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>

###  <a name="synchronous-commit-mode-with-automatic-failover"></a><a name="SyncCommitWithAuto"></a><span data-ttu-id="e0083-218">具有自動容錯移轉的同步認可模式</span><span class="sxs-lookup"><span data-stu-id="e0083-218">Synchronous-Commit Mode with Automatic Failover</span></span>
 <span data-ttu-id="e0083-219">自動容錯移轉可確保主要複本遺失之後快速地重新提供資料庫，藉以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="e0083-219">Automatic failover provides high availability by ensuring that the database is quickly made available again after the loss of the primary replica.</span></span> <span data-ttu-id="e0083-220">若要將可用性群組設定為自動容錯移轉，您必須將目前的主要複本和一個次要複本都設定為包含自動容錯移轉的同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0083-220">To configure an availability group for automatic failover, you need to set both the current primary replica and one secondary replica to synchronous-commit mode with automatic failover.</span></span>

 <span data-ttu-id="e0083-221">此外，為了能夠在給定的時間進行自動容錯移轉，這個次要複本必須與主要複本同步處理 (亦即，次要資料庫都會同步處理)，而且 Windows Server 容錯移轉叢集 (WSFC) 叢集必須具有仲裁。</span><span class="sxs-lookup"><span data-stu-id="e0083-221">Furthermore, for an automatic failover to be possible at a given time, this secondary replica must be synchronized with the primary replica (that is, the secondary databases are all synchronized), and the Windows Server Failover Clustering (WSFC) cluster must have quorum.</span></span> <span data-ttu-id="e0083-222">如果主要複本在這些條件下變得無法使用，就會進行自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="e0083-222">If the primary replica becomes unavailable under these conditions, automatic failover occurs.</span></span> <span data-ttu-id="e0083-223">次要複本會切換成主要角色，而且它會提供其資料庫做為主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0083-223">The secondary replica switches to the role of primary, and it offers its database as the primary database.</span></span> <span data-ttu-id="e0083-224">如需詳細資訊，請參閱[容錯移轉和容錯移轉模式 &#40;AlwaysOn 可用性群組&#41;](failover-and-failover-modes-always-on-availability-groups.md)主題的「自動容錯移轉」一節。</span><span class="sxs-lookup"><span data-stu-id="e0083-224">For more information, see the "Automatic Failover " section of the [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) topic.</span></span>

> [!NOTE]
>  <span data-ttu-id="e0083-225">如需 WSFC 仲裁和 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的資訊，請參閱 [WSFC 仲裁模式和投票組態 &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="e0083-225">For information about WSFC quorum and [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see For more information, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>

##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="e0083-226">相關工作</span><span class="sxs-lookup"><span data-stu-id="e0083-226">Related Tasks</span></span>
 <span data-ttu-id="e0083-227">**若要變更可用性模式與容錯移轉模式**</span><span class="sxs-lookup"><span data-stu-id="e0083-227">**To change the availability mode and failover mode**</span></span>

-   [<span data-ttu-id="e0083-228">變更可用性複本的可用性模式 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-228">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)

-   [<span data-ttu-id="e0083-229">變更可用性複本的容錯移轉模式 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-229">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)

 <span data-ttu-id="e0083-230">**若要調整仲裁投票**</span><span class="sxs-lookup"><span data-stu-id="e0083-230">**To adjust quorum votes**</span></span>

-   [<span data-ttu-id="e0083-231">檢視叢集仲裁 NodeWeight 設定</span><span class="sxs-lookup"><span data-stu-id="e0083-231">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)

-   [<span data-ttu-id="e0083-232">設定叢集仲裁 NodeWeight 設定</span><span class="sxs-lookup"><span data-stu-id="e0083-232">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)

-   [<span data-ttu-id="e0083-233">在無仲裁情況下強制啟動 WSFC 叢集</span><span class="sxs-lookup"><span data-stu-id="e0083-233">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)

 <span data-ttu-id="e0083-234">**若要執行手動容錯移轉**</span><span class="sxs-lookup"><span data-stu-id="e0083-234">**To perform a manual failover**</span></span>

-   [<span data-ttu-id="e0083-235">執行可用性群組的已規劃手動容錯移轉 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-235">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)

-   [<span data-ttu-id="e0083-236">執行可用性群組的強制手動容錯移轉 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-236">Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)

-   [<span data-ttu-id="e0083-237">使用容錯移轉可用性群組精靈 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-237">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)

 <span data-ttu-id="e0083-238">**若要檢視可用性群組、可用性複本和資料庫狀態**</span><span class="sxs-lookup"><span data-stu-id="e0083-238">**To view availability group, availability replica, and database states**</span></span>

-   [<span data-ttu-id="e0083-239">sys.dm_hadr_availability_group_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-239">sys.dm_hadr_availability_group_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-group-states-transact-sql)

-   [<span data-ttu-id="e0083-240">sys.dm_hadr_availability_replica_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-240">sys.dm_hadr_availability_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql)

-   [<span data-ttu-id="e0083-241">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e0083-241">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)

##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="e0083-242">相關內容</span><span class="sxs-lookup"><span data-stu-id="e0083-242">Related Content</span></span>

-   [<span data-ttu-id="e0083-243">Microsoft SQL Server AlwaysOn 高可用性和災害復原方案指南</span><span class="sxs-lookup"><span data-stu-id="e0083-243">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)

-   [<span data-ttu-id="e0083-244">SQL Server AlwaysOn 團隊部落格：官方 SQL Server AlwaysOn 團隊部落格</span><span class="sxs-lookup"><span data-stu-id="e0083-244">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)

## <a name="see-also"></a><span data-ttu-id="e0083-245">另請參閱</span><span class="sxs-lookup"><span data-stu-id="e0083-245">See Also</span></span>
 <span data-ttu-id="e0083-246">[概述 AlwaysOn 可用性群組 &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [容錯移轉和容錯移轉模式 &#40;AlwaysOn 可用性群組](failover-and-failover-modes-always-on-availability-groups.md)&#41;[Windows SERVER 容錯移轉叢集 &#40;WSFC&#41; 使用 SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="e0083-246">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)</span></span>


