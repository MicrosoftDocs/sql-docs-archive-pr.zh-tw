---
title: 容錯移轉和容錯移轉模式 (AlwaysOn 可用性群組) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], failover
- Availability Groups [SQL Server], failover modes
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 378d2d63-50b9-420b-bafb-d375543fda17
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: eb904cd0f0649c43553b5d6c8b031c5f284901f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595287"
---
# <a name="failover-and-failover-modes-alwayson-availability-groups"></a><span data-ttu-id="3d80b-102">容錯移轉及容錯移轉模式 (AlwaysOn 可用性群組)</span><span class="sxs-lookup"><span data-stu-id="3d80b-102">Failover and Failover Modes (AlwaysOn Availability Groups)</span></span>
  <span data-ttu-id="3d80b-103">在可用性群組的內容中，可用性複本的主要角色和次要角色在稱為 *「容錯移轉」* (Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-103">Within the context of an availability group, the primary role and secondary role of availability replicas are typically interchangeable in a process known as *failover*.</span></span> <span data-ttu-id="3d80b-104">容錯移轉共有三種形式，包括自動容錯移轉 (不會遺失資料)、規劃的手動容錯移轉 (不會遺失資料)，以及強制手動容錯移轉 (可能會遺失資料)，這種形式通常稱為「強制容錯移轉」。</span><span class="sxs-lookup"><span data-stu-id="3d80b-104">Three forms of failover exist: automatic failover (without data loss), planned manual failover (without data loss), and forced manual failover (with possible data loss), typically called *forced failover*.</span></span> <span data-ttu-id="3d80b-105">自動及經過規劃的手動容錯移轉會保留您的所有資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-105">Automatic and planned manual failover preserve all your data.</span></span> <span data-ttu-id="3d80b-106">可用性群組會在可用性複本層級容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-106">An availability group fails over at the availability-replica level.</span></span> <span data-ttu-id="3d80b-107">亦即可用性群組會容錯移轉至其中一個次要複本 (目前的「容錯移轉目標」)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-107">That is, an availability group fails over to one of its secondary replicas (the current *failover target*).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3d80b-108">資料庫層級問題 (如資料庫因為資料檔案遺失而有問題、資料庫刪除或交易記錄損毀) 並不會造成可用性群組容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-108">Issues at the database level, such as a database becoming suspect due to the loss of a data file, deletion of a database, or corruption of a transaction log, do not cause an availability group to failover.</span></span>  
  
 <span data-ttu-id="3d80b-109">容錯移轉期間，容錯移轉目標會接管主要角色並復原其資料庫，使之上線之後做為新的主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-109">During the failover, the failover target takes over the primary role, recovers its databases, and brings them online as the new primary databases.</span></span> <span data-ttu-id="3d80b-110">之前的主要複本 (如果可用的話) 會切換到次要角色，而且其資料庫會變成次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-110">The former primary replica, when available, switches to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="3d80b-111">原則上，這些角色可以來回切換 (或切換為不同的容錯移轉目標)，以回應多項失敗或達成管理目的。</span><span class="sxs-lookup"><span data-stu-id="3d80b-111">Potentially, these roles can switch back and forth (or to a different failover target) in response to multiple failures or for administrative purposes.</span></span>  
  
 <span data-ttu-id="3d80b-112">指定可用性複本支援的容錯移轉形式是由 [容錯移轉模式] 屬性所指定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-112">The form(s) of failover that a given availability replica supports is specified by the *failover mode* property.</span></span> <span data-ttu-id="3d80b-113">指定可用性複本的可能容錯移轉模式取決於複本的[可用性模式](availability-modes-always-on-availability-groups.md)，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d80b-113">For a given availability replica, the possible failover modes depends on the [availability mode](availability-modes-always-on-availability-groups.md) of the replica, as follows:</span></span>  
  
-   <span data-ttu-id="3d80b-114">**同步認可複本**支援兩個設定：自動或手動。</span><span class="sxs-lookup"><span data-stu-id="3d80b-114">**Synchronous-commit replicas** support two settings-automatic or manual.</span></span> <span data-ttu-id="3d80b-115">「自動」設定同時支援自動容錯移轉和手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-115">The "automatic" setting supports both automatic failover and manual failover.</span></span> <span data-ttu-id="3d80b-116">若要避免資料遺失，自動容錯移轉和已規劃的容錯移轉要求容錯移轉目標必須是同步處理狀態良好的同步認可次要複本 (這表示容錯移轉目標上的每個次要資料庫與對應的主要資料庫同步處理)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-116">To prevent data loss, automatic failover and planned failover require that the failover target be a synchronous-commit secondary replica with a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span> <span data-ttu-id="3d80b-117">當次要複本不符合上述兩項條件時，只會支援強制容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-117">Whenever a secondary replica does not meet both of these conditions, it supports only forced failover.</span></span> <span data-ttu-id="3d80b-118">請注意，在角色處於 RESOLVING 狀態的複本中也支援強制容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-118">Note that forced failover is also supported a replicas whose role is in the RESOLVING state.</span></span>  
  
-   <span data-ttu-id="3d80b-119">**非同步認可複本** 僅支援手動容錯移轉模式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-119">**Asynchronous-commit replicas** support only the manual failover mode.</span></span> <span data-ttu-id="3d80b-120">此外，因為它們絕對不會同步處理，所以僅支援強制容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-120">Moreover, because they are never synchronized, they support only forced failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3d80b-121">容錯移轉之後，需要存取主要資料庫的用戶端應用程式必須連接至新的主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-121">After a failover, client applications that need to access the primary databases must connect to the new primary replica.</span></span> <span data-ttu-id="3d80b-122">若新的次要複本設定為允許唯讀存取，則唯讀用戶端應用程式即可連接至該次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-122">Also, if the new secondary replica is configured to allow read-only access, read-only client applications can connect to it.</span></span> <span data-ttu-id="3d80b-123">如需用戶端如何連接到可用性群組的資訊，請參閱[可用性群組接聽程式、用戶端連線及應用程式容錯移轉 &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-123">For information about how clients connect to an availability group, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="3d80b-124">詞彙和定義</span><span class="sxs-lookup"><span data-stu-id="3d80b-124">Terms and Definitions</span></span>  
 <span data-ttu-id="3d80b-125">自動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-125">Automatic failover</span></span>  
 <span data-ttu-id="3d80b-126">在遺失主要複本時自動發生的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-126">A failover that occurs automatically on the loss of the primary replica.</span></span> <span data-ttu-id="3d80b-127">只有在使用設為 AUTOMATIC 的容錯移轉模式同時設定目前的主要複本和一個次要複本，且次要複本目前已同步處理時，才支援自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-127">Automatic failover is supported only when the current primary and one secondary replica are both configured with failover mode set to AUTOMATIC and the secondary replica currently synchronized.</span></span>  <span data-ttu-id="3d80b-128">如果主要或次要複本的容錯移轉模式為 MANUAL，則無法進行自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-128">If the failover mode of either the primary or secondary replica is MANUAL, automatic failover cannot occur.</span></span>  
  
 <span data-ttu-id="3d80b-129">已規劃的手動容錯移轉 (不會遺失資料)</span><span class="sxs-lookup"><span data-stu-id="3d80b-129">Planned manual failover (without data loss)</span></span>  
 <span data-ttu-id="3d80b-130">規劃的手動容錯移轉 (或「手動容錯移轉」) 通常是指資料庫管理員基於系統管理目的起始的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-130">Planned manual failover, or *manual failover*, is a failover that is initiated by a database administrator, typically, for administrative purposes.</span></span> <span data-ttu-id="3d80b-131">只有在主要複本和次要複本都設定成同步認可模式，而且次要複本目前已同步處理 (處於 SYNCHRONIZED 狀態) 時，才支援已規劃的手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-131">A planned manual failover is supported only if both the primary replica and secondary replica are configured for synchronous-commit mode and the secondary replica is currently synchronized (in the SYNCHRONIZED state).</span></span> <span data-ttu-id="3d80b-132">當目標次要複本已同步處理時，即使主要複本已經當機，手動容錯移轉 (不會遺失資料) 也是可能的，因為次要資料庫已做好容錯移轉的準備。</span><span class="sxs-lookup"><span data-stu-id="3d80b-132">When the target secondary replica is synchronized, manual failover (without data loss) is possible even if the primary replica has crashed because the secondary databases are ready for failover.</span></span> <span data-ttu-id="3d80b-133">資料庫管理員會手動起始手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-133">A database administrator manually initiates a manual failover.</span></span>  
  
 <span data-ttu-id="3d80b-134">強制容錯移轉 (可能會遺失資料)</span><span class="sxs-lookup"><span data-stu-id="3d80b-134">Forced failover (with possible data loss)</span></span>  
 <span data-ttu-id="3d80b-135">如果沒有次要複本與主要複本同步處理 (SYNCHRONIZED) 或主要複本未執行而且沒有任何次要複本已做好容錯移轉的準備，資料庫管理員可起始的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-135">A failover that can be initiated by a database administrator when no secondary replica is SYNCHRONIZED with the primary replica or the primary replica is not running and no secondary replica is failover ready.</span></span> <span data-ttu-id="3d80b-136">強制容錯移轉可能造成資料遺失，建議僅限用於災害復原。</span><span class="sxs-lookup"><span data-stu-id="3d80b-136">Forced failover risks possible data loss and is recommended strictly for disaster recovery.</span></span> <span data-ttu-id="3d80b-137">強制容錯移轉只能手動起始，因此視為一種強制手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-137">Forced failover is also known as forced manual failover because it can only be initiated manually.</span></span> <span data-ttu-id="3d80b-138">這是在同步認可的可用性模式下唯一支援的容錯移轉形式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-138">This is the only form of failover supported by in asynchronous-commit availability mode.</span></span>  
  
 [!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)]  
 <span data-ttu-id="3d80b-139">在特定可用性群組內，是指使用自動容錯移轉 (如果有的話) 設定成同步認可模式的一對可用性複本 (包括目前的主要複本)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-139">Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="3d80b-140">只有在次要複本目前與主要複本 SYNCHRONIZED 時，[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]才會生效。</span><span class="sxs-lookup"><span data-stu-id="3d80b-140">An[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)]  
 <span data-ttu-id="3d80b-141">在特定可用性群組內，是指設定成同步認可模式 (如果有) 的一組兩個或三個可用性複本 (包括目前的主要複本)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-141">Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3d80b-142">只有在次要複本設定成手動容錯移轉模式，而且至少一個次要複本目前與主要複本 SYNCHRONIZED 時， [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]才會生效。</span><span class="sxs-lookup"><span data-stu-id="3d80b-142">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]  
 <span data-ttu-id="3d80b-143">在給定的可用性群組中，其操作狀態目前 ONLINE (不管是可用性模式還是容錯移轉模式) 的這組全部的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-143">Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="3d80b-144">在目前沒有次要複本與主要複本 SYNCHRONIZED 時， [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]會變成相關。</span><span class="sxs-lookup"><span data-stu-id="3d80b-144">The [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
##  <a name="overview-of-failover"></a><a name="Overview"></a> <span data-ttu-id="3d80b-145">容錯移轉的概觀</span><span class="sxs-lookup"><span data-stu-id="3d80b-145">Overview of Failover</span></span>  
 <span data-ttu-id="3d80b-146">下表摘要說明不同可用性和容錯移轉模式下支援的容錯移轉形式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-146">The following table summarizes which forms of failover are supported under different availability and failover modes.</span></span> <span data-ttu-id="3d80b-147">對於每個配對，有效的可用性模式和容錯移轉模式是由主要複本模式與一個或多個次要複本模式的交集所決定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-147">For each pairing, the effective availability mode and failover mode is determined by the intersection of the modes of the primary replica plus the modes of one or more secondary replicas.</span></span>  
  
||<span data-ttu-id="3d80b-148">非同步認可模式</span><span class="sxs-lookup"><span data-stu-id="3d80b-148">Asynchronous-commit mode</span></span>|<span data-ttu-id="3d80b-149">包含手動容錯移轉模式的同步認可模式</span><span class="sxs-lookup"><span data-stu-id="3d80b-149">Synchronous-commit mode with manual-failover mode</span></span>|<span data-ttu-id="3d80b-150">包含自動容錯移轉模式的同步認可模式</span><span class="sxs-lookup"><span data-stu-id="3d80b-150">Synchronous-commit mode with automatic-failover mode</span></span>|  
|-|-------------------------------|---------------------------------------------------------|------------------------------------------------------------|  
|<span data-ttu-id="3d80b-151">自動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-151">Automatic failover</span></span>|<span data-ttu-id="3d80b-152">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-152">No</span></span>|<span data-ttu-id="3d80b-153">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-153">No</span></span>|<span data-ttu-id="3d80b-154">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-154">Yes</span></span>|  
|<span data-ttu-id="3d80b-155">已規劃的手動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-155">Planned manual failover</span></span>|<span data-ttu-id="3d80b-156">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-156">No</span></span>|<span data-ttu-id="3d80b-157">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-157">Yes</span></span>|<span data-ttu-id="3d80b-158">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-158">Yes</span></span>|  
|<span data-ttu-id="3d80b-159">強制容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-159">Forced failover</span></span>|<span data-ttu-id="3d80b-160">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-160">Yes</span></span>|<span data-ttu-id="3d80b-161">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-161">Yes</span></span>|<span data-ttu-id="3d80b-162">是的**<sup>\*</sup>**</span><span class="sxs-lookup"><span data-stu-id="3d80b-162">Yes**<sup>\*</sup>**</span></span>|  
  
 <span data-ttu-id="3d80b-163">**<sup>\*</sup>** 如果您在已同步處理的次要複本上發出強制容錯移轉命令，次要複本的行為會與手動容錯移轉相同。</span><span class="sxs-lookup"><span data-stu-id="3d80b-163">**<sup>\*</sup>**  If you issue a forced failover command on a synchronized secondary replica, the secondary replica behaves the same as for a manual failover.</span></span>  
  
 <span data-ttu-id="3d80b-164">在容錯移轉期間，資料庫無法使用的時間量將依容錯移轉的類型及其原因而定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-164">The amount of time that the database is unavailable during a failover depends on the type of failover and its cause.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3d80b-165">為了在容錯移轉之後支援用戶端連接，除了自主資料庫之外，在任何先前的主要資料庫上定義的登入和作業都必須在新的主要資料庫上手動重新建立。</span><span class="sxs-lookup"><span data-stu-id="3d80b-165">To support client connections after failover, except for contained databases, logins and jobs defined on any of the former primary databases must be manually recreated on the new primary database.</span></span> <span data-ttu-id="3d80b-166">如需詳細資訊，請參閱 [管理可用性群組之資料庫的登入及工作 &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-166">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
### <a name="failover-sets"></a><span data-ttu-id="3d80b-167">容錯移轉設定</span><span class="sxs-lookup"><span data-stu-id="3d80b-167">Failover Sets</span></span>  
 <span data-ttu-id="3d80b-168">由容錯移轉設定便能理解給定的可用性群組可能進行的容錯移轉形式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-168">The forms of failover that are possible for a given availability group can be understood in terms of failover sets.</span></span> <span data-ttu-id="3d80b-169">容錯移轉設定是由支援給定容錯移轉形式的主要複本與次要複本所組成，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d80b-169">A failover set consists of the primary replica and secondary replicas that support a given form of failover, as follows:</span></span>  
  
-   <span data-ttu-id="3d80b-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (選擇性)：** 在特定可用性群組內，是指使用自動容錯移轉 (如果有的話) 設定成同步認可模式的一對可用性複本 (包括目前的主要複本)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (optional):**  Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="3d80b-171">自動容錯移轉設定只有在次要複本目前與主要複本 SYNCHRONIZED 時才會生效。</span><span class="sxs-lookup"><span data-stu-id="3d80b-171">An automatic failover set takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="3d80b-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (選擇性)：** 在特定可用性群組內，是指設定成同步認可模式 (如果有) 的一組兩個或三個可用性複本 (包括目前的主要複本)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (optional):**  Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3d80b-173">同步認可容錯移轉設定只有在次要複本設定成手動容錯移轉模式，而且至少一個次要複本目前與主要複本 SYNCHRONIZED 時才會生效。</span><span class="sxs-lookup"><span data-stu-id="3d80b-173">A synchronous-commit failover set takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="3d80b-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]：** 在給定的可用性群組中，其操作狀態目前 ONLINE (不管是可用性模式還是容錯移轉模式) 的這組全部的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :**  Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="3d80b-175">完整容錯移轉設定會在次要複本目前與主要複本 SYNCHRONIZED 時變成相關。</span><span class="sxs-lookup"><span data-stu-id="3d80b-175">The entire failover set becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 <span data-ttu-id="3d80b-176">當使用自動容錯移轉將可用性複本設定成同步認可時，該可用性複本會變成 [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]的一部分。</span><span class="sxs-lookup"><span data-stu-id="3d80b-176">When you configure an availability replica as synchronous commit with automatic failover, the availability replica becomes part of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span></span> <span data-ttu-id="3d80b-177">不過，設定是否生效，取決於目前的主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-177">However whether the set takes effect depends the current primary.</span></span> <span data-ttu-id="3d80b-178">實際上在給定時間可能進行的容錯移轉形式取決於目前生效的容錯移轉設定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-178">The forms of failover that are actually possible at a given time depends on what failover sets are currently in effect.</span></span>  
  
 <span data-ttu-id="3d80b-179">例如，請考慮使用擁有四個可用性複本的可用性群組，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d80b-179">For example, consider an availability group that has four availability replicas, as follows:</span></span>  
  
|<span data-ttu-id="3d80b-180">複本</span><span class="sxs-lookup"><span data-stu-id="3d80b-180">Replica</span></span>|<span data-ttu-id="3d80b-181">可用性模式與容錯移轉模式設定</span><span class="sxs-lookup"><span data-stu-id="3d80b-181">Availability Mode and Failover Mode Settings</span></span>|  
|-------------|--------------------------------------------------|  
|<span data-ttu-id="3d80b-182">A</span><span class="sxs-lookup"><span data-stu-id="3d80b-182">A</span></span>|<span data-ttu-id="3d80b-183">包含自動容錯移轉的同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-183">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="3d80b-184">B</span><span class="sxs-lookup"><span data-stu-id="3d80b-184">B</span></span>|<span data-ttu-id="3d80b-185">包含自動容錯移轉的同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-185">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="3d80b-186">C</span><span class="sxs-lookup"><span data-stu-id="3d80b-186">C</span></span>|<span data-ttu-id="3d80b-187">僅包含已規劃的手動容錯移轉的同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-187">Synchronous commit with planned manual failover only</span></span>|  
|<span data-ttu-id="3d80b-188">D</span><span class="sxs-lookup"><span data-stu-id="3d80b-188">D</span></span>|<span data-ttu-id="3d80b-189">非同步認可 (僅包含強制容錯移轉)</span><span class="sxs-lookup"><span data-stu-id="3d80b-189">Asynchronous commit (with only forced failover)</span></span>|  
  
 <span data-ttu-id="3d80b-190">每個次要複本的容錯移轉行為取決於目前是主要複本的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-190">The failover behavior for each secondary replica depends on which availability replica is currently the primary replica.</span></span> <span data-ttu-id="3d80b-191">基本上，若是給定的次要複本，容錯移轉行為是最嚴重的目前給定主要複本案例。</span><span class="sxs-lookup"><span data-stu-id="3d80b-191">Basically, for a given secondary replica, the failover behavior is the worst case given the current primary replica.</span></span> <span data-ttu-id="3d80b-192">下圖說明次要複本的容錯移轉行為如何根據目前主要複本，以及它設定為非同步認可模式 (只使用強制容錯移轉) 或同步認可模式 (不論是否使用自動容錯移轉)，而有所不同。</span><span class="sxs-lookup"><span data-stu-id="3d80b-192">The following figure illustrates how the failover behavior of secondary replicas varies depending on the current primary replica, and whether it is configured for asynchronous-commit mode (with only forced failover) or synchronous-commit mode (with or without automatic failover).</span></span>  
  
 <span data-ttu-id="3d80b-193">![主要複本組態如何影響容錯移轉](../../media/aoag-failoversetexample.gif "主要複本組態如何影響容錯移轉")</span><span class="sxs-lookup"><span data-stu-id="3d80b-193">![How primary replica configuration affects failover](../../media/aoag-failoversetexample.gif "How primary replica configuration affects failover")</span></span>  
  
##  <a name="automatic-failover"></a><a name="AutomaticFailover"></a> <span data-ttu-id="3d80b-194">Automatic Failover</span><span class="sxs-lookup"><span data-stu-id="3d80b-194">Automatic Failover</span></span>  
 <span data-ttu-id="3d80b-195">自動容錯移轉會使合格的次要複本在主要複本變成無法使用之後，自動移轉到主要角色。</span><span class="sxs-lookup"><span data-stu-id="3d80b-195">An automatic failover causes a qualified secondary replica to automatically transition to the primary role after the primary replica becomes unavailable.</span></span> <span data-ttu-id="3d80b-196">當裝載主要複本的 WSFC 節點是裝載次要複本的本機節點時，最適合使用自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-196">Automatic failover is best suited when the WSFC node that hosts the primary replica is local to the node that hosts the secondary replica.</span></span> <span data-ttu-id="3d80b-197">這是因為資料同步處理在電腦之間有低度訊息延遲時效果最佳，而且因為用戶端連接可以保持本機狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-197">This is because data synchronization works best with low message latency between computers and because client connections can remain local.</span></span>  
  
  
###  <a name="conditions-required-for-an-automatic-failover"></a><a name="RequiredConditions"></a> <span data-ttu-id="3d80b-198">自動容錯移轉所需的條件</span><span class="sxs-lookup"><span data-stu-id="3d80b-198">Conditions Required for an Automatic Failover</span></span>  
 <span data-ttu-id="3d80b-199">只有在下列情況下，才會進行自動容錯移轉：</span><span class="sxs-lookup"><span data-stu-id="3d80b-199">Automatic failover occurs only under the following conditions:</span></span>  
  
-   <span data-ttu-id="3d80b-200">自動容錯移轉設定已存在。</span><span class="sxs-lookup"><span data-stu-id="3d80b-200">An automatic failover set exists.</span></span> <span data-ttu-id="3d80b-201">此設定是由一併設定成同步認可模式及 AUTOMATIC 容錯移轉的主要複本與次要複本所組成，後者稱為「自動容錯移轉目標」。</span><span class="sxs-lookup"><span data-stu-id="3d80b-201">This set consists of a primary replica and a secondary replica (the *automatic failover target*) that are both configured for synchronous-commit mode and set to AUTOMATIC failover.</span></span> <span data-ttu-id="3d80b-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920"  如果主要複本設為 MANUAL 容錯移轉，則即使次要複本是設為 AUTOMATIC 容錯移轉，也不會發生自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920"  If the primary replica is set MANUAL failover, automatic failover cannot occur, even if a secondary replica is set to AUTOMATIC failover.</span></span>  
  
     <span data-ttu-id="3d80b-203">如需詳細資訊，請參閱[可用性模式 &#40;AlwaysOn 可用性群組&#41;](availability-modes-always-on-availability-groups.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-203">For more information, see [Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="3d80b-204">自動容錯移轉目標的同步處理狀態良好 (這表示容錯移轉目標上的每一個次要資料庫會與其對應的主要資料庫同步處理)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-204">The automatic failover target has a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="3d80b-205">AlwaysOn 可用性群組正監視著自動容錯移轉設定中兩個複本的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="3d80b-205">AlwaysOn Availability Groups monitors the health of both replicas in an automatic failover set.</span></span> <span data-ttu-id="3d80b-206">如果任一複本失敗，可用性群組的健全狀態將設為 CRITICAL。</span><span class="sxs-lookup"><span data-stu-id="3d80b-206">If either replica fails, the availability group's health state is set to CRITICAL.</span></span> <span data-ttu-id="3d80b-207">如果次要複本失敗，則因自動容錯移轉目標已無法使用而不可能發生自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-207">If the secondary replica fails, automatic failover is not possible because the automatic failover target is unavailable.</span></span> <span data-ttu-id="3d80b-208">如果主要複本失敗，可用性群組便會容錯移轉至次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-208">If the primary replica fails, the availability group will fail over to the secondary replica.</span></span> <span data-ttu-id="3d80b-209">在原先的主要複本恢復上線之前，並無任何自動容錯移轉目標存在。</span><span class="sxs-lookup"><span data-stu-id="3d80b-209">Until the former primary replica comes online, no automatic failover target exists.</span></span> <span data-ttu-id="3d80b-210">不論是哪一種情況，為確保罕見地發生相繼失敗時仍能維持可用性，建議您設定另一個次要複本做為自動容錯移轉目標。</span><span class="sxs-lookup"><span data-stu-id="3d80b-210">In either case, to ensure availability in the unlikely case of a sequential failure, we recommend that you configure a different secondary replica as the automatic failover target.</span></span>  
    >   
    >  <span data-ttu-id="3d80b-211">如需詳細資訊，請參閱[使用 AlwaysOn 原則檢視可用性群組的健全狀況 &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) 和[變更可用性複本的容錯移轉模式 &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-211">For more information, see [Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) and [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
-   <span data-ttu-id="3d80b-212">Windows Server 容錯移轉叢集 (WSFC) 叢集有仲裁。</span><span class="sxs-lookup"><span data-stu-id="3d80b-212">The Windows Server Failover Clustering (WSFC) cluster has quorum.</span></span> <span data-ttu-id="3d80b-213">如需詳細資訊，請參閱 [WSFC 仲裁模式和投票組態 &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-213">For more information, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
-   <span data-ttu-id="3d80b-214">主要複本已經變成無法使用，而且已經符合您靈活的容錯移轉原則所定義的容錯移轉條件層級。</span><span class="sxs-lookup"><span data-stu-id="3d80b-214">The primary replica has become unavailable, and the failover-condition levels defined by your the flexible failover policy have been met.</span></span> <span data-ttu-id="3d80b-215">如需容錯移轉條件層級的資訊，請參閱 [可用性群組自動容錯移轉的彈性容錯移轉原則 &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-215">For information about failover-condition levels, see [Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md).</span></span>  
  
###  <a name="how-automatic-failover-works"></a><a name="HowAutoFoWorks"></a> <span data-ttu-id="3d80b-216">自動容錯移轉如何運作</span><span class="sxs-lookup"><span data-stu-id="3d80b-216">How Automatic Failover Works</span></span>  
 <span data-ttu-id="3d80b-217">自動容錯移轉會起始下列動作順序：</span><span class="sxs-lookup"><span data-stu-id="3d80b-217">An automatic failover initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="3d80b-218">如果裝載目前主要複本的伺服器仍在執行，就會將主要資料庫的狀態變更為 DISCONNECTED，並中斷所有用戶端的連接。</span><span class="sxs-lookup"><span data-stu-id="3d80b-218">If the server instance that is hosting the current primary replica is still running, it changes the state of the primary databases to DISCONNECTED and disconnects all clients.</span></span>  
  
2.  <span data-ttu-id="3d80b-219">如果在目標次要複本的復原佇列中有任何記錄檔記錄正在等待，次要複本會套用其餘的記錄檔記錄以完成次要資料庫的向前復原。</span><span class="sxs-lookup"><span data-stu-id="3d80b-219">If any log records are waiting in recovery queues on the target secondary replica, the secondary replica applies the remaining log records to finish rolling forward the secondary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3d80b-220">將記錄套用到給定資料庫所需的時間量視系統的速度、最近的工作負載，以及復原佇列中的記錄量而定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-220">The amount of time required to apply the log to a given database depends on the speed of the system, the recent work load, and the amount of log in the recovery queue.</span></span>  
  
3.  <span data-ttu-id="3d80b-221">先前的次要複本會轉換成主要角色。</span><span class="sxs-lookup"><span data-stu-id="3d80b-221">The former secondary replica transitions to the primary role.</span></span> <span data-ttu-id="3d80b-222">其資料庫會變成主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-222">Its databases become the primary databases.</span></span> <span data-ttu-id="3d80b-223">新的主要複本會盡快回復任何未認可的交易 (復原的恢復階段)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-223">The new primary replica rolls back any uncommitted transactions (the undo phase of recovery) as quickly as possible.</span></span> <span data-ttu-id="3d80b-224">鎖定隔離這些未認可的交易，讓回復在用戶端使用資料庫時，在背景進行。</span><span class="sxs-lookup"><span data-stu-id="3d80b-224">Locks isolate these uncommitted transactions, allowing roll back to occur in the background while clients use the database.</span></span> <span data-ttu-id="3d80b-225">此程序不會回復任何未認可的交易。</span><span class="sxs-lookup"><span data-stu-id="3d80b-225">This process does not roll back any committed transactions.</span></span>  
  
     <span data-ttu-id="3d80b-226">在給定次要資料庫已連接之前，它會短暫標示為 NOT_SYNCHRONIZED。</span><span class="sxs-lookup"><span data-stu-id="3d80b-226">Until a given secondary database is connected, it is briefly marked as NOT_SYNCHRONIZED.</span></span> <span data-ttu-id="3d80b-227">在回復復原啟動之前，次要資料庫可以連接到新的主要資料庫並快速轉換成 SYNCHRONIZED 狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-227">Before the rollback recovery starts, secondary databases can connect to the new primary databases and quickly transition to the SYNCHRONIZED state.</span></span> <span data-ttu-id="3d80b-228">最佳案例通常是在容錯移轉後保持為次要角色的第三個同步認可複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-228">The best case is usually for a third synchronous-commit replica that remains in the secondary role after the failover.</span></span>  
  
4.  <span data-ttu-id="3d80b-229">之後，當裝載先前主要複本的伺服器執行個體重新啟動時，會辨識另一個可用性複本現在擁有主要角色。</span><span class="sxs-lookup"><span data-stu-id="3d80b-229">Later, when the server instance that is hosting the former primary replica restarts, it recognizes that another availability replica now owns the primary role.</span></span> <span data-ttu-id="3d80b-230">之前的主要複本會轉換到次要角色，且其資料庫會變成次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-230">The former primary replica transitions to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="3d80b-231">新的次要複本會連接至目前的主要複本，並盡快讓其資料庫趕上目前的主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-231">The new secondary replica connects to the current primary replica and catches its database up to the current primary databases as quickly as possible.</span></span> <span data-ttu-id="3d80b-232">只要新的次要複本重新同步處理其資料庫後，就可以再次容錯移轉，但是方向會相反。</span><span class="sxs-lookup"><span data-stu-id="3d80b-232">As soon as the new secondary replica has resynchronized its databases, failover is again possible, in the reverse direction.</span></span>  
  
###  <a name="to-configure-automatic-failover"></a><a name="EnableAutoFo"></a> <span data-ttu-id="3d80b-233">若要設定自動容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-233">To Configure Automatic Failover</span></span>  
 <span data-ttu-id="3d80b-234">可用性複本可以設定成在任何時間都支援自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-234">An availability replica can be configured to support automatic failover at any point.</span></span>  
  
 <span data-ttu-id="3d80b-235">**若要設定自動容錯移轉**</span><span class="sxs-lookup"><span data-stu-id="3d80b-235">**To configure automatic failover**</span></span>  
  
1.  <span data-ttu-id="3d80b-236">請確認次要複本設定為使用同步認可的可用性模式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-236">Ensure that the secondary replica is configured to use the synchronous-commit availability mode.</span></span> <span data-ttu-id="3d80b-237">如需詳細資訊，請參閱 [變更可用性複本的可用性模式 &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-237">For more information, see [Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="3d80b-238">將容錯移轉模式設定為自動。</span><span class="sxs-lookup"><span data-stu-id="3d80b-238">Set the failover mode to automatic.</span></span> <span data-ttu-id="3d80b-239">如需詳細資訊，請參閱 [變更可用性複本的容錯移轉模式 &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-239">For more information, see [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="3d80b-240">(選擇性) 變更可用性群組的靈活容錯移轉原則，指定可造成自動容錯移轉的各種失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="3d80b-240">Optionally, change the flexible failover policy of the availability group to specify the sorts of failures that can cause an automatic failover to occur.</span></span> <span data-ttu-id="3d80b-241">如需詳細資訊，請參閱[設定彈性容錯移轉原則以控制自動容錯移轉的條件 &#40;AlwaysOn 可用性群組&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce" 和[容錯移轉叢集執行個體的容錯移轉原則](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-241">For more information, see [Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce"  and [Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span></span>  
  
##  <a name="planned-manual-failover-without-data-loss"></a><a name="ManualFailover"></a> <span data-ttu-id="3d80b-242">已規劃的手動容錯移轉 (不會遺失資料)</span><span class="sxs-lookup"><span data-stu-id="3d80b-242">Planned Manual Failover (Without Data Loss)</span></span>  
 <span data-ttu-id="3d80b-243">在資料庫管理員在裝載目標次要複本的伺服器執行個體上發出手動容錯移轉命令之後，手動容錯移轉會使同步處理的次要複本轉換成主要角色。</span><span class="sxs-lookup"><span data-stu-id="3d80b-243">A manual failover causes a synchronized secondary replica to transition to the primary role after a database administrator issues a manual-failover command on the server instance that hosts the target secondary replica.</span></span> <span data-ttu-id="3d80b-244">為支援手動容錯移轉，次要複本和目前的主要複本 (如果有) 都必須設定成同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-244">To support manual failover, the secondary replica and the current primary replica must both be configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="3d80b-245">可用性複本上的每個次要資料庫都必須聯結至可用性群組，並與其對應的主要資料庫進行同步處理 (亦即，次要複本必須已經同步處理)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-245">Every secondary database on the availability replica must be joined to the availability group and synchronized with its corresponding primary database (that is, the secondary replica must be synchronized).</span></span> <span data-ttu-id="3d80b-246">這可確保在先前主要資料庫上認可的每個交易也已經在新的主要資料庫上認可。</span><span class="sxs-lookup"><span data-stu-id="3d80b-246">This guarantees that every transaction that was committed on a former primary database has also been committed on the new primary database.</span></span> <span data-ttu-id="3d80b-247">因此，新的主要資料庫與舊的主要資料庫相同。</span><span class="sxs-lookup"><span data-stu-id="3d80b-247">Therefore, the new primary databases are identical to the old primary databases.</span></span>  
  
 <span data-ttu-id="3d80b-248">下圖說明已規劃的容錯移轉階段：</span><span class="sxs-lookup"><span data-stu-id="3d80b-248">The following figure illustrates the stages of a planned failover:</span></span>  
  
1.  <span data-ttu-id="3d80b-249">在容錯移轉之前，主要複本是由 `Node01`上的伺服器執行個體裝載。</span><span class="sxs-lookup"><span data-stu-id="3d80b-249">Before the failover, the primary replica is hosted by the server instance on `Node01`.</span></span>  
  
2.  <span data-ttu-id="3d80b-250">資料庫管理員會起始已規劃的容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-250">A database administrator initiates a planned failover.</span></span> <span data-ttu-id="3d80b-251">容錯移轉目標是由 `Node02`上的伺服器執行個體所裝載的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-251">The failover target is the availability replica hosted by the server instance on `Node02`.</span></span>  
  
3.  <span data-ttu-id="3d80b-252">容錯移轉目標 (位於 `Node02`) 將成為新的主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-252">The failover target (on `Node02`) becomes the new primary replica.</span></span> <span data-ttu-id="3d80b-253">因為這是已規劃的容錯移轉，之前的主要複本會在容錯移轉期間切換為次要角色，而且會立即使其資料庫變成線上狀態以做為次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-253">Because this is a planned failover, the former primary replica switches to the secondary role during the failover and brings its databases online as secondary databases immediately.</span></span>  
  
 <span data-ttu-id="3d80b-254">![已規劃的手動容錯移轉圖例](../../media/aoag-plannedmanualfailover.gif "已規劃的手動容錯移轉圖例")</span><span class="sxs-lookup"><span data-stu-id="3d80b-254">![Illustation of a planned manual failover](../../media/aoag-plannedmanualfailover.gif "Illustation of a planned manual failover")</span></span>  
  
  
###  <a name="conditions-required-for-a-manual-failover"></a><a name="ManualFailoverConditions"></a> <span data-ttu-id="3d80b-255">手動容錯移轉所需的條件</span><span class="sxs-lookup"><span data-stu-id="3d80b-255">Conditions Required for a Manual Failover</span></span>  
 <span data-ttu-id="3d80b-256">為支援手動容錯移轉，目前的主要複本必須設定成同步認可模式，而且次要複本必須：</span><span class="sxs-lookup"><span data-stu-id="3d80b-256">To support a manual failover, the current primary replica must be set to synchronous-commit mode and a secondary replica must be:</span></span>  
  
-   <span data-ttu-id="3d80b-257">設定成同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="3d80b-257">Configured for synchronous-commit mode.</span></span>  
  
-   <span data-ttu-id="3d80b-258">目前與主要複本同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d80b-258">Currently synchronized with the primary replica.</span></span>  
  
 <span data-ttu-id="3d80b-259">若要手動容錯移轉可用性群組，您必須連接至即將成為新主要複本的次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-259">To manually fail over an availability group, you must be connected to the secondary replica that is to become the new primary replica.</span></span>  
  
###  <a name="how-a-planned-manual-failover-works"></a><a name="ManualFailoverHowWorks"></a> <span data-ttu-id="3d80b-260">規劃的手動容錯移轉如何運作</span><span class="sxs-lookup"><span data-stu-id="3d80b-260">How a Planned Manual Failover Works</span></span>  
 <span data-ttu-id="3d80b-261">規劃的手動容錯移轉必須在目標次要複本上起始，會起始下列動作順序：</span><span class="sxs-lookup"><span data-stu-id="3d80b-261">A planned manual failover, which must be initiated on the target secondary replica, initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="3d80b-262">為確保在原始的主要資料庫上不會發生任何新的使用者交易，WSFC 叢集會將要求傳送到主要複本以便離線。</span><span class="sxs-lookup"><span data-stu-id="3d80b-262">To ensure that no new user transactions occur on the original primary databases, the WSFC cluster sends a request to the primary replica to go offline.</span></span>  
  
2.  <span data-ttu-id="3d80b-263">如果在任何次要資料庫的復原佇列中有任何記錄正在等待，次要複本會完成該次要資料庫的向前復原。</span><span class="sxs-lookup"><span data-stu-id="3d80b-263">If any log is waiting in the recovery queue of any secondary database, the secondary replica finishes rolling forward that secondary database.</span></span> <span data-ttu-id="3d80b-264">所需時間取決於系統的速度、最近的工作負載，以及復原佇列中的記錄量。</span><span class="sxs-lookup"><span data-stu-id="3d80b-264">The amount of time required depends on the speed of the system, the recent workload, and the amount of log in the recovery queue.</span></span> <span data-ttu-id="3d80b-265">若要了解復原佇列的目前大小，請使用 **Recovery Queue** 效能計數器。</span><span class="sxs-lookup"><span data-stu-id="3d80b-265">To learn the current size of the recovery queue, use the **Recovery Queue** performance counter.</span></span> <span data-ttu-id="3d80b-266">如需詳細資訊，請參閱 [SQL Server、資料庫複本](../../../relational-databases/performance-monitor/sql-server-database-replica.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-266">For more information, see [SQL Server, Database Replica](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3d80b-267">容錯移轉時間可以藉由限制復原佇列的大小來調節。</span><span class="sxs-lookup"><span data-stu-id="3d80b-267">The failover time can be regulated by limiting the size of the recovery queue.</span></span> <span data-ttu-id="3d80b-268">不過，這可能會造成主要複本變慢，以便次要複本能夠跟上。</span><span class="sxs-lookup"><span data-stu-id="3d80b-268">However, this can cause the primary replica to slow down to allow the secondary replica to keep up.</span></span>  
  
3.  <span data-ttu-id="3d80b-269">次要複本會變成新的主要複本，而且先前的主要複本會變成新的次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-269">The secondary replica becomes the new primary replica, and the former primary replica becomes the new secondary replica.</span></span>  
  
4.  <span data-ttu-id="3d80b-270">新的主要複本會回復任何未認可的交易，並使其資料庫變成與主要資料庫相同的線上狀態。所有次要資料庫都會短暫標示為 NOT SYNCHRONIZED，直到這些資料庫連接並重新與新的主要資料庫同步處理為止。</span><span class="sxs-lookup"><span data-stu-id="3d80b-270">The new primary replica rolls back any uncommitted transactions and brings its databases online as the primary databases.All secondary databases are briefly marked as NOT SYNCHRONIZED until they connect and resynchronize to the new primary databases.</span></span> <span data-ttu-id="3d80b-271">此程序不會回復任何未認可的交易。</span><span class="sxs-lookup"><span data-stu-id="3d80b-271">This process does not roll back any committed transactions.</span></span>  
  
5.  <span data-ttu-id="3d80b-272">當先前的主要複本回到線上時，會擔任次要角色，而且先前的主要資料庫會變成次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-272">When the former primary replica comes back online, it takes on the secondary role, and the former primary database becomes the secondary database.</span></span> <span data-ttu-id="3d80b-273">新的次要複本會將新的次要資料庫快速與對應的主要資料庫重新同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d80b-273">The new secondary replica quickly resynchronizes the new secondary databases with the corresponding primary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="3d80b-274">只要新的次要複本重新同步處理資料庫後，就可以再次容錯移轉，但是方向會相反。</span><span class="sxs-lookup"><span data-stu-id="3d80b-274">As soon as the new secondary replica has resynchronized the databases, failover is again possible, but in the reverse direction.</span></span>  
  
 <span data-ttu-id="3d80b-275">容錯移轉之後，用戶端必須重新連接到目前的主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-275">After failover, clients must reconnect to the current primary database.</span></span> <span data-ttu-id="3d80b-276">如需詳細資訊，請參閱[可用性群組接聽程式、用戶端連接性及應用程式容錯移轉 &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-276">For more information, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
###  <a name="maintaining-availability-during-upgrades"></a><a name="ManualFailoverDuringUpgrades"></a> <span data-ttu-id="3d80b-277">維護升級期間的可用性</span><span class="sxs-lookup"><span data-stu-id="3d80b-277">Maintaining Availability During Upgrades</span></span>  
 <span data-ttu-id="3d80b-278">升級硬體或軟體時，可用性群組的資料庫管理員可以使用手動容錯移轉維護資料庫可用性。</span><span class="sxs-lookup"><span data-stu-id="3d80b-278">The database administrator for your availability groups can use manual failovers to maintain database availability when you upgrade hardware or software.</span></span> <span data-ttu-id="3d80b-279">若要使用可用性群組進行軟體升級，裝載目標次要複本的伺服器執行個體和/或電腦節點必須已經獲得升級。</span><span class="sxs-lookup"><span data-stu-id="3d80b-279">To use an availability group for software upgrades, the server instance and/or computer node that hosts the target secondary replica must have already received the upgrades.</span></span> <span data-ttu-id="3d80b-280">如需詳細資訊，請參閱 [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-280">For more information, see [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span></span>  
  
##  <a name="forced-failover-with-possible-data-loss"></a><a name="ForcedFailover"></a> <span data-ttu-id="3d80b-281">強制容錯移轉 (可能會遺失資料)</span><span class="sxs-lookup"><span data-stu-id="3d80b-281">Forced Failover (with Possible Data Loss)</span></span>  
 <span data-ttu-id="3d80b-282">強制可用性群組容錯移轉 (可能會遺失資料) 是可將次要複本當做暖待命伺服器使用的災害復原方法。由於強制容錯移轉會面臨可能遺失資料的風險，所以應該小心並謹慎使用。</span><span class="sxs-lookup"><span data-stu-id="3d80b-282">Forcing failover of an availability group (with possible data loss) is a disaster recovery method that allows you to use a secondary replica as a warm standby server.Because forcing failover risks possible data loss, it should be used cautiously and sparingly.</span></span> <span data-ttu-id="3d80b-283">只有在您必須立即還原可用性資料庫的服務，並且願意承擔遺失資料的風險時，才建議使用強制容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3d80b-283">We recommend forcing failover only if you must restore service to your availability databases immediately and are willing to risk losing data.</span></span> <span data-ttu-id="3d80b-284">如需強制容錯移轉之必要條件和建議的詳細資訊，以及使用強制容錯移轉從重大錯誤復原的範例案例，請參閱 [執行可用性群組的強制手動容錯移轉 &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-284">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="3d80b-285">強制容錯移轉需要 WSFC 叢集有仲裁。</span><span class="sxs-lookup"><span data-stu-id="3d80b-285">Forcing failover requires that the WSFC cluster have quorum.</span></span> <span data-ttu-id="3d80b-286">如需設定仲裁和強制仲裁的資訊，請參閱 [SQL Server 的 Windows Server 容錯移轉叢集 &#40;WSFC&#41;](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-286">For information about configuring quorum and forcing quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
  
###  <a name="how-forced-failover-works"></a><a name="ForcedFailoverHowWorks"></a> <span data-ttu-id="3d80b-287">強制容錯移轉如何運作</span><span class="sxs-lookup"><span data-stu-id="3d80b-287">How Forced Failover Works</span></span>  
 <span data-ttu-id="3d80b-288">強制容錯移轉會起始將主要角色轉換到角色處於 SECONDARY 或 RESOLVING 狀態的目標複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-288">Forcing failover initiates a transition of the primary role to a target replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="3d80b-289">容錯移轉目標會變成新的主要複本，並且立刻將它的資料庫複本提供給用戶端使用。</span><span class="sxs-lookup"><span data-stu-id="3d80b-289">The failover target becomes the new primary replica and immediately serves its copies of the databases to clients.</span></span> <span data-ttu-id="3d80b-290">當之前的主要複本變成可用複本時，會轉換到次要角色，且其資料庫會變成次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-290">When the former primary replica becomes available, it will transition to the secondary role and its databases will become secondary databases.</span></span>  
  
 <span data-ttu-id="3d80b-291">所有次要資料庫 (包括先前的主要資料庫 (當它們變成可用時)) 都處於 SUSPENDED 狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-291">All secondary databases (including the former primary databases, when they become available) are SUSPENDED.</span></span> <span data-ttu-id="3d80b-292">根據已暫停之次要資料庫先前的資料同步處理狀態，它可能適用於搶救該主要資料庫遺失的認可資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-292">Depending on the previous data synchronization state of a suspended secondary database, it might be suitable for salvaging missing committed data for that primary database.</span></span> <span data-ttu-id="3d80b-293">在設定為唯讀存取的次要複本上，您可以查詢次要資料庫來手動探索遺失的資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-293">On a secondary replica that is configured for read-only access, you can query the secondary databases to manually discover missing data.</span></span> <span data-ttu-id="3d80b-294">然後您可以在新的主要資料庫上發出 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 陳述式，進行任何所需的變更。</span><span class="sxs-lookup"><span data-stu-id="3d80b-294">Then you can issue [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements on the new primary databases to make any necessary changes.</span></span>  
  
###  <a name="risks-of-forcing-failover"></a><a name="ForcedFailoverRisks"></a> <span data-ttu-id="3d80b-295">強制容錯移轉的風險</span><span class="sxs-lookup"><span data-stu-id="3d80b-295">Risks of Forcing Failover</span></span>  
 <span data-ttu-id="3d80b-296">您必須了解，強制容錯移轉可能會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-296">It is essential to understand that forcing failover can cause data loss.</span></span> <span data-ttu-id="3d80b-297">由於目標複本無法與主要複本進行通訊，因此無法保證兩個資料庫會同步處理，所以可能會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-297">Data loss is possible because the target replica cannot communicate with the primary replica and, therefore, cannot guarantee that the databases are synchronized.</span></span> <span data-ttu-id="3d80b-298">此外，強制容錯移轉會啟動新的復原分岔。</span><span class="sxs-lookup"><span data-stu-id="3d80b-298">Forcing failover starts a new recovery fork.</span></span> <span data-ttu-id="3d80b-299">由於原始的主要資料庫和次要資料庫位於不同的復原分岔，因此每個資料庫現在都包含其他資料庫沒有的資料：每個原始的主要資料庫包含尚未從傳送佇列傳送至先前次要資料庫的所有變更 (未傳送記錄)，而先前的次要資料庫則包含強制容錯移轉之後進行的所有變更。</span><span class="sxs-lookup"><span data-stu-id="3d80b-299">Because the original primary databases and secondary databases are on different recovery forks, each of them now contains data that the other database does not contain: each original primary database contains whatever changes were not yet sent from its send queue to the former secondary database (the unsent log); the former secondary databases contain whatever changes occur after failover was forced.</span></span>  
  
 <span data-ttu-id="3d80b-300">如果因為主要複本失敗而進行強制容錯移轉，潛在資料遺失就會根據失敗之前是否有任何交易記錄未傳送至次要複本而定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-300">If failover is forced because the primary replica has failed, potential data loss is depends on whether any transaction logs had not been sent to the secondary replica before the failure.</span></span> <span data-ttu-id="3d80b-301">在非同步認可模式下，累積未傳送的記錄永遠是可能的。</span><span class="sxs-lookup"><span data-stu-id="3d80b-301">Under the asynchronous-commit mode, accumulated unsent log is always a possibility.</span></span> <span data-ttu-id="3d80b-302">在同步認可模式下，只有在次要資料庫同步處理後才會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="3d80b-302">Under synchronous-commit mode, this is possible only until the secondary databases becomes synchronized.</span></span>  
  
 <span data-ttu-id="3d80b-303">下表摘要說明在強制容錯移轉的目標複本上特定資料庫遺失資料的可能性。</span><span class="sxs-lookup"><span data-stu-id="3d80b-303">The following table summarizes the possibility of data loss for a particular database on the replica to which you force failover.</span></span>  
  
|<span data-ttu-id="3d80b-304">次要複本的可用性模式</span><span class="sxs-lookup"><span data-stu-id="3d80b-304">Availability mode of Secondary Replica</span></span>|<span data-ttu-id="3d80b-305">資料庫已同步處理？</span><span class="sxs-lookup"><span data-stu-id="3d80b-305">Is database synchronized?</span></span>|<span data-ttu-id="3d80b-306">可能會遺失資料？</span><span class="sxs-lookup"><span data-stu-id="3d80b-306">Is data loss possible?</span></span>|  
|--------------------------------------------|-------------------------------|----------------------------|  
|<span data-ttu-id="3d80b-307">同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-307">Synchronous-commit</span></span>|<span data-ttu-id="3d80b-308">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-308">Yes</span></span>|<span data-ttu-id="3d80b-309">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-309">No</span></span>|  
|<span data-ttu-id="3d80b-310">同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-310">Synchronous-commit</span></span>|<span data-ttu-id="3d80b-311">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-311">No</span></span>|<span data-ttu-id="3d80b-312">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-312">Yes</span></span>|  
|<span data-ttu-id="3d80b-313">非同步認可</span><span class="sxs-lookup"><span data-stu-id="3d80b-313">Asynchronous-commit</span></span>|<span data-ttu-id="3d80b-314">否</span><span class="sxs-lookup"><span data-stu-id="3d80b-314">No</span></span>|<span data-ttu-id="3d80b-315">是</span><span class="sxs-lookup"><span data-stu-id="3d80b-315">Yes</span></span>|  
||||  
  
 <span data-ttu-id="3d80b-316">次要資料庫僅追蹤兩個復原分岔，因此，如果您執行多個強制容錯移轉，沒有開始與先前的強制容錯移轉同步處理的所有次要資料庫可能都無法繼續。</span><span class="sxs-lookup"><span data-stu-id="3d80b-316">Secondary databases track only two recovery forks, so if you perform multiple forced failovers, any secondary database that did start data synchronization with the previous force failover might not be able to resume.</span></span> <span data-ttu-id="3d80b-317">如果發生這個情況，無法繼續的任何次要資料庫必須從可用性群組移除，還原到正確的時間點，然後重新聯結至可用性群組。</span><span class="sxs-lookup"><span data-stu-id="3d80b-317">If this occurs, any secondary databases that cannot be resumed will need to be removed from the availability group, restored to the correct point in time, and rejoined to the availability group.</span></span> <span data-ttu-id="3d80b-318">還原無法跨多個復原分岔運作，因此在執行一個以上的強制容錯移轉之後，務必執行記錄備份。</span><span class="sxs-lookup"><span data-stu-id="3d80b-318">A restore will not work across multiple recovery forks, therefore, be sure to perform a log backup after performing more than one forced failover.</span></span>  
  
###  <a name="why-forced-failover-is-required-after-forcing-quorum"></a><a name="WhyFFoPostForcedQuorum"></a> <span data-ttu-id="3d80b-319">為什麼在強制仲裁之後需要強制容錯移轉</span><span class="sxs-lookup"><span data-stu-id="3d80b-319">Why Forced Failover is Required After Forcing Quorum</span></span>  
 <span data-ttu-id="3d80b-320">在 WSFC 叢集上強制進行仲裁之後 (「強制仲裁」)，您需要在每個可用性群組上執行強制容錯移轉 (可能會遺失資料)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-320">After quorum is forced on the WSFC cluster (*forced quorum*) you need to perform a forced failover (with possible data loss) on each availability group.</span></span> <span data-ttu-id="3d80b-321">強制容錯移轉是必要的，因為 WSFC 叢集值的實際狀態可能已遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-321">The forced failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="3d80b-322">必須避免在強制仲裁之後進行正常容錯移轉，因為未同步處理的次要複本有可能像是已在重新設定的 WSFC 叢集上同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d80b-322">Preventing normal failovers after a forced quorum is required because of the possibility than an unsynchronized secondary replica would appear to be synchronized on the reconfigured WSFC cluster.</span></span>  
  
 <span data-ttu-id="3d80b-323">例如，假設有一個 WSFC 叢集在三個節點上裝載可用性群組：節點 A 裝載主要複本、節點 B 和節點 C 各裝載次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-323">For example, consider a WSFC cluster that hosts an availability group on three nodes:  Node A hosts the primary replica and Node B and Node C each hosts a secondary replica.</span></span> <span data-ttu-id="3d80b-324">當本機次要複本同步處理 (SYNCHRONIZED) 時，節點 C 會中斷與 WSFC 叢集的連接。</span><span class="sxs-lookup"><span data-stu-id="3d80b-324">Node C gets disconnected from the WSFC cluster while the local secondary replica is SYNCHRONIZED.</span></span>  <span data-ttu-id="3d80b-325">但是，節點 A 和節點 B 都會保留狀況良好的仲裁，而且可用性群組依然在線上。</span><span class="sxs-lookup"><span data-stu-id="3d80b-325">But Node A and Node B retain a healthy quorum and the availability group remains online.</span></span> <span data-ttu-id="3d80b-326">在節點 A 上，主要複本會繼續接受更新，而在節點 B 上，次要複本會繼續與主要複本同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d80b-326">On Node A, the primary replica continues to accept updates, and on Node B, the secondary replica continues to synchronize with the primary replica.</span></span> <span data-ttu-id="3d80b-327">節點 C 上的次要複本會變成未同步處理的狀態，而且越來越落後主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-327">The secondary replica on Node C becomes unsynchronized and falls increasingly behind the primary replica.</span></span> <span data-ttu-id="3d80b-328">不過，因為節點 C 已中斷連接，因此複本依然錯誤地處於 SYNCHRONIZED 狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-328">However, because Node C is disconnected, the replica remains, incorrectly, in the SYNCHRONIZED state.</span></span>  
  
 <span data-ttu-id="3d80b-329">如果遺失仲裁然後在節點 A 上強制仲裁，WSFC 叢集上可用性群組的同步處理狀態應該是正確的，而節點 C 上的次要複本則顯示為 UNSYNCHRONIZED 的狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-329">If quorum is lost and is then forced on Node A, the synchronization state of the availability group on the WSFC cluster should be correct-with the secondary replica on Node C shown as UNSYNCHRONIZED.</span></span> <span data-ttu-id="3d80b-330">不過，如果在節點 C 上強制仲裁，可用性群組的同步處理會不正確。</span><span class="sxs-lookup"><span data-stu-id="3d80b-330">However, if quorum is forced on Node C, the synchronization of the availability group will be incorrect.</span></span> <span data-ttu-id="3d80b-331">叢集上的同步處理狀態將會還原為節點 C 已中斷連接 (而且節點 C 上的次要複本「不正確地」顯示為 SYNCHRONIZED) 的狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-331">The synchronization state on the cluster will have reverted back to when Node C was disconnected-with the secondary replica on Node C *incorrectly* shown as SYNCHRONIZED.</span></span> <span data-ttu-id="3d80b-332">因為已規劃的手動容錯移轉會保證資料的安全，因此不允許它們在強制仲裁之後讓可用性群組恢復上線。</span><span class="sxs-lookup"><span data-stu-id="3d80b-332">Since planned manual failovers guarantee the safety of the data, they are disallowed for bring an availability group back online after quorum is forced.</span></span>  
  
###  <a name="tracking-potential-data-loss"></a><a name="TrackPotentialDataLoss"></a> <span data-ttu-id="3d80b-333">追蹤可能的資料遺失</span><span class="sxs-lookup"><span data-stu-id="3d80b-333">Tracking Potential Data Loss</span></span>  
 <span data-ttu-id="3d80b-334">當 WSFC 叢集有狀況良好的仲裁時，您可以評估目前資料庫上發生資料遺失的可能性。</span><span class="sxs-lookup"><span data-stu-id="3d80b-334">When the WSFC cluster has a healthy quorum, you can estimate the current potential for data loss on databases.</span></span> <span data-ttu-id="3d80b-335">如果是給定的次要複本，目前資料遺失的可能性取決於本機次要資料庫落後於對應的主要資料庫的程度。</span><span class="sxs-lookup"><span data-stu-id="3d80b-335">For a given secondary replica, the current potential for data loss depends on how far the local secondary databases are lagging behind the corresponding primary databases.</span></span> <span data-ttu-id="3d80b-336">因為落後的程度會隨時間而不同，我們建議您定期追蹤未同步處理之次要資料庫的潛在資料遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-336">Because the amount of lag varies over time, we recommend that you periodically track potential data loss for your unsynchronized secondary databases.</span></span> <span data-ttu-id="3d80b-337">追蹤落後程度牽涉到針對每個主要資料庫及其次要資料庫比較上次認可 LSN 和上次認可時間，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d80b-337">Tracking lag involves comparing the Last Commit LSN and Last Commit Time for each primary database and its secondary databases, as follows:</span></span>  
  
1.  <span data-ttu-id="3d80b-338">連接到主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-338">Connect to the primary replica.</span></span>  
  
2.  <span data-ttu-id="3d80b-339">查詢 `last_commit_lsn` 上一次認可交易) 的 (LSN，以及 `last_commit_time` [dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)動態管理檢視的最後一次認可) 資料行的 (時間。</span><span class="sxs-lookup"><span data-stu-id="3d80b-339">Query the `last_commit_lsn` (LSN of the last committed transaction) and `last_commit_time` (time of the last commit) columns of the [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) dynamic management view.</span></span>  
  
3.  <span data-ttu-id="3d80b-340">比較每一個主要資料庫和其每個次要資料庫所傳回的值。</span><span class="sxs-lookup"><span data-stu-id="3d80b-340">Compare the values returned for each primary database and each of its secondary databases.</span></span> <span data-ttu-id="3d80b-341">兩者的上次認可 LSN 之間的差異表示落後的程度。</span><span class="sxs-lookup"><span data-stu-id="3d80b-341">The difference between their Last Commit LSNs indicate the amount of lag.</span></span>  
  
4.  <span data-ttu-id="3d80b-342">當一個資料庫或一組資料庫的落後程度超過給定期間的所需落後最大值時，您可以觸發警示。</span><span class="sxs-lookup"><span data-stu-id="3d80b-342">You can trigger an alert when the amount of lag on a database or set of databases exceeds your desired maximum lag for a given period of time.</span></span> <span data-ttu-id="3d80b-343">例如，可由每分鐘在每個主要資料庫上執行的作業來執行查詢。</span><span class="sxs-lookup"><span data-stu-id="3d80b-343">For example, the query can be run by a job that executes every minute on each primary database.</span></span> <span data-ttu-id="3d80b-344">如果主要資料庫及其任何次要資料庫之間的 `last_commit_time` 差異已經超過上一次執行作業之後的復原點目標 (RPO) (例如 5 分鐘)，則此作業可能會引發警示。</span><span class="sxs-lookup"><span data-stu-id="3d80b-344">If the difference between the `last_commit_time` of a primary database and any of its secondary databases has exceeded the recovery point objective (RPO) (for example, 5 minutes) since the last time the job executed, the job can raise an alert.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="3d80b-345">當 WSFC 叢集缺乏仲裁或已經強制仲裁時，`last_commit_lsn` 和 `last_commit_time` 為 NULL。</span><span class="sxs-lookup"><span data-stu-id="3d80b-345">When the WSFC cluster lacks quorum or quorum has been forced, `last_commit_lsn` and `last_commit_time` are NULL.</span></span> <span data-ttu-id="3d80b-346">如需如何在強制仲裁之後可能避免資料遺失的相關資訊，請參閱 [執行可用性群組的強制手動容錯移轉 &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)(Failover) 的程序中通常可以互換。</span><span class="sxs-lookup"><span data-stu-id="3d80b-346">For information about how you might be able to avoid data loss after you forced quorum, see "Potential Ways to Avoid Data Loss After Quorum is Forced" in [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
###  <a name="managing-the-potential-data-loss"></a><a name="ForcedFailoverManagingDataLoss"></a> <span data-ttu-id="3d80b-347">管理潛在資料遺失</span><span class="sxs-lookup"><span data-stu-id="3d80b-347">Managing the Potential Data Loss</span></span>  
 <span data-ttu-id="3d80b-348">強制容錯移轉之後，就會暫停所有次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-348">After failover is forced, all secondary databases are suspended.</span></span> <span data-ttu-id="3d80b-349">這包括舊的主要資料庫，在舊的主要複本再次上線之後會發現它現在是次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-349">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="3d80b-350">您必須以手動方式在每個次要複本上個別繼續每個暫停的資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-350">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
 <span data-ttu-id="3d80b-351">一旦先前的主要複本可以使用，假設其資料庫未損毀，您就可以嘗試管理潛在資料遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-351">Once the former primary replica is available, assuming that its databases are undamaged, you can attempt to manage the potential data loss.</span></span> <span data-ttu-id="3d80b-352">管理潛在資料遺失的可用方法會根據原始的主要複本是否已連接至新的主要複本而定。</span><span class="sxs-lookup"><span data-stu-id="3d80b-352">The available approach for managing potential data loss depends on whether the original primary replica has connected to the new primary replica.</span></span> <span data-ttu-id="3d80b-353">假設原始的主要複本可以存取新的主要執行個體，就會自動且透明地進行重新連接。</span><span class="sxs-lookup"><span data-stu-id="3d80b-353">Assuming that the original primary replica can access the new primary instance, reconnecting occurs automatically and transparently.</span></span>  
  
#### <a name="the-original-primary-replica-has-reconnected"></a><span data-ttu-id="3d80b-354">原始的主要複本已重新連接</span><span class="sxs-lookup"><span data-stu-id="3d80b-354">The Original Primary Replica Has Reconnected</span></span>  
 <span data-ttu-id="3d80b-355">一般而言，在發生故障後，當原始的主要複本重新啟動時，它就會迅速重新連接至其夥伴。</span><span class="sxs-lookup"><span data-stu-id="3d80b-355">Typically, after a failure, when the original primary replica restarts it quickly reconnects to its partner.</span></span> <span data-ttu-id="3d80b-356">重新連接後，原始的主要複本會變成次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-356">On reconnecting, the original primary replica becomes the secondary replica.</span></span> <span data-ttu-id="3d80b-357">其資料庫會變成次要資料庫，並進入 SUSPENDED 狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-357">Its databases becomes the secondary databases and enter the SUSPENDED state.</span></span> <span data-ttu-id="3d80b-358">除非您繼續新的次要資料庫，否則它們不會回復。</span><span class="sxs-lookup"><span data-stu-id="3d80b-358">The new secondary databases will not be not rolled back unless you resume them.</span></span>  
  
 <span data-ttu-id="3d80b-359">不過，暫停的資料庫無法存取，因此您無法檢查這些資料庫來評估繼續給定資料庫時哪些資料會遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-359">However, the suspended databases are inaccessible, so you cannot inspect them to evaluate what data would be lost if you were to resume a given database.</span></span> <span data-ttu-id="3d80b-360">所以，要繼續還是移除次要資料庫的決定取決於您是否願意接受任何資料遺失，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3d80b-360">Therefore, the decision on whether to resume or remove a secondary database depends on whether you are willing to accept any data loss, as follows:</span></span>  
  
-   <span data-ttu-id="3d80b-361">如果您無法接受遺失任何資料，就應該從可用性群組移除資料庫以便搶救資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-361">If losing any data would be unacceptable, you should remove the databases from the availability group to salvage them.</span></span>  
  
     <span data-ttu-id="3d80b-362">資料庫管理員現在可以復原先前的主要資料庫，並嘗試復原已經遺失的資料。</span><span class="sxs-lookup"><span data-stu-id="3d80b-362">The database administrator can now recover the former primary databases and attempt to recover the data that would have been lost.</span></span> <span data-ttu-id="3d80b-363">不過，當先前的主要資料庫變成線上狀態時，該資料庫與目前的主要資料庫不同，因此，資料庫管理員需要讓用戶端無法存取移除的資料庫或目前的主要資料庫，以避免資料庫進一步的分歧，並防止用戶端容錯移轉問題。</span><span class="sxs-lookup"><span data-stu-id="3d80b-363">However, when a former primary database comes online, it is divergent from the current primary database, so the database administrator needs to make either the removed database or the current primary database inaccessible to clients to avoid further divergence of the databases and to prevent client-failover issues.</span></span>  
  
-   <span data-ttu-id="3d80b-364">如果您的商務目標接受遺失資料，可以繼續次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-364">If losing data would be acceptable to your business goals, you can resume the secondary databases.</span></span>  
  
     <span data-ttu-id="3d80b-365">繼續新的次要資料庫會使其回復至同步處理資料庫的第一個步驟。</span><span class="sxs-lookup"><span data-stu-id="3d80b-365">Resuming a new secondary database causes it to be rolled back as the first step in synchronizing the database.</span></span> <span data-ttu-id="3d80b-366">如果發生故障時，有任何記錄檔記錄正在傳送佇列中等候，就會遺失對應的交易，即使這些交易已認可也一樣。</span><span class="sxs-lookup"><span data-stu-id="3d80b-366">If any log records were waiting in the send queue at the time of failure, the corresponding transactions are lost, even if they were committed.</span></span>  
  
#### <a name="the-original-primary-replica-has-not-reconnected"></a><span data-ttu-id="3d80b-367">原始的主要複本尚未重新連接</span><span class="sxs-lookup"><span data-stu-id="3d80b-367">The Original Primary Replica Has Not Reconnected</span></span>  
 <span data-ttu-id="3d80b-368">如果您可以暫時防止原始的主要複本透過網路重新連接至新的主要複本，就可以檢查原始的主要資料庫，以便評估繼續進行時哪些資料會遺失。</span><span class="sxs-lookup"><span data-stu-id="3d80b-368">If you can temporarily prevent the original primary replica from reconnecting over the network to the new primary replica, you can inspect the original primary databases to evaluate what data would be lost if they were resumed.</span></span>  
  
-   <span data-ttu-id="3d80b-369">如果可以接受潛在資料遺失</span><span class="sxs-lookup"><span data-stu-id="3d80b-369">If the potential data loss is acceptable</span></span>  
  
     <span data-ttu-id="3d80b-370">允許原始的主要複本重新連接至新的主要複本。</span><span class="sxs-lookup"><span data-stu-id="3d80b-370">Allow the original primary replica to reconnect to the new primary replica.</span></span> <span data-ttu-id="3d80b-371">重新連接會導致新的次要資料庫暫停。</span><span class="sxs-lookup"><span data-stu-id="3d80b-371">Reconnecting causes the new secondary databases to be suspended.</span></span> <span data-ttu-id="3d80b-372">若要在資料庫上開始資料同步處理，只需繼續它。</span><span class="sxs-lookup"><span data-stu-id="3d80b-372">To start data synchronization on a database, simply resume it.</span></span> <span data-ttu-id="3d80b-373">新的次要複本會卸除該資料庫原始的復原分岔，並遺失從未傳送至先前次要複本或由先前次要複本接收的任何交易。</span><span class="sxs-lookup"><span data-stu-id="3d80b-373">The new secondary replica drops the original recovery fork for that database, losing any transactions that were never sent to or received by the former secondary replica.</span></span>  
  
-   <span data-ttu-id="3d80b-374">如果無法接受資料遺失</span><span class="sxs-lookup"><span data-stu-id="3d80b-374">If the data loss is unacceptable</span></span>  
  
     <span data-ttu-id="3d80b-375">如果原始的主要資料庫包含繼續暫停之資料庫後便會遺失的重要資料，您可以從可用性群組移除該資料庫，以便將這些資料保留在原始的主要資料庫上。</span><span class="sxs-lookup"><span data-stu-id="3d80b-375">If the original primary database contains critical data that would be lost if you resumed the suspended database, you can preserve the data on the original primary database by removing it from the availability group.</span></span> <span data-ttu-id="3d80b-376">這會使資料庫進入 RESTORING 狀態。</span><span class="sxs-lookup"><span data-stu-id="3d80b-376">This causes the database to enter the RESTORING state.</span></span> <span data-ttu-id="3d80b-377">此時，建議您嘗試備份移除之資料庫記錄的結尾。</span><span class="sxs-lookup"><span data-stu-id="3d80b-377">At this point, we recommend that you attempt to back up the tail of the removed database's log.</span></span> <span data-ttu-id="3d80b-378">接著，您可以從原始的主要資料庫匯出要搶救的資料，再將它匯入目前的主要資料庫中，以便更新目前的主要 (先前的次要資料庫)。</span><span class="sxs-lookup"><span data-stu-id="3d80b-378">Then, you can update the current primary (the former secondary database) by exporting the data you want to salvage from the original primary database and importing it into the current primary database.</span></span> <span data-ttu-id="3d80b-379">建議您儘快建立更新之主要資料庫的完整資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="3d80b-379">We recommend taking a full database backup of the updated primary database as quickly as possible.</span></span>  
  
     <span data-ttu-id="3d80b-380">然後，在裝載新次要複本的伺服器執行個體上，您可以刪除暫停的次要資料庫，然後使用 RESTORE WITH NORECOVERY 還原此備份 (以及至少一個後續的記錄備份) 以建立新的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="3d80b-380">Then, on the server instance that hosts the new secondary replica, you can delete the suspended secondary database and create a new secondary database by restoring this backup (and least one subsequent log backup) using RESTORE WITH NORECOVERY.</span></span> <span data-ttu-id="3d80b-381">建議在繼續對應的次要資料庫之前，延遲目前主要資料庫的其他記錄備份。</span><span class="sxs-lookup"><span data-stu-id="3d80b-381">We recommend delaying additional log backups of the current primary databases until the corresponding secondary databases are resumed.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="3d80b-382">只要有任何次要資料庫暫停，主要資料庫上的交易記錄截斷就會延遲。</span><span class="sxs-lookup"><span data-stu-id="3d80b-382">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="3d80b-383">另外，只要任何本機資料庫持續暫停狀態，同步認可次要複本的同步健全狀態就無法轉換成 HEALTHY。</span><span class="sxs-lookup"><span data-stu-id="3d80b-383">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="3d80b-384">相關工作</span><span class="sxs-lookup"><span data-stu-id="3d80b-384">Related Tasks</span></span>  
 <span data-ttu-id="3d80b-385">**若要設定容錯移轉行為**</span><span class="sxs-lookup"><span data-stu-id="3d80b-385">**To configure failover behavior**</span></span>  
  
-   [<span data-ttu-id="3d80b-386">變更可用性複本的可用性模式 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-386">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3d80b-387">變更可用性複本的容錯移轉模式 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-387">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3d80b-388">設定彈性容錯移轉原則，以控制自動容錯移轉 &#40;AlwaysOn 可用性群組的條件&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-388">Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;</span></span>](configure-flexible-automatic-failover-policy.md)  
  
 <span data-ttu-id="3d80b-389">**若要執行手動容錯移轉**</span><span class="sxs-lookup"><span data-stu-id="3d80b-389">**To perform a manual fail over**</span></span>  
  
-   [<span data-ttu-id="3d80b-390">執行可用性群組的已規劃手動容錯移轉 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-390">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="3d80b-391">執行可用性群組的強制手動容錯移轉 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-391">Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="3d80b-392">使用容錯移轉可用性群組精靈 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-392">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="3d80b-393">管理可用性群組之資料庫的登入及工作 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-393">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)  
  
 <span data-ttu-id="3d80b-394">**若要設定 WSFC 仲裁設定**</span><span class="sxs-lookup"><span data-stu-id="3d80b-394">**To configure WSFC Quorum Configuration**</span></span>  
  
-   [<span data-ttu-id="3d80b-395">設定叢集仲裁 NodeWeight 設定</span><span class="sxs-lookup"><span data-stu-id="3d80b-395">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="3d80b-396">檢視叢集仲裁 NodeWeight 設定</span><span class="sxs-lookup"><span data-stu-id="3d80b-396">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="3d80b-397">在無仲裁情況下強制啟動 WSFC 叢集</span><span class="sxs-lookup"><span data-stu-id="3d80b-397">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="3d80b-398">相關內容</span><span class="sxs-lookup"><span data-stu-id="3d80b-398">Related Content</span></span>  
  
-   [<span data-ttu-id="3d80b-399">Microsoft SQL Server AlwaysOn 高可用性和災害復原方案指南</span><span class="sxs-lookup"><span data-stu-id="3d80b-399">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="3d80b-400">SQL Server AlwaysOn 團隊部落格：官方 SQL Server AlwaysOn 團隊部落格</span><span class="sxs-lookup"><span data-stu-id="3d80b-400">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="3d80b-401">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3d80b-401">See Also</span></span>  
 <span data-ttu-id="3d80b-402">[AlwaysOn 可用性群組 &#40;SQL Server 的總覽&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3d80b-402">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="3d80b-403">[可用性模式 &#40;AlwaysOn 可用性群組&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="3d80b-403">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="3d80b-404">[SQL Server 的 Windows Server 容錯移轉叢集 &#40;WSFC&#41;](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3d80b-404">[Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span></span>  
 <span data-ttu-id="3d80b-405">[資料庫鏡像或 AlwaysOn 可用性群組 &#40;SQL Server 不支援跨資料庫交易&#41;](transactions-always-on-availability-and-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="3d80b-405">[Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span></span>  
 <span data-ttu-id="3d80b-406">[容錯移轉叢集執行個體的容錯移轉原則](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span><span class="sxs-lookup"><span data-stu-id="3d80b-406">[Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span></span>  
 [<span data-ttu-id="3d80b-407">可用性群組自動容錯移轉的彈性容錯移轉原則 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3d80b-407">Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;</span></span>](flexible-automatic-failover-policy-availability-group.md)  
  
  
