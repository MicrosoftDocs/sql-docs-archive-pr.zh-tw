---
title: 容錯移轉叢集和 AlwaysOn 可用性群組 (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- Availability Groups [SQL Server], WSFC clusters
- Failover Cluster Instances [SQL Server], see failover clustering [SQL Server]
- quorum [SQL Server]
- failover clustering [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], Failover Cluster Instances
ms.assetid: 613bfbf1-9958-477b-a6be-c6d4f18785c3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 64ee815c2b852849d9506ca6c3fc114d3d0e4935
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87595279"
---
# <a name="failover-clustering-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="6568e-102">容錯移轉叢集和 AlwaysOn 可用性群組 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="6568e-102">Failover Clustering and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="6568e-103">(也就是 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] 中所引進的高可用性和災害復原解決方案) 需要 Windows Server 容錯移轉叢集 (WSFC)。</span><span class="sxs-lookup"><span data-stu-id="6568e-103">, the high availability and disaster recovery solution introduced in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requires Windows Server Failover Clustering (WSFC).</span></span> <span data-ttu-id="6568e-104">此外，雖然 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 不依賴 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集，但是您可以使用容錯移轉叢集執行個體 (FCI) 來裝載可用性群組的可用性複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-104">Also, though [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is not dependent upon [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Clustering, you can use a failover clustering instance (FCI) to host an availability replica for an availability group.</span></span> <span data-ttu-id="6568e-105">請務必了解每個叢集技術的角色，也要知道設計您的 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 環境時所必須考量的事項。</span><span class="sxs-lookup"><span data-stu-id="6568e-105">It is important to know the role of each clustering technology, and to know what considerations are necessary as you design your [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] environment.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6568e-106">如需 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 概念的相關資訊，請參閱 [AlwaysOn 可用性群組概觀 &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="6568e-106">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] concepts, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>  
  

  
##  <a name="windows-server-failover-clustering-and-availability-groups"></a><a name="WSFC"></a><span data-ttu-id="6568e-107">Windows Server 容錯移轉叢集和可用性群組</span><span class="sxs-lookup"><span data-stu-id="6568e-107">Windows Server Failover Clustering and Availability Groups</span></span>  
 <span data-ttu-id="6568e-108">部署 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 需要一個 Windows Server 容錯移轉叢集 (WSFC) 叢集。</span><span class="sxs-lookup"><span data-stu-id="6568e-108">Deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="6568e-109">若要啟用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]， [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體必須位於 WSFC 節點上，而且 WSFC 叢集和節點必須在線上。</span><span class="sxs-lookup"><span data-stu-id="6568e-109">To be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must reside on a WSFC node, and the WSFC cluster and node must be online.</span></span> <span data-ttu-id="6568e-110">此外，給定可用性群組的每個可用性複本都必須位在相同 WSFC 叢集的不同節點上。</span><span class="sxs-lookup"><span data-stu-id="6568e-110">Furthermore, each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="6568e-111">唯一的例外狀況是在移轉至另一個 WSFC 叢集期間，可用性群組可以暫時跨兩個叢集。</span><span class="sxs-lookup"><span data-stu-id="6568e-111">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="6568e-112">依賴 Windows 容錯移轉叢集 (WSFC) 叢集來監視及管理屬於給定可用性群組之可用性複本的目前角色，並判斷容錯移轉事件對於可用性複本的影響程度。</span><span class="sxs-lookup"><span data-stu-id="6568e-112">relies on the Windows Failover Clustering (WSFC) cluster to monitor and manage the current roles of the availability replicas that belong to a given availability group and to determine how a failover event affects the availability replicas.</span></span> <span data-ttu-id="6568e-113">對於您建立的每個可用性群組，系統會建立一個 WSFC 資源群組。</span><span class="sxs-lookup"><span data-stu-id="6568e-113">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="6568e-114">WSFC 叢集會監視此資源群組，以評估主要複本的健康情況。</span><span class="sxs-lookup"><span data-stu-id="6568e-114">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  
  
 <span data-ttu-id="6568e-115">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 的仲裁會以 WSFC 叢集中的所有節點為基礎，而不論給定叢集節點是否裝載任何可用性複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-115">The quorum for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is based on all nodes in the WSFC cluster regardless of whether a given cluster node hosts any availability replicas.</span></span> <span data-ttu-id="6568e-116">相較於資料庫鏡像， [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]沒有見證角色。</span><span class="sxs-lookup"><span data-stu-id="6568e-116">In contrast to database mirroring, there is no witness role in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="6568e-117">WSFC 叢集的整體健全狀況是由叢集節點的仲裁投票所決定。</span><span class="sxs-lookup"><span data-stu-id="6568e-117">The overall health of a WSFC cluster is determined by the votes of quorum of nodes in the cluster.</span></span> <span data-ttu-id="6568e-118">如果 WSFC 叢集因為未規劃的災害或由於持續硬體或通訊失敗而離線，則需要手動管理介入。</span><span class="sxs-lookup"><span data-stu-id="6568e-118">If the WSFC cluster goes offline because of an unplanned disaster, or due to a persistent hardware or communications failure, manual administrative intervention is required.</span></span> <span data-ttu-id="6568e-119">Windows Server 或 WSFC 叢集管理員需要強制仲裁，然後使非容錯組態中的存活叢集節點恢復上線。</span><span class="sxs-lookup"><span data-stu-id="6568e-119">A Windows Server or WSFC cluster administrator will need to force a quorum and then bring the surviving cluster nodes back online in a non-fault-tolerant configuration.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="6568e-120">登錄機碼是 WSFC 叢集的子機碼。</span><span class="sxs-lookup"><span data-stu-id="6568e-120">registry keys are subkeys of the WSFC cluster.</span></span> <span data-ttu-id="6568e-121">如果您刪除然後重新建立 WSFC 叢集，則必須在原始 WSFC 叢集上裝載可用性複本的每個 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 執行個體，停用然後重新啟用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 功能。</span><span class="sxs-lookup"><span data-stu-id="6568e-121">If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosted an availability replica on the original WSFC cluster.</span></span>  
  
 <span data-ttu-id="6568e-122">如需在 Windows Server 容錯移轉叢集 (WSFC) 節點上執行 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 以及 WSFC 仲裁的資訊，請參閱 [SQL Server 的 Windows Server 容錯移轉叢集&#40;WSFC&#41; ](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="6568e-122">For information about running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on Windows Server Failover Clustering (WSFC) nodes and about WSFC quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
### <a name="cross-cluster-migration-of-alwayson-availability-groups-for-os-upgrade"></a><span data-ttu-id="6568e-123">針對作業系統升級進行 AlwaysOn 可用性群組的跨叢集移轉</span><span class="sxs-lookup"><span data-stu-id="6568e-123">Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade</span></span>  
 <span data-ttu-id="6568e-124">從 [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)]開始， [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 對於部署至新的 Windows Server 容錯移轉叢集 (WSFC) 叢集的情況，支援跨叢集移轉可用性群組。</span><span class="sxs-lookup"><span data-stu-id="6568e-124">Beginning with [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] supports cross-cluster migration of availability groups for deployments to a new Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="6568e-125">跨叢集移轉是指以最短的停機時間，將一個可用性群組或一批可用性群組移到新的目的地 WSFC 叢集。</span><span class="sxs-lookup"><span data-stu-id="6568e-125">A cross-cluster migration moves one availability group or a batch of availability groups to the new, destination WSFC cluster with minimal downtime.</span></span> <span data-ttu-id="6568e-126">跨叢集移轉程序可讓您在升級至 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] 叢集的同時，維護您的服務等級協定 (SLA)。</span><span class="sxs-lookup"><span data-stu-id="6568e-126">The cross-cluster migration process enables you to maintain your service level agreements (SLAs) when upgrading to a [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] cluster.</span></span> [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] <span data-ttu-id="6568e-127">(或更新版本) 必須針對目的地 WSFC 叢集上的 AlwaysOn 安裝及啟用。</span><span class="sxs-lookup"><span data-stu-id="6568e-127">(or a later version) must be installed and enabled for AlwaysOn on the destination WSFC cluster.</span></span> <span data-ttu-id="6568e-128">跨叢集移轉是否成功，取決於目的地 WSFC 叢集整套計畫和準備工作。</span><span class="sxs-lookup"><span data-stu-id="6568e-128">The success of a cross-cluster migration depends on thorough planning and preparation of the destination WSFC cluster.</span></span>  
  
 <span data-ttu-id="6568e-129">如需詳細資訊，請參閱[針對作業系統升級進行 AlwaysOn 可用性群組的跨叢集移轉](https://msdn.microsoft.com/library/jj873730.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6568e-129">For more information, see [Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade](https://msdn.microsoft.com/library/jj873730.aspx).</span></span>  
  
##  <a name="ssnoversion-failover-cluster-instances-fcis-and-availability-groups"></a><a name="SQLServerFC"></a> <span data-ttu-id="6568e-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體 (FCI) 和可用性群組</span><span class="sxs-lookup"><span data-stu-id="6568e-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster Instances (FCIs) and Availability Groups</span></span>  
 <span data-ttu-id="6568e-131">您可以藉由實作 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集連同 WSFC 叢集，在伺服器執行個體層級設定容錯移轉的第二層。</span><span class="sxs-lookup"><span data-stu-id="6568e-131">You can set up a second layer of failover at the server-instance level by implementing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering together with the WSFC cluster.</span></span> <span data-ttu-id="6568e-132">可用性複本可由 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 獨立執行個體或 FCI 執行個體所裝載。</span><span class="sxs-lookup"><span data-stu-id="6568e-132">An availability replica can be hosted by either a standalone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or an FCI instance.</span></span> <span data-ttu-id="6568e-133">只有一個 FCI 夥伴可以裝載給定可用性群組的複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-133">Only one FCI partner can host a replica for a given availability group.</span></span> <span data-ttu-id="6568e-134">在 FCI 上執行可用性複本時，可用性群組的可能擁有者清單只包含使用中 FCI 節點。</span><span class="sxs-lookup"><span data-stu-id="6568e-134">When an availability replica is running on an FCI, the possible owners list for the availability group will contain only the active FCI node.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="6568e-135">不依賴任何形式的共用儲存體。</span><span class="sxs-lookup"><span data-stu-id="6568e-135">does not depend on any form of shared storage.</span></span> <span data-ttu-id="6568e-136">不過，如果您使用 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體 (FCI) 來裝載一個或多個可用性複本，依照標準 SQL Server 容錯移轉叢集執行個體安裝，這些 FCI 都需要共用儲存體。</span><span class="sxs-lookup"><span data-stu-id="6568e-136">However, if you use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host one or more availability replicas, each of those FCIs will require shared storage as per standard SQL Server failover cluster instance installation.</span></span>  
  
 <span data-ttu-id="6568e-137">如需其他必要條件的詳細資訊，請參閱 [AlwaysOn 可用性群組的必要條件、限制和建議 &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) 的＜使用 SQL Server 容錯移轉叢集執行個體 (FCI) 裝載可用性複本的必要條件和限制＞一節。</span><span class="sxs-lookup"><span data-stu-id="6568e-137">For more information about additional prerequisites, see the "Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica" section of [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="comparison-of-failover-cluster-instances-and-availability-groups"></a><span data-ttu-id="6568e-138">容錯移轉叢集執行個體和可用性群組的比較</span><span class="sxs-lookup"><span data-stu-id="6568e-138">Comparison of Failover Cluster Instances and Availability Groups</span></span>  
 <span data-ttu-id="6568e-139">無論 FCI 中節點的數目有多少，整個 FCI 只能裝載可用性群組的單一複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-139">Regardless of the number of nodes in the FCI, an entire FCI hosts a single replica within an availability group.</span></span> <span data-ttu-id="6568e-140">下表描述 FCI 節點和可用性群組複本之間的概念差異。</span><span class="sxs-lookup"><span data-stu-id="6568e-140">The following table describes the distinctions in concepts between nodes in an FCI and replicas within an availability group.</span></span>  
  
||<span data-ttu-id="6568e-141">FCI 內的節點</span><span class="sxs-lookup"><span data-stu-id="6568e-141">Nodes within an FCI</span></span>|<span data-ttu-id="6568e-142">可用性群組內的複本</span><span class="sxs-lookup"><span data-stu-id="6568e-142">Replicas within an availability group</span></span>|  
|-|-------------------------|-------------------------------------------|  
|<span data-ttu-id="6568e-143">**使用 WSFC 叢集**</span><span class="sxs-lookup"><span data-stu-id="6568e-143">**Uses WSFC cluster**</span></span>|<span data-ttu-id="6568e-144">是</span><span class="sxs-lookup"><span data-stu-id="6568e-144">Yes</span></span>|<span data-ttu-id="6568e-145">是</span><span class="sxs-lookup"><span data-stu-id="6568e-145">Yes</span></span>|  
|<span data-ttu-id="6568e-146">**保護等級**</span><span class="sxs-lookup"><span data-stu-id="6568e-146">**Protection level**</span></span>|<span data-ttu-id="6568e-147">執行個體</span><span class="sxs-lookup"><span data-stu-id="6568e-147">Instance</span></span>|<span data-ttu-id="6568e-148">資料庫</span><span class="sxs-lookup"><span data-stu-id="6568e-148">Database</span></span>|  
|<span data-ttu-id="6568e-149">**儲存體類型**</span><span class="sxs-lookup"><span data-stu-id="6568e-149">**Storage type**</span></span>|<span data-ttu-id="6568e-150">共用</span><span class="sxs-lookup"><span data-stu-id="6568e-150">Shared</span></span>|<span data-ttu-id="6568e-151">非共用</span><span class="sxs-lookup"><span data-stu-id="6568e-151">Non-shared</span></span><br /><br /> <span data-ttu-id="6568e-152">請注意，雖然可用性群組中的複本不會共用儲存體，但是 FCI 裝載的複本會使用該 FCI 所需的共用儲存方案。</span><span class="sxs-lookup"><span data-stu-id="6568e-152">Note that while the replicas in an availability group do not share storage, a replica that is hosted by an FCI uses a shared storage solution as required by that FCI.</span></span> <span data-ttu-id="6568e-153">只有 FCI 內的節點共用儲存方案，可用性群組的複本之間不共用儲存方案。</span><span class="sxs-lookup"><span data-stu-id="6568e-153">The storage solution is shared only by nodes within the FCI and not between replicas of the availability group.</span></span>|  
|<span data-ttu-id="6568e-154">**儲存方案**</span><span class="sxs-lookup"><span data-stu-id="6568e-154">**Storage solutions**</span></span>|<span data-ttu-id="6568e-155">直接附加、SAN、掛接點、SMB</span><span class="sxs-lookup"><span data-stu-id="6568e-155">Direct attached, SAN, mount points, SMB</span></span>|<span data-ttu-id="6568e-156">取決於節點類型</span><span class="sxs-lookup"><span data-stu-id="6568e-156">Depends on node type</span></span>|  
|<span data-ttu-id="6568e-157">**可讀取次要**</span><span class="sxs-lookup"><span data-stu-id="6568e-157">**Readable secondaries**</span></span>|<span data-ttu-id="6568e-158">否\*</span><span class="sxs-lookup"><span data-stu-id="6568e-158">No\*</span></span>|<span data-ttu-id="6568e-159">是</span><span class="sxs-lookup"><span data-stu-id="6568e-159">Yes</span></span>|  
|<span data-ttu-id="6568e-160">**適用的容錯移轉原則設定**</span><span class="sxs-lookup"><span data-stu-id="6568e-160">**Applicable failover policy settings**</span></span>|<span data-ttu-id="6568e-161">WSFC 仲裁</span><span class="sxs-lookup"><span data-stu-id="6568e-161">WSFC quorum</span></span><br /><br /> <span data-ttu-id="6568e-162">FCI 特定</span><span class="sxs-lookup"><span data-stu-id="6568e-162">FCI-specific</span></span><br /><br /> <span data-ttu-id="6568e-163">可用性群組設定\*\*</span><span class="sxs-lookup"><span data-stu-id="6568e-163">Availability group settings\*\*</span></span>|<span data-ttu-id="6568e-164">WSFC 仲裁</span><span class="sxs-lookup"><span data-stu-id="6568e-164">WSFC quorum</span></span><br /><br /> <span data-ttu-id="6568e-165">可用性群組設定</span><span class="sxs-lookup"><span data-stu-id="6568e-165">Availability group settings</span></span>|  
|<span data-ttu-id="6568e-166">**容錯移轉資源**</span><span class="sxs-lookup"><span data-stu-id="6568e-166">**Failed-over resources**</span></span>|<span data-ttu-id="6568e-167">伺服器、執行個體和資料庫</span><span class="sxs-lookup"><span data-stu-id="6568e-167">Server, instance, and database</span></span>|<span data-ttu-id="6568e-168">僅限資料庫</span><span class="sxs-lookup"><span data-stu-id="6568e-168">Database only</span></span>|  
  
 <span data-ttu-id="6568e-169">\*可用性群組中的同步次要複本一律在其各自的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體上執行，而 FCI 中的次要節點實際上尚未啟動其各自的 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體，因此不可讀取。</span><span class="sxs-lookup"><span data-stu-id="6568e-169">\*Whereas synchronous secondary replicas in an availability group are always running on their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances, secondary nodes in an FCI actually have not started their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances and are therefore not readable.</span></span> <span data-ttu-id="6568e-170">在 FCI 中，次要節點只在 FCI 容錯移轉期間資源群組擁有權轉移到它自己時才會啟動其 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 執行個體。</span><span class="sxs-lookup"><span data-stu-id="6568e-170">In an FCI, a secondary node starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance only when the resource group ownership is transferred to it during an FCI failover.</span></span> <span data-ttu-id="6568e-171">不過，在使用中 FCI 節點上，當 FCI 裝載的資料庫屬於可用性群組時，如果本機可用性複本以可讀取的次要複本方式執行，資料庫就是可讀取的。</span><span class="sxs-lookup"><span data-stu-id="6568e-171">However, on the active FCI node, when an FCI-hosted database belongs to an availability group, if the local availability replica is running as a readable secondary replica, the database is readable.</span></span>  
  
 <span data-ttu-id="6568e-172">\*\*可用性群組的容錯移轉原則設定適用於所有複本，無論複本裝載於獨立執行個體或 FCI 執行個體。</span><span class="sxs-lookup"><span data-stu-id="6568e-172">\*\*Failover policy settings for the availability group apply to all replicas, whether it is hosted in a standalone instance or an FCI instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6568e-173">如需容錯移轉叢集內**的節點數目**和不同版本**AlwaysOn 可用性群組**的詳細資訊 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ，請參閱[SQL Server 2012 (版本所支援](https://go.microsoft.com/fwlink/?linkid=232473)的功能 https://go.microsoft.com/fwlink/?linkid=232473) 。</span><span class="sxs-lookup"><span data-stu-id="6568e-173">For more information about **Number of nodes** within Failover Clustering and **AlwaysOn Availability Groups** for different editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) (https://go.microsoft.com/fwlink/?linkid=232473).</span></span>  
  
### <a name="considerations-for-hosting-an-availability-replica-on-an-fci"></a><span data-ttu-id="6568e-174">FCI 裝載可用性複本的考量</span><span class="sxs-lookup"><span data-stu-id="6568e-174">Considerations for hosting an Availability Replica on an FCI</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6568e-175">如果您計劃在 SQL Server 容錯移轉叢集執行個體 (FCI) 裝載可用性複本，請確定 Windows Server 2008 主機節點符合容錯移轉叢集執行個體 (FCI) 的 AlwaysOn 必要條件和限制。</span><span class="sxs-lookup"><span data-stu-id="6568e-175">If you plan to host an availability replica on a SQL Server Failover Cluster Instance (FCI), ensure that the Windows Server 2008 host nodes meet the AlwaysOn prerequisites and restrictions for Failover Cluster Instances (FCIs).</span></span> <span data-ttu-id="6568e-176">如需詳細資訊，請參閱 [AlwaysOn 可用性群組的必要條件、限制和建議 &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)。</span><span class="sxs-lookup"><span data-stu-id="6568e-176">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="6568e-177">容錯移轉叢集執行個體 (FCI) 不支援依照可用性群組進行自動容錯移轉，因此任何由 FCI 裝載的可用性複本只能設定為手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="6568e-177">Failover Cluster Instances (FCIs) do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can only be configured for manual failover.</span></span>  
  
 <span data-ttu-id="6568e-178">您可能需要設定 Windows Server 容錯移轉叢集 (WSFC) 叢集，使其包含並非在所有節點都可使用的共用磁碟。</span><span class="sxs-lookup"><span data-stu-id="6568e-178">You might need to configure a Windows Server Failover Clustering (WSFC) cluster to include shared disks that are not available on all nodes.</span></span> <span data-ttu-id="6568e-179">例如，假設有一個 WSFC 叢集跨兩個資料中心，其共有三個節點。</span><span class="sxs-lookup"><span data-stu-id="6568e-179">For example, consider a WSFC cluster across two data centers with three nodes.</span></span> <span data-ttu-id="6568e-180">在主要資料中心的兩個節點裝載 SQL Server 容錯移轉叢集執行個體 (FCI)，而且可存取相同的共用磁碟。</span><span class="sxs-lookup"><span data-stu-id="6568e-180">Two of the nodes host a SQL Server failover clustering instance (FCI) in the primary data center and have access to the same shared disks.</span></span> <span data-ttu-id="6568e-181">在另一個資料中心，第三個節點裝載 SQL Server 獨立執行個體，而且無法存取主要資料中心的共用磁碟。</span><span class="sxs-lookup"><span data-stu-id="6568e-181">The third node hosts a stand-alone instance of SQL Server in a different data center and does not have access to the shared disks from the primary data center.</span></span> <span data-ttu-id="6568e-182">如果 FCI 裝載主要複本，而且獨立執行個體裝載次要複本，此 WSFC 叢集組態就會支援可用性群組的部署。</span><span class="sxs-lookup"><span data-stu-id="6568e-182">This WSFC cluster configuration supports the deployment of an availability group if the FCI hosts the primary replica and the stand-alone instance hosts the secondary replica.</span></span>  
  
 <span data-ttu-id="6568e-183">當您選擇讓 FCI 裝載給定可用性群組的可用性複本時，請確定 FCI 容錯移轉不會使單一 WSFC 節點嘗試裝載同一個可用性群組的兩個可用性複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-183">When choosing an FCI to host an availability replica for a given availability group, ensure that an FCI failover could not potentially cause a single WSFC node to attempt to host two availability replicas for the same availability group.</span></span>  
  
 <span data-ttu-id="6568e-184">下列範例案例說明這個組態可能會如何導致問題的發生：</span><span class="sxs-lookup"><span data-stu-id="6568e-184">The following example scenario illustrates how this configuration could lead to problems:</span></span>  
  
 <span data-ttu-id="6568e-185">Marcel 設定包含兩個節點 `NODE01` 和 `NODE02`的 WSFC 叢集。</span><span class="sxs-lookup"><span data-stu-id="6568e-185">Marcel configures two a WSFC cluster with two nodes, `NODE01` and `NODE02`.</span></span> <span data-ttu-id="6568e-186">他將 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集執行個體 `fciInstance1`同時安裝在 `NODE01` 和 `NODE02` 上，其中 `NODE01` 是 `fciInstance1`的目前擁有者。</span><span class="sxs-lookup"><span data-stu-id="6568e-186">He installs a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance, `fciInstance1`, on both `NODE01` and `NODE02` where `NODE01` is the current owner for `fciInstance1`.</span></span>  
 <span data-ttu-id="6568e-187">Marcel 會在 `NODE02`上安裝另一個 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]執行個體 `Instance3`，這是獨立執行個體。</span><span class="sxs-lookup"><span data-stu-id="6568e-187">On `NODE02`, Marcel installs another instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, which is a stand-alone instance.</span></span>  
 <span data-ttu-id="6568e-188">Marcel 在 `NODE01`上讓 fciInstance1 啟用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="6568e-188">On `NODE01`, Marcel enables fciInstance1 for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="6568e-189">他在 `NODE02`上讓 `Instance3` 啟用 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="6568e-189">On `NODE02`, he enables `Instance3` for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="6568e-190">接著他設定可用性群組，由 `fciInstance1` 裝載其主要複本，並由 `Instance3` 裝載其次要複本。</span><span class="sxs-lookup"><span data-stu-id="6568e-190">Then he sets up an availability group for which `fciInstance1` hosts the primary replica, and `Instance3` hosts the secondary replica.</span></span>  
 <span data-ttu-id="6568e-191">在某個時間點， `fciInstance1` 變得無法在 `NODE01`上使用，而且 WSFC 叢集會造成 `fciInstance1` 容錯移轉到 `NODE02`。</span><span class="sxs-lookup"><span data-stu-id="6568e-191">At some point `fciInstance1` becomes unavailable on `NODE01`, and the WSFC cluster causes a failover of `fciInstance1` to `NODE02`.</span></span> <span data-ttu-id="6568e-192">在容錯移轉之後， `fciInstance1` 就是具有 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]功能的執行個體，於 `NODE02`的主要角色之下執行。</span><span class="sxs-lookup"><span data-stu-id="6568e-192">After the failover, `fciInstance1` is a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]-enabled instance running under the primary role on `NODE02`.</span></span> <span data-ttu-id="6568e-193">但是， `Instance3` 現在位於與 `fciInstance1`相同的 WSFC 節點上。</span><span class="sxs-lookup"><span data-stu-id="6568e-193">However, `Instance3` now resides on the same WSFC node as `fciInstance1`.</span></span> <span data-ttu-id="6568e-194">這樣會違反 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 條件約束。</span><span class="sxs-lookup"><span data-stu-id="6568e-194">This violates the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] constraint.</span></span>  
 <span data-ttu-id="6568e-195">若要更正此案例所呈現的問題，獨立執行個體 `Instance3`必須位於與 `NODE01` 和 `NODE02`相同的 WSFC 叢集內的另一個節點上。</span><span class="sxs-lookup"><span data-stu-id="6568e-195">To correct the problem that this scenario presents, the stand-alone instance, `Instance3`, must reside on another node in the same WSFC cluster as `NODE01` and `NODE02`.</span></span>  
  
 <span data-ttu-id="6568e-196">如需 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 容錯移轉叢集的詳細資訊，請參閱 [AlwaysOn 容錯移轉叢集執行個體 &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="6568e-196">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering, see [AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
##  <a name="restrictions-on-using-the-wsfc-failover-cluster-manager-with-availability-groups"></a><a name="FCMrestrictions"></a><span data-ttu-id="6568e-197">搭配可用性群組使用 WSFC 容錯移轉叢集管理員的限制</span><span class="sxs-lookup"><span data-stu-id="6568e-197">Restrictions on Using The WSFC Failover Cluster Manager with Availability Groups</span></span>  
 <span data-ttu-id="6568e-198">不要使用容錯移轉叢集管理員操作可用性群組，例如：</span><span class="sxs-lookup"><span data-stu-id="6568e-198">Do not use the Failover Cluster Manager to manipulate availability groups, for example:</span></span>  
  
-   <span data-ttu-id="6568e-199">請勿在可用性群組的叢集服務 (資源群組) 中加入或移除資源。</span><span class="sxs-lookup"><span data-stu-id="6568e-199">Do not add or remove resources in the clustered service (resource group) for the availability group.</span></span>  
  
-   <span data-ttu-id="6568e-200">請勿變更任何可用性群組屬性，例如可能的擁有者和慣用擁有者。</span><span class="sxs-lookup"><span data-stu-id="6568e-200">Do not change any availability group properties, such as the possible owners and preferred owners.</span></span> <span data-ttu-id="6568e-201">可用性群組會自動設定這些屬性。</span><span class="sxs-lookup"><span data-stu-id="6568e-201">These properties are set automatically by the availability group.</span></span>  
  
-   <span data-ttu-id="6568e-202">請勿使用容錯移轉叢集管理員來將可用性群組移到不同的節點或容錯移轉可用性群組。</span><span class="sxs-lookup"><span data-stu-id="6568e-202">Do not use the Failover Cluster Manager to move availability groups to different nodes or to fail over availability groups.</span></span> <span data-ttu-id="6568e-203">容錯移轉叢集管理員不會察覺可用性複本的同步處理狀態，而且這樣做可能會造成停機時間延長。</span><span class="sxs-lookup"><span data-stu-id="6568e-203">The Failover Cluster Manager is not aware of the synchronization status of the availability replicas, and doing so can lead to extended downtime.</span></span> <span data-ttu-id="6568e-204">您必須使用 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 或 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="6568e-204">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="6568e-205">相關內容</span><span class="sxs-lookup"><span data-stu-id="6568e-205">Related Content</span></span>  
  
-   <span data-ttu-id="6568e-206">**部落格：**</span><span class="sxs-lookup"><span data-stu-id="6568e-206">**Blogs:**</span></span>  
  
     [<span data-ttu-id="6568e-207">以有限安全性設定 SQL Server 的 Windows 容錯移轉叢集 (可用性群組或 FCI)</span><span class="sxs-lookup"><span data-stu-id="6568e-207">Configure Windows Failover Clustering for SQL Server (Availability Group or FCI) with Limited Security</span></span>](https://blogs.msdn.com/b/sqlalwayson/archive/2012/06/05/configure-windows-failover-clustering-for-sql-server-availability-group-or-fci-with-limited-security.aspx)  
  
     [<span data-ttu-id="6568e-208">SQL Server AlwaysOn 團隊部落格：官方 SQL Server AlwaysOn 團隊部落格</span><span class="sxs-lookup"><span data-stu-id="6568e-208">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="6568e-209">CSS SQL Server 工程師部落格</span><span class="sxs-lookup"><span data-stu-id="6568e-209">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="6568e-210">**白皮書：**</span><span class="sxs-lookup"><span data-stu-id="6568e-210">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="6568e-211">AlwaysOn 架構指南：使用容錯移轉叢集執行個體和可用性群組，建立高可用性和災害復原方案</span><span class="sxs-lookup"><span data-stu-id="6568e-211">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://msdn.microsoft.com/library/jj215886.aspx)  
  
     [<span data-ttu-id="6568e-212">Microsoft SQL Server AlwaysOn 高可用性和災害復原方案指南</span><span class="sxs-lookup"><span data-stu-id="6568e-212">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="6568e-213">Microsoft 的 SQL Server 2012 白皮書</span><span class="sxs-lookup"><span data-stu-id="6568e-213">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="6568e-214">SQL Server 客戶諮詢團隊白皮書</span><span class="sxs-lookup"><span data-stu-id="6568e-214">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="6568e-215">另請參閱</span><span class="sxs-lookup"><span data-stu-id="6568e-215">See Also</span></span>  
 <span data-ttu-id="6568e-216">[AlwaysOn 可用性群組 &#40;SQL Server 的總覽&#41;](overview-of-always-on-availability-groups-sql-server.md) [啟用和停用 AlwaysOn 可用性群組](enable-and-disable-always-on-availability-groups-sql-server.md)&#40;SQL Server[監視可用性群組&#41;transact-sql &#40;](monitor-availability-groups-transact-sql.md)</span><span class="sxs-lookup"><span data-stu-id="6568e-216">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md) [Monitor Availability Groups &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span></span>  
 [<span data-ttu-id="6568e-217">AlwaysOn 容錯移轉叢集實例 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6568e-217">AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
