---
title: SQL Server 受管理的備份至 Azure：互通性與共存 |Microsoft Docs
description: 本文說明 SQL Server 的受控備份，以 Microsoft Azure SQL Server 2014 中的數項功能進行互通性和共存。
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 78fb78ed-653f-45fe-a02a-a66519bfee1b
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 2e2839fc4755fe47504e42e5058a5da117888900
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701527"
---
# <a name="sql-server-managed-backup-to-azure-interoperability-and-coexistence"></a><span data-ttu-id="4b70b-103">SQL Server Managed Backup 到 Azure：互通性與共存性</span><span class="sxs-lookup"><span data-stu-id="4b70b-103">SQL Server Managed Backup to Azure: Interoperability and Coexistence</span></span>
  <span data-ttu-id="4b70b-104">本主題說明[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]與 [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] 中之數項功能的互通性與並存性。</span><span class="sxs-lookup"><span data-stu-id="4b70b-104">This topic describes [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] interoperability and coexistence with several features in [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="4b70b-105">這些功能包括：AlwaysOn 可用性群組、資料庫鏡像、備份維護計劃、記錄傳送、隨選備份、卸離資料庫及卸除資料庫。</span><span class="sxs-lookup"><span data-stu-id="4b70b-105">These features include the following: AlwaysOn Availability Groups, Database Mirroring, Backup Maintenance Plans, Log Shipping, Ad hoc backups, Detach Database, and Drop Database.</span></span>  
  
### <a name="alwayson-availability-groups"></a><span data-ttu-id="4b70b-106">AlwaysOn 可用性群組</span><span class="sxs-lookup"><span data-stu-id="4b70b-106">AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="4b70b-107">設定為僅支援 Azure 解決方案的 AlwaysOn 可用性群組 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="4b70b-107">AlwaysOn Availability Groups that are configured as an Azure-only solution supported for [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="4b70b-108">僅限內部部署或混合式 AlwaysOn 可用性群組組態皆不予支援。</span><span class="sxs-lookup"><span data-stu-id="4b70b-108">On-premises only, or Hybrid AlwaysOn Availability Group configurations are not supported.</span></span> <span data-ttu-id="4b70b-109">如需詳細資訊和其他考慮，請參閱[針對可用性群組設定 SQL Server 受管理的備份至 Azure](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span><span class="sxs-lookup"><span data-stu-id="4b70b-109">For more information and other considerations, see [Setting up SQL Server Managed Backup to Azure for Availability Groups](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span></span>  
  
### <a name="database-mirroring"></a><span data-ttu-id="4b70b-110">資料庫鏡像</span><span class="sxs-lookup"><span data-stu-id="4b70b-110">Database Mirroring</span></span>  
 <span data-ttu-id="4b70b-111">只有主體資料庫才支援[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4b70b-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is supported only on the principal database.</span></span> <span data-ttu-id="4b70b-112">若主體與鏡像皆設定成使用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]，將會略過鏡像資料庫不予備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-112">If both the principal and the mirror are configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], the mirrored database is skipped and will not be backed up.</span></span> <span data-ttu-id="4b70b-113">但在容錯移轉事件時，[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]會在鏡像完成角色切換並上線之後，開始執行備份程序。</span><span class="sxs-lookup"><span data-stu-id="4b70b-113">However, in the event of a failover, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will start the backup process after the mirror has completed role switching and is online.</span></span> <span data-ttu-id="4b70b-114">在此情況下，備份會儲存在新容器中。</span><span class="sxs-lookup"><span data-stu-id="4b70b-114">The backups will be stored in a new container in this case.</span></span> <span data-ttu-id="4b70b-115">在容錯移轉事件時，若未將鏡像設定成使用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]，便不會執行備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-115">If the mirror is not configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], in the event of a failover, no backups are taken.</span></span> <span data-ttu-id="4b70b-116">建議將主體及鏡像均設為使用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]，如此一來在容錯移轉事件時，才能執行備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-116">We recommend that you configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] on both the principal and the mirror so backups continue in the event of a failover.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="4b70b-117">如果您想要在使用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]預設設定的執行個體上建立鏡像資料庫，建議停用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]執行個體的預設值，使其不會套用到鏡像資料庫，待完成主體與鏡像資料庫的設定之後，再重新啟用執行個體的預設值。</span><span class="sxs-lookup"><span data-stu-id="4b70b-117">If you are creating a mirrored database on an instance with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] default settings, it may be preferable to disable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] instance defaults, so they are not applied to the mirrored database, and then re-enable the instance defaults after configuring the Principal and the Mirror.</span></span>  
  
### <a name="maintenance-plan"></a><span data-ttu-id="4b70b-118">維護計劃</span><span class="sxs-lookup"><span data-stu-id="4b70b-118">Maintenance Plan</span></span>  
 <span data-ttu-id="4b70b-119">不支援在啟用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]時，使用維護計劃建立資料庫備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-119">Using Maintenance Plans for creating backups for a database when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled is not supported.</span></span> <span data-ttu-id="4b70b-120">維護計劃會導致記錄鏈結中斷，且[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]可能無法確保還原期間的資料庫復原能力。</span><span class="sxs-lookup"><span data-stu-id="4b70b-120">Maintenance plans will cause broken log chain and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] may not be able to support a guaranteed recoverability of the database during restore.</span></span> <span data-ttu-id="4b70b-121">若已在執行個體層級啟用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]，也同樣適用此規則。</span><span class="sxs-lookup"><span data-stu-id="4b70b-121">This also applies when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled at the instance level.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="4b70b-122">相同資料庫或執行個體所設定的[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]可支援只複製備份的維護計畫。</span><span class="sxs-lookup"><span data-stu-id="4b70b-122">Maintenance Plans with Copy Only backups is supported with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configured for the same database or instance.</span></span>  
  
### <a name="log-shipping"></a><span data-ttu-id="4b70b-123">記錄傳送</span><span class="sxs-lookup"><span data-stu-id="4b70b-123">Log Shipping</span></span>  
 <span data-ttu-id="4b70b-124">您無法針對相同的資料庫，同時設定記錄傳送和[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4b70b-124">You cannot configure Log Shipping and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database at the same time.</span></span> <span data-ttu-id="4b70b-125">這樣做會影響使用任一功能的資料庫復原能力。</span><span class="sxs-lookup"><span data-stu-id="4b70b-125">Doing so will affect the recoverability of the database using either functionality.</span></span>  
  
### <a name="ad-hoc-backups-using-transact-sql-and-sql-server-management-studio"></a><span data-ttu-id="4b70b-126">使用 Transact-SQL 和 SQL Server Management Studio 的隨選備份</span><span class="sxs-lookup"><span data-stu-id="4b70b-126">Ad Hoc Backups Using Transact-SQL and SQL Server Management Studio</span></span>  
 <span data-ttu-id="4b70b-127">根據使用的備份和儲存媒體類型，使用 Transact-SQL 或 SQL Server Management Studio 在[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]之外建立臨選或一次性備份會影響[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]程序。</span><span class="sxs-lookup"><span data-stu-id="4b70b-127">Ad hoc or one time backups created outside [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] using Transact-SQL or SQL Server Management Studio may affect the [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process depending on the type of backup and the storage media used.</span></span> <span data-ttu-id="4b70b-128">記錄備份到不同的 Azure 儲存體帳戶，而 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 不是使用或 Azure Blob 儲存體服務的任何其他目的地，將導致記錄鏈中斷。</span><span class="sxs-lookup"><span data-stu-id="4b70b-128">Log backups to a different Azure storage account than what [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is using, or any other destination than the Azure Blob storage service, will cause a log chain break.</span></span> <span data-ttu-id="4b70b-129">建議您使用[smart_admin. sp_backup_on_demand &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql)預存程式，在已啟用的資料庫上起始備份 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="4b70b-129">We recommend that you use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure to initiate a backup on databases that have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled.</span></span> <span data-ttu-id="4b70b-130">您可以使用此預存程序起始完整的資料庫備份或記錄備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-130">You can initiate either a full database or log backup using this stored procedure.</span></span>  
  
### <a name="drop-database-and-detach-database"></a><span data-ttu-id="4b70b-131">卸除資料庫和卸離資料庫</span><span class="sxs-lookup"><span data-stu-id="4b70b-131">Drop Database and Detach Database</span></span>  
 <span data-ttu-id="4b70b-132">如果啟用[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]的資料庫遭到卸離或卸除，雖然無法進行其他備份，但是先前的備份會保留在儲存體中，直到保留期限到期為止，之後會清除備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-132">If a database that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled is detached or dropped, although no additional backups are possible, the previous backups remain in the storage until the retention period has elapsed, at which point the backups will be purged.</span></span>  
  
### <a name="changes-to-recovery-model"></a><span data-ttu-id="4b70b-133">復原模式的變更</span><span class="sxs-lookup"><span data-stu-id="4b70b-133">Changes to Recovery Model</span></span>  
  
-   <span data-ttu-id="4b70b-134">如果您將資料庫的復原模式從 [**簡單**] 變更為 [**完整**] 或 [**大量記錄**]，您可以選擇 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 為資料庫設定。</span><span class="sxs-lookup"><span data-stu-id="4b70b-134">If you change the recovery model of a database from **Simple** to **Full** or **Bulk-Logged**, you have the option of configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the database.</span></span> <span data-ttu-id="4b70b-135">從[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]的觀點來看，這就像是新資料庫一樣。</span><span class="sxs-lookup"><span data-stu-id="4b70b-135">This will be considered like a new database from [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] perspective.</span></span>  
  
-   <span data-ttu-id="4b70b-136">如果您將資料庫的復原模式從 [**完整**] 或 [**大量記錄**] 變更為 [**簡單**] （已 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 啟用），則不會再排程備份作業。</span><span class="sxs-lookup"><span data-stu-id="4b70b-136">If you change the recovery model of a database from **Full** or **Bulk-Logged** to **Simple**, that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled, backup operations will no longer be scheduled.</span></span> <span data-ttu-id="4b70b-137">保留週期設定仍然有效，而且備份檔案會保留在儲存體帳戶中，直到保留週期到期為止。</span><span class="sxs-lookup"><span data-stu-id="4b70b-137">The retention period setting will still be active and backup files will remain in the storage account until the retention period has elapsed.</span></span> <span data-ttu-id="4b70b-138">如果您想保留備份，建議您將檔案下載至不同的儲存體帳戶或內部部署的位置。</span><span class="sxs-lookup"><span data-stu-id="4b70b-138">If you want to retain the backups, we recommend that you download the files either to a different storage account or to an on-premises location.</span></span> <span data-ttu-id="4b70b-139">這些設定會保留下來，如果復原模式設定回**完整**或**大量記錄**，則可以重複使用。</span><span class="sxs-lookup"><span data-stu-id="4b70b-139">The configuration settings are retained and can be reused if the recovery model is set back to **Full** or **Bulk-Logged** again.</span></span>  
  
### <a name="log-backups-using-other-backup-tools-or-custom-scripts"></a><span data-ttu-id="4b70b-140">使用其他備份工具或自訂指令碼的記錄備份</span><span class="sxs-lookup"><span data-stu-id="4b70b-140">Log Backups Using Other Backup Tools or Custom Scripts</span></span>  
 <span data-ttu-id="4b70b-141">設定為在相同資料庫上執行記錄備份的任何兩個備份將會導致備份記錄鏈結中斷。</span><span class="sxs-lookup"><span data-stu-id="4b70b-141">Any two backups that are configured to perform log backups on the same database will cause break in the backup log chain.</span></span> <span data-ttu-id="4b70b-142">雖然 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 在偵測到鏈結中斷時會嘗試排程完整備份來修復備份鏈結中的中斷，但這就表示會繼續定期中斷及兩個競爭工具所執行的記錄備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-142">Although [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will attempt to remedy the break in the backup chain by scheduling full backups when a break in chain is detected, this means keeping up continuously with periodic breaks and log backups performed by two competing tools.</span></span> <span data-ttu-id="4b70b-143">這樣也可能會影響資料庫的復原能力，因為無法預期任何工具必須擁有循序的完整備份組。</span><span class="sxs-lookup"><span data-stu-id="4b70b-143">This can also potentially affect the recoverability of the database since no one tool can be expected to have a full set of backup in sequence.</span></span> <span data-ttu-id="4b70b-144">雖然這適用於任何兩項功能或執行記錄備份的工具，但是對於執行特定範例 (如以下所述) 也很實用。</span><span class="sxs-lookup"><span data-stu-id="4b70b-144">Although this applies to any two features or tools performing log backups,, it is useful to call out specific examples as described below.</span></span> <span data-ttu-id="4b70b-145">這也是設定維護計畫或記錄傳送之相關問題的根本，如本主題的稍早章節所述。</span><span class="sxs-lookup"><span data-stu-id="4b70b-145">This is also the basis for the issues with configuring maintenance plans or log shipping as described in earlier sections of this topic.</span></span>  
  
 <span data-ttu-id="4b70b-146">**Data Protection Manager (DPM) 為基礎的備份：** Microsoft Data Protection Manager 可讓您執行完整和增量備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-146">**Data Protection Manager (DPM) based backups:** Microsoft Data Protection Manager allows you to do full and incremental backups.</span></span> <span data-ttu-id="4b70b-147">累加備份是指在建立 T 記錄備份之後執行記錄截斷的記錄備份。</span><span class="sxs-lookup"><span data-stu-id="4b70b-147">The incremental backups are log backups that do perform a log truncation after creating a T-log backup.</span></span> <span data-ttu-id="4b70b-148">因此不支援針對相同資料庫設定 DPM 和[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4b70b-148">So configuring both DPM and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database is not supported.</span></span>  
  
 <span data-ttu-id="4b70b-149">**協力廠商工具或腳本：** 執行記錄備份而造成記錄截斷的任何協力廠商工具或腳本，與不相容 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] ，而且也不受支援。</span><span class="sxs-lookup"><span data-stu-id="4b70b-149">**Third Party Tools or Scripts:** Any third party tool or scripts that perform log backups causing log truncation is incompatible with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], and is not supported.</span></span>  
  
 <span data-ttu-id="4b70b-150">如果您已 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 針對資料庫實例啟用，而且想要進行臨機操作備份，您可以使用[smart_admin。 Sp_backup_on_demand &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql)預存程式，如先前章節中所述。</span><span class="sxs-lookup"><span data-stu-id="4b70b-150">If you have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled for a database instance, and you want to take an ad hoc backup you can either use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure as described in the earlier section.</span></span> <span data-ttu-id="4b70b-151">如果您在[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]之外也需要定期排程或執行備份，您可以使用 [只複製備份]。</span><span class="sxs-lookup"><span data-stu-id="4b70b-151">If you also have a need to schedule or un backups periodically outside of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], you can use the Copy Only Backup.</span></span>  <span data-ttu-id="4b70b-152">如需詳細資訊，請參閱[只複製備份 &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="4b70b-152">For more information, see [Copy-Only Backups &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span></span>  
  
  
