---
title: affinity Input-Output mask 伺服器組態選項 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- affinity I/O mask option
- processor affinity [SQL Server]
- binding processors [SQL Server]
- CPU affinity mask option
ms.assetid: 9950a8c9-9fe0-4003-95df-6f0d1becb0e7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3d0606e2a3f5480b27e27a4a585562f4b289b640
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/04/2020
ms.locfileid: "87584728"
---
# <a name="affinity-input-output-mask-server-configuration-option"></a><span data-ttu-id="fd73f-102">affinity Input-Output mask 伺服器組態選項</span><span class="sxs-lookup"><span data-stu-id="fd73f-102">affinity Input-Output mask Server Configuration Option</span></span>
  <span data-ttu-id="fd73f-103">為了完成多工作業， [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 2000 與 Windows Server 2003 有時會在不同的處理器之間移動處理序執行緒。</span><span class="sxs-lookup"><span data-stu-id="fd73f-103">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 2000 and Windows Server 2003 sometimes move process threads among different processors.</span></span> <span data-ttu-id="fd73f-104">雖然從作業系統的觀點來看很有效率，但是在繁重的系統負載下，這項活動可能會降低 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 的效能，因為每個處理器快取會重複重新載入資料。</span><span class="sxs-lookup"><span data-stu-id="fd73f-104">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="fd73f-105">將處理器指派給特定的執行緒，可藉由去除處理器的重新載入，而在這些狀況下增進效能；執行緒與處理器之間的這種關聯，稱為處理器相似性。</span><span class="sxs-lookup"><span data-stu-id="fd73f-105">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads; such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fd73f-106">透過兩個相似性遮罩選項支援處理器相似性： **affinity mask** (也稱為 **CPU affinity mask**) 與 **affinity I/O mask**。</span><span class="sxs-lookup"><span data-stu-id="fd73f-106">supports processor affinity by means of two affinity mask options: **affinity mask** (also known as **CPU affinity mask**) and **affinity I/O mask**.</span></span> <span data-ttu-id="fd73f-107">如需 **affinity mask** 選項的詳細資訊，請參閱 [affinity mask 伺服器組態選項](affinity-mask-server-configuration-option.md)。</span><span class="sxs-lookup"><span data-stu-id="fd73f-107">For more information on the **affinity mask** option, see [affinity mask Server Configuration Option](affinity-mask-server-configuration-option.md).</span></span> <span data-ttu-id="fd73f-108">擁有 33 到 64 個處理器的 CPU 與 I/O 相似性支援需要分別另外使用 [affinity64 mask 伺服器組態選項](affinity64-mask-server-configuration-option.md) 與 [affinity64 Input-Output mask 伺服器組態選項](affinity64-input-output-mask-server-configuration-option.md) 。</span><span class="sxs-lookup"><span data-stu-id="fd73f-108">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md) respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="fd73f-109">擁有 33 到 64 個處理器之伺服器的相似性支援只能在 64 位元的作業系統上使用。</span><span class="sxs-lookup"><span data-stu-id="fd73f-109">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="fd73f-110">**affinity I/O mask** 選項會將 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 磁碟 I/O 繫結到指定的 CPU 子集。</span><span class="sxs-lookup"><span data-stu-id="fd73f-110">The **affinity I/O mask** option binds [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O to a specified subset of CPUs.</span></span> <span data-ttu-id="fd73f-111">在高階的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 線上交易處理 (OLTP) 環境中，此延伸模組可強化 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行緒發行 I/O 的效能。</span><span class="sxs-lookup"><span data-stu-id="fd73f-111">In high-end [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] online transactional processing (OLTP) environments, this extension can enhance the performance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads issuing I/Os.</span></span> <span data-ttu-id="fd73f-112">這項增強功能並不支援個別磁碟或磁碟控制器的硬體相似性。</span><span class="sxs-lookup"><span data-stu-id="fd73f-112">This enhancement does not support hardware affinity for individual disks or disk controllers.</span></span>  
  
 <span data-ttu-id="fd73f-113">**affinity I/O mask** 的值可指定在多處理器的電腦中，有哪些 CPU 適合處理 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 磁碟 I/O 作業。</span><span class="sxs-lookup"><span data-stu-id="fd73f-113">The value for **affinity I/O mask** specifies which CPUs in a multiprocessor computer are eligible to process [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations.</span></span> <span data-ttu-id="fd73f-114">遮罩是一種點陣圖，其中最右邊的位元會指定最低順位 CPU(0)，緊鄰其左側的位元則指定次低順位 CPU(1)，依此類推。</span><span class="sxs-lookup"><span data-stu-id="fd73f-114">The mask is a bitmap in which the rightmost bit specifies the lowest-order CPU(0), the bit to its immediate left specifies the next-lowest-order CPU(1), and so on.</span></span> <span data-ttu-id="fd73f-115">若要設定 32 個以上的處理器，請同時設定 **affinity I/O mask** 與 **affinity64 I/O mask**。</span><span class="sxs-lookup"><span data-stu-id="fd73f-115">To configure more than 32 processors, set both the **affinity I/O mask** and the **affinity64 I/O mask**.</span></span>  
  
 <span data-ttu-id="fd73f-116">**affinity I/O mask** 的值如下所示：</span><span class="sxs-lookup"><span data-stu-id="fd73f-116">The values for **affinity I/O mask** are as follows:</span></span>  
  
-   <span data-ttu-id="fd73f-117">在多處理器的電腦中，1 位元組的 **affinity I/O mask** 最多可涵蓋 8 個 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-117">A 1-byte **affinity I/O mask** covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="fd73f-118">在多處理器的電腦中，2 位元組的 **affinity I/O mask** 最多可涵蓋 16 個 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-118">A 2-byte **affinity I/O mask** covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="fd73f-119">在多處理器的電腦中，3 位元組的 **affinity I/O mask** 最多可涵蓋 24 個 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-119">A 3-byte **affinity I/O mask** covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="fd73f-120">在多處理器的電腦中，4 位元組的 **affinity I/O mask** 最多可涵蓋 32 個 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-120">A 4-byte **affinity I/O mask** covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="fd73f-121">若要處理 32 個以上的 CPU，請針對前 32 個 CPU 設定一個 4 位元組的 **affinity I/O mask** ，並針對剩餘的 CPU 設定最多 4 位元組的 **affinity64 I/O mask** 。</span><span class="sxs-lookup"><span data-stu-id="fd73f-121">To cover more than 32 CPUs, configure a four-byte **affinity I/O mask** for the first 32 CPUs and up to a four-byte **affinity64 I/O mask** for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="fd73f-122">相似性 I/O 模式中的 1 位元，會指定對應的 CPU 適合執行 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 磁碟 I/O 作業；0 位元則指定不要為對應的 CPU 排程任何 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 磁碟 I/O 作業。</span><span class="sxs-lookup"><span data-stu-id="fd73f-122">A 1 bit in the affinity I/O pattern specifies that the corresponding CPU is eligible to perform [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations; a 0 bit specifies that no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations should be scheduled for the corresponding CPU.</span></span> <span data-ttu-id="fd73f-123">若所有的位元都設為零，或未指定 **affinity I/O mask** ， [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 磁碟 I/O 會排程給所有適合處理 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行緒的 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-123">When all bits are set to zero, or **affinity I/O mask** is not specified, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O is scheduled to any of the CPUs eligible to process [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads.</span></span>  
  
 <span data-ttu-id="fd73f-124">因為設定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **affinity I/O mask** 選項是專門的作業，因此只有在必要時才使用。</span><span class="sxs-lookup"><span data-stu-id="fd73f-124">Because setting the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **affinity I/O mask** option is a specialized operation, it should be used only when necessary.</span></span> <span data-ttu-id="fd73f-125">在大部分情況下，Windows 2000 或 Windows Server 2003 的預設相似性都能提供最佳效能。</span><span class="sxs-lookup"><span data-stu-id="fd73f-125">In most cases, the Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span>  
  
 <span data-ttu-id="fd73f-126">在指定 **affinity I/O mask** 選項時，您必須搭配使用 **affinity mask** 組態選項。</span><span class="sxs-lookup"><span data-stu-id="fd73f-126">When specifying the **affinity I/O mask** option, you must use it with the **affinity mask** configuration option.</span></span> <span data-ttu-id="fd73f-127">請勿同時在 **affinity I/O mask** 參數與 **affinity mask** 選項中啟用相同的 CPU。</span><span class="sxs-lookup"><span data-stu-id="fd73f-127">Do not enable the same CPU in both the **affinity I/O mask** switch and the **affinity mask** option.</span></span> <span data-ttu-id="fd73f-128">對應到每個 CPU 的位元，應屬於下列三種情況之一：</span><span class="sxs-lookup"><span data-stu-id="fd73f-128">The bits corresponding to each CPU should be in one of the following three states:</span></span>  
  
-   <span data-ttu-id="fd73f-129">在 **affinity I/O mask** 選項與 **affinity mask** 選項中皆為 0。</span><span class="sxs-lookup"><span data-stu-id="fd73f-129">0 in both the **affinity I/O mask** option and the **affinity mask** option.</span></span>  
  
-   <span data-ttu-id="fd73f-130">在 **affinity I/O mask** 選項中為 1，而在 **affinity mask** 選項中為 0。</span><span class="sxs-lookup"><span data-stu-id="fd73f-130">1 in the **affinity I/O mask** option and 0 in the **affinity mask** option.</span></span>  
  
-   <span data-ttu-id="fd73f-131">在 **affinity I/O mask** 選項中為 0，而在 **affinity mask** 選項中為 1。</span><span class="sxs-lookup"><span data-stu-id="fd73f-131">0 in the **affinity I/O mask** option and 1 in the **affinity mask** option.</span></span>  
  
 <span data-ttu-id="fd73f-132">**affinity I/O mask** 屬於進階選項。</span><span class="sxs-lookup"><span data-stu-id="fd73f-132">The **affinity I/O mask** option is an advanced option.</span></span> <span data-ttu-id="fd73f-133">如果您要使用 `sp_configure` 系統預存程式來變更此設定，只有當**show advanced options**設為1時，才能變更**相似性 i/o mask** 。</span><span class="sxs-lookup"><span data-stu-id="fd73f-133">If you are using the `sp_configure` system stored procedure to change the setting, you can change **affinity I/O mask** only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="fd73f-134">在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中，重新設定 **affinity I/O mask** 選項需要重新啟動 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體。</span><span class="sxs-lookup"><span data-stu-id="fd73f-134">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], reconfiguring the **affinity I/O mask** option requires a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="fd73f-135">不要在 Windows 作業系統中設定 CPU 相似性，然後又在 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]中設定相似性遮罩。</span><span class="sxs-lookup"><span data-stu-id="fd73f-135">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="fd73f-136">這些設定嘗試達到相同的結果，如果組態不一致，可能會有無法預期的結果。</span><span class="sxs-lookup"><span data-stu-id="fd73f-136">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> <span data-ttu-id="fd73f-137">設定 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] CPU 相似性時，最好使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 中的 `sp_configure` 選項。</span><span class="sxs-lookup"><span data-stu-id="fd73f-137">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] CPU affinity is best configured using the `sp_configure` option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fd73f-138">另請參閱</span><span class="sxs-lookup"><span data-stu-id="fd73f-138">See Also</span></span>  
 <span data-ttu-id="fd73f-139">[監視資源使用量 &#40;系統監視器&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="fd73f-139">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="fd73f-140">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="fd73f-140">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="fd73f-141">[伺服器組態選項 &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="fd73f-141">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 [<span data-ttu-id="fd73f-142">sp_configure &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fd73f-142">sp_configure &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql)  
  
  
